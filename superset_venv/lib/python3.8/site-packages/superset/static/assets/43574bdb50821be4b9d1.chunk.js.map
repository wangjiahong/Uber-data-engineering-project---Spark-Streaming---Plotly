{"version":3,"file":"43574bdb50821be4b9d1.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/Graph/EchartsGraph.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { BinaryQueryObjectFilterClause } from '@superset-ui/core';\nimport { EventHandlers } from '../types';\nimport Echart from '../components/Echart';\nimport { GraphChartTransformedProps } from './types';\n\ntype Event = {\n  name: string;\n  event: { stop: () => void; event: PointerEvent };\n  data: { source: string; target: string };\n};\n\nexport default function EchartsGraph({\n  height,\n  width,\n  echartOptions,\n  formData,\n  onContextMenu,\n  refs,\n}: GraphChartTransformedProps) {\n  const eventHandlers: EventHandlers = {\n    contextmenu: (e: Event) => {\n      if (onContextMenu) {\n        e.event.stop();\n        const pointerEvent = e.event.event;\n        const data = (echartOptions as any).series[0].data as {\n          id: string;\n          name: string;\n        }[];\n        const sourceValue = data.find(item => item.id === e.data.source)?.name;\n        const targetValue = data.find(item => item.id === e.data.target)?.name;\n        if (sourceValue && targetValue) {\n          const filters: BinaryQueryObjectFilterClause[] = [\n            {\n              col: formData.source,\n              op: '==',\n              val: sourceValue,\n              formattedVal: sourceValue,\n            },\n            {\n              col: formData.target,\n              op: '==',\n              val: targetValue,\n              formattedVal: targetValue,\n            },\n          ];\n          onContextMenu(pointerEvent.clientX, pointerEvent.clientY, filters);\n        }\n      }\n    },\n  };\n  return (\n    <Echart\n      refs={refs}\n      height={height}\n      width={width}\n      echartOptions={echartOptions}\n      eventHandlers={eventHandlers}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["EchartsGraph","height","width","echartOptions","formData","onContextMenu","refs","eventHandlers","contextmenu","e","event","stop","pointerEvent","data","series","sourceValue","find","item","id","source","name","targetValue","target","filters","col","op","val","formattedVal","clientX","clientY","Styles","styled","Echart","ref","zrEventHandlers","selectedValues","divRef","useRef","chartRef","currentSelection","useMemo","Object","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","init","entries","forEach","handler","off","on","getZr","setOption","dispatchAction","type","dataIndex","filter","value","length","handleSizeChange","useCallback","resize","dispose","useLayoutEffect","forwardRef"],"sourceRoot":""}
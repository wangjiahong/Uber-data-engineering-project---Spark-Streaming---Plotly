{"version":3,"file":"7243.eb13a437224caf9ae59a.entry.js","mappings":"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","sources":["webpack://superset/./src/components/Chart/chartAction.js","webpack://superset/./src/components/ErrorBoundary/index.jsx","webpack://superset/./src/dashboard/actions/dashboardFilters.js","webpack://superset/./src/dashboard/actions/dashboardLayout.js","webpack://superset/./src/dashboard/util/dropOverflowsParent.js","webpack://superset/./src/dashboard/util/isInDifferentFilterScopes.js","webpack://superset/./src/dashboard/util/getOverwriteItems.ts","webpack://superset/./src/dashboard/actions/dashboardState.js","webpack://superset/./src/dashboard/util/serializeFilterScopes.js","webpack://superset/./src/dashboard/util/filterboxMigrationHelper.ts","webpack://superset/./src/dashboard/actions/hydrate.js","webpack://superset/./src/dashboard/util/getEmptyLayout.js","webpack://superset/./src/dashboard/util/findFirstParentContainer.js","webpack://superset/./src/dashboard/actions/sliceEntities.js","webpack://superset/./src/dashboard/reducers/dashboardFilters.js","webpack://superset/./src/dashboard/reducers/sliceEntities.js","webpack://superset/./src/dashboard/util/activeDashboardFilters.js","webpack://superset/./src/dashboard/util/getComponentWidthFromDrop.js","webpack://superset/./src/dashboard/util/getDetailedComponentWidth.js","webpack://superset/./src/dashboard/util/getFilterConfigsFromFormdata.js","webpack://superset/./src/dashboard/util/newComponentFactory.js","webpack://superset/./src/dashboard/util/serializeActiveFilterValues.js","webpack://superset/./src/dashboard/util/updateComponentParentsList.js","webpack://superset/./src/explore/components/controls/CheckboxControl.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilter/index.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterOption/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/adhocFilterType.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterControl/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetric.js","webpack://superset/./src/explore/components/controls/MetricControl/FilterDefinitionOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/adhocMetricType.js","webpack://superset/./src/explore/components/controls/MetricControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/savedMetricType.js","webpack://superset/./src/explore/components/controls/SelectControl.jsx","webpack://superset/./src/explore/components/controls/SpatialControl.jsx","webpack://superset/./src/explore/components/controls/TextAreaControl.jsx","webpack://superset/./src/explore/controls.jsx","webpack://superset/./src/explore/store.js","webpack://superset/./src/modules/AnnotationTypes.js","webpack://superset/./src/reports/actions/reports.js","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/WindowedMenuList.tsx","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/windowed.tsx","webpack://superset/./src/components/DeprecatedSelect/WindowedSelect/index.tsx","webpack://superset/./src/components/DeprecatedSelect/styles.tsx","webpack://superset/./src/components/DeprecatedSelect/DeprecatedSelect.tsx","webpack://superset/./src/components/DeprecatedSelect/utils.ts","webpack://superset/./src/components/DeprecatedSelect/OnPasteSelect.jsx","webpack://superset/./src/components/DeprecatedSelect/NativeSelect.tsx","webpack://superset/./src/visualizations/FilterBox/FilterBox.jsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/CertifiedIconWithTooltip.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_derived.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_boolean.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_abc.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_num.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/ColumnTypeLabel.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/MetricOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/SQLPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/labelUtils.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/constants.ts","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlHeader.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/RadioButtonControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/Select.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/controls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/ControlFormItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/constants.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/dndControls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/mixins.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/sharedControls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/D3Formatting.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/defineSavedMetrics.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/expandControlConfig.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/utils/getStandardizedControls.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/getTemporalColumns.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/selectOptions.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartControlPanelRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/types/Base.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorNamespace.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorScale.ts","webpack://superset/./packages/superset-ui-core/src/color/SharedLabelColorSingleton.ts","webpack://superset/./packages/superset-ui-core/src/color/stringifyAndTrim.ts","webpack://superset/./packages/superset-ui-core/src/color/utils.ts","webpack://superset/./packages/superset-ui-core/src/components/constants.ts","webpack://superset/./packages/superset-ui-core/src/dynamic-plugins/shared-modules.ts","webpack://superset/./packages/superset-ui-core/src/models/TypedRegistry.ts","webpack://superset/./packages/superset-ui-core/src/query/types/AdvancedAnalytics.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Dashboard.ts","webpack://superset/./packages/superset-ui-core/src/query/types/QueryResponse.ts","webpack://superset/./packages/superset-ui-core/src/ui-overrides/ExtensionsRegistry.ts","webpack://superset/./packages/superset-ui-core/src/utils/isEqualArray.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateInteger.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateNumber.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNonEmpty.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNumber.ts","webpack://superset/./src/components/Chart/chartReducer.ts","webpack://superset/./src/components/Checkbox/CheckboxIcons.tsx","webpack://superset/./src/components/Checkbox/Checkbox.tsx","webpack://superset/./src/components/Datasource/ChangeDatasourceModal.tsx","webpack://superset/./src/components/Datasource/DatasourceModal.tsx","webpack://superset/./src/components/DatePicker/index.tsx","webpack://superset/./src/components/DynamicPlugins/index.tsx","webpack://superset/./src/components/FacePile/index.tsx","webpack://superset/./src/components/FacePile/utils.tsx","webpack://superset/./src/components/Popover/index.tsx","webpack://superset/./src/components/PopoverSection/index.tsx","webpack://superset/./src/components/UiConfigContext/index.tsx","webpack://superset/./src/dashboard/actions/dashboardInfo.ts","webpack://superset/./src/dashboard/actions/datasources.ts","webpack://superset/./src/dashboard/actions/nativeFilters.ts","webpack://superset/./src/dashboard/components/nativeFilters/FiltersConfigModal/utils.ts","webpack://superset/./src/dashboard/components/nativeFilters/utils.ts","webpack://superset/./src/dashboard/constants.ts","webpack://superset/./src/dashboard/reducers/nativeFilters.ts","webpack://superset/./src/dashboard/types.ts","webpack://superset/./src/dashboard/util/componentTypes.ts","webpack://superset/./src/dashboard/util/crossFilters.ts","webpack://superset/./src/dashboard/util/extractUrlParams.ts","webpack://superset/./src/dashboard/util/findParentId.ts","webpack://superset/./src/dashboard/util/getChartIdsInFilterScope.ts","webpack://superset/./src/dashboard/util/getDashboardFilterKey.ts","webpack://superset/./src/dashboard/util/getLocationHash.ts","webpack://superset/./src/types/bootstrapTypes.ts","webpack://superset/./src/dashboard/util/permissionUtils.ts","webpack://superset/./src/dataMask/actions.ts","webpack://superset/./src/dataMask/reducer.ts","webpack://superset/./src/explore/actions/hydrateExplore.ts","webpack://superset/./src/explore/components/controls/CustomListItem/index.tsx","webpack://superset/./src/explore/components/controls/AnnotationLayerControl/index.jsx","webpack://superset/./src/explore/components/controls/BoundsControl.tsx","webpack://superset/./src/explore/components/controls/CollectionControl/index.jsx","webpack://superset/./src/explore/components/controls/ColorPickerControl.jsx","webpack://superset/./src/explore/components/controls/ViewQueryModalFooter.tsx","webpack://superset/./src/explore/components/controls/DatasourceControl/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricDefinitionValue.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricsControl.jsx","webpack://superset/./src/explore/components/controls/FixedOrMetricControl/index.jsx","webpack://superset/./src/explore/components/controls/SelectAsyncControl/index.tsx","webpack://superset/./src/components/Slider/index.tsx","webpack://superset/./src/explore/components/controls/TimeSeriesColumnControl/index.jsx","webpack://superset/./src/explore/components/controls/ViewportControl.jsx","webpack://superset/./src/explore/components/controls/VizTypeControl/FastVizSwitcher.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/index.tsx","webpack://superset/./src/components/FormRow/index.jsx","webpack://superset/./src/explore/components/controls/FilterBoxItemControl/index.jsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/types.ts","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopoverContent.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopover.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/ConditionalFormattingControl.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndSelectLabel.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/Option.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/OptionWrapper.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/utils/optionSelector.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopover.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelectPopoverTitle.jsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelect.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndAdhocFilterOption.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndFilterSelect.tsx","webpack://superset/./src/explore/components/DatasourcePanel/types.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndMetricSelect.tsx","webpack://superset/./src/explore/components/controls/index.js","webpack://superset/./src/explore/components/controls/HiddenControl.tsx","webpack://superset/./src/explore/components/controls/SliderControl.tsx","webpack://superset/./src/explore/components/controls/XAxisSortControl.tsx","webpack://superset/./src/explore/components/Control.tsx","webpack://superset/./src/explore/components/ControlHeader.tsx","webpack://superset/./src/explore/components/ControlRow.tsx","webpack://superset/./src/explore/components/DataTableControl/index.tsx","webpack://superset/./src/explore/components/DataTableControl/utils.ts","webpack://superset/./src/explore/components/DndItemType.ts","webpack://superset/./src/explore/components/ExploreContentPopover.tsx","webpack://superset/./src/explore/components/RowCountLabel/index.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/ColorSchemeLabel.tsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/index.tsx","webpack://superset/./src/explore/components/controls/ControlPopover/ControlPopover.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CommonFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CalendarFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CustomFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/DateFunctionTooltip.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/AdvancedFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/DateLabel.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/types.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateFilterUtils.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/constants.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateParser.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/useAdvancedDataTypes.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/useGetTimeRangeLabel.tsx","webpack://superset/./src/explore/components/controls/FilterControl/utils/useDatePickerInAdhocFilter.tsx","webpack://superset/./src/explore/components/controls/OptionControls/index.tsx","webpack://superset/./src/explore/components/controls/TextControl/index.tsx","webpack://superset/./src/explore/components/controls/ViewQuery.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/VizTypeGallery.tsx","webpack://superset/./src/explore/components/optionRenderers.tsx","webpack://superset/./src/explore/controlPanels/sections.tsx","webpack://superset/./src/explore/controlUtils/getSectionsToRender.ts","webpack://superset/./src/explore/controlUtils/getControlConfig.ts","webpack://superset/./src/explore/controlUtils/getControlState.ts","webpack://superset/./src/explore/controlUtils/getFormDataFromControls.ts","webpack://superset/./src/explore/controlUtils/getControlValuesCompatibleWithDatasource.ts","webpack://superset/./src/explore/controlUtils/standardizedFormData.ts","webpack://superset/./src/hooks/useComponentDidUpdate/useComponentDidUpdate.ts","webpack://superset/./src/middleware/asyncEvent.ts","webpack://superset/./src/utils/findPermission.ts","webpack://superset/./src/utils/getDatasourceUid.ts","webpack://superset/./src/utils/textUtils.ts","webpack://superset/./src/utils/urlUtils.ts","webpack://superset/./src/views/CRUD/data/dataset/constants.ts","webpack://superset/./src/views/CRUD/hooks.ts","webpack://superset/./src/views/CRUD/types.ts","webpack://superset/./src/views/CRUD/utils.tsx","webpack://superset/./src/views/CRUD/welcome/types.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-undef: 'error' */\n/* eslint no-param-reassign: [\"error\", { \"props\": false }] */\nimport moment from 'moment';\nimport { t, SupersetClient, isDefined } from '@superset-ui/core';\nimport { getControlsState } from 'src/explore/store';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport {\n  getAnnotationJsonUrl,\n  getExploreUrl,\n  getLegacyEndpointType,\n  buildV1ChartDataPayload,\n  shouldUseLegacyApi,\n  getChartDataUri,\n} from 'src/explore/exploreUtils';\nimport { requiresQuery } from 'src/modules/AnnotationTypes';\n\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { logEvent } from 'src/logger/actions';\nimport { Logger, LOG_ACTIONS_LOAD_CHART } from 'src/logger/LogUtils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { allowCrossDomain as domainShardingEnabled } from 'src/utils/hostNamesConfig';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\n\nexport const CHART_UPDATE_STARTED = 'CHART_UPDATE_STARTED';\nexport function chartUpdateStarted(queryController, latestQueryFormData, key) {\n  return {\n    type: CHART_UPDATE_STARTED,\n    queryController,\n    latestQueryFormData,\n    key,\n  };\n}\n\nexport const CHART_UPDATE_SUCCEEDED = 'CHART_UPDATE_SUCCEEDED';\nexport function chartUpdateSucceeded(queriesResponse, key) {\n  return { type: CHART_UPDATE_SUCCEEDED, queriesResponse, key };\n}\n\nexport const CHART_UPDATE_STOPPED = 'CHART_UPDATE_STOPPED';\nexport function chartUpdateStopped(key) {\n  return { type: CHART_UPDATE_STOPPED, key };\n}\n\nexport const CHART_UPDATE_FAILED = 'CHART_UPDATE_FAILED';\nexport function chartUpdateFailed(queriesResponse, key) {\n  return { type: CHART_UPDATE_FAILED, queriesResponse, key };\n}\n\nexport const CHART_RENDERING_FAILED = 'CHART_RENDERING_FAILED';\nexport function chartRenderingFailed(error, key, stackTrace) {\n  return { type: CHART_RENDERING_FAILED, error, key, stackTrace };\n}\n\nexport const CHART_RENDERING_SUCCEEDED = 'CHART_RENDERING_SUCCEEDED';\nexport function chartRenderingSucceeded(key) {\n  return { type: CHART_RENDERING_SUCCEEDED, key };\n}\n\nexport const REMOVE_CHART = 'REMOVE_CHART';\nexport function removeChart(key) {\n  return { type: REMOVE_CHART, key };\n}\n\nexport const ANNOTATION_QUERY_SUCCESS = 'ANNOTATION_QUERY_SUCCESS';\nexport function annotationQuerySuccess(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_SUCCESS, annotation, queryResponse, key };\n}\n\nexport const ANNOTATION_QUERY_STARTED = 'ANNOTATION_QUERY_STARTED';\nexport function annotationQueryStarted(annotation, queryController, key) {\n  return { type: ANNOTATION_QUERY_STARTED, annotation, queryController, key };\n}\n\nexport const ANNOTATION_QUERY_FAILED = 'ANNOTATION_QUERY_FAILED';\nexport function annotationQueryFailed(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_FAILED, annotation, queryResponse, key };\n}\n\nexport const DYNAMIC_PLUGIN_CONTROLS_READY = 'DYNAMIC_PLUGIN_CONTROLS_READY';\nexport const dynamicPluginControlsReady = () => (dispatch, getState) => {\n  const state = getState();\n  const controlsState = getControlsState(\n    state.explore,\n    state.explore.form_data,\n  );\n  dispatch({\n    type: DYNAMIC_PLUGIN_CONTROLS_READY,\n    key: controlsState.slice_id.value,\n    controlsState,\n  });\n};\n\nconst legacyChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  method = 'POST',\n  requestParams = {},\n) => {\n  const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getExploreUrl({\n    formData,\n    endpointType,\n    force,\n    allowDomainSharding,\n    method,\n    requestParams: requestParams.dashboard_id\n      ? { dashboard_id: requestParams.dashboard_id }\n      : {},\n  });\n  const querySettings = {\n    ...requestParams,\n    url,\n    postPayload: { form_data: formData },\n    parseMethod: 'json-bigint',\n  };\n\n  const clientMethod =\n    'GET' && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)\n      ? SupersetClient.get\n      : SupersetClient.post;\n  return clientMethod(querySettings).then(({ json, response }) =>\n    // Make the legacy endpoint return a payload that corresponds to the\n    // V1 chart data endpoint response signature.\n    ({\n      response,\n      json: { result: [json] },\n    }),\n  );\n};\n\nconst v1ChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  requestParams,\n  setDataMask,\n  ownState,\n) => {\n  const payload = buildV1ChartDataPayload({\n    formData,\n    resultType,\n    resultFormat,\n    force,\n    setDataMask,\n    ownState,\n  });\n\n  // The dashboard id is added to query params for tracking purposes\n  const { slice_id: sliceId } = formData;\n  const { dashboard_id: dashboardId } = requestParams;\n\n  const qs = {};\n  if (sliceId !== undefined) qs.form_data = `{\"slice_id\":${sliceId}}`;\n  if (dashboardId !== undefined) qs.dashboard_id = dashboardId;\n  if (force !== false) qs.force = force;\n\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getChartDataUri({\n    path: '/api/v1/chart/data',\n    qs,\n    allowDomainSharding,\n  }).toString();\n\n  const querySettings = {\n    ...requestParams,\n    url,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload),\n    parseMethod: 'json-bigint',\n  };\n\n  return SupersetClient.post(querySettings);\n};\n\nexport async function getChartDataRequest({\n  formData,\n  setDataMask = () => {},\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  method = 'POST',\n  requestParams = {},\n  ownState = {},\n}) {\n  let querySettings = {\n    ...requestParams,\n  };\n\n  if (domainShardingEnabled) {\n    querySettings = {\n      ...querySettings,\n      mode: 'cors',\n      credentials: 'include',\n    };\n  }\n\n  if (shouldUseLegacyApi(formData)) {\n    return legacyChartDataRequest(\n      formData,\n      resultFormat,\n      resultType,\n      force,\n      method,\n      querySettings,\n    );\n  }\n  return v1ChartDataRequest(\n    formData,\n    resultFormat,\n    resultType,\n    force,\n    querySettings,\n    setDataMask,\n    ownState,\n  );\n}\n\nexport function runAnnotationQuery({\n  annotation,\n  timeout = 60,\n  formData = null,\n  key,\n  isDashboardRequest = false,\n  force = false,\n}) {\n  return function (dispatch, getState) {\n    const sliceKey = key || Object.keys(getState().charts)[0];\n    // make a copy of formData, not modifying original formData\n    const fd = {\n      ...(formData || getState().charts[sliceKey].latestQueryFormData),\n    };\n\n    if (!requiresQuery(annotation.sourceType)) {\n      return Promise.resolve();\n    }\n\n    const granularity = fd.time_grain_sqla || fd.granularity;\n    fd.time_grain_sqla = granularity;\n    fd.granularity = granularity;\n    const overridesKeys = Object.keys(annotation.overrides);\n    if (overridesKeys.includes('since') || overridesKeys.includes('until')) {\n      annotation.overrides = {\n        ...annotation.overrides,\n        time_range: null,\n      };\n    }\n    const sliceFormData = Object.keys(annotation.overrides).reduce(\n      (d, k) => ({\n        ...d,\n        [k]: annotation.overrides[k] || fd[k],\n      }),\n      {},\n    );\n\n    if (!isDashboardRequest && fd) {\n      const hasExtraFilters = fd.extra_filters && fd.extra_filters.length > 0;\n      sliceFormData.extra_filters = hasExtraFilters\n        ? fd.extra_filters\n        : undefined;\n    }\n\n    const url = getAnnotationJsonUrl(annotation.value, force);\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    dispatch(annotationQueryStarted(annotation, controller, sliceKey));\n\n    const annotationIndex = fd?.annotation_layers?.findIndex(\n      it => it.name === annotation.name,\n    );\n    if (annotationIndex >= 0) {\n      fd.annotation_layers[annotationIndex].overrides = sliceFormData;\n    }\n\n    return SupersetClient.post({\n      url,\n      signal,\n      timeout: timeout * 1000,\n      headers: { 'Content-Type': 'application/json' },\n      jsonPayload: buildV1ChartDataPayload({\n        formData: fd,\n        force,\n        resultFormat: 'json',\n        resultType: 'full',\n      }),\n    })\n      .then(({ json }) => {\n        const data = json?.result?.[0]?.annotation_data?.[annotation.name];\n        return dispatch(annotationQuerySuccess(annotation, { data }, sliceKey));\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(err => {\n          if (err.statusText === 'timeout') {\n            dispatch(\n              annotationQueryFailed(\n                annotation,\n                { error: 'Query timeout' },\n                sliceKey,\n              ),\n            );\n          } else if ((err.error || '').toLowerCase().includes('no data')) {\n            dispatch(annotationQuerySuccess(annotation, err, sliceKey));\n          } else if (err.statusText !== 'abort') {\n            dispatch(annotationQueryFailed(annotation, err, sliceKey));\n          }\n        }),\n      );\n  };\n}\n\nexport const TRIGGER_QUERY = 'TRIGGER_QUERY';\nexport function triggerQuery(value = true, key) {\n  return { type: TRIGGER_QUERY, value, key };\n}\n\n// this action is used for forced re-render without fetch data\nexport const RENDER_TRIGGERED = 'RENDER_TRIGGERED';\nexport function renderTriggered(value, key) {\n  return { type: RENDER_TRIGGERED, value, key };\n}\n\nexport const UPDATE_QUERY_FORM_DATA = 'UPDATE_QUERY_FORM_DATA';\nexport function updateQueryFormData(value, key) {\n  return { type: UPDATE_QUERY_FORM_DATA, value, key };\n}\n\n// in the sql lab -> explore flow, user can inline edit chart title,\n// then the chart will be assigned a new slice_id\nexport const UPDATE_CHART_ID = 'UPDATE_CHART_ID';\nexport function updateChartId(newId, key = 0) {\n  return { type: UPDATE_CHART_ID, newId, key };\n}\n\nexport const ADD_CHART = 'ADD_CHART';\nexport function addChart(chart, key) {\n  return { type: ADD_CHART, chart, key };\n}\n\nexport function exploreJSON(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  method,\n  dashboardId,\n  ownState,\n) {\n  return async dispatch => {\n    const logStart = Logger.getTimestamp();\n    const controller = new AbortController();\n\n    const requestParams = {\n      signal: controller.signal,\n      timeout: timeout * 1000,\n    };\n    if (dashboardId) requestParams.dashboard_id = dashboardId;\n\n    const setDataMask = dataMask => {\n      dispatch(updateDataMask(formData.slice_id, dataMask));\n    };\n    const chartDataRequest = getChartDataRequest({\n      setDataMask,\n      formData,\n      resultFormat: 'json',\n      resultType: 'full',\n      force,\n      method,\n      requestParams,\n      ownState,\n    });\n\n    dispatch(chartUpdateStarted(controller, formData, key));\n\n    const chartDataRequestCaught = chartDataRequest\n      .then(({ response, json }) => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          // deal with getChartDataRequest transforming the response data\n          const result = 'result' in json ? json.result : json;\n          switch (response.status) {\n            case 200:\n              // Query results returned synchronously, meaning query was already cached.\n              return Promise.resolve(result);\n            case 202:\n              // Query is running asynchronously and we must await the results\n              if (shouldUseLegacyApi(formData)) {\n                return waitForAsyncData(result[0]);\n              }\n              return waitForAsyncData(result);\n            default:\n              throw new Error(\n                `Received unexpected response status (${response.status}) while fetching chart data`,\n              );\n          }\n        }\n\n        return json.result;\n      })\n      .then(queriesResponse => {\n        queriesResponse.forEach(resultItem =>\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              applied_filters: resultItem.applied_filters,\n              is_cached: resultItem.is_cached,\n              force_refresh: force,\n              row_count: resultItem.rowcount,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n              has_extra_filters:\n                formData.extra_filters && formData.extra_filters.length > 0,\n              viz_type: formData.viz_type,\n              data_age: resultItem.is_cached\n                ? moment(new Date()).diff(moment.utc(resultItem.cached_dttm))\n                : null,\n            }),\n          ),\n        );\n        return dispatch(chartUpdateSucceeded(queriesResponse, key));\n      })\n      .catch(response => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          return dispatch(chartUpdateFailed([response], key));\n        }\n\n        const appendErrorLog = (errorDetails, isCached) => {\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              has_err: true,\n              is_cached: isCached,\n              error_details: errorDetails,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n            }),\n          );\n        };\n        if (response.name === 'AbortError') {\n          appendErrorLog('abort');\n          return dispatch(chartUpdateStopped(key));\n        }\n        return getClientErrorObject(response).then(parsedResponse => {\n          if (response.statusText === 'timeout') {\n            appendErrorLog('timeout');\n          } else {\n            appendErrorLog(parsedResponse.error, parsedResponse.is_cached);\n          }\n          return dispatch(chartUpdateFailed([parsedResponse], key));\n        });\n      });\n\n    // only retrieve annotations when calling the legacy API\n    const annotationLayers = shouldUseLegacyApi(formData)\n      ? formData.annotation_layers || []\n      : [];\n    const isDashboardRequest = dashboardId > 0;\n\n    return Promise.all([\n      chartDataRequestCaught,\n      dispatch(triggerQuery(false, key)),\n      dispatch(updateQueryFormData(formData, key)),\n      ...annotationLayers.map(annotation =>\n        dispatch(\n          runAnnotationQuery({\n            annotation,\n            timeout,\n            formData,\n            key,\n            isDashboardRequest,\n            force,\n          }),\n        ),\n      ),\n    ]);\n  };\n}\n\nexport const GET_SAVED_CHART = 'GET_SAVED_CHART';\nexport function getSavedChart(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a GET request to `/explore_json`.\n   *\n   * This will return the payload of a saved chart, optionally filtered by\n   * ad-hoc or extra filters from dashboards. Eg:\n   *\n   *  GET  /explore_json?{\"chart_id\":1}\n   *  GET  /explore_json?{\"chart_id\":1,\"extra_filters\":\"...\"}\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'GET',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport const POST_CHART_FORM_DATA = 'POST_CHART_FORM_DATA';\nexport function postChartFormData(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a POST request to `/explore_json`.\n   *\n   * This will post the form data to the endpoint, returning a new chart.\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'POST',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport function redirectSQLLab(formData) {\n  return dispatch => {\n    getChartDataRequest({ formData, resultFormat: 'json', resultType: 'query' })\n      .then(({ json }) => {\n        const redirectUrl = '/superset/sqllab/';\n        const payload = {\n          datasourceKey: formData.datasource,\n          sql: json.result[0].query,\n        };\n        SupersetClient.postForm(redirectUrl, {\n          form_data: safeStringify(payload),\n        });\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('An error occurred while loading the SQL'))),\n      );\n  };\n}\n\nexport function refreshChart(chartKey, force, dashboardId) {\n  return (dispatch, getState) => {\n    const chart = (getState().charts || {})[chartKey];\n    const timeout =\n      getState().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;\n\n    if (\n      !chart.latestQueryFormData ||\n      Object.keys(chart.latestQueryFormData).length === 0\n    ) {\n      return;\n    }\n    dispatch(\n      postChartFormData(\n        chart.latestQueryFormData,\n        force,\n        timeout,\n        chart.id,\n        dashboardId,\n        getState().dataMask[chart.id]?.ownState,\n      ),\n    );\n  };\n}\n\nexport const getDatasourceSamples = async (\n  datasourceType,\n  datasourceId,\n  force,\n  jsonPayload,\n  perPage,\n  page,\n) => {\n  try {\n    const searchParams = {\n      force,\n      datasource_type: datasourceType,\n      datasource_id: datasourceId,\n    };\n\n    if (isDefined(perPage) && isDefined(page)) {\n      searchParams.per_page = perPage;\n      searchParams.page = page;\n    }\n\n    const response = await SupersetClient.post({\n      endpoint: '/datasource/samples',\n      jsonPayload,\n      searchParams,\n    });\n\n    return response.json.result;\n  } catch (err) {\n    const clientError = await getClientErrorObject(err);\n    throw new Error(\n      clientError.message || clientError.error || t('Sorry, an error occurred'),\n      { cause: err },\n    );\n  }\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\n\nconst propTypes = {\n  children: PropTypes.node.isRequired,\n  onError: PropTypes.func,\n  showMessage: PropTypes.bool,\n};\nconst defaultProps = {\n  onError: () => {},\n  showMessage: true,\n};\n\nexport default class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null, info: null };\n  }\n\n  componentDidCatch(error, info) {\n    if (this.props.onError) this.props.onError(error, info);\n    this.setState({ error, info });\n  }\n\n  render() {\n    const { error, info } = this.state;\n    if (error) {\n      const firstLine = error.toString();\n      const message = (\n        <span>\n          <strong>{t('Unexpected error')}</strong>\n          {firstLine ? `: ${firstLine}` : ''}\n        </span>\n      );\n      if (this.props.showMessage) {\n        return (\n          <ErrorMessageWithStackTrace\n            subtitle={message}\n            copyText={message}\n            stackTrace={info ? info.componentStack : null}\n          />\n        );\n      }\n      return null;\n    }\n    return this.props.children;\n  }\n}\nErrorBoundary.propTypes = propTypes;\nErrorBoundary.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n// util function to make sure filter is a valid slice in current dashboard\nfunction isValidFilter(getState, chartId) {\n  return getState().dashboardState.sliceIds.includes(chartId);\n}\n\nexport const ADD_FILTER = 'ADD_FILTER';\nexport function addFilter(chartId, component, form_data) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: ADD_FILTER, chartId, component, form_data });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const REMOVE_FILTER = 'REMOVE_FILTER';\nexport function removeFilter(chartId) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: REMOVE_FILTER, chartId });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const CHANGE_FILTER = 'CHANGE_FILTER';\nexport function changeFilter(chartId, newSelectedValues, merge) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      const components = getState().dashboardLayout.present;\n      return dispatch({\n        type: CHANGE_FILTER,\n        chartId,\n        newSelectedValues,\n        merge,\n        components,\n      });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_DIRECT_PATH_TO_FILTER = 'UPDATE_DIRECT_PATH_TO_FILTER';\nexport function updateDirectPathToFilter(chartId, path) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: UPDATE_DIRECT_PATH_TO_FILTER, chartId, path });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_LAYOUT_COMPONENTS = 'UPDATE_LAYOUT_COMPONENTS';\nexport function updateLayoutComponents(components) {\n  return dispatch => {\n    dispatch({ type: UPDATE_LAYOUT_COMPONENTS, components });\n  };\n}\n\nexport const UPDATE_DASHBOARD_FILTERS_SCOPE = 'UPDATE_DASHBOARD_FILTERS_SCOPE';\nexport function updateDashboardFiltersScope(scopes) {\n  return dispatch => {\n    dispatch({ type: UPDATE_DASHBOARD_FILTERS_SCOPE, scopes });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport { t } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\nimport { TABS_TYPE, ROW_TYPE } from 'src/dashboard/util/componentTypes';\nimport {\n  DASHBOARD_ROOT_ID,\n  NEW_COMPONENTS_SOURCE_ID,\n  DASHBOARD_HEADER_ID,\n} from 'src/dashboard/util/constants';\nimport dropOverflowsParent from 'src/dashboard/util/dropOverflowsParent';\nimport findParentId from 'src/dashboard/util/findParentId';\nimport isInDifferentFilterScopes from 'src/dashboard/util/isInDifferentFilterScopes';\nimport { updateLayoutComponents } from './dashboardFilters';\nimport { setUnsavedChanges } from './dashboardState';\n\n// Component CRUD -------------------------------------------------------------\nexport const UPDATE_COMPONENTS = 'UPDATE_COMPONENTS';\n\n// this is a helper that takes an action as input and dispatches\n// an additional setUnsavedChanges(true) action after the dispatch in the case\n// that dashboardState.hasUnsavedChanges is false.\nfunction setUnsavedChangesAfterAction(action) {\n  return (...args) =>\n    (dispatch, getState) => {\n      const result = action(...args);\n      if (typeof result === 'function') {\n        dispatch(result(dispatch, getState));\n      } else {\n        dispatch(result);\n      }\n\n      const { dashboardLayout, dashboardState } = getState();\n\n      const isComponentLevelEvent =\n        result.type === UPDATE_COMPONENTS &&\n        result.payload &&\n        result.payload.nextComponents;\n      // trigger dashboardFilters state update if dashboard layout is changed.\n      if (!isComponentLevelEvent) {\n        const components = dashboardLayout.present;\n        dispatch(updateLayoutComponents(components));\n      }\n\n      if (!dashboardState.hasUnsavedChanges) {\n        dispatch(setUnsavedChanges(true));\n      }\n    };\n}\n\nexport const updateComponents = setUnsavedChangesAfterAction(\n  nextComponents => ({\n    type: UPDATE_COMPONENTS,\n    payload: {\n      nextComponents,\n    },\n  }),\n);\n\nexport function updateDashboardTitle(text) {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    dispatch(\n      updateComponents({\n        [DASHBOARD_HEADER_ID]: {\n          ...dashboardLayout.present[DASHBOARD_HEADER_ID],\n          meta: {\n            text,\n          },\n        },\n      }),\n    );\n  };\n}\n\nexport const DASHBOARD_TITLE_CHANGED = 'DASHBOARD_TITLE_CHANGED';\n\n// call this one when it's not an undo-able action\nexport function dashboardTitleChanged(text) {\n  return {\n    type: DASHBOARD_TITLE_CHANGED,\n    text,\n  };\n}\n\nexport const DELETE_COMPONENT = 'DELETE_COMPONENT';\nexport const deleteComponent = setUnsavedChangesAfterAction((id, parentId) => ({\n  type: DELETE_COMPONENT,\n  payload: {\n    id,\n    parentId,\n  },\n}));\n\nexport const CREATE_COMPONENT = 'CREATE_COMPONENT';\nexport const createComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\n// Tabs -----------------------------------------------------------------------\nexport const CREATE_TOP_LEVEL_TABS = 'CREATE_TOP_LEVEL_TABS';\nexport const createTopLevelTabs = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_TOP_LEVEL_TABS,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const DELETE_TOP_LEVEL_TABS = 'DELETE_TOP_LEVEL_TABS';\nexport const deleteTopLevelTabs = setUnsavedChangesAfterAction(() => ({\n  type: DELETE_TOP_LEVEL_TABS,\n  payload: {},\n}));\n\n// Resize ---------------------------------------------------------------------\nexport const RESIZE_COMPONENT = 'RESIZE_COMPONENT';\nexport function resizeComponent({ id, width, height }) {\n  return (dispatch, getState) => {\n    const { dashboardLayout: undoableLayout } = getState();\n    const { present: dashboard } = undoableLayout;\n    const component = dashboard[id];\n    const widthChanged = width && component.meta.width !== width;\n    const heightChanged = height && component.meta.height !== height;\n    if (component && (widthChanged || heightChanged)) {\n      // update the size of this component\n      const updatedComponents = {\n        [id]: {\n          ...component,\n          meta: {\n            ...component.meta,\n            width: width || component.meta.width,\n            height: height || component.meta.height,\n          },\n        },\n      };\n\n      dispatch(updateComponents(updatedComponents));\n    }\n  };\n}\n\n// Drag and drop --------------------------------------------------------------\nexport const MOVE_COMPONENT = 'MOVE_COMPONENT';\nconst moveComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: MOVE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const HANDLE_COMPONENT_DROP = 'HANDLE_COMPONENT_DROP';\nexport function handleComponentDrop(dropResult) {\n  return (dispatch, getState) => {\n    const overflowsParent = dropOverflowsParent(\n      dropResult,\n      getState().dashboardLayout.present,\n    );\n\n    if (overflowsParent) {\n      return dispatch(\n        addWarningToast(\n          t(\n            `There is not enough space for this component. Try decreasing its width, or increasing the destination width.`,\n          ),\n        ),\n      );\n    }\n\n    const { source, destination } = dropResult;\n    const droppedOnRoot = destination && destination.id === DASHBOARD_ROOT_ID;\n    const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n    const dashboardRoot = getState().dashboardLayout.present[DASHBOARD_ROOT_ID];\n    const rootChildId =\n      dashboardRoot && dashboardRoot.children ? dashboardRoot.children[0] : '';\n\n    if (droppedOnRoot) {\n      dispatch(createTopLevelTabs(dropResult));\n    } else if (destination && isNewComponent) {\n      dispatch(createComponent(dropResult));\n    } else if (\n      // Add additional allow-to-drop logic for tag/tags source.\n      // We only allow\n      // - top-level tab => top-level tab: rearrange top-level tab order\n      // - nested tab => top-level tab: allow row tab become top-level tab\n      // Dashboard does not allow top-level tab become nested tab, to avoid\n      // nested tab inside nested tab.\n      source.type === TABS_TYPE &&\n      destination.type === TABS_TYPE &&\n      source.id === rootChildId &&\n      destination.id !== rootChildId\n    ) {\n      return dispatch(\n        addWarningToast(t('Can not move top level tab into nested tabs')),\n      );\n    } else if (\n      destination &&\n      source &&\n      !(\n        // ensure it has moved\n        (destination.id === source.id && destination.index === source.index)\n      )\n    ) {\n      dispatch(moveComponent(dropResult));\n    }\n\n    // call getState() again down here in case redux state is stale after\n    // previous dispatch(es)\n    const { dashboardFilters, dashboardLayout: undoableLayout } = getState();\n\n    // if we moved a child from a Tab or Row parent and it was the only child, delete the parent.\n    if (!isNewComponent) {\n      const { present: layout } = undoableLayout;\n      const sourceComponent = layout[source.id] || {};\n      const destinationComponent = layout[destination.id] || {};\n      if (\n        (sourceComponent.type === TABS_TYPE ||\n          sourceComponent.type === ROW_TYPE) &&\n        sourceComponent.children &&\n        sourceComponent.children.length === 0\n      ) {\n        const parentId = findParentId({\n          childId: source.id,\n          layout,\n        });\n        dispatch(deleteComponent(source.id, parentId));\n      }\n\n      // show warning if item has been moved between different scope\n      if (\n        isInDifferentFilterScopes({\n          dashboardFilters,\n          source: (sourceComponent.parents || []).concat(source.id),\n          destination: (destinationComponent.parents || []).concat(\n            destination.id,\n          ),\n        })\n      ) {\n        dispatch(\n          addWarningToast(\n            t('This chart has been moved to a different filter scope.'),\n          ),\n        );\n      }\n    }\n\n    return null;\n  };\n}\n\n// Undo redo ------------------------------------------------------------------\nexport function undoLayoutAction() {\n  return (dispatch, getState) => {\n    dispatch(UndoActionCreators.undo());\n\n    const { dashboardLayout, dashboardState } = getState();\n\n    if (\n      dashboardLayout.past.length === 0 &&\n      !dashboardState.maxUndoHistoryExceeded &&\n      !dashboardState.updatedColorScheme\n    ) {\n      dispatch(setUnsavedChanges(false));\n    }\n  };\n}\n\nexport const redoLayoutAction = setUnsavedChangesAfterAction(\n  UndoActionCreators.redo,\n);\n\n// Update component parents list ----------------------------------------------\nexport const UPDATE_COMPONENTS_PARENTS_LIST = 'UPDATE_COMPONENTS_PARENTS_LIST';\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport getComponentWidthFromDrop from './getComponentWidthFromDrop';\n\nexport default function doesChildOverflowParent(dropResult, layout) {\n  const childWidth = getComponentWidthFromDrop({ dropResult, layout });\n  return typeof childWidth === 'number' && childWidth < 0;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function isInDifferentFilterScopes({\n  dashboardFilters = {},\n  source = [],\n  destination = [],\n}) {\n  const sourceSet = new Set(source);\n  const destinationSet = new Set(destination);\n\n  const allScopes = [].concat(\n    ...Object.values(dashboardFilters).map(({ scopes }) =>\n      [].concat(...Object.values(scopes).map(({ scope }) => scope)),\n    ),\n  );\n  return allScopes.some(tab => destinationSet.has(tab) !== sourceSet.has(tab));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject } from '@superset-ui/core';\nimport { OVERWRITE_INSPECT_FIELDS } from 'src/dashboard/constants';\n\nconst JSON_KEYS = new Set(['json_metadata', 'position_json']);\n\nfunction extractValue(object: JsonObject, keyPath: string) {\n  return keyPath.split('.').reduce((obj: JsonObject, key: string) => {\n    const value = obj?.[key];\n    return JSON_KEYS.has(key) && value ? JSON.parse(value) : value;\n  }, object);\n}\n\nexport default function getOverwriteItems(prev: JsonObject, next: JsonObject) {\n  return OVERWRITE_INSPECT_FIELDS.map(keyPath => ({\n    keyPath,\n    ...(keyPath.split('.').find(key => JSON_KEYS.has(key))\n      ? {\n          oldValue:\n            JSON.stringify(extractValue(prev, keyPath), null, 2) || '{}',\n          newValue:\n            JSON.stringify(extractValue(next, keyPath), null, 2) || '{}',\n        }\n      : {\n          oldValue: extractValue(prev, keyPath) || '',\n          newValue: extractValue(next, keyPath) || '',\n        }),\n  })).filter(({ oldValue, newValue }) => oldValue !== newValue);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport {\n  ensureIsArray,\n  t,\n  SupersetClient,\n  getSharedLabelColor,\n} from '@superset-ui/core';\nimport {\n  addChart,\n  removeChart,\n  refreshChart,\n} from 'src/components/Chart/chartAction';\nimport { chart as initChart } from 'src/components/Chart/chartReducer';\nimport { applyDefaultFormData } from 'src/explore/store';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport {\n  SAVE_TYPE_OVERWRITE,\n  SAVE_TYPE_OVERWRITE_CONFIRMED,\n} from 'src/dashboard/util/constants';\nimport { isCrossFiltersEnabled } from 'src/dashboard/util/crossFilters';\nimport {\n  addSuccessToast,\n  addWarningToast,\n  addDangerToast,\n} from 'src/components/MessageToasts/actions';\nimport serializeActiveFilterValues from 'src/dashboard/util/serializeActiveFilterValues';\nimport serializeFilterScopes from 'src/dashboard/util/serializeFilterScopes';\nimport { getActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { logEvent } from 'src/logger/actions';\nimport { LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA } from 'src/logger/LogUtils';\nimport { UPDATE_COMPONENTS_PARENTS_LIST } from './dashboardLayout';\nimport {\n  setChartConfiguration,\n  dashboardInfoChanged,\n  SET_CHART_CONFIG_COMPLETE,\n} from './dashboardInfo';\nimport { fetchDatasourceMetadata } from './datasources';\nimport {\n  addFilter,\n  removeFilter,\n  updateDirectPathToFilter,\n} from './dashboardFilters';\nimport { SET_FILTER_CONFIG_COMPLETE } from './nativeFilters';\nimport getOverwriteItems from '../util/getOverwriteItems';\n\nexport const SET_UNSAVED_CHANGES = 'SET_UNSAVED_CHANGES';\nexport function setUnsavedChanges(hasUnsavedChanges) {\n  return { type: SET_UNSAVED_CHANGES, payload: { hasUnsavedChanges } };\n}\n\nexport const ADD_SLICE = 'ADD_SLICE';\nexport function addSlice(slice) {\n  return { type: ADD_SLICE, slice };\n}\n\nexport const REMOVE_SLICE = 'REMOVE_SLICE';\nexport function removeSlice(sliceId) {\n  return { type: REMOVE_SLICE, sliceId };\n}\n\nconst FAVESTAR_BASE_URL = '/superset/favstar/Dashboard';\nexport const TOGGLE_FAVE_STAR = 'TOGGLE_FAVE_STAR';\nexport function toggleFaveStar(isStarred) {\n  return { type: TOGGLE_FAVE_STAR, isStarred };\n}\n\nexport const FETCH_FAVE_STAR = 'FETCH_FAVE_STAR';\nexport function fetchFaveStar(id) {\n  return function fetchFaveStarThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `${FAVESTAR_BASE_URL}/${id}/count/`,\n    })\n      .then(({ json }) => {\n        if (json.count > 0) dispatch(toggleFaveStar(true));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching the favorite status of this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport const SAVE_FAVE_STAR = 'SAVE_FAVE_STAR';\nexport function saveFaveStar(id, isStarred) {\n  return function saveFaveStarThunk(dispatch) {\n    const urlSuffix = isStarred ? 'unselect' : 'select';\n    return SupersetClient.get({\n      endpoint: `${FAVESTAR_BASE_URL}/${id}/${urlSuffix}/`,\n    })\n      .then(() => {\n        dispatch(toggleFaveStar(!isStarred));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(t('There was an issue favoriting this dashboard.')),\n        ),\n      );\n  };\n}\n\nexport const TOGGLE_PUBLISHED = 'TOGGLE_PUBLISHED';\nexport function togglePublished(isPublished) {\n  return { type: TOGGLE_PUBLISHED, isPublished };\n}\n\nexport function savePublished(id, isPublished) {\n  return function savePublishedThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: `/api/v1/dashboard/${id}`,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        published: isPublished,\n      }),\n    })\n      .then(() => {\n        dispatch(\n          addSuccessToast(\n            isPublished\n              ? t('This dashboard is now published')\n              : t('This dashboard is now hidden'),\n          ),\n        );\n        dispatch(togglePublished(isPublished));\n      })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('You do not have permissions to edit this dashboard.'),\n          ),\n        );\n      });\n  };\n}\n\nexport const TOGGLE_EXPAND_SLICE = 'TOGGLE_EXPAND_SLICE';\nexport function toggleExpandSlice(sliceId) {\n  return { type: TOGGLE_EXPAND_SLICE, sliceId };\n}\n\nexport const UPDATE_CSS = 'UPDATE_CSS';\nexport function updateCss(css) {\n  return { type: UPDATE_CSS, css };\n}\n\nexport const SET_EDIT_MODE = 'SET_EDIT_MODE';\nexport function setEditMode(editMode) {\n  return { type: SET_EDIT_MODE, editMode };\n}\n\nexport const ON_CHANGE = 'ON_CHANGE';\nexport function onChange() {\n  return { type: ON_CHANGE };\n}\n\nexport const ON_SAVE = 'ON_SAVE';\nexport function onSave(lastModifiedTime) {\n  return { type: ON_SAVE, lastModifiedTime };\n}\n\nexport const SET_REFRESH_FREQUENCY = 'SET_REFRESH_FREQUENCY';\nexport function setRefreshFrequency(refreshFrequency, isPersistent = false) {\n  return { type: SET_REFRESH_FREQUENCY, refreshFrequency, isPersistent };\n}\n\nexport function saveDashboardRequestSuccess(lastModifiedTime) {\n  return dispatch => {\n    dispatch(onSave(lastModifiedTime));\n    // clear layout undo history\n    dispatch(UndoActionCreators.clearHistory());\n  };\n}\n\nexport const SET_OVERRIDE_CONFIRM = 'SET_OVERRIDE_CONFIRM';\nexport function setOverrideConfirm(overwriteConfirmMetadata) {\n  return {\n    type: SET_OVERRIDE_CONFIRM,\n    overwriteConfirmMetadata,\n  };\n}\n\nexport const SAVE_DASHBOARD_STARTED = 'SAVE_DASHBOARD_STARTED';\nexport function saveDashboardStarted() {\n  return { type: SAVE_DASHBOARD_STARTED };\n}\n\nexport const SAVE_DASHBOARD_FINISHED = 'SAVE_DASHBOARD_FINISHED';\nexport function saveDashboardFinished() {\n  return { type: SAVE_DASHBOARD_FINISHED };\n}\n\nexport function saveDashboardRequest(data, id, saveType) {\n  return (dispatch, getState) => {\n    dispatch({ type: UPDATE_COMPONENTS_PARENTS_LIST });\n    dispatch(saveDashboardStarted());\n\n    const { dashboardFilters, dashboardLayout } = getState();\n    const layout = dashboardLayout.present;\n    Object.values(dashboardFilters).forEach(filter => {\n      const { chartId } = filter;\n      const componentId = filter.directPathToFilter.slice().pop();\n      const directPathToFilter = (layout[componentId]?.parents || []).slice();\n      directPathToFilter.push(componentId);\n      dispatch(updateDirectPathToFilter(chartId, directPathToFilter));\n    });\n    // serialize selected values for each filter field, grouped by filter id\n    const serializedFilters = serializeActiveFilterValues(getActiveFilters());\n    // serialize filter scope for each filter field, grouped by filter id\n    const serializedFilterScopes = serializeFilterScopes(dashboardFilters);\n    const {\n      certified_by,\n      certification_details,\n      css,\n      dashboard_title,\n      owners,\n      roles,\n      slug,\n    } = data;\n\n    const hasId = item => item.id !== undefined;\n    const metadataCrossFiltersEnabled = data.metadata?.cross_filters_enabled;\n    // making sure the data is what the backend expects\n    const cleanedData = {\n      ...data,\n      certified_by: certified_by || '',\n      certification_details:\n        certified_by && certification_details ? certification_details : '',\n      css: css || '',\n      dashboard_title: dashboard_title || t('[ untitled dashboard ]'),\n      owners: ensureIsArray(owners).map(o => (hasId(o) ? o.id : o)),\n      roles: !isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)\n        ? undefined\n        : ensureIsArray(roles).map(r => (hasId(r) ? r.id : r)),\n      slug: slug || null,\n      metadata: {\n        ...data.metadata,\n        color_namespace: data.metadata?.color_namespace || undefined,\n        color_scheme: data.metadata?.color_scheme || '',\n        color_scheme_domain: data.metadata?.color_scheme_domain || [],\n        expanded_slices: data.metadata?.expanded_slices || {},\n        label_colors: data.metadata?.label_colors || {},\n        shared_label_colors: data.metadata?.shared_label_colors || {},\n        refresh_frequency: data.metadata?.refresh_frequency || 0,\n        timed_refresh_immune_slices:\n          data.metadata?.timed_refresh_immune_slices || [],\n        // cross-filters should be enabled by default\n        cross_filters_enabled: isCrossFiltersEnabled(\n          metadataCrossFiltersEnabled,\n        ),\n      },\n    };\n\n    const handleChartConfiguration = () => {\n      const {\n        dashboardInfo: {\n          metadata: { chart_configuration = {} },\n        },\n      } = getState();\n      const chartConfiguration = Object.values(chart_configuration).reduce(\n        (prev, next) => {\n          // If chart removed from dashboard - remove it from metadata\n          if (\n            Object.values(layout).find(\n              layoutItem => layoutItem?.meta?.chartId === next.id,\n            )\n          ) {\n            return { ...prev, [next.id]: next };\n          }\n          return prev;\n        },\n        {},\n      );\n      return chartConfiguration;\n    };\n\n    const onCopySuccess = response => {\n      const lastModifiedTime = response.json.last_modified_time;\n      if (lastModifiedTime) {\n        dispatch(saveDashboardRequestSuccess(lastModifiedTime));\n      }\n      if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n        const chartConfiguration = handleChartConfiguration();\n        dispatch(setChartConfiguration(chartConfiguration));\n      }\n      dispatch(saveDashboardFinished());\n      dispatch(addSuccessToast(t('This dashboard was saved successfully.')));\n      return response;\n    };\n\n    const onUpdateSuccess = response => {\n      const updatedDashboard = response.json.result;\n      const lastModifiedTime = response.json.last_modified_time;\n      // syncing with the backend transformations of the metadata\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        dispatch(\n          dashboardInfoChanged({\n            metadata,\n          }),\n        );\n        if (metadata.chart_configuration) {\n          dispatch({\n            type: SET_CHART_CONFIG_COMPLETE,\n            chartConfiguration: metadata.chart_configuration,\n          });\n        }\n        if (metadata.native_filter_configuration) {\n          dispatch({\n            type: SET_FILTER_CONFIG_COMPLETE,\n            filterConfig: metadata.native_filter_configuration,\n          });\n        }\n      }\n      if (lastModifiedTime) {\n        dispatch(saveDashboardRequestSuccess(lastModifiedTime));\n      }\n      dispatch(saveDashboardFinished());\n      // redirect to the new slug or id\n      window.history.pushState(\n        { event: 'dashboard_properties_changed' },\n        '',\n        `/superset/dashboard/${slug || id}/`,\n      );\n\n      dispatch(addSuccessToast(t('This dashboard was saved successfully.')));\n      dispatch(setOverrideConfirm(undefined));\n      return response;\n    };\n\n    const onError = async response => {\n      const { error, message } = await getClientErrorObject(response);\n      let errorText = t('Sorry, an unknown error occurred');\n\n      if (error) {\n        errorText = t(\n          'Sorry, there was an error saving this dashboard: %s',\n          error,\n        );\n      }\n      if (typeof message === 'string' && message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n      dispatch(saveDashboardFinished());\n      dispatch(addDangerToast(errorText));\n    };\n\n    if (\n      [SAVE_TYPE_OVERWRITE, SAVE_TYPE_OVERWRITE_CONFIRMED].includes(saveType)\n    ) {\n      let chartConfiguration = {};\n      if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n        chartConfiguration = handleChartConfiguration();\n      }\n      const updatedDashboard =\n        saveType === SAVE_TYPE_OVERWRITE_CONFIRMED\n          ? data\n          : {\n              certified_by: cleanedData.certified_by,\n              certification_details: cleanedData.certification_details,\n              css: cleanedData.css,\n              dashboard_title: cleanedData.dashboard_title,\n              slug: cleanedData.slug,\n              owners: cleanedData.owners,\n              roles: cleanedData.roles,\n              json_metadata: safeStringify({\n                ...(cleanedData?.metadata || {}),\n                default_filters: safeStringify(serializedFilters),\n                filter_scopes: serializedFilterScopes,\n                chart_configuration: chartConfiguration,\n              }),\n            };\n\n      const updateDashboard = () =>\n        SupersetClient.put({\n          endpoint: `/api/v1/dashboard/${id}`,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(updatedDashboard),\n        })\n          .then(response => onUpdateSuccess(response))\n          .catch(response => onError(response));\n      return new Promise((resolve, reject) => {\n        if (\n          !isFeatureEnabled(FeatureFlag.CONFIRM_DASHBOARD_DIFF) ||\n          saveType === SAVE_TYPE_OVERWRITE_CONFIRMED\n        ) {\n          // skip overwrite precheck\n          resolve();\n          return;\n        }\n\n        // precheck for overwrite items\n        SupersetClient.get({\n          endpoint: `/api/v1/dashboard/${id}`,\n        }).then(response => {\n          const dashboard = response.json.result;\n          const overwriteConfirmItems = getOverwriteItems(\n            dashboard,\n            updatedDashboard,\n          );\n          if (overwriteConfirmItems.length > 0) {\n            dispatch(\n              setOverrideConfirm({\n                updatedAt: dashboard.changed_on,\n                updatedBy: dashboard.changed_by_name,\n                overwriteConfirmItems,\n                dashboardId: id,\n                data: updatedDashboard,\n              }),\n            );\n            return reject(overwriteConfirmItems);\n          }\n          return resolve();\n        });\n      })\n        .then(updateDashboard)\n        .catch(overwriteConfirmItems => {\n          const errorText = t('Please confirm the overwrite values.');\n          dispatch(\n            logEvent(LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA, {\n              dashboard_id: id,\n              items: overwriteConfirmItems,\n            }),\n          );\n          dispatch(addDangerToast(errorText));\n        });\n    }\n    // changing the data as the endpoint requires\n    const copyData = { ...cleanedData };\n    if (copyData.metadata) {\n      delete copyData.metadata;\n    }\n    const finalCopyData = {\n      ...copyData,\n      // the endpoint is expecting the metadata to be flat\n      ...(cleanedData?.metadata || {}),\n    };\n    return SupersetClient.post({\n      endpoint: `/superset/copy_dash/${id}/`,\n      postPayload: {\n        data: {\n          ...finalCopyData,\n          default_filters: safeStringify(serializedFilters),\n          filter_scopes: safeStringify(serializedFilterScopes),\n        },\n      },\n    })\n      .then(response => onCopySuccess(response))\n      .catch(response => onError(response));\n  };\n}\n\nexport function fetchCharts(\n  chartList = [],\n  force = false,\n  interval = 0,\n  dashboardId,\n) {\n  return (dispatch, getState) => {\n    if (!interval) {\n      chartList.forEach(chartKey =>\n        dispatch(refreshChart(chartKey, force, dashboardId)),\n      );\n      return;\n    }\n\n    const { metadata: meta } = getState().dashboardInfo;\n    const refreshTime = Math.max(interval, meta.stagger_time || 5000); // default 5 seconds\n    if (typeof meta.stagger_refresh !== 'boolean') {\n      meta.stagger_refresh =\n        meta.stagger_refresh === undefined\n          ? true\n          : meta.stagger_refresh === 'true';\n    }\n    const delay = meta.stagger_refresh\n      ? refreshTime / (chartList.length - 1)\n      : 0;\n    chartList.forEach((chartKey, i) => {\n      setTimeout(\n        () => dispatch(refreshChart(chartKey, force, dashboardId)),\n        delay * i,\n      );\n    });\n  };\n}\n\nconst refreshCharts = (chartList, force, interval, dashboardId, dispatch) =>\n  new Promise(resolve => {\n    dispatch(fetchCharts(chartList, force, interval, dashboardId));\n    resolve();\n  });\n\nexport const ON_FILTERS_REFRESH = 'ON_FILTERS_REFRESH';\nexport function onFiltersRefresh() {\n  return { type: ON_FILTERS_REFRESH };\n}\n\nexport const ON_FILTERS_REFRESH_SUCCESS = 'ON_FILTERS_REFRESH_SUCCESS';\nexport function onFiltersRefreshSuccess() {\n  return { type: ON_FILTERS_REFRESH_SUCCESS };\n}\n\nexport const ON_REFRESH_SUCCESS = 'ON_REFRESH_SUCCESS';\nexport function onRefreshSuccess() {\n  return { type: ON_REFRESH_SUCCESS };\n}\n\nexport const ON_REFRESH = 'ON_REFRESH';\nexport function onRefresh(\n  chartList = [],\n  force = false,\n  interval = 0,\n  dashboardId,\n) {\n  return dispatch => {\n    dispatch({ type: ON_REFRESH });\n    refreshCharts(chartList, force, interval, dashboardId, dispatch).then(\n      () => {\n        dispatch(onRefreshSuccess());\n        dispatch(onFiltersRefresh());\n      },\n    );\n  };\n}\n\nexport const SHOW_BUILDER_PANE = 'SHOW_BUILDER_PANE';\nexport function showBuilderPane() {\n  return { type: SHOW_BUILDER_PANE };\n}\n\nexport function addSliceToDashboard(id, component) {\n  return (dispatch, getState) => {\n    const { sliceEntities } = getState();\n    const selectedSlice = sliceEntities.slices[id];\n    if (!selectedSlice) {\n      return dispatch(\n        addWarningToast(\n          'Sorry, there is no chart definition associated with the chart trying to be added.',\n        ),\n      );\n    }\n    const form_data = {\n      ...selectedSlice.form_data,\n      slice_id: selectedSlice.slice_id,\n    };\n    const newChart = {\n      ...initChart,\n      id,\n      form_data: applyDefaultFormData(form_data),\n    };\n\n    return Promise.all([\n      dispatch(addChart(newChart, id)),\n      dispatch(fetchDatasourceMetadata(form_data.datasource)),\n    ]).then(() => {\n      dispatch(addSlice(selectedSlice));\n\n      if (selectedSlice && selectedSlice.viz_type === 'filter_box') {\n        dispatch(addFilter(id, component, selectedSlice.form_data));\n      }\n    });\n  };\n}\n\nexport function removeSliceFromDashboard(id) {\n  return (dispatch, getState) => {\n    const sliceEntity = getState().sliceEntities.slices[id];\n    if (sliceEntity && sliceEntity.viz_type === 'filter_box') {\n      dispatch(removeFilter(id));\n    }\n\n    dispatch(removeSlice(id));\n    dispatch(removeChart(id));\n    getSharedLabelColor().removeSlice(id);\n  };\n}\n\nexport const SET_COLOR_SCHEME = 'SET_COLOR_SCHEME';\nexport function setColorScheme(colorScheme) {\n  return { type: SET_COLOR_SCHEME, colorScheme };\n}\n\nexport function setColorSchemeAndUnsavedChanges(colorScheme) {\n  return dispatch => {\n    dispatch(setColorScheme(colorScheme));\n    dispatch(setUnsavedChanges(true));\n  };\n}\n\nexport const SET_DIRECT_PATH = 'SET_DIRECT_PATH';\nexport function setDirectPathToChild(path) {\n  return { type: SET_DIRECT_PATH, path };\n}\n\nexport const SET_ACTIVE_TABS = 'SET_ACTIVE_TABS';\nexport function setActiveTabs(tabId, prevTabId) {\n  return { type: SET_ACTIVE_TABS, tabId, prevTabId };\n}\n\nexport const SET_FOCUSED_FILTER_FIELD = 'SET_FOCUSED_FILTER_FIELD';\nexport function setFocusedFilterField(chartId, column) {\n  return { type: SET_FOCUSED_FILTER_FIELD, chartId, column };\n}\n\nexport const UNSET_FOCUSED_FILTER_FIELD = 'UNSET_FOCUSED_FILTER_FIELD';\nexport function unsetFocusedFilterField(chartId, column) {\n  return { type: UNSET_FOCUSED_FILTER_FIELD, chartId, column };\n}\n\nexport const SET_FULL_SIZE_CHART_ID = 'SET_FULL_SIZE_CHART_ID';\nexport function setFullSizeChartId(chartId) {\n  return { type: SET_FULL_SIZE_CHART_ID, chartId };\n}\n\n// Undo history ---------------------------------------------------------------\nexport const SET_MAX_UNDO_HISTORY_EXCEEDED = 'SET_MAX_UNDO_HISTORY_EXCEEDED';\nexport function setMaxUndoHistoryExceeded(maxUndoHistoryExceeded = true) {\n  return {\n    type: SET_MAX_UNDO_HISTORY_EXCEEDED,\n    payload: { maxUndoHistoryExceeded },\n  };\n}\n\nexport function maxUndoHistoryToast() {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    const historyLength = dashboardLayout.past.length;\n\n    return dispatch(\n      addWarningToast(\n        t(\n          'You have used all %(historyLength)s undo slots and will not be able to fully undo subsequent actions. You may save your current state to reset the history.',\n          { historyLength },\n        ),\n      ),\n    );\n  };\n}\n\nexport const SET_DATASETS_STATUS = 'SET_DATASETS_STATUS';\nexport function setDatasetsStatus(status) {\n  return {\n    type: SET_DATASETS_STATUS,\n    status,\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function serializeFilterScopes(dashboardFilters) {\n  return Object.values(dashboardFilters).reduce((map, { chartId, scopes }) => {\n    const scopesById = Object.keys(scopes).reduce(\n      (scopesByColumn, column) => ({\n        ...scopesByColumn,\n        [column]: scopes[column],\n      }),\n      {},\n    );\n\n    return {\n      ...map,\n      [chartId]: scopesById,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport { find, isEmpty } from 'lodash';\n\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\nimport { DASHBOARD_FILTER_SCOPE_GLOBAL } from 'src/dashboard/reducers/dashboardFilters';\nimport { Filter, NativeFilterType, TimeGranularity } from '@superset-ui/core';\nimport { getChartIdsInFilterBoxScope } from './activeDashboardFilters';\nimport getFilterConfigsFromFormdata from './getFilterConfigsFromFormdata';\n\ninterface FilterConfig {\n  asc: boolean;\n  clearable: boolean;\n  column: string;\n  defaultValue?: any;\n  key: string;\n  label?: string;\n  metric: string;\n  multiple: boolean;\n}\n\ninterface SliceData {\n  slice_id: number;\n  form_data: {\n    adhoc_filters?: [];\n    datasource: string;\n    date_filter?: boolean;\n    filter_configs?: FilterConfig[];\n    granularity?: string;\n    granularity_sqla?: string;\n    time_grain_sqla?: string;\n    time_range?: string;\n    show_sqla_time_column?: boolean;\n    show_sqla_time_granularity?: boolean;\n    viz_type: string;\n  };\n}\n\ninterface FilterScopeType {\n  scope: string[];\n  immune: number[];\n}\n\ninterface FilterScopesMetadata {\n  [key: string]: {\n    [key: string]: FilterScopeType;\n  };\n}\n\ninterface PreselectedFilterColumn {\n  [key: string]: boolean | string | number | string[] | number[];\n}\n\ninterface PreselectedFiltersMetadata {\n  [key: string]: PreselectedFilterColumn;\n}\n\ninterface FilterBoxToFilterComponentMap {\n  [key: string]: {\n    [key: string]: string;\n  };\n}\n\ninterface FilterBoxDependencyMap {\n  [key: string]: {\n    [key: string]: number[];\n  };\n}\n\nenum FILTER_COMPONENT_FILTER_TYPES {\n  FILTER_TIME = 'filter_time',\n  FILTER_TIMEGRAIN = 'filter_timegrain',\n  FILTER_TIMECOLUMN = 'filter_timecolumn',\n  FILTER_SELECT = 'filter_select',\n  FILTER_RANGE = 'filter_range',\n}\n\nconst getPreselectedValuesFromDashboard =\n  (preselectedFilters: PreselectedFiltersMetadata) =>\n  (filterKey: string, column: string) => {\n    if (preselectedFilters[filterKey]?.[column]) {\n      // overwrite default values by dashboard default_filters\n      return preselectedFilters[filterKey][column];\n    }\n    return null;\n  };\n\nconst getFilterBoxDefaultValues = (config: FilterConfig) => {\n  let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n  // treat empty string as null (no default value)\n  if (defaultValues === '') {\n    defaultValues = null;\n  }\n\n  // defaultValue could be ; separated values,\n  // could be null or ''\n  if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n    defaultValues = config.defaultValue.split(';');\n  }\n\n  return defaultValues;\n};\n\nconst setValuesInArray = (value1: any, value2: any) => {\n  if (!isEmpty(value1)) {\n    return [value1];\n  }\n  if (!isEmpty(value2)) {\n    return [value2];\n  }\n  return [];\n};\n\nconst getFilterboxDependencies = (filterScopes: FilterScopesMetadata) => {\n  const filterFieldsDependencies: FilterBoxDependencyMap = {};\n  const filterChartIds: number[] = Object.keys(filterScopes).map(key =>\n    parseInt(key, 10),\n  );\n  Object.entries(filterScopes).forEach(([key, filterFields]) => {\n    filterFieldsDependencies[key] = {};\n    Object.entries(filterFields).forEach(([filterField, filterScope]) => {\n      filterFieldsDependencies[key][filterField] = getChartIdsInFilterBoxScope({\n        filterScope,\n      }).filter(\n        chartId => filterChartIds.includes(chartId) && String(chartId) !== key,\n      );\n    });\n  });\n  return filterFieldsDependencies;\n};\n\nexport default function getNativeFilterConfig(\n  chartData: SliceData[] = [],\n  filterScopes: FilterScopesMetadata = {},\n  preselectFilters: PreselectedFiltersMetadata = {},\n): Filter[] {\n  const filterConfig: Filter[] = [];\n  const filterBoxToFilterComponentMap: FilterBoxToFilterComponentMap = {};\n\n  chartData.forEach(slice => {\n    const key = String(slice.slice_id);\n\n    if (slice.form_data.viz_type === 'filter_box') {\n      filterBoxToFilterComponentMap[key] = {};\n      const configs = getFilterConfigsFromFormdata(slice.form_data);\n      let { columns } = configs;\n      if (preselectFilters[key]) {\n        Object.keys(columns).forEach(col => {\n          if (preselectFilters[key][col]) {\n            columns = {\n              ...columns,\n              [col]: preselectFilters[key][col],\n            };\n          }\n        });\n      }\n\n      const scopesByChartId = Object.keys(columns).reduce((map, column) => {\n        const scopeSettings = {\n          ...filterScopes[key],\n        };\n        const { scope, immune }: FilterScopeType = {\n          ...DASHBOARD_FILTER_SCOPE_GLOBAL,\n          ...scopeSettings[column],\n        };\n\n        return {\n          ...map,\n          [column]: {\n            scope,\n            immune,\n          },\n        };\n      }, {});\n\n      const {\n        adhoc_filters = [],\n        datasource = '',\n        date_filter = false,\n        filter_configs = [],\n        granularity_sqla,\n        show_sqla_time_column = false,\n        show_sqla_time_granularity = false,\n        time_grain_sqla,\n        time_range,\n      } = slice.form_data;\n\n      const getDashboardDefaultValues =\n        getPreselectedValuesFromDashboard(preselectFilters);\n\n      if (date_filter) {\n        const { scope, immune }: FilterScopeType =\n          scopesByChartId[TIME_FILTER_MAP.time_range] ||\n          DASHBOARD_FILTER_SCOPE_GLOBAL;\n        const timeRangeFilter: Filter = {\n          id: `NATIVE_FILTER-${shortid.generate()}`,\n          description: 'time range filter',\n          controlValues: {},\n          name: TIME_FILTER_LABELS.time_range,\n          filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIME,\n          targets: [{}],\n          cascadeParentIds: [],\n          defaultDataMask: {},\n          type: NativeFilterType.NATIVE_FILTER,\n          scope: {\n            rootPath: scope,\n            excluded: immune,\n          },\n        };\n        filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.time_range] =\n          timeRangeFilter.id;\n        const dashboardDefaultValues =\n          getDashboardDefaultValues(key, TIME_FILTER_MAP.time_range) ||\n          time_range;\n        if (!isEmpty(dashboardDefaultValues)) {\n          timeRangeFilter.defaultDataMask = {\n            extraFormData: { time_range: dashboardDefaultValues as string },\n            filterState: { value: dashboardDefaultValues },\n          };\n        }\n        filterConfig.push(timeRangeFilter);\n\n        if (show_sqla_time_granularity) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.time_grain_sqla] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const timeGrainFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            controlValues: {},\n            description: 'time grain filter',\n            name: TIME_FILTER_LABELS.time_grain_sqla,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMEGRAIN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.time_grain_sqla] =\n            timeGrainFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.time_grain_sqla,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            timeGrainFilter.defaultDataMask = {\n              extraFormData: {\n                time_grain_sqla: (dashboardDefaultValues ||\n                  time_grain_sqla) as TimeGranularity,\n              },\n              filterState: {\n                value: setValuesInArray(\n                  dashboardDefaultValues,\n                  time_grain_sqla,\n                ),\n              },\n            };\n          }\n          filterConfig.push(timeGrainFilter);\n        }\n\n        if (show_sqla_time_column) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.granularity_sqla] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const timeColumnFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            description: 'time column filter',\n            controlValues: {},\n            name: TIME_FILTER_LABELS.granularity_sqla,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMECOLUMN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.granularity_sqla] =\n            timeColumnFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.granularity_sqla,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            timeColumnFilter.defaultDataMask = {\n              extraFormData: {\n                granularity_sqla: (dashboardDefaultValues ||\n                  granularity_sqla) as string,\n              },\n              filterState: {\n                value: setValuesInArray(\n                  dashboardDefaultValues,\n                  granularity_sqla,\n                ),\n              },\n            };\n          }\n          filterConfig.push(timeColumnFilter);\n        }\n      }\n\n      filter_configs.forEach(config => {\n        const { scope, immune }: FilterScopeType =\n          scopesByChartId[config.column] || DASHBOARD_FILTER_SCOPE_GLOBAL;\n        const entry: Filter = {\n          id: `NATIVE_FILTER-${shortid.generate()}`,\n          description: '',\n          controlValues: {\n            enableEmptyFilter: !config[FILTER_CONFIG_ATTRIBUTES.CLEARABLE],\n            defaultToFirstItem: false,\n            inverseSelection: false,\n            multiSelect: config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE],\n            sortAscending: config[FILTER_CONFIG_ATTRIBUTES.SORT_ASCENDING],\n          },\n          name: config.label || config.column,\n          filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_SELECT,\n          targets: [\n            {\n              datasetId: parseInt(datasource.split('__')[0], 10),\n              column: {\n                name: config.column,\n              },\n            },\n          ],\n          cascadeParentIds: [],\n          defaultDataMask: {},\n          type: NativeFilterType.NATIVE_FILTER,\n          scope: {\n            rootPath: scope,\n            excluded: immune,\n          },\n          adhoc_filters,\n          sortMetric: config[FILTER_CONFIG_ATTRIBUTES.SORT_METRIC],\n          time_range,\n        };\n        filterBoxToFilterComponentMap[key][config.column] = entry.id;\n        const defaultValues =\n          getDashboardDefaultValues(key, config.column) ||\n          getFilterBoxDefaultValues(config);\n        if (!isEmpty(defaultValues)) {\n          entry.defaultDataMask = {\n            extraFormData: {\n              filters: [{ col: config.column, op: 'IN', val: defaultValues }],\n            },\n            filterState: { value: defaultValues },\n          };\n        }\n        filterConfig.push(entry);\n      });\n    }\n  });\n\n  const dependencies: FilterBoxDependencyMap =\n    getFilterboxDependencies(filterScopes);\n  Object.entries(dependencies).forEach(([key, filterFields]) => {\n    Object.entries(filterFields).forEach(([field, childrenChartIds]) => {\n      const parentComponentId = filterBoxToFilterComponentMap[key][field];\n      childrenChartIds.forEach(childrenChartId => {\n        const childComponentIds = Object.values(\n          filterBoxToFilterComponentMap[childrenChartId],\n        );\n        childComponentIds.forEach(childComponentId => {\n          const childComponent = find(\n            filterConfig,\n            ({ id }) => id === childComponentId,\n          );\n          if (\n            childComponent &&\n            // time related filter components don't have parent\n            [\n              FILTER_COMPONENT_FILTER_TYPES.FILTER_SELECT,\n              FILTER_COMPONENT_FILTER_TYPES.FILTER_RANGE,\n            ].includes(\n              childComponent.filterType as FILTER_COMPONENT_FILTER_TYPES,\n            )\n          ) {\n            childComponent.cascadeParentIds =\n              childComponent.cascadeParentIds || [];\n            childComponent.cascadeParentIds.push(parentComponentId);\n          }\n        });\n      });\n    });\n  });\n\n  return filterConfig;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport { Behavior, getChartMetadataRegistry } from '@superset-ui/core';\n\nimport { chart } from 'src/components/Chart/chartReducer';\nimport { initSliceEntities } from 'src/dashboard/reducers/sliceEntities';\nimport { getInitialState as getInitialNativeFilterState } from 'src/dashboard/reducers/nativeFilters';\nimport { applyDefaultFormData } from 'src/explore/store';\nimport { buildActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { findPermission } from 'src/utils/findPermission';\nimport { canUserEditDashboard } from 'src/dashboard/util/permissionUtils';\nimport { isCrossFiltersEnabled } from 'src/dashboard/util/crossFilters';\nimport {\n  DASHBOARD_FILTER_SCOPE_GLOBAL,\n  dashboardFilter,\n} from 'src/dashboard/reducers/dashboardFilters';\nimport {\n  DASHBOARD_HEADER_ID,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n  DASHBOARD_ROOT_ID,\n} from 'src/dashboard/util/constants';\nimport {\n  DASHBOARD_HEADER_TYPE,\n  CHART_TYPE,\n  ROW_TYPE,\n} from 'src/dashboard/util/componentTypes';\nimport findFirstParentContainerId from 'src/dashboard/util/findFirstParentContainer';\nimport getEmptyLayout from 'src/dashboard/util/getEmptyLayout';\nimport getFilterConfigsFromFormdata from 'src/dashboard/util/getFilterConfigsFromFormdata';\nimport getLocationHash from 'src/dashboard/util/getLocationHash';\nimport newComponentFactory from 'src/dashboard/util/newComponentFactory';\nimport { TIME_RANGE } from 'src/visualizations/FilterBox/FilterBox';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { FILTER_BOX_MIGRATION_STATES } from 'src/explore/constants';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { FeatureFlag, isFeatureEnabled } from '../../featureFlags';\nimport extractUrlParams from '../util/extractUrlParams';\nimport getNativeFilterConfig from '../util/filterboxMigrationHelper';\nimport { updateColorSchema } from './dashboardInfo';\nimport { getChartIdsInFilterScope } from '../util/getChartIdsInFilterScope';\nimport updateComponentParentsList from '../util/updateComponentParentsList';\nimport { FilterBarOrientation } from '../types';\n\nexport const HYDRATE_DASHBOARD = 'HYDRATE_DASHBOARD';\n\nexport const hydrateDashboard =\n  ({\n    history,\n    dashboard,\n    charts,\n    filterboxMigrationState = FILTER_BOX_MIGRATION_STATES.NOOP,\n    dataMask,\n    activeTabs,\n  }) =>\n  (dispatch, getState) => {\n    const { user, common, dashboardState } = getState();\n    const { metadata, position_data: positionData } = dashboard;\n    const regularUrlParams = extractUrlParams('regular');\n    const reservedUrlParams = extractUrlParams('reserved');\n    const editMode = reservedUrlParams.edit === 'true';\n\n    let preselectFilters = {};\n\n    charts.forEach(chart => {\n      // eslint-disable-next-line no-param-reassign\n      chart.slice_id = chart.form_data.slice_id;\n    });\n    try {\n      // allow request parameter overwrite dashboard metadata\n      preselectFilters =\n        getUrlParam(URL_PARAMS.preselectFilters) ||\n        JSON.parse(metadata.default_filters);\n    } catch (e) {\n      //\n    }\n\n    if (metadata?.shared_label_colors) {\n      updateColorSchema(metadata, metadata?.shared_label_colors);\n    }\n\n    // Priming the color palette with user's label-color mapping provided in\n    // the dashboard's JSON metadata\n    if (metadata?.label_colors) {\n      updateColorSchema(metadata, metadata?.label_colors);\n    }\n\n    // new dash: position_json could be {} or null\n    const layout =\n      positionData && Object.keys(positionData).length > 0\n        ? positionData\n        : getEmptyLayout();\n\n    // create a lookup to sync layout names with slice names\n    const chartIdToLayoutId = {};\n    Object.values(layout).forEach(layoutComponent => {\n      if (layoutComponent.type === CHART_TYPE) {\n        chartIdToLayoutId[layoutComponent.meta.chartId] = layoutComponent.id;\n      }\n    });\n\n    // find root level chart container node for newly-added slices\n    const parentId = findFirstParentContainerId(layout);\n    const parent = layout[parentId];\n    let newSlicesContainer;\n    let newSlicesContainerWidth = 0;\n\n    const filterScopes = metadata?.filter_scopes || {};\n\n    const chartQueries = {};\n    const dashboardFilters = {};\n    const slices = {};\n    const sliceIds = new Set();\n    const slicesFromExploreCount = new Map();\n\n    charts.forEach(slice => {\n      const key = slice.slice_id;\n      const form_data = {\n        ...slice.form_data,\n        url_params: {\n          ...slice.form_data.url_params,\n          ...regularUrlParams,\n        },\n      };\n      chartQueries[key] = {\n        ...chart,\n        id: key,\n        form_data: applyDefaultFormData(form_data),\n      };\n\n      slices[key] = {\n        slice_id: key,\n        slice_url: slice.slice_url,\n        slice_name: slice.slice_name,\n        form_data: slice.form_data,\n        viz_type: slice.form_data.viz_type,\n        datasource: slice.form_data.datasource,\n        description: slice.description,\n        description_markeddown: slice.description_markeddown,\n        owners: slice.owners,\n        modified: slice.modified,\n        changed_on: new Date(slice.changed_on).getTime(),\n      };\n\n      sliceIds.add(key);\n\n      // if there are newly added slices from explore view, fill slices into 1 or more rows\n      if (!chartIdToLayoutId[key] && layout[parentId]) {\n        if (\n          newSlicesContainerWidth === 0 ||\n          newSlicesContainerWidth + GRID_DEFAULT_CHART_WIDTH > GRID_COLUMN_COUNT\n        ) {\n          newSlicesContainer = newComponentFactory(\n            ROW_TYPE,\n            (parent.parents || []).slice(),\n          );\n          layout[newSlicesContainer.id] = newSlicesContainer;\n          parent.children.push(newSlicesContainer.id);\n          newSlicesContainerWidth = 0;\n        }\n\n        const chartHolder = newComponentFactory(\n          CHART_TYPE,\n          {\n            chartId: slice.slice_id,\n          },\n          (newSlicesContainer.parents || []).slice(),\n        );\n\n        const count = (slicesFromExploreCount.get(slice.slice_id) ?? 0) + 1;\n        chartHolder.id = `${CHART_TYPE}-explore-${slice.slice_id}-${count}`;\n        slicesFromExploreCount.set(slice.slice_id, count);\n\n        layout[chartHolder.id] = chartHolder;\n        newSlicesContainer.children.push(chartHolder.id);\n        chartIdToLayoutId[chartHolder.meta.chartId] = chartHolder.id;\n        newSlicesContainerWidth += GRID_DEFAULT_CHART_WIDTH;\n      }\n\n      // build DashboardFilters for interactive filter features\n      if (slice.form_data.viz_type === 'filter_box') {\n        const configs = getFilterConfigsFromFormdata(slice.form_data);\n        let { columns } = configs;\n        const { labels } = configs;\n        if (preselectFilters[key]) {\n          Object.keys(columns).forEach(col => {\n            if (preselectFilters[key][col]) {\n              columns = {\n                ...columns,\n                [col]: preselectFilters[key][col],\n              };\n            }\n          });\n        }\n\n        const scopesByChartId = Object.keys(columns).reduce((map, column) => {\n          const scopeSettings = {\n            ...filterScopes[key],\n          };\n          const { scope, immune } = {\n            ...DASHBOARD_FILTER_SCOPE_GLOBAL,\n            ...scopeSettings[column],\n          };\n\n          return {\n            ...map,\n            [column]: {\n              scope,\n              immune,\n            },\n          };\n        }, {});\n\n        const componentId = chartIdToLayoutId[key];\n        const directPathToFilter = (layout[componentId].parents || []).slice();\n        directPathToFilter.push(componentId);\n        if (\n          [\n            FILTER_BOX_MIGRATION_STATES.NOOP,\n            FILTER_BOX_MIGRATION_STATES.SNOOZED,\n          ].includes(filterboxMigrationState)\n        ) {\n          dashboardFilters[key] = {\n            ...dashboardFilter,\n            chartId: key,\n            componentId,\n            datasourceId: slice.form_data.datasource,\n            filterName: slice.slice_name,\n            directPathToFilter,\n            columns,\n            labels,\n            scopes: scopesByChartId,\n            isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n          };\n        }\n      }\n\n      // sync layout names with current slice names in case a slice was edited\n      // in explore since the layout was updated. name updates go through layout for undo/redo\n      // functionality and python updates slice names based on layout upon dashboard save\n      const layoutId = chartIdToLayoutId[key];\n      if (layoutId && layout[layoutId]) {\n        layout[layoutId].meta.sliceName = slice.slice_name;\n      }\n    });\n\n    // make sure that parents tree is built\n    if (\n      Object.values(layout).some(\n        element => element.id !== DASHBOARD_ROOT_ID && !element.parents,\n      )\n    ) {\n      updateComponentParentsList({\n        currentComponent: layout[DASHBOARD_ROOT_ID],\n        layout,\n      });\n    }\n\n    buildActiveFilters({\n      dashboardFilters,\n      components: layout,\n    });\n\n    // store the header as a layout component so we can undo/redo changes\n    layout[DASHBOARD_HEADER_ID] = {\n      id: DASHBOARD_HEADER_ID,\n      type: DASHBOARD_HEADER_TYPE,\n      meta: {\n        text: dashboard.dashboard_title,\n      },\n    };\n\n    const dashboardLayout = {\n      past: [],\n      present: layout,\n      future: [],\n    };\n\n    // Searches for a focused_chart parameter in the URL to automatically focus a chart\n    const focusedChartId = getUrlParam(URL_PARAMS.dashboardFocusedChart);\n    let focusedChartLayoutId;\n    if (focusedChartId) {\n      // Converts focused_chart to dashboard layout id\n      const found = Object.values(dashboardLayout.present).find(\n        element => element.meta?.chartId === focusedChartId,\n      );\n      focusedChartLayoutId = found?.id;\n      // Removes the focused_chart parameter from the URL\n      const params = new URLSearchParams(window.location.search);\n      params.delete(URL_PARAMS.dashboardFocusedChart.name);\n      history.replace({\n        search: params.toString(),\n      });\n    }\n\n    // find direct link component and path from root\n    const directLinkComponentId = focusedChartLayoutId || getLocationHash();\n    let directPathToChild = dashboardState.directPathToChild || [];\n    if (layout[directLinkComponentId]) {\n      directPathToChild = (layout[directLinkComponentId].parents || []).slice();\n      directPathToChild.push(directLinkComponentId);\n    }\n\n    // should convert filter_box to filter component?\n    let filterConfig = metadata?.native_filter_configuration || [];\n    if (filterboxMigrationState === FILTER_BOX_MIGRATION_STATES.REVIEWING) {\n      filterConfig = getNativeFilterConfig(\n        charts,\n        filterScopes,\n        preselectFilters,\n      );\n      metadata.native_filter_configuration = filterConfig;\n      metadata.show_native_filters = true;\n    }\n    const nativeFilters = getInitialNativeFilterState({\n      filterConfig,\n    });\n    metadata.show_native_filters =\n      dashboard?.metadata?.show_native_filters ??\n      (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) &&\n        [\n          FILTER_BOX_MIGRATION_STATES.CONVERTED,\n          FILTER_BOX_MIGRATION_STATES.REVIEWING,\n          FILTER_BOX_MIGRATION_STATES.NOOP,\n        ].includes(filterboxMigrationState));\n\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n      // If user just added cross filter to dashboard it's not saving it scope on server,\n      // so we tweak it until user will update scope and will save it in server\n      Object.values(dashboardLayout.present).forEach(layoutItem => {\n        const chartId = layoutItem.meta?.chartId;\n        const behaviors =\n          (\n            getChartMetadataRegistry().get(\n              chartQueries[chartId]?.form_data?.viz_type,\n            ) ?? {}\n          )?.behaviors ?? [];\n\n        if (!metadata.chart_configuration) {\n          metadata.chart_configuration = {};\n        }\n        if (behaviors.includes(Behavior.INTERACTIVE_CHART)) {\n          if (!metadata.chart_configuration[chartId]) {\n            metadata.chart_configuration[chartId] = {\n              id: chartId,\n              crossFilters: {\n                scope: {\n                  rootPath: [DASHBOARD_ROOT_ID],\n                  excluded: [chartId], // By default it doesn't affects itself\n                },\n              },\n            };\n          }\n          metadata.chart_configuration[chartId].crossFilters.chartsInScope =\n            getChartIdsInFilterScope(\n              metadata.chart_configuration[chartId].crossFilters.scope,\n              chartQueries,\n              dashboardLayout.present,\n            );\n        }\n        if (\n          behaviors.includes(Behavior.INTERACTIVE_CHART) &&\n          !metadata.chart_configuration[chartId]\n        ) {\n          metadata.chart_configuration[chartId] = {\n            id: chartId,\n            crossFilters: {\n              scope: {\n                rootPath: [DASHBOARD_ROOT_ID],\n                excluded: [chartId], // By default it doesn't affects itself\n              },\n            },\n          };\n        }\n      });\n    }\n\n    const { roles } = user;\n    const canEdit = canUserEditDashboard(dashboard, user);\n    const crossFiltersEnabled = isCrossFiltersEnabled(\n      metadata.cross_filters_enabled,\n    );\n\n    return dispatch({\n      type: HYDRATE_DASHBOARD,\n      data: {\n        sliceEntities: { ...initSliceEntities, slices, isLoading: false },\n        charts: chartQueries,\n        // read-only data\n        dashboardInfo: {\n          ...dashboard,\n          metadata,\n          userId: user.userId ? String(user.userId) : null, // legacy, please use state.user instead\n          dash_edit_perm: canEdit,\n          dash_save_perm: findPermission('can_save_dash', 'Superset', roles),\n          dash_share_perm: findPermission(\n            'can_share_dashboard',\n            'Superset',\n            roles,\n          ),\n          superset_can_explore: findPermission(\n            'can_explore',\n            'Superset',\n            roles,\n          ),\n          superset_can_share: findPermission(\n            'can_share_chart',\n            'Superset',\n            roles,\n          ),\n          superset_can_csv: findPermission('can_csv', 'Superset', roles),\n          slice_can_edit: findPermission('can_slice', 'Superset', roles),\n          common: {\n            // legacy, please use state.common instead\n            flash_messages: common?.flash_messages,\n            conf: common?.conf,\n          },\n          filterBarOrientation:\n            (isFeatureEnabled(FeatureFlag.HORIZONTAL_FILTER_BAR) &&\n              metadata.filter_bar_orientation) ||\n            FilterBarOrientation.VERTICAL,\n          crossFiltersEnabled,\n        },\n        dataMask,\n        dashboardFilters,\n        nativeFilters,\n        dashboardState: {\n          preselectNativeFilters: getUrlParam(URL_PARAMS.nativeFilters),\n          sliceIds: Array.from(sliceIds),\n          directPathToChild,\n          directPathLastUpdated: Date.now(),\n          focusedFilterField: null,\n          expandedSlices: metadata?.expanded_slices || {},\n          refreshFrequency: metadata?.refresh_frequency || 0,\n          // dashboard viewers can set refresh frequency for the current visit,\n          // only persistent refreshFrequency will be saved to backend\n          shouldPersistRefreshFrequency: false,\n          css: dashboard.css || '',\n          colorNamespace: metadata?.color_namespace || null,\n          colorScheme: metadata?.color_scheme || null,\n          editMode: canEdit && editMode,\n          isPublished: dashboard.published,\n          hasUnsavedChanges: false,\n          dashboardIsSaving: false,\n          maxUndoHistoryExceeded: false,\n          lastModifiedTime: dashboard.changed_on,\n          isRefreshing: false,\n          isFiltersRefreshing: false,\n          activeTabs: activeTabs || dashboardState?.activeTabs || [],\n          filterboxMigrationState,\n          datasetsStatus: ResourceStatus.LOADING,\n        },\n        dashboardLayout,\n      },\n    });\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DASHBOARD_ROOT_TYPE, DASHBOARD_GRID_TYPE } from './componentTypes';\n\nimport {\n  DASHBOARD_GRID_ID,\n  DASHBOARD_ROOT_ID,\n  DASHBOARD_VERSION_KEY,\n} from './constants';\n\nexport default function getEmptyLayout() {\n  return {\n    [DASHBOARD_VERSION_KEY]: 'v2',\n    [DASHBOARD_ROOT_ID]: {\n      type: DASHBOARD_ROOT_TYPE,\n      id: DASHBOARD_ROOT_ID,\n      children: [DASHBOARD_GRID_ID],\n    },\n    [DASHBOARD_GRID_ID]: {\n      type: DASHBOARD_GRID_TYPE,\n      id: DASHBOARD_GRID_ID,\n      children: [],\n      parents: [DASHBOARD_ROOT_ID],\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { TABS_TYPE } from './componentTypes';\nimport { DASHBOARD_ROOT_ID } from './constants';\n\nexport default function findFirstParentContainerId(layout = {}) {\n  // DASHBOARD_GRID_TYPE or TABS_TYPE?\n  let parent = layout[DASHBOARD_ROOT_ID];\n  if (\n    parent &&\n    parent.children.length &&\n    layout[parent.children[0]].type === TABS_TYPE\n  ) {\n    const tabs = layout[parent.children[0]];\n    parent = layout[tabs.children[0]];\n  } else {\n    parent = layout[parent.children[0]];\n  }\n\n  return parent.id;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\n\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\nexport const SET_ALL_SLICES = 'SET_ALL_SLICES';\nconst FETCH_SLICES_PAGE_SIZE = 200;\n\nexport function getDatasourceParameter(datasourceId, datasourceType) {\n  return `${datasourceId}__${datasourceType}`;\n}\n\nexport function setAllSlices(slices) {\n  return { type: SET_ALL_SLICES, payload: { slices } };\n}\n\nexport const FETCH_ALL_SLICES_STARTED = 'FETCH_ALL_SLICES_STARTED';\nexport function fetchAllSlicesStarted() {\n  return { type: FETCH_ALL_SLICES_STARTED };\n}\n\nexport const FETCH_ALL_SLICES_FAILED = 'FETCH_ALL_SLICES_FAILED';\nexport function fetchAllSlicesFailed(error) {\n  return { type: FETCH_ALL_SLICES_FAILED, payload: { error } };\n}\n\nexport function fetchSlices(\n  userId,\n  excludeFilterBox,\n  dispatch,\n  filter_value,\n  sortColumn = 'changed_on',\n  slices = {},\n) {\n  const additional_filters = filter_value\n    ? [{ col: 'slice_name', opr: 'chart_all_text', value: filter_value }]\n    : [];\n\n  const cloneSlices = { ...slices };\n\n  return SupersetClient.get({\n    endpoint: `/api/v1/chart/?q=${rison.encode({\n      columns: [\n        'changed_on_delta_humanized',\n        'changed_on_utc',\n        'datasource_id',\n        'datasource_type',\n        'datasource_url',\n        'datasource_name_text',\n        'description_markeddown',\n        'description',\n        'id',\n        'params',\n        'slice_name',\n        'thumbnail_url',\n        'url',\n        'viz_type',\n      ],\n      filters: [...additional_filters],\n      page_size: FETCH_SLICES_PAGE_SIZE,\n      order_column:\n        sortColumn === 'changed_on' ? 'changed_on_delta_humanized' : sortColumn,\n      order_direction: sortColumn === 'changed_on' ? 'desc' : 'asc',\n    })}`,\n  })\n    .then(({ json }) => {\n      let { result } = json;\n      // disable add filter_box viz to dashboard\n      if (excludeFilterBox) {\n        result = result.filter(slice => slice.viz_type !== 'filter_box');\n      }\n      result.forEach(slice => {\n        let form_data = JSON.parse(slice.params);\n        form_data = {\n          ...form_data,\n          // force using datasource stored in relational table prop\n          datasource:\n            getDatasourceParameter(\n              slice.datasource_id,\n              slice.datasource_type,\n            ) || form_data.datasource,\n        };\n        cloneSlices[slice.id] = {\n          slice_id: slice.id,\n          slice_url: slice.url,\n          slice_name: slice.slice_name,\n          form_data,\n          datasource_name: slice.datasource_name_text,\n          datasource_url: slice.datasource_url,\n          datasource_id: slice.datasource_id,\n          datasource_type: slice.datasource_type,\n          changed_on: new Date(slice.changed_on_utc).getTime(),\n          description: slice.description,\n          description_markdown: slice.description_markeddown,\n          viz_type: slice.viz_type,\n          modified: slice.changed_on_delta_humanized,\n          changed_on_humanized: slice.changed_on_delta_humanized,\n          thumbnail_url: slice.thumbnail_url,\n        };\n      });\n\n      return dispatch(setAllSlices(cloneSlices));\n    })\n    .catch(errorResponse =>\n      getClientErrorObject(errorResponse).then(({ error }) => {\n        dispatch(\n          fetchAllSlicesFailed(error || t('Could not fetch all saved charts')),\n        );\n        dispatch(\n          addDangerToast(\n            t('Sorry there was an error fetching saved charts: ') + error,\n          ),\n        );\n      }),\n    );\n}\n\nexport function fetchAllSlices(userId, excludeFilterBox = false) {\n  return (dispatch, getState) => {\n    const { sliceEntities } = getState();\n    if (sliceEntities.lastUpdated === 0) {\n      dispatch(fetchAllSlicesStarted());\n      return fetchSlices(userId, excludeFilterBox, dispatch, undefined);\n    }\n\n    return dispatch(setAllSlices(sliceEntities.slices));\n  };\n}\n\nexport function fetchSortedSlices(\n  userId,\n  excludeFilterBox = false,\n  order_column,\n) {\n  return dispatch => {\n    dispatch(fetchAllSlicesStarted());\n    return fetchSlices(\n      userId,\n      excludeFilterBox,\n      dispatch,\n      undefined,\n      order_column,\n    );\n  };\n}\n\nexport function fetchFilteredSlices(\n  userId,\n  excludeFilterBox = false,\n  filter_value,\n) {\n  return (dispatch, getState) => {\n    dispatch(fetchAllSlicesStarted());\n    const { sliceEntities } = getState();\n    return fetchSlices(\n      userId,\n      excludeFilterBox,\n      dispatch,\n      filter_value,\n      undefined,\n      sliceEntities.slices,\n    );\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  ADD_FILTER,\n  REMOVE_FILTER,\n  CHANGE_FILTER,\n  UPDATE_DIRECT_PATH_TO_FILTER,\n  UPDATE_LAYOUT_COMPONENTS,\n  UPDATE_DASHBOARD_FILTERS_SCOPE,\n} from '../actions/dashboardFilters';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\nimport { TIME_RANGE } from '../../visualizations/FilterBox/FilterBox';\nimport { DASHBOARD_ROOT_ID } from '../util/constants';\nimport getFilterConfigsFromFormdata from '../util/getFilterConfigsFromFormdata';\nimport { buildActiveFilters } from '../util/activeDashboardFilters';\nimport { getChartIdAndColumnFromFilterKey } from '../util/getDashboardFilterKey';\n\nexport const DASHBOARD_FILTER_SCOPE_GLOBAL = {\n  scope: [DASHBOARD_ROOT_ID],\n  immune: [],\n};\n\nexport const dashboardFilter = {\n  chartId: null,\n  componentId: null,\n  filterName: null,\n  datasourceId: null,\n  directPathToFilter: [],\n  isDateFilter: false,\n  isInstantFilter: true,\n  columns: {},\n  labels: {},\n  scopes: {},\n};\n\nconst CHANGE_FILTER_VALUE_ACTIONS = [ADD_FILTER, REMOVE_FILTER, CHANGE_FILTER];\n\nexport default function dashboardFiltersReducer(dashboardFilters = {}, action) {\n  const actionHandlers = {\n    [ADD_FILTER]() {\n      const { chartId, component, form_data } = action;\n      const { columns, labels } = getFilterConfigsFromFormdata(form_data);\n      const scopes = Object.keys(columns).reduce(\n        (map, column) => ({\n          ...map,\n          [column]: DASHBOARD_FILTER_SCOPE_GLOBAL,\n        }),\n        {},\n      );\n      const directPathToFilter = component\n        ? (component.parents || []).slice().concat(component.id)\n        : [];\n\n      const newFilter = {\n        ...dashboardFilter,\n        chartId,\n        componentId: component.id,\n        datasourceId: form_data.datasource,\n        filterName: component.meta.sliceName,\n        directPathToFilter,\n        columns,\n        labels,\n        scopes,\n        isInstantFilter: !!form_data.instant_filtering,\n        isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n      };\n\n      return newFilter;\n    },\n\n    [CHANGE_FILTER](state) {\n      const { newSelectedValues, merge } = action;\n      const updatedColumns = Object.keys(newSelectedValues).reduce(\n        (columns, name) => {\n          // override existed column value, or add new column name\n          if (!merge || !(name in columns)) {\n            return {\n              ...columns,\n              [name]: newSelectedValues[name],\n            };\n          }\n\n          return {\n            ...columns,\n            [name]: [...columns[name], ...newSelectedValues[name]],\n          };\n        },\n        { ...state.columns },\n      );\n\n      return {\n        ...state,\n        columns: updatedColumns,\n      };\n    },\n\n    [UPDATE_DIRECT_PATH_TO_FILTER](state) {\n      const { path } = action;\n      return {\n        ...state,\n        directPathToFilter: path,\n      };\n    },\n  };\n\n  if (action.type === UPDATE_LAYOUT_COMPONENTS) {\n    buildActiveFilters({\n      dashboardFilters,\n      components: action.components,\n    });\n    return dashboardFilters;\n  }\n  if (action.type === UPDATE_DASHBOARD_FILTERS_SCOPE) {\n    const allDashboardFiltersScope = action.scopes;\n    // update filter scope for each filter field\n    const updatedFilters = Object.entries(allDashboardFiltersScope).reduce(\n      (map, entry) => {\n        const [filterKey, { scope, immune }] = entry;\n        const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n        const scopes = {\n          ...map[chartId].scopes,\n          [column]: {\n            scope,\n            immune,\n          },\n        };\n        return {\n          ...map,\n          [chartId]: {\n            ...map[chartId],\n            scopes,\n          },\n        };\n      },\n      dashboardFilters,\n    );\n\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n    return updatedFilters;\n  }\n  if (action.type === REMOVE_FILTER) {\n    const { chartId } = action;\n    const { [chartId]: deletedFilter, ...updatedFilters } = dashboardFilters;\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n\n    return updatedFilters;\n  }\n  if (action.type === HYDRATE_DASHBOARD) {\n    return action.data.dashboardFilters;\n  }\n\n  if (action.type in actionHandlers) {\n    const updatedFilters = {\n      ...dashboardFilters,\n      [action.chartId]: actionHandlers[action.type](\n        dashboardFilters[action.chartId],\n      ),\n    };\n    if (CHANGE_FILTER_VALUE_ACTIONS.includes(action.type)) {\n      buildActiveFilters({ dashboardFilters: updatedFilters });\n    }\n\n    return updatedFilters;\n  }\n\n  return dashboardFilters;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nimport {\n  FETCH_ALL_SLICES_FAILED,\n  FETCH_ALL_SLICES_STARTED,\n  SET_ALL_SLICES,\n} from '../actions/sliceEntities';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport const initSliceEntities = {\n  slices: {},\n  isLoading: true,\n  errorMessage: null,\n  lastUpdated: 0,\n};\n\nexport default function sliceEntitiesReducer(\n  state = initSliceEntities,\n  action,\n) {\n  const actionHandlers = {\n    [HYDRATE_DASHBOARD]() {\n      return {\n        ...action.data.sliceEntities,\n      };\n    },\n    [FETCH_ALL_SLICES_STARTED]() {\n      return {\n        ...state,\n        isLoading: true,\n      };\n    },\n    [SET_ALL_SLICES]() {\n      return {\n        ...state,\n        isLoading: false,\n        slices: { ...state.slices, ...action.payload.slices },\n        lastUpdated: new Date().getTime(),\n      };\n    },\n    [FETCH_ALL_SLICES_FAILED]() {\n      return {\n        ...state,\n        isLoading: false,\n        lastUpdated: new Date().getTime(),\n        errorMessage:\n          action.payload.error || t('Could not fetch all saved charts'),\n      };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isEmpty } from 'lodash';\nimport { mapValues, flow, keyBy } from 'lodash/fp';\nimport {\n  getChartIdAndColumnFromFilterKey,\n  getDashboardFilterKey,\n} from './getDashboardFilterKey';\nimport { CHART_TYPE } from './componentTypes';\nimport { DASHBOARD_FILTER_SCOPE_GLOBAL } from '../reducers/dashboardFilters';\n\nlet allFilterBoxChartIds = [];\nlet activeFilters = {};\nlet appliedFilterValuesByChart = {};\nlet allComponents = {};\n\n// output: { [id_column]: { values, scope } }\nexport function getActiveFilters() {\n  return activeFilters;\n}\n\n// currently filter_box is a chart,\n// when selecting filter scopes, they have to be out pulled out in a few places.\n// after we make filter_box a dashboard build-in component, will not need this check anymore.\nexport function isFilterBox(chartId) {\n  return allFilterBoxChartIds.includes(chartId);\n}\n\n// this function is to find all filter values applied to a chart,\n// it goes through all active filters and their scopes.\n// return: { [column]: array of selected values }\nexport function getAppliedFilterValues(chartId, filters) {\n  // use cached data if possible\n  if (!(chartId in appliedFilterValuesByChart)) {\n    const applicableFilters = Object.entries(filters || activeFilters).filter(\n      ([, { scope: chartIds }]) => chartIds.includes(chartId),\n    );\n    appliedFilterValuesByChart[chartId] = flow(\n      keyBy(\n        ([filterKey]) => getChartIdAndColumnFromFilterKey(filterKey).column,\n      ),\n      mapValues(([, { values }]) => values),\n    )(applicableFilters);\n  }\n  return appliedFilterValuesByChart[chartId];\n}\n\n// Legacy - getChartIdsInFilterBoxScope is used only by\n// components and functions related to filter box\n// Please use src/dashboard/util/getChartIdsInFilterScope instead\nexport function getChartIdsInFilterBoxScope({ filterScope }) {\n  function traverse(chartIds = [], component = {}, immuneChartIds = []) {\n    if (!component) {\n      return;\n    }\n\n    if (\n      component.type === CHART_TYPE &&\n      component.meta &&\n      component.meta.chartId &&\n      !immuneChartIds.includes(component.meta.chartId)\n    ) {\n      chartIds.push(component.meta.chartId);\n    } else if (component.children) {\n      component.children.forEach(child =>\n        traverse(chartIds, allComponents[child], immuneChartIds),\n      );\n    }\n  }\n\n  const chartIds = [];\n  const { scope: scopeComponentIds, immune: immuneChartIds } =\n    filterScope || DASHBOARD_FILTER_SCOPE_GLOBAL;\n  scopeComponentIds.forEach(componentId =>\n    traverse(chartIds, allComponents[componentId], immuneChartIds),\n  );\n\n  return chartIds;\n}\n\n// non-empty filter fields in dashboardFilters,\n// activeFilters map contains selected values and filter scope.\n// values: array of selected values\n// scope: array of chartIds that applicable to the filter field.\nexport function buildActiveFilters({ dashboardFilters = {}, components = {} }) {\n  allFilterBoxChartIds = Object.values(dashboardFilters).map(\n    filter => filter.chartId,\n  );\n\n  // clear cache\n  if (!isEmpty(components)) {\n    allComponents = components;\n  }\n  appliedFilterValuesByChart = {};\n  activeFilters = Object.values(dashboardFilters).reduce((result, filter) => {\n    const { chartId, columns, scopes } = filter;\n    const nonEmptyFilters = {};\n\n    Object.keys(columns).forEach(column => {\n      if (\n        Array.isArray(columns[column])\n          ? columns[column].length\n          : columns[column] !== undefined\n      ) {\n        // remove filter itself\n        const scope = getChartIdsInFilterBoxScope({\n          filterScope: scopes[column],\n        }).filter(id => chartId !== id);\n\n        nonEmptyFilters[getDashboardFilterKey({ chartId, column })] = {\n          values: columns[column],\n          scope,\n        };\n      }\n    });\n\n    return {\n      ...result,\n      ...nonEmptyFilters,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { NEW_COMPONENTS_SOURCE_ID } from './constants';\nimport findParentId from './findParentId';\nimport getDetailedComponentWidth from './getDetailedComponentWidth';\nimport newComponentFactory from './newComponentFactory';\n\nexport default function getComponentWidthFromDrop({\n  dropResult,\n  layout: components,\n}) {\n  const { source, destination, dragging } = dropResult;\n\n  const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n  const component = isNewComponent\n    ? newComponentFactory(dragging.type)\n    : components[dragging.id] || {};\n\n  // moving a component within the same container shouldn't change its width\n  if (source.id === destination.id) {\n    return component.meta.width;\n  }\n\n  const { width: draggingWidth, minimumWidth: minDraggingWidth } =\n    getDetailedComponentWidth({\n      component,\n      components,\n    });\n\n  const { width: destinationWidth, occupiedWidth: draggingOccupiedWidth } =\n    getDetailedComponentWidth({\n      id: destination.id,\n      components,\n    });\n\n  let destinationCapacity = Number(destinationWidth - draggingOccupiedWidth);\n\n  if (Number.isNaN(destinationCapacity)) {\n    const { width: grandparentWidth, occupiedWidth: grandparentOccupiedWidth } =\n      getDetailedComponentWidth({\n        id: findParentId({\n          childId: destination.id,\n          layout: components,\n        }),\n        components,\n      });\n\n    destinationCapacity = Number(grandparentWidth - grandparentOccupiedWidth);\n  }\n\n  if (\n    Number.isNaN(destinationCapacity) ||\n    Number.isNaN(Number(draggingWidth))\n  ) {\n    return draggingWidth;\n  }\n  if (destinationCapacity >= draggingWidth) {\n    return draggingWidth;\n  }\n  if (destinationCapacity >= minDraggingWidth) {\n    return destinationCapacity;\n  }\n\n  return -1;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport findParentId from './findParentId';\nimport { GRID_MIN_COLUMN_COUNT, GRID_COLUMN_COUNT } from './constants';\nimport {\n  ROW_TYPE,\n  COLUMN_TYPE,\n  MARKDOWN_TYPE,\n  CHART_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nfunction getTotalChildWidth({ id, components }) {\n  const component = components[id];\n  if (!component) return 0;\n\n  let width = 0;\n\n  (component.children || []).forEach(childId => {\n    const child = components[childId] || {};\n    width += (child.meta || {}).width || 0;\n  });\n\n  return width;\n}\n\nexport default function getDetailedComponentWidth({\n  // pass either an id, or a component\n  id,\n  component: passedComponent,\n  components = {},\n}) {\n  const result = {\n    width: undefined,\n    occupiedWidth: undefined,\n    minimumWidth: undefined,\n  };\n\n  const component = passedComponent || components[id];\n  if (!component) return result;\n\n  // note these remain as undefined if the component has no defined width\n  result.width = (component.meta || {}).width;\n  result.occupiedWidth = result.width;\n\n  if (component.type === ROW_TYPE) {\n    // not all rows have width 12, e\n    result.width =\n      getDetailedComponentWidth({\n        id: findParentId({\n          childId: component.id,\n          layout: components,\n        }),\n        components,\n      }).width || GRID_COLUMN_COUNT;\n    result.occupiedWidth = getTotalChildWidth({ id: component.id, components });\n    result.minimumWidth = result.occupiedWidth || GRID_MIN_COLUMN_COUNT;\n  } else if (component.type === COLUMN_TYPE) {\n    // find the width of the largest child, only rows count\n    result.minimumWidth = GRID_MIN_COLUMN_COUNT;\n    result.occupiedWidth = 0;\n    (component.children || []).forEach(childId => {\n      // rows don't have widths, so find the width of its children\n      if (components[childId].type === ROW_TYPE) {\n        result.minimumWidth = Math.max(\n          result.minimumWidth,\n          getTotalChildWidth({ id: childId, components }),\n        );\n      }\n    });\n  } else if (\n    component.type === DYNAMIC_TYPE ||\n    component.type === MARKDOWN_TYPE ||\n    component.type === CHART_TYPE\n  ) {\n    result.minimumWidth = GRID_MIN_COLUMN_COUNT;\n  }\n\n  return result;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\nexport default function getFilterConfigsFromFormdata(form_data = {}) {\n  const {\n    date_filter,\n    filter_configs = [],\n    show_druid_time_granularity,\n    show_sqla_time_column,\n    show_sqla_time_granularity,\n  } = form_data;\n  let configs = filter_configs.reduce(\n    ({ columns, labels }, config) => {\n      let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n      // treat empty string as null (no default value)\n      if (defaultValues === '') {\n        defaultValues = null;\n      }\n\n      // defaultValue could be ; separated values,\n      // could be null or ''\n      if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n        defaultValues = config.defaultValue.split(';');\n      }\n\n      const updatedColumns = {\n        ...columns,\n        [config.column]: config.vals || defaultValues,\n      };\n      const updatedLabels = {\n        ...labels,\n        [config.column]: config.label,\n      };\n\n      return {\n        columns: updatedColumns,\n        labels: updatedLabels,\n      };\n    },\n    { columns: {}, labels: {} },\n  );\n\n  if (date_filter) {\n    let updatedColumns = {\n      ...configs.columns,\n      [TIME_FILTER_MAP.time_range]: form_data.time_range,\n    };\n    const updatedLabels = {\n      ...configs.labels,\n      ...Object.entries(TIME_FILTER_MAP).reduce(\n        (map, [key, value]) => ({\n          ...map,\n          [value]: TIME_FILTER_LABELS[key],\n        }),\n        {},\n      ),\n    };\n\n    if (show_sqla_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.time_grain_sqla]: form_data.time_grain_sqla,\n      };\n    }\n\n    if (show_sqla_time_column) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity_sqla]: form_data.granularity_sqla,\n      };\n    }\n\n    if (show_druid_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity]: form_data.granularity,\n      };\n    }\n\n    configs = {\n      ...configs,\n      columns: updatedColumns,\n      labels: updatedLabels,\n    };\n  }\n  return configs;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/core';\n\nimport {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nimport {\n  MEDIUM_HEADER,\n  BACKGROUND_TRANSPARENT,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n} from './constants';\n\nconst typeToDefaultMetaData = {\n  [CHART_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [COLUMN_TYPE]: {\n    width: GRID_DEFAULT_CHART_WIDTH,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [DIVIDER_TYPE]: null,\n  [HEADER_TYPE]: {\n    text: t('New header'),\n    headerSize: MEDIUM_HEADER,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [MARKDOWN_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [ROW_TYPE]: { background: BACKGROUND_TRANSPARENT },\n  [TABS_TYPE]: null,\n  [TAB_TYPE]: {\n    text: '',\n    defaultText: t('Tab title'),\n    placeholder: t('Tab title'),\n  },\n  [DYNAMIC_TYPE]: {\n    width: GRID_COLUMN_COUNT,\n    background: BACKGROUND_TRANSPARENT,\n  },\n};\n\nfunction uuid(type) {\n  return `${type}-${shortid.generate()}`;\n}\n\nexport default function entityFactory(type, meta, parents = []) {\n  return {\n    type,\n    id: uuid(type),\n    children: [],\n    parents,\n    meta: {\n      ...typeToDefaultMetaData[type],\n      ...meta,\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\n// input: { [id_column1]: values, [id_column2]: values }\n// output: { id: { column1: values, column2: values } }\nexport default function serializeActiveFilterValues(activeFilters) {\n  return Object.entries(activeFilters).reduce((map, entry) => {\n    const [filterKey, { values }] = entry;\n    const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n    const entryByChartId = {\n      ...map[chartId],\n      [column]: values,\n    };\n    return {\n      ...map,\n      [chartId]: entryByChartId,\n    };\n  }, {});\n}\n","import { logging } from '@superset-ui/core';\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function updateComponentParentsList({\n  currentComponent,\n  layout = {},\n}) {\n  if (currentComponent && layout) {\n    if (layout[currentComponent.id]) {\n      const parentsList = Array.isArray(currentComponent.parents)\n        ? currentComponent.parents.slice()\n        : [];\n\n      parentsList.push(currentComponent.id);\n\n      if (Array.isArray(currentComponent.children)) {\n        currentComponent.children.forEach(childId => {\n          const child = layout[childId];\n          if (child) {\n            child.parents = parentsList; // eslint-disable-line no-param-reassign\n            updateComponentParentsList({\n              currentComponent: child,\n              layout,\n            });\n          } else {\n            logging.warn(\n              `The current layout does not contain a component with the id: ${childId}.  Skipping this component`,\n            );\n          }\n        });\n      }\n    } else {\n      logging.warn(\n        `The current layout does not contain a component with the id: ${currentComponent?.id}.  Skipping this component`,\n      );\n    }\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, css } from '@superset-ui/core';\nimport ControlHeader from '../ControlHeader';\nimport Checkbox from '../../../components/Checkbox';\n\nconst propTypes = {\n  value: PropTypes.bool,\n  label: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  value: false,\n  onChange: () => {},\n};\n\nconst CheckBoxControlWrapper = styled.div`\n  ${({ theme }) => css`\n    .ControlHeader label {\n      color: ${theme.colors.grayscale.dark1};\n    }\n    span[role='checkbox'] {\n      padding-right: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\nexport default class CheckboxControl extends React.Component {\n  onChange() {\n    this.props.onChange(!this.props.value);\n  }\n\n  renderCheckbox() {\n    return (\n      <Checkbox\n        onChange={this.onChange.bind(this)}\n        checked={!!this.props.value}\n      />\n    );\n  }\n\n  render() {\n    if (this.props.label) {\n      return (\n        <CheckBoxControlWrapper>\n          <ControlHeader\n            {...this.props}\n            leftNode={this.renderCheckbox()}\n            onClick={this.onChange.bind(this)}\n          />\n        </CheckBoxControlWrapper>\n      );\n    }\n    return this.renderCheckbox();\n  }\n}\nCheckboxControl.propTypes = propTypes;\nCheckboxControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CUSTOM_OPERATORS,\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport { getSimpleSQLExpression } from 'src/explore/exploreUtils';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nexport const CLAUSES = {\n  HAVING: 'HAVING',\n  WHERE: 'WHERE',\n};\n\nconst OPERATORS_TO_SQL = {\n  '==': '=',\n  '!=': '<>',\n  '>': '>',\n  '<': '<',\n  '>=': '>=',\n  '<=': '<=',\n  IN: 'IN',\n  'NOT IN': 'NOT IN',\n  LIKE: 'LIKE',\n  ILIKE: 'ILIKE',\n  REGEX: 'REGEX',\n  'IS NOT NULL': 'IS NOT NULL',\n  'IS NULL': 'IS NULL',\n  'IS TRUE': 'IS TRUE',\n  'IS FALSE': 'IS FALSE',\n  'LATEST PARTITION': ({ datasource }) =>\n    `= '{{ presto.latest_partition('${datasource.schema}.${datasource.datasource_name}') }}'`,\n};\n\nconst CUSTOM_OPERATIONS = [...CUSTOM_OPERATORS].map(\n  op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n);\n\nfunction translateToSql(adhocMetric, { useSimple } = {}) {\n  if (adhocMetric.expressionType === EXPRESSION_TYPES.SIMPLE || useSimple) {\n    const { subject, comparator } = adhocMetric;\n    const operator =\n      adhocMetric.operator &&\n      // 'LATEST PARTITION' supported callback only\n      adhocMetric.operator ===\n        OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.LATEST_PARTITION].operation\n        ? OPERATORS_TO_SQL[adhocMetric.operator](adhocMetric)\n        : OPERATORS_TO_SQL[adhocMetric.operator];\n    return getSimpleSQLExpression(subject, operator, comparator);\n  }\n  if (adhocMetric.expressionType === EXPRESSION_TYPES.SQL) {\n    return adhocMetric.sqlExpression;\n  }\n  return '';\n}\n\nexport default class AdhocFilter {\n  constructor(adhocFilter) {\n    this.expressionType = adhocFilter.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      this.subject = adhocFilter.subject;\n      this.operator = adhocFilter.operator?.toUpperCase();\n      this.operatorId = adhocFilter.operatorId;\n      this.comparator = adhocFilter.comparator;\n      if (\n        [Operators.IS_TRUE, Operators.IS_FALSE].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = adhocFilter.operatorId === Operators.IS_TRUE;\n      }\n      if (\n        [Operators.IS_NULL, Operators.IS_NOT_NULL].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = null;\n      }\n      this.clause = adhocFilter.clause || CLAUSES.WHERE;\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression =\n        typeof adhocFilter.sqlExpression === 'string'\n          ? adhocFilter.sqlExpression\n          : translateToSql(adhocFilter, { useSimple: true });\n      this.clause = adhocFilter.clause;\n      if (\n        adhocFilter.operator &&\n        CUSTOM_OPERATIONS.indexOf(adhocFilter.operator) >= 0\n      ) {\n        this.subject = adhocFilter.subject;\n        this.operator = adhocFilter.operator;\n        this.operatorId = adhocFilter.operatorId;\n      } else {\n        this.subject = null;\n        this.operator = null;\n      }\n      this.comparator = null;\n    }\n    this.isExtra = !!adhocFilter.isExtra;\n    this.isNew = !!adhocFilter.isNew;\n    this.datasourceWarning = !!adhocFilter.datasourceWarning;\n\n    this.filterOptionName =\n      adhocFilter.filterOptionName ||\n      `filter_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocFilter({\n      ...this,\n      // all duplicated fields are not new (i.e. will not open popup automatically)\n      isNew: false,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocFilter) {\n    return (\n      adhocFilter.expressionType === this.expressionType &&\n      adhocFilter.sqlExpression === this.sqlExpression &&\n      adhocFilter.operator === this.operator &&\n      adhocFilter.operatorId === this.operatorId &&\n      adhocFilter.comparator === this.comparator &&\n      adhocFilter.subject === this.subject\n    );\n  }\n\n  isValid() {\n    const nullCheckOperators = [Operators.IS_NOT_NULL, Operators.IS_NULL].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    const truthCheckOperators = [Operators.IS_TRUE, Operators.IS_FALSE].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      if (nullCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.operator && this.subject);\n      }\n      if (truthCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.subject && this.comparator !== null);\n      }\n      if (this.operator && this.subject && this.clause) {\n        if (Array.isArray(this.comparator)) {\n          if (this.comparator.length > 0) {\n            // A non-empty array of values ('IN' or 'NOT IN' clauses)\n            return true;\n          }\n        } else if (this.comparator !== null) {\n          // A value has been selected or typed\n          return true;\n        }\n      }\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!(this.sqlExpression && this.clause);\n    }\n    return false;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql();\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  getTooltipTitle() {\n    return this.translateToSql();\n  }\n\n  translateToSql() {\n    return translateToSql(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { Operators } from 'src/explore/constants';\nimport { useGetTimeRangeLabel } from '../utils';\n\nexport interface AdhocFilterOptionProps {\n  adhocFilter: AdhocFilter;\n  onFilterEdit: () => void;\n  onRemoveFilter: () => void;\n  options: OptionSortType[];\n  sections: string[];\n  operators: Operators[];\n  datasource: Record<string, any>;\n  partitionColumn: string;\n  onMoveLabel: () => void;\n  onDropLabel: () => void;\n  index: number;\n}\n\nexport default function AdhocFilterOption({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onRemoveFilter,\n  partitionColumn,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  sections,\n  operators,\n}: AdhocFilterOptionProps) {\n  const { actualTimeRange, title } = useGetTimeRangeLabel(adhocFilter);\n\n  return (\n    <AdhocFilterPopoverTrigger\n      sections={sections}\n      operators={operators}\n      adhocFilter={adhocFilter}\n      options={options}\n      datasource={datasource}\n      onFilterEdit={onFilterEdit}\n      partitionColumn={partitionColumn}\n    >\n      <OptionControlLabel\n        label={actualTimeRange ?? adhocFilter.getDefaultLabel()}\n        tooltipTitle={title ?? adhocFilter.getTooltipTitle()}\n        onRemove={onRemoveFilter}\n        onMoveLabel={onMoveLabel}\n        onDropLabel={onDropLabel}\n        index={index}\n        type={DndItemType.FilterOption}\n        withCaret\n        isExtra={adhocFilter.isExtra}\n      />\n    </AdhocFilterPopoverTrigger>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { EXPRESSION_TYPES, CLAUSES } from './AdhocFilter';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.HAVING, CLAUSES.WHERE]).isRequired,\n    subject: PropTypes.string.isRequired,\n    comparator: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.arrayOf(PropTypes.string),\n    ]).isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.WHERE, CLAUSES.HAVING]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  t,\n  logging,\n  SupersetClient,\n  withTheme,\n  ensureIsArray,\n} from '@superset-ui/core';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport {\n  AddControlLabel,\n  AddIconButton,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport Icons from 'src/components/Icons';\nimport Modal from 'src/components/Modal';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilterOption from 'src/explore/components/controls/FilterControl/AdhocFilterOption';\nimport AdhocFilter, {\n  CLAUSES,\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport adhocFilterType from 'src/explore/components/controls/FilterControl/adhocFilterType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\n\nconst { warning } = Modal;\n\nconst selectedMetricType = PropTypes.oneOfType([\n  PropTypes.string,\n  adhocMetricType,\n]);\n\nconst propTypes = {\n  label: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  name: PropTypes.string,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  onChange: PropTypes.func,\n  value: PropTypes.arrayOf(adhocFilterType),\n  datasource: PropTypes.object,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  selectedMetrics: PropTypes.oneOfType([\n    selectedMetricType,\n    PropTypes.arrayOf(selectedMetricType),\n  ]),\n  isLoading: PropTypes.bool,\n  canDelete: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  onChange: () => {},\n  columns: [],\n  savedMetrics: [],\n  selectedMetrics: [],\n};\n\nfunction isDictionaryForAdhocFilter(value) {\n  return value && !(value instanceof AdhocFilter) && value.expressionType;\n}\n\nclass AdhocFilterControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.optionsForSelect = this.optionsForSelect.bind(this);\n    this.onRemoveFilter = this.onRemoveFilter.bind(this);\n    this.onNewFilter = this.onNewFilter.bind(this);\n    this.onFilterEdit = this.onFilterEdit.bind(this);\n    this.moveLabel = this.moveLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.mapOption = this.mapOption.bind(this);\n    this.getMetricExpression = this.getMetricExpression.bind(this);\n    this.removeFilter = this.removeFilter.bind(this);\n\n    const filters = (this.props.value || []).map(filter =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    );\n\n    this.optionRenderer = option => <FilterDefinitionOption option={option} />;\n    this.valueRenderer = (adhocFilter, index) => (\n      <AdhocFilterOption\n        key={index}\n        index={index}\n        adhocFilter={adhocFilter}\n        onFilterEdit={this.onFilterEdit}\n        options={this.state.options}\n        sections={this.props.sections}\n        operators={this.props.operators}\n        datasource={this.props.datasource}\n        onRemoveFilter={e => {\n          e.stopPropagation();\n          this.onRemoveFilter(index);\n        }}\n        onMoveLabel={this.moveLabel}\n        onDropLabel={() => this.props.onChange(this.state.values)}\n        partitionColumn={this.state.partitionColumn}\n      />\n    );\n    this.state = {\n      values: filters,\n      options: this.optionsForSelect(this.props),\n      partitionColumn: null,\n    };\n  }\n\n  componentDidMount() {\n    const { datasource } = this.props;\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }) => {\n            if (json && json.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions &&\n                partitions.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                this.setState({ partitionColumn: partitions.cols[0] });\n              }\n            }\n          })\n          .catch(error => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (this.props.columns !== nextProps.columns) {\n      this.setState({ options: this.optionsForSelect(nextProps) });\n    }\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        values: (nextProps.value || []).map(filter =>\n          isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n        ),\n      });\n    }\n  }\n\n  removeFilter(index) {\n    const valuesCopy = [...this.state.values];\n    valuesCopy.splice(index, 1);\n    this.setState(prevState => ({\n      ...prevState,\n      values: valuesCopy,\n    }));\n    this.props.onChange(valuesCopy);\n  }\n\n  onRemoveFilter(index) {\n    const { canDelete } = this.props;\n    const { values } = this.state;\n    const result = canDelete?.(values[index], values);\n    if (typeof result === 'string') {\n      warning({ title: t('Warning'), content: result });\n      return;\n    }\n    this.removeFilter(index);\n  }\n\n  onNewFilter(newFilter) {\n    const mappedOption = this.mapOption(newFilter);\n    if (mappedOption) {\n      this.setState(\n        prevState => ({\n          ...prevState,\n          values: [...prevState.values, mappedOption],\n        }),\n        () => {\n          this.props.onChange(this.state.values);\n        },\n      );\n    }\n  }\n\n  onFilterEdit(changedFilter) {\n    this.props.onChange(\n      this.state.values.map(value => {\n        if (value.filterOptionName === changedFilter.filterOptionName) {\n          return changedFilter;\n        }\n        return value;\n      }),\n    );\n  }\n\n  onChange(opts) {\n    const options = (opts || [])\n      .map(option => this.mapOption(option))\n      .filter(option => option);\n    this.props.onChange(options);\n  }\n\n  getMetricExpression(savedMetricName) {\n    return this.props.savedMetrics.find(\n      savedMetric => savedMetric.metric_name === savedMetricName,\n    ).expression;\n  }\n\n  moveLabel(dragIndex, hoverIndex) {\n    const { values } = this.state;\n\n    const newValues = [...values];\n    [newValues[hoverIndex], newValues[dragIndex]] = [\n      newValues[dragIndex],\n      newValues[hoverIndex],\n    ];\n    this.setState({ values: newValues });\n  }\n\n  mapOption(option) {\n    // already a AdhocFilter, skip\n    if (option instanceof AdhocFilter) {\n      return option;\n    }\n    // via datasource saved metric\n    if (option.saved_metric_name) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        subject: this.getMetricExpression(option.saved_metric_name),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // has a custom label, meaning it's custom column\n    if (option.label) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        subject: new AdhocMetric(option).translateToSql(),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // add a new filter item\n    if (option.column_name) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        subject: option.column_name,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n        comparator: '',\n        clause: CLAUSES.WHERE,\n        isNew: true,\n      });\n    }\n    return null;\n  }\n\n  optionsForSelect(props) {\n    const options = [\n      ...props.columns,\n      ...ensureIsArray(props.selectedMetrics).map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce((results, option) => {\n        if (option.saved_metric_name) {\n          results.push({\n            ...option,\n            filterOptionName: option.saved_metric_name,\n          });\n        } else if (option.column_name) {\n          results.push({\n            ...option,\n            filterOptionName: `_col_${option.column_name}`,\n          });\n        } else if (option instanceof AdhocMetric) {\n          results.push({\n            ...option,\n            filterOptionName: `_adhocmetric_${option.label}`,\n          });\n        }\n        return results;\n      }, [])\n      .sort((a, b) =>\n        (a.saved_metric_name || a.column_name || a.label).localeCompare(\n          b.saved_metric_name || b.column_name || b.label,\n        ),\n      );\n  }\n\n  addNewFilterPopoverTrigger(trigger) {\n    return (\n      <AdhocFilterPopoverTrigger\n        operators={this.props.operators}\n        sections={this.props.sections}\n        adhocFilter={new AdhocFilter({})}\n        datasource={this.props.datasource}\n        options={this.state.options}\n        onFilterEdit={this.onNewFilter}\n        partitionColumn={this.state.partitionColumn}\n      >\n        {trigger}\n      </AdhocFilterPopoverTrigger>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div className=\"metrics-select\" data-test=\"adhoc-filter-control\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          {this.addNewFilterPopoverTrigger(\n            <AddIconButton data-test=\"add-filter-button\">\n              <Icons.PlusLarge\n                iconSize=\"s\"\n                iconColor={theme.colors.grayscale.light5}\n              />\n            </AddIconButton>,\n          )}\n        </HeaderContainer>\n        <LabelsContainer>\n          {this.state.values.length > 0\n            ? this.state.values.map((value, index) =>\n                this.valueRenderer(value, index),\n              )\n            : this.addNewFilterPopoverTrigger(\n                <AddControlLabel>\n                  <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                  {t('Add filter')}\n                </AddControlLabel>,\n              )}\n        </LabelsContainer>\n      </div>\n    );\n  }\n}\n\nAdhocFilterControl.propTypes = propTypes;\nAdhocFilterControl.defaultProps = defaultProps;\n\nexport default withTheme(AdhocFilterControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  sqlaAutoGeneratedMetricRegex,\n  AGGREGATES,\n} from 'src/explore/constants';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nfunction inferSqlExpressionColumn(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstCloseParen = adhocMetric.sqlExpression.indexOf(')');\n    const indexPairedOpenParen = adhocMetric.sqlExpression\n      .substring(0, indexFirstCloseParen)\n      .lastIndexOf('(');\n    if (indexFirstCloseParen > 0 && indexPairedOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(\n        indexPairedOpenParen + 1,\n        indexFirstCloseParen,\n      );\n    }\n  }\n  return null;\n}\n\nfunction inferSqlExpressionAggregate(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstOpenParen = adhocMetric.sqlExpression.indexOf('(');\n    if (indexFirstOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(0, indexFirstOpenParen);\n    }\n  }\n  return null;\n}\n\nexport default class AdhocMetric {\n  constructor(adhocMetric) {\n    this.expressionType = adhocMetric.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      // try to be clever in the case of transitioning from Sql expression back to simple expression\n      const inferredColumn = inferSqlExpressionColumn(adhocMetric);\n      this.column =\n        adhocMetric.column ||\n        (inferredColumn && { column_name: inferredColumn });\n      this.aggregate =\n        adhocMetric.aggregate || inferSqlExpressionAggregate(adhocMetric);\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression = adhocMetric.sqlExpression;\n      this.column = null;\n      this.aggregate = null;\n    }\n    this.datasourceWarning = !!adhocMetric.datasourceWarning;\n    this.hasCustomLabel = !!(adhocMetric.hasCustomLabel && adhocMetric.label);\n    this.label = this.hasCustomLabel\n      ? adhocMetric.label\n      : this.getDefaultLabel();\n\n    this.optionName =\n      adhocMetric.optionName ||\n      `metric_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql({ useVerboseName: true });\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  translateToSql(\n    params = { useVerboseName: false, transformCountDistinct: false },\n  ) {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      const aggregate = this.aggregate || '';\n      // eslint-disable-next-line camelcase\n      const column =\n        params.useVerboseName && this.column?.verbose_name\n          ? `(${this.column.verbose_name})`\n          : this.column?.column_name\n          ? `(${this.column.column_name})`\n          : '';\n      // transform from `count_distinct(column)` to `count(distinct column)`\n      if (\n        params.transformCountDistinct &&\n        aggregate === AGGREGATES.COUNT_DISTINCT &&\n        /^\\(.*\\)$/.test(column)\n      ) {\n        return `COUNT(DISTINCT ${column.slice(1, -1)})`;\n      }\n      return aggregate + column;\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return this.sqlExpression;\n    }\n    return '';\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocMetric({\n      ...this,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocMetric) {\n    return (\n      adhocMetric.label === this.label &&\n      adhocMetric.expressionType === this.expressionType &&\n      adhocMetric.sqlExpression === this.sqlExpression &&\n      adhocMetric.aggregate === this.aggregate &&\n      (adhocMetric.column && adhocMetric.column.column_name) ===\n        (this.column && this.column.column_name)\n    );\n  }\n\n  isValid() {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      return !!(this.column && this.aggregate);\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!this.sqlExpression;\n    }\n    return false;\n  }\n\n  inferSqlExpressionAggregate() {\n    return inferSqlExpressionAggregate(this);\n  }\n\n  inferSqlExpressionColumn() {\n    return inferSqlExpressionColumn(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport columnType from './columnType';\nimport adhocMetricType from './adhocMetricType';\nimport { StyledColumnOption } from '../../optionRenderers';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType,\n  ]).isRequired,\n};\n\nexport default function FilterDefinitionOption({ option }) {\n  if (option.saved_metric_name) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.saved_metric_name, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  if (option.column_name) {\n    return <StyledColumnOption column={option} showType />;\n  }\n  if (option.label) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.label, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  return null;\n}\nFilterDefinitionOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nimport { AGGREGATES } from 'src/explore/constants';\nimport columnType from './columnType';\nimport { EXPRESSION_TYPES } from './AdhocMetric';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    column: columnType.isRequired,\n    aggregate: PropTypes.oneOf(Object.keys(AGGREGATES)).isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  metric_name: PropTypes.string,\n  verbose_name: PropTypes.string,\n  expression: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, isEqualArray, t } from '@superset-ui/core';\nimport Select from 'src/components/Select/Select';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  default: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n  tokenSeparators: PropTypes.arrayOf(PropTypes.string),\n  notFoundContent: PropTypes.object,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string,\n};\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n};\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n    };\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      !isEqualArray(nextProps.choices, this.props.choices) ||\n      !isEqualArray(nextProps.options, this.props.options)\n    ) {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map(v =>\n        v?.[valueKey] !== undefined ? v[valueKey] : v,\n      );\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val?.[valueKey] !== undefined) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map(o => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined,\n      }));\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map(c => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label,\n          };\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey],\n          };\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      placeholder,\n      onFocus,\n      showHeader,\n      value,\n      tokenSeparators,\n      notFoundContent,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    } = this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    };\n\n    const getValue = () => {\n      const currentValue =\n        value ||\n        (this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n        currentValue === null &&\n        !this.state.options.find(o => o.value === null)\n      ) {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n        ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n        filterOption && typeof filterOption === 'function'\n          ? this.handleFilterOptions\n          : true,\n      header: showHeader && <ControlHeader {...headerProps} />,\n      loading: isLoading,\n      mode: isMulti || multi ? 'multiple' : 'single',\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      options: this.state.options,\n      placeholder,\n      sortComparator: this.props.sortComparator,\n      value: getValue(),\n      tokenSeparators,\n      notFoundContent,\n    };\n\n    return (\n      <div\n        css={theme => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        `}\n      >\n        <Select {...selectProps} />\n      </div>\n    );\n  }\n}\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\nimport { t } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport PopoverSection from 'src/components/PopoverSection';\nimport Checkbox from 'src/components/Checkbox';\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [],\n};\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [],\n    };\n    this.toggleCheckbox = this.toggleCheckbox.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.renderReverseCheckbox = this.renderReverseCheckbox.bind(this);\n  }\n\n  componentDidMount() {\n    this.onChange();\n  }\n\n  onChange() {\n    const { type } = this.state;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  toggleCheckbox() {\n    this.setState(\n      prevState => ({ reverseCheckbox: !prevState.reverseCheckbox }),\n      this.onChange,\n    );\n  }\n\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    }\n    if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    }\n    if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n\n  renderSelect(name, type) {\n    return (\n      <SelectControl\n        ariaLabel={name}\n        name={name}\n        choices={this.props.choices}\n        value={this.state[name]}\n        clearable={false}\n        onFocus={() => {\n          this.setType(type);\n        }}\n        onChange={value => {\n          this.setState({ [name]: value }, this.onChange);\n        }}\n      />\n    );\n  }\n\n  renderReverseCheckbox() {\n    return (\n      <span>\n        {t('Reverse lat/long ')}\n        <Checkbox\n          checked={this.state.reverseCheckbox}\n          onChange={this.toggleCheckbox}\n        />\n      </span>\n    );\n  }\n\n  renderPopoverContent() {\n    return (\n      <div style={{ width: '300px' }}>\n        <PopoverSection\n          title={t('Longitude & Latitude columns')}\n          isSelected={this.state.type === spatialTypes.latlong}\n          onSelect={this.setType.bind(this, spatialTypes.latlong)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Longitude')}\n              {this.renderSelect('lonCol', spatialTypes.latlong)}\n            </Col>\n            <Col xs={24} md={12}>\n              {t('Latitude')}\n              {this.renderSelect('latCol', spatialTypes.latlong)}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Delimited long & lat single column')}\n          info={t(\n            'Multiple formats accepted, look the geopy.points ' +\n              'Python library for more details',\n          )}\n          isSelected={this.state.type === spatialTypes.delimited}\n          onSelect={this.setType.bind(this, spatialTypes.delimited)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('lonlatCol', spatialTypes.delimited)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Geohash')}\n          isSelected={this.state.type === spatialTypes.geohash}\n          onSelect={this.setType.bind(this, spatialTypes.geohash)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('geohashCol', spatialTypes.geohash)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          content={this.renderPopoverContent()}\n          placement=\"topLeft\" // so that popover doesn't move when label changes\n          trigger=\"click\"\n        >\n          <Label className=\"pointer\">{this.renderLabelContent()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { TextArea } from 'src/components/Input';\nimport { t, withTheme } from '@superset-ui/core';\n\nimport Button from 'src/components/Button';\nimport { TextAreaEditor } from 'src/components/AsyncAceEditor';\nimport ModalTrigger from 'src/components/ModalTrigger';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  name: PropTypes.string,\n  onChange: PropTypes.func,\n  initialValue: PropTypes.string,\n  height: PropTypes.number,\n  minLines: PropTypes.number,\n  maxLines: PropTypes.number,\n  offerEditInModal: PropTypes.bool,\n  language: PropTypes.oneOf([\n    null,\n    'json',\n    'html',\n    'sql',\n    'markdown',\n    'javascript',\n  ]),\n  aboveEditorSection: PropTypes.node,\n  readOnly: PropTypes.bool,\n  resize: PropTypes.oneOf([\n    null,\n    'block',\n    'both',\n    'horizontal',\n    'inline',\n    'none',\n    'vertical',\n  ]),\n  textAreaStyles: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  initialValue: '',\n  height: 250,\n  minLines: 3,\n  maxLines: 10,\n  offerEditInModal: true,\n  readOnly: false,\n  resize: null,\n  textAreaStyles: {},\n};\n\nclass TextAreaControl extends React.Component {\n  onControlChange(event) {\n    const { value } = event.target;\n    this.props.onChange(value);\n  }\n\n  onAreaEditorChange(value) {\n    this.props.onChange(value);\n  }\n\n  renderEditor(inModal = false) {\n    const minLines = inModal ? 40 : this.props.minLines || 12;\n    if (this.props.language) {\n      const style = {\n        border: `1px solid ${this.props.theme.colors.grayscale.light1}`,\n        minHeight: `${minLines}em`,\n        width: 'auto',\n        ...this.props.textAreaStyles,\n      };\n      if (this.props.resize) {\n        style.resize = this.props.resize;\n      }\n      if (this.props.readOnly) {\n        style.backgroundColor = '#f2f2f2';\n      }\n\n      return (\n        <TextAreaEditor\n          mode={this.props.language}\n          style={style}\n          minLines={minLines}\n          maxLines={inModal ? 1000 : this.props.maxLines}\n          editorProps={{ $blockScrolling: true }}\n          defaultValue={this.props.initialValue}\n          readOnly={this.props.readOnly}\n          key={this.props.name}\n          {...this.props}\n          onChange={this.onAreaEditorChange.bind(this)}\n        />\n      );\n    }\n    return (\n      <TextArea\n        placeholder={t('textarea')}\n        onChange={this.onControlChange.bind(this)}\n        defaultValue={this.props.initialValue}\n        disabled={this.props.readOnly}\n        style={{ height: this.props.height }}\n      />\n    );\n  }\n\n  renderModalBody() {\n    return (\n      <>\n        <div>{this.props.aboveEditorSection}</div>\n        {this.renderEditor(true)}\n      </>\n    );\n  }\n\n  render() {\n    const controlHeader = <ControlHeader {...this.props} />;\n    return (\n      <div>\n        {controlHeader}\n        {this.renderEditor()}\n        {this.props.offerEditInModal && (\n          <ModalTrigger\n            modalTitle={controlHeader}\n            triggerNode={\n              <Button buttonSize=\"small\" className=\"m-t-5\">\n                {t('Edit')} <strong>{this.props.language}</strong>{' '}\n                {t('in modal')}\n              </Button>\n            }\n            modalBody={this.renderModalBody(true)}\n            responsive\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nTextAreaControl.propTypes = propTypes;\nTextAreaControl.defaultProps = defaultProps;\n\nexport default withTheme(TextAreaControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * This file exports all controls available for use in the different visualization types\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface:\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n     when changed. This should `true` for controls that only affect the rendering (client side)\n     and don't affect the query or backend data processing as those require to re run a query\n     and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n     should return error messages when the value is not valid. The error message gets\n     bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n     to overwrite configuration at runtime. This is useful to alter a component based on\n     anything external to it, like another control's value. For instance it's possible to\n     show a warning based on the value of another component. It's also possible to bind\n     arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, otherwise `renderTrigger: true` components will show up on the `Style` tab.\n *\n * Note that the keys defined in controls in this file that are not listed above represent\n * props specific for the React component defined as `type`. Also note that this module work\n * in tandem with `controlPanels/index.js` that defines how controls are composed into sections for\n * each and every visualization type.\n */\nimport React from 'react';\nimport {\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  legacyValidateInteger,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { formatSelectOptions } from 'src/explore/exploreUtils';\nimport { TIME_FILTER_LABELS } from './constants';\nimport { StyledColumnOption } from './components/optionRenderers';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS = [\n  ['SMART_NUMBER', t('Adaptive formatting')],\n  ['~g', t('Original value')],\n  [',d', ',d (12345.432 => 12,345)'],\n  ['.1s', '.1s (12345.432 => 10k)'],\n  ['.3s', '.3s (12345.432 => 12.3k)'],\n  [',.1%', ',.1% (12345.432 => 1,234,543.2%)'],\n  ['.3%', '.3% (12345.432 => 1234543.200%)'],\n  ['.4r', '.4r (12345.432 => 12350)'],\n  [',.3f', ',.3f (12345.432 => 12,345.432)'],\n  ['+,', '+, (12345.432 => +12,345.432)'],\n  ['$,.2f', '$,.2f (12345.432 => $12,345.43)'],\n  ['DURATION', t('Duration in ms (66000 => 1m 6s)')],\n  ['DURATION_SUB', t('Duration in ms (100.40008 => 100ms 400µs 80ns)')],\n];\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\n\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nexport const D3_FORMAT_DOCS =\n  'D3 format syntax: https://github.com/d3/d3-format';\n\nexport const D3_TIME_FORMAT_OPTIONS = [\n  ['smart_date', t('Adaptive formatting')],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%Y-%m-%d %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nconst timeColumnOption = {\n  verbose_name: 'Time',\n  column_name: '__timestamp',\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into ' +\n      'account',\n  ),\n};\n\nconst groupByControl = {\n  type: 'SelectControl',\n  multi: true,\n  freeForm: true,\n  label: t('Dimensions'),\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a series limit ' +\n      'to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: c => <StyledColumnOption column={c} showType />,\n  valueKey: 'column_name',\n  filterOption: ({ data: opt }, text) =>\n    (opt.column_name &&\n      opt.column_name.toLowerCase().indexOf(text.toLowerCase()) >= 0) ||\n    (opt.verbose_name &&\n      opt.verbose_name.toLowerCase().indexOf(text.toLowerCase()) >= 0),\n  mapStateToProps: (state, control) => {\n    const newState = {};\n    if (state.datasource) {\n      newState.options = state.datasource.columns.filter(c => c.groupby);\n      if (control && control.includeTime) {\n        newState.options.push(timeColumnOption);\n      }\n    }\n    return newState;\n  },\n};\n\nconst metrics = {\n  type: 'MetricsControl',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: state => {\n    const { datasource } = state;\n    return {\n      columns: datasource ? datasource.columns : [],\n      savedMetrics: datasource ? datasource.metrics : [],\n      datasource,\n    };\n  },\n  description: t('One or many metrics to display'),\n};\nconst metric = {\n  ...metrics,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport function columnChoices(datasource) {\n  if (datasource && datasource.columns) {\n    return datasource.columns\n      .map(col => [col.column_name, col.verbose_name || col.column_name])\n      .sort((opt1, opt2) =>\n        opt1[1].toLowerCase() > opt2[1].toLowerCase() ? 1 : -1,\n      );\n  }\n  return [];\n}\n\nexport const controls = {\n  metrics,\n\n  metric,\n\n  datasource: {\n    type: 'DatasourceControl',\n    label: t('Dataset'),\n    default: null,\n    description: null,\n    mapStateToProps: ({ datasource }) => ({\n      datasource,\n      isEditable: !!datasource,\n    }),\n  },\n\n  viz_type: {\n    type: 'VizTypeControl',\n    default: 'table',\n    description: t('The type of visualization to display'),\n  },\n\n  color_picker: {\n    label: t('Fixed color'),\n    description: t('Use this to define a static color for all circles'),\n    type: 'ColorPickerControl',\n    default: PRIMARY_COLOR,\n    renderTrigger: true,\n  },\n\n  metric_2: {\n    ...metric,\n    label: t('Right axis metric'),\n    clearable: true,\n    description: t('Choose a metric for right axis'),\n  },\n\n  linear_color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Linear color scheme'),\n    choices: () =>\n      sequentialSchemeRegistry.values().map(value => [value.id, value.label]),\n    default: sequentialSchemeRegistry.getDefaultKey(),\n    clearable: false,\n    description: '',\n    renderTrigger: true,\n    schemes: () => sequentialSchemeRegistry.getMap(),\n    isLinear: true,\n  },\n\n  secondary_metric: {\n    ...metric,\n    label: t('Color metric'),\n    default: null,\n    validators: [],\n    description: t('A metric to use for color'),\n  },\n\n  groupby: groupByControl,\n\n  columns: {\n    ...groupByControl,\n    label: t('Columns'),\n    description: t('One or many controls to pivot as columns'),\n  },\n\n  granularity: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.granularity,\n    default: 'P1D',\n    choices: [\n      [null, t('all')],\n      ['PT5S', t('5 seconds')],\n      ['PT30S', t('30 seconds')],\n      ['PT1M', t('1 minute')],\n      ['PT5M', t('5 minutes')],\n      ['PT30M', t('30 minutes')],\n      ['PT1H', t('1 hour')],\n      ['PT6H', t('6 hour')],\n      ['P1D', t('1 day')],\n      ['P7D', t('7 days')],\n      ['P1W', t('week')],\n      ['week_starting_sunday', t('week starting Sunday')],\n      ['week_ending_saturday', t('week ending Saturday')],\n      ['P1M', t('month')],\n      ['P3M', t('quarter')],\n      ['P1Y', t('year')],\n    ],\n    description: t(\n      'The time granularity for the visualization. Note that you ' +\n        'can type and use simple natural language as in `10 seconds`,' +\n        '`1 day` or `56 weeks`',\n    ),\n  },\n\n  granularity_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.granularity_sqla,\n    description: t(\n      'The time column for the visualization. Note that you ' +\n        'can define arbitrary expression that return a DATETIME ' +\n        'column in the table. Also note that the ' +\n        'filter below is applied against this column or ' +\n        'expression',\n    ),\n    clearable: false,\n    optionRenderer: c => <StyledColumnOption column={c} showType />,\n    valueKey: 'column_name',\n    mapStateToProps: state => {\n      const props = {};\n      if (state.datasource) {\n        props.choices = state.datasource.granularity_sqla;\n        props.default = null;\n        if (state.datasource.main_dttm_col) {\n          props.default = state.datasource.main_dttm_col;\n        } else if (props.choices && props.choices.length > 0) {\n          props.default = props.choices[0].column_name;\n        }\n      }\n      return props;\n    },\n  },\n\n  time_grain_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.time_grain_sqla,\n    default: 'P1D',\n    description: t(\n      'The time granularity for the visualization. This ' +\n        'applies a date transformation to alter ' +\n        'your time column and defines a new time granularity. ' +\n        'The options here are defined on a per database ' +\n        'engine basis in the Superset source code.',\n    ),\n    mapStateToProps: state => ({\n      choices: state.datasource ? state.datasource.time_grain_sqla : null,\n    }),\n  },\n\n  time_range: {\n    type: 'DateFilterControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.time_range,\n    default: t('No filter'), // this value is translated, but the backend wouldn't understand a translated value?\n    description: t(\n      'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n        '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n        'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n        'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n        \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n        'per the ISO 8601 format if specifying either the start and/or end time.',\n    ),\n  },\n\n  row_limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Row limit'),\n    validators: [legacyValidateInteger],\n    default: 10000,\n    choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n    description: t('Limits the number of rows that get displayed.'),\n  },\n\n  limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Series limit'),\n    validators: [legacyValidateInteger],\n    choices: formatSelectOptions(SERIES_LIMITS),\n    clearable: true,\n    description: t(\n      'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n        'where subqueries are not supported) is applied to limit the number of series that get ' +\n        'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n        'column(s) though does increase the query complexity and cost.',\n    ),\n  },\n\n  timeseries_limit_metric: {\n    type: 'MetricsControl',\n    label: t('Sort by'),\n    default: null,\n    clearable: true,\n    description: t(\n      'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n        'If undefined reverts to the first metric (where appropriate).',\n    ),\n    mapStateToProps: state => ({\n      columns: state.datasource ? state.datasource.columns : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  series: {\n    ...groupByControl,\n    label: t('Dimensions'),\n    multi: false,\n    default: null,\n    description: t(\n      'Defines the grouping of entities. ' +\n        'Each series is shown as a specific color on the chart and ' +\n        'has a legend toggle',\n    ),\n  },\n\n  entity: {\n    ...groupByControl,\n    label: t('Entity'),\n    default: null,\n    multi: false,\n    validators: [validateNonEmpty],\n    description: t('This defines the element to be plotted on the chart'),\n  },\n\n  x: {\n    ...metric,\n    label: t('X Axis'),\n    description: t('Metric assigned to the [X] axis'),\n    default: null,\n  },\n\n  y: {\n    ...metric,\n    label: t('Y Axis'),\n    default: null,\n    description: t('Metric assigned to the [Y] axis'),\n  },\n\n  size: {\n    ...metric,\n    label: t('Bubble size'),\n    default: null,\n  },\n\n  y_axis_format: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: 'SMART_NUMBER',\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    mapStateToProps: state => {\n      const showWarning =\n        state.controls &&\n        state.controls.comparison_type &&\n        state.controls.comparison_type.value === 'percentage';\n      return {\n        warning: showWarning\n          ? t(\n              'When `Calculation type` is set to \"Percentage change\", the Y ' +\n                'Axis Format is forced to `.1%`',\n            )\n          : null,\n        disabled: showWarning,\n      };\n    },\n  },\n\n  adhoc_filters: {\n    type: 'AdhocFilterControl',\n    label: t('Filters'),\n    default: null,\n    description: '',\n    mapStateToProps: state => ({\n      columns: state.datasource\n        ? state.datasource.columns.filter(c => c.filterable)\n        : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Color scheme'),\n    default: categoricalSchemeRegistry.getDefaultKey(),\n    renderTrigger: true,\n    choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n    description: t('The color scheme for rendering chart'),\n    schemes: () => categoricalSchemeRegistry.getMap(),\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport { getAllControlsState, getFormDataFromControls } from './controlUtils';\nimport { controls } from './controls';\n\nfunction handleDeprecatedControls(formData) {\n  // Reaffectation / handling of deprecated controls\n  /* eslint-disable no-param-reassign */\n\n  // y_axis_zero was a boolean forcing 0 to be part of the Y Axis\n  if (formData.y_axis_zero) {\n    formData.y_axis_bounds = [0, null];\n  }\n}\n\nexport function getControlsState(state, inputFormData) {\n  /*\n   * Gets a new controls object to put in the state. The controls object\n   * is similar to the configuration control with only the controls\n   * related to the current viz_type, materializes mapStateToProps functions,\n   * adds value keys coming from inputFormData passed here. This can't be an action creator\n   * just yet because it's used in both the explore and dashboard views.\n   * */\n  // Getting a list of active control names for the current viz\n  const formData = { ...inputFormData };\n  const vizType =\n    formData.viz_type || state.common?.conf.DEFAULT_VIZ_TYPE || 'table';\n\n  handleDeprecatedControls(formData);\n  const controlsState = getAllControlsState(\n    vizType,\n    state.datasource.type,\n    state,\n    formData,\n  );\n\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  if (controlPanelConfig.onInit) {\n    return controlPanelConfig.onInit(controlsState);\n  }\n\n  return controlsState;\n}\n\nexport function applyDefaultFormData(inputFormData) {\n  const datasourceType = inputFormData.datasource.split('__')[1];\n  const vizType = inputFormData.viz_type;\n  const controlsState = getAllControlsState(\n    vizType,\n    datasourceType,\n    null,\n    inputFormData,\n  );\n  const controlFormData = getFormDataFromControls(controlsState);\n\n  const formData = {};\n  Object.keys(controlsState)\n    .concat(Object.keys(inputFormData))\n    .forEach(controlName => {\n      if (inputFormData[controlName] === undefined) {\n        formData[controlName] = controlFormData[controlName];\n      } else {\n        formData[controlName] = inputFormData[controlName];\n      }\n    });\n\n  return formData;\n}\n\nconst defaultControls = { ...controls };\nObject.keys(controls).forEach(f => {\n  defaultControls[f].value = controls[f].default;\n});\n\nconst defaultState = {\n  controls: defaultControls,\n  form_data: getFormDataFromControls(defaultControls),\n};\n\nexport { defaultControls, defaultState };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nfunction extractTypes(metadata) {\n  return Object.keys(metadata).reduce((prev, key) => {\n    const result = prev;\n    result[key] = key;\n    return result;\n  }, {});\n}\n\nexport const ANNOTATION_TYPES_METADATA = {\n  FORMULA: {\n    value: 'FORMULA',\n    label: t('Formula'),\n  },\n  EVENT: {\n    value: 'EVENT',\n    label: t('Event'),\n    supportNativeSource: true,\n  },\n  INTERVAL: {\n    value: 'INTERVAL',\n    label: t('Interval'),\n    supportNativeSource: true,\n  },\n  TIME_SERIES: {\n    value: 'TIME_SERIES',\n    label: t('Time series'),\n  },\n};\n\nexport const ANNOTATION_TYPES = extractTypes(ANNOTATION_TYPES_METADATA);\n\nexport const DEFAULT_ANNOTATION_TYPE = ANNOTATION_TYPES.FORMULA;\n\nexport const ANNOTATION_SOURCE_TYPES_METADATA = {\n  NATIVE: {\n    value: 'NATIVE',\n    label: 'Superset annotation',\n  },\n};\n\nexport const ANNOTATION_SOURCE_TYPES = extractTypes(\n  ANNOTATION_SOURCE_TYPES_METADATA,\n);\n\nexport function requiresQuery(annotationSourceType) {\n  return !!annotationSourceType;\n}\n\nconst NATIVE_COLUMN_NAMES = {\n  timeColumn: 'start_dttm',\n  intervalEndColumn: 'end_dttm',\n  titleColumn: 'short_descr',\n  descriptionColumns: ['long_descr'],\n};\n\nexport function applyNativeColumns(annotation) {\n  if (annotation.sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n    return { ...annotation, ...NATIVE_COLUMN_NAMES };\n  }\n  return annotation;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport {\n  addDangerToast,\n  addSuccessToast,\n} from 'src/components/MessageToasts/actions';\nimport { isEmpty } from 'lodash';\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report, resourceId, creationMethod, filterField) {\n  return { type: SET_REPORT, report, resourceId, creationMethod, filterField };\n}\n\nexport function fetchUISpecificReport({\n  userId,\n  filterField,\n  creationMethod,\n  resourceId,\n}) {\n  const queryParams = rison.encode({\n    filters: [\n      {\n        col: filterField,\n        opr: 'eq',\n        value: resourceId,\n      },\n      {\n        col: 'creation_method',\n        opr: 'eq',\n        value: creationMethod,\n      },\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: userId,\n      },\n    ],\n  });\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}`,\n    })\n      .then(({ json }) => {\n        dispatch(setReport(json, resourceId, creationMethod, filterField));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching reports attached to this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (!isEmpty(dashboardInfo)) {\n    dispatch(\n      fetchUISpecificReport({\n        userId: user.userId,\n        filterField: 'dashboard_id',\n        creationMethod: 'dashboards',\n        resourceId: dashboardInfo.id,\n      }),\n    );\n  } else {\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n      fetchUISpecificReport({\n        userId: explore.user?.userId || user?.userId,\n        filterField: 'chart_id',\n        creationMethod: 'charts',\n        resourceId: charts[chartArr].id,\n      }),\n    );\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = report => dispatch =>\n  SupersetClient.post({\n    endpoint: `/api/v1/report/`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: ADD_REPORT, json });\n    dispatch(addSuccessToast(t('The report has been created')));\n  });\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport const editReport = (id, report) => dispatch =>\n  SupersetClient.put({\n    endpoint: `/api/v1/report/${id}`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: EDIT_REPORT, json });\n    dispatch(addSuccessToast(t('Report updated')));\n  });\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive,\n      }),\n    })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('We were unable to active or deactivate this report.'),\n          ),\n        );\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n      });\n  };\n}\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n    })\n      .catch(() => {\n        dispatch(addDangerToast(t('Your report could not be deleted')));\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n        dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n      });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  Component,\n  FunctionComponent,\n  ReactElement,\n  RefObject,\n} from 'react';\nimport {\n  ListChildComponentProps,\n  FixedSizeList as WindowedList,\n} from 'react-window';\nimport {\n  OptionTypeBase,\n  OptionProps,\n  MenuListComponentProps,\n} from 'react-select';\nimport { ThemeConfig } from '../styles';\n\nexport type WindowedMenuListProps = {\n  selectProps: {\n    windowListRef?: RefObject<WindowedList>;\n    optionHeight?: number;\n  };\n};\n\n/**\n * MenuListComponentProps should always have `children` elements, as guaranteed\n * by https://github.com/JedWatson/react-select/blob/32ad5c040bdd96cd1ca71010c2558842d684629c/packages/react-select/src/Select.js#L1686-L1719\n *\n * `children` may also be `Component<NoticeProps<OptionType>>` if options are not\n * provided (e.g., when async list is still loading, or no results), but that's\n * not possible because this MenuList will only be rendered when\n * optionsLength > windowThreshold.\n *\n * If may also be `Component<GroupProps<OptionType>>[]` but we are not supporting\n * grouped options just yet.\n */\n\ntype MenuListPropsChildren<OptionType extends OptionTypeBase> =\n  | Component<OptionProps<OptionType>>[]\n  | ReactElement[];\n\nexport type MenuListProps<OptionType extends OptionTypeBase> =\n  MenuListComponentProps<OptionType> & {\n    children: MenuListPropsChildren<OptionType>;\n    // theme is not present with built-in @types/react-select, but is actually\n    // available via CommonProps.\n    theme?: ThemeConfig;\n    className?: string;\n  } & WindowedMenuListProps;\n\nconst DEFAULT_OPTION_HEIGHT = 30;\n\n/**\n * Get the index of the last selected option.\n */\nfunction getLastSelected(children: MenuListPropsChildren<any>) {\n  return Array.isArray(children)\n    ? children.findIndex(\n        ({ props: { isFocused = false } = {} }) => isFocused,\n      ) || 0\n    : -1;\n}\n\n/**\n * Calculate probable option height as set in theme configs\n */\nfunction detectHeight({ spacing: { baseUnit, lineHeight } }: ThemeConfig) {\n  // Option item expects 2 * baseUnit for each of top and bottom padding.\n  return baseUnit * 4 + lineHeight;\n}\n\nexport default function WindowedMenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListProps<OptionType>) {\n  const {\n    maxHeight,\n    selectProps,\n    theme,\n    getStyles,\n    cx,\n    innerRef,\n    isMulti,\n    className,\n  } = props;\n  const {\n    // Expose react-window VariableSizeList instance and HTML elements\n    windowListRef: windowListRef_,\n    windowListInnerRef,\n  } = selectProps;\n  const defaultWindowListRef = useRef<WindowedList>(null);\n  const windowListRef = windowListRef_ || defaultWindowListRef;\n\n  // try get default option height from theme configs\n  let { optionHeight } = selectProps;\n  if (!optionHeight) {\n    optionHeight = theme ? detectHeight(theme) : DEFAULT_OPTION_HEIGHT;\n  }\n\n  const itemCount = children.length;\n  const totalHeight = optionHeight * itemCount;\n\n  const Row: FunctionComponent<ListChildComponentProps> = ({\n    data,\n    index,\n    style,\n  }) => <div style={style}>{data[index]}</div>;\n\n  useEffect(() => {\n    const lastSelected = getLastSelected(children);\n    if (windowListRef.current && lastSelected) {\n      windowListRef.current.scrollToItem(lastSelected);\n    }\n  }, [children, windowListRef]);\n\n  return (\n    <WindowedList\n      css={getStyles('menuList', props)}\n      className={cx(\n        {\n          'menu-list': true,\n          'menu-list--is-multi': isMulti,\n        },\n        className,\n      )}\n      ref={windowListRef}\n      outerRef={innerRef}\n      innerRef={windowListInnerRef}\n      height={Math.min(totalHeight, maxHeight)}\n      width=\"100%\"\n      itemData={children}\n      itemCount={children.length}\n      itemSize={optionHeight}\n    >\n      {Row}\n    </WindowedList>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ComponentType,\n  FunctionComponent,\n  ReactElement,\n  forwardRef,\n} from 'react';\nimport Select, {\n  Props as SelectProps,\n  OptionTypeBase,\n  MenuListComponentProps,\n  components as defaultComponents,\n} from 'react-select';\nimport WindowedMenuList, { WindowedMenuListProps } from './WindowedMenuList';\n\nconst { MenuList: DefaultMenuList } = defaultComponents;\n\nexport const DEFAULT_WINDOW_THRESHOLD = 100;\n\nexport type WindowedSelectProps<OptionType extends OptionTypeBase> =\n  SelectProps<OptionType> & {\n    windowThreshold?: number;\n  } & WindowedMenuListProps['selectProps'];\n\nexport type WindowedSelectComponentType<OptionType extends OptionTypeBase> =\n  FunctionComponent<WindowedSelectProps<OptionType>>;\n\nexport function MenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListComponentProps<OptionType> & {\n  selectProps: WindowedSelectProps<OptionType>;\n}) {\n  const { windowThreshold = DEFAULT_WINDOW_THRESHOLD } = props.selectProps;\n  if (Array.isArray(children) && children.length > windowThreshold) {\n    return (\n      <WindowedMenuList {...props}>\n        {children as ReactElement[]}\n      </WindowedMenuList>\n    );\n  }\n  return <DefaultMenuList {...props}>{children}</DefaultMenuList>;\n}\n\n/**\n * Add \"windowThreshold\" option to a react-select component, turn the options\n * list into a virtualized list when appropriate.\n *\n * @param SelectComponent the React component to render Select\n */\nexport default function windowed<OptionType extends OptionTypeBase>(\n  SelectComponent: ComponentType<SelectProps<OptionType>>,\n): WindowedSelectComponentType<OptionType> {\n  const WindowedSelect = forwardRef(\n    (\n      props: WindowedSelectProps<OptionType>,\n      ref: React.RefObject<Select<OptionType>>,\n    ) => {\n      const { components: components_ = {}, ...restProps } = props;\n      const components = { ...components_, MenuList };\n      return (\n        <SelectComponent components={components} ref={ref} {...restProps} />\n      );\n    },\n  );\n  return WindowedSelect;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Select from 'react-select';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\nimport windowed from './windowed';\n\nexport * from './windowed';\n\nexport const WindowedSelect = windowed(Select);\nexport const WindowedCreatableSelect = windowed(Creatable);\nexport const WindowedAsyncCreatableSelect = windowed(AsyncCreatable);\nexport default WindowedSelect;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// Deprecated component\n/* eslint-disable theme-colors/no-literal-colors */\n\nimport React, { CSSProperties, ComponentType, ReactNode } from 'react';\nimport { SerializedStyles } from '@emotion/react';\nimport { SupersetTheme, css } from '@superset-ui/core';\nimport {\n  Styles,\n  Theme,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  InputProps as ReactSelectInputProps,\n  Props as SelectProps,\n} from 'react-select';\nimport type { colors as reactSelectColors } from 'react-select/src/theme';\nimport type { DeepNonNullable } from 'react-select/src/components';\nimport { OptionType } from 'antd/lib/select';\nimport { SupersetStyledSelectProps } from './DeprecatedSelect';\n\nexport const DEFAULT_CLASS_NAME = 'Select';\nexport const DEFAULT_CLASS_NAME_PREFIX = 'Select';\n\ntype RecursivePartial<T> = {\n  [P in keyof T]?: RecursivePartial<T[P]>;\n};\n\nconst colors = (theme: SupersetTheme) => ({\n  primary: theme.colors.success.base,\n  danger: theme.colors.error.base,\n  warning: theme.colors.warning.base,\n  indicator: theme.colors.info.base,\n  almostBlack: theme.colors.grayscale.dark1,\n  grayDark: theme.colors.grayscale.dark1,\n  grayLight: theme.colors.grayscale.light2,\n  gray: theme.colors.grayscale.light1,\n  grayBg: theme.colors.grayscale.light4,\n  grayBgDarker: theme.colors.grayscale.light3,\n  grayBgDarkest: theme.colors.grayscale.light2,\n  grayHeading: theme.colors.grayscale.light1,\n  menuHover: theme.colors.grayscale.light3,\n  lightest: theme.colors.grayscale.light5,\n  darkest: theme.colors.grayscale.dark2,\n  grayBorder: theme.colors.grayscale.light2,\n  grayBorderLight: theme.colors.grayscale.light3,\n  grayBorderDark: theme.colors.grayscale.light1,\n  textDefault: theme.colors.grayscale.dark1,\n  textDarkest: theme.colors.grayscale.dark2,\n  dangerLight: theme.colors.error.light1,\n});\n\nexport type ThemeConfig = {\n  borderRadius: number;\n  // z-index for menu dropdown\n  // (the same as `@z-index-above-dashboard-charts + 1` in variables.less)\n  zIndex: number;\n  colors: {\n    // add known colors\n    [key in keyof typeof reactSelectColors]: string;\n  } & {\n    [key in keyof ReturnType<typeof colors>]: string;\n  } & {\n    [key: string]: string; // any other colors\n  };\n  spacing: Theme['spacing'] & {\n    // line height and font size must be pixels for easier computation\n    // of option item height in WindowedMenuList\n    lineHeight: number;\n    fontSize: number;\n    // other relative size must be string\n    minWidth: string;\n  };\n};\n\nexport type PartialThemeConfig = RecursivePartial<ThemeConfig>;\n\nexport const defaultTheme: (theme: SupersetTheme) => PartialThemeConfig =\n  theme => ({\n    borderRadius: theme.borderRadius,\n    zIndex: 11,\n    colors: colors(theme),\n    spacing: {\n      baseUnit: 3,\n      menuGutter: 0,\n      controlHeight: 34,\n      lineHeight: 19,\n      fontSize: 14,\n      minWidth: '6.5em',\n    },\n    weights: theme.typography.weights,\n  });\n\n// let styles accept serialized CSS, too\ntype CSSStyles = CSSProperties | SerializedStyles;\ntype styleFnWithSerializedStyles = (\n  base: CSSProperties,\n  state: any,\n) => CSSStyles | CSSStyles[];\n\nexport type StylesConfig = {\n  [key in keyof Styles]: styleFnWithSerializedStyles;\n};\nexport type PartialStylesConfig = Partial<StylesConfig>;\n\nexport const DEFAULT_STYLES: PartialStylesConfig = {\n  container: (\n    provider,\n    {\n      theme: {\n        spacing: { minWidth },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      min-width: ${minWidth};\n    `,\n  ],\n  placeholder: provider => [\n    provider,\n    css`\n      white-space: nowrap;\n    `,\n  ],\n  indicatorSeparator: () => css`\n    display: none;\n  `,\n  indicatorsContainer: provider => [\n    provider,\n    css`\n      i {\n        width: 1em;\n        display: inline-block;\n      }\n    `,\n  ],\n  clearIndicator: provider => [\n    provider,\n    css`\n      padding: 4px 0 4px 6px;\n    `,\n  ],\n  control: (\n    provider,\n    { isFocused, menuIsOpen, theme: { borderRadius, colors } },\n  ) => {\n    const isPseudoFocused = isFocused && !menuIsOpen;\n    let borderColor = colors.grayBorder;\n    if (isPseudoFocused || menuIsOpen) {\n      borderColor = colors.grayBorderDark;\n    }\n    return [\n      provider,\n      css`\n        border-color: ${borderColor};\n        box-shadow: ${isPseudoFocused\n          ? 'inset 0 1px 1px rgba(0,0,0,.075), 0 0 0 3px rgba(0,0,0,.1)'\n          : 'none'};\n        border-radius: ${menuIsOpen\n          ? `${borderRadius}px ${borderRadius}px 0 0`\n          : `${borderRadius}px`};\n        &:hover {\n          border-color: ${borderColor};\n          box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n        }\n        flex-wrap: nowrap;\n        padding-left: 1px;\n      `,\n    ];\n  },\n  menu: (provider, { theme: { zIndex } }) => [\n    provider,\n    css`\n      padding-bottom: 2em;\n      z-index: ${zIndex}; /* override at least multi-page pagination */\n      width: auto;\n      min-width: 100%;\n      max-width: 80vw;\n      background: none;\n      box-shadow: none;\n      border: 0;\n    `,\n  ],\n  menuList: (provider, { theme: { borderRadius, colors } }) => [\n    provider,\n    css`\n      background: ${colors.lightest};\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      border: 1px solid ${colors.grayBorderDark};\n      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n      margin-top: -1px;\n      border-top-color: ${colors.grayBorderLight};\n      min-width: 100%;\n      width: auto;\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      padding-top: 0;\n      padding-bottom: 0;\n    `,\n  ],\n  option: (\n    provider,\n    {\n      isDisabled,\n      isFocused,\n      isSelected,\n      theme: {\n        colors,\n        spacing: { lineHeight, fontSize },\n        weights,\n      },\n    },\n  ) => {\n    let color = colors.textDefault;\n    let backgroundColor = colors.lightest;\n    if (isFocused) {\n      backgroundColor = colors.grayBgDarker;\n    } else if (isDisabled) {\n      color = '#ccc';\n    }\n    return [\n      provider,\n      css`\n        cursor: pointer;\n        line-height: ${lineHeight}px;\n        font-size: ${fontSize}px;\n        background-color: ${backgroundColor};\n        color: ${color};\n        font-weight: ${isSelected ? weights.bold : weights.normal};\n        white-space: nowrap;\n        &:hover:active {\n          background-color: ${colors.grayBg};\n        }\n      `,\n    ];\n  },\n  valueContainer: (\n    provider,\n    {\n      isMulti,\n      hasValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      padding-left: ${isMulti && hasValue ? 1 : baseUnit * 3}px;\n    `,\n  ],\n  multiValueLabel: (\n    provider,\n    {\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: baseUnit * 1.2,\n    paddingRight: baseUnit * 1.2,\n  }),\n  input: (provider, { selectProps }) => [\n    provider,\n    css`\n      margin-left: 0;\n      vertical-align: middle;\n      ${selectProps?.isMulti && selectProps?.value?.length\n        ? 'padding: 0 6px; width: 100%'\n        : 'padding: 0; flex: 1 1 auto;'};\n    `,\n  ],\n  menuPortal: base => ({\n    ...base,\n    zIndex: 1030, // must be same or higher of antd popover\n  }),\n};\n\nconst INPUT_TAG_BASE_STYLES = {\n  background: 'none',\n  border: 'none',\n  outline: 'none',\n  padding: 0,\n};\n\nexport type SelectComponentsType = Omit<\n  SelectComponentsConfig<any>,\n  'Input'\n> & {\n  Input: ComponentType<InputProps>;\n};\n\n// react-select is missing selectProps from their props type\n// so overwriting it here to avoid errors\nexport type InputProps = ReactSelectInputProps & {\n  placeholder?: ReactNode;\n  selectProps: SelectProps;\n  autoComplete?: string;\n  onPaste?: SupersetStyledSelectProps<OptionType>['onPaste'];\n  inputStyle?: object;\n};\n\nconst { ClearIndicator, DropdownIndicator, Option, Input, SelectContainer } =\n  defaultComponents as Required<DeepNonNullable<SelectComponentsType>>;\n\nexport const DEFAULT_COMPONENTS: SelectComponentsType = {\n  SelectContainer: ({ children, ...props }) => {\n    const {\n      selectProps: { assistiveText },\n    } = props;\n    return (\n      <div>\n        <SelectContainer {...props}>{children}</SelectContainer>\n        {assistiveText && (\n          <span\n            css={(theme: SupersetTheme) => ({\n              marginLeft: 3,\n              fontSize: theme.typography.sizes.s,\n              color: theme.colors.grayscale.light1,\n            })}\n          >\n            {assistiveText}\n          </span>\n        )}\n      </div>\n    );\n  },\n  Option: ({ children, innerProps, data, ...props }) => (\n    <Option\n      {...props}\n      data={data}\n      css={data?.style ? data.style : null}\n      innerProps={innerProps}\n    >\n      {children}\n    </Option>\n  ),\n  ClearIndicator: props => (\n    <ClearIndicator {...props}>\n      <i className=\"fa\">×</i>\n    </ClearIndicator>\n  ),\n  DropdownIndicator: props => (\n    <DropdownIndicator {...props}>\n      <i\n        className={`fa fa-caret-${\n          props.selectProps.menuIsOpen ? 'up' : 'down'\n        }`}\n      />\n    </DropdownIndicator>\n  ),\n  Input: (props: InputProps) => {\n    const { getStyles } = props;\n    return (\n      <Input\n        {...props}\n        css={getStyles('input', props)}\n        autoComplete=\"chrome-off\"\n        inputStyle={INPUT_TAG_BASE_STYLES}\n      />\n    );\n  },\n};\n\nexport const VALUE_LABELED_STYLES: PartialStylesConfig = {\n  valueContainer: (\n    provider,\n    {\n      getValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n      isMulti,\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: getValue().length > 0 ? 1 : baseUnit * 3,\n    overflow: isMulti && getValue().length > 0 ? 'visible' : 'hidden',\n  }),\n  // render single value as is they are multi-value\n  singleValue: (provider, props) => {\n    const { getStyles } = props;\n    return {\n      ...getStyles('multiValue', props),\n      '.metric-option': getStyles('multiValueLabel', props),\n    };\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { SyntheticEvent, MutableRefObject, ComponentType } from 'react';\nimport { merge } from 'lodash';\nimport BasicSelect, {\n  OptionTypeBase,\n  MultiValueProps,\n  FormatOptionLabelMeta,\n  ValueType,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  createFilter,\n  Props as SelectProps,\n} from 'react-select';\nimport Async from 'react-select/async';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\n\nimport type { SelectComponents } from 'react-select/src/components';\nimport {\n  SortableContainer,\n  SortableElement,\n  SortableContainerProps,\n} from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\nimport { useTheme } from '@superset-ui/core';\nimport { findValue } from './utils';\nimport {\n  WindowedSelectComponentType,\n  WindowedSelectProps,\n  WindowedSelect,\n  WindowedCreatableSelect,\n  WindowedAsyncCreatableSelect,\n} from './WindowedSelect';\nimport {\n  DEFAULT_CLASS_NAME,\n  DEFAULT_CLASS_NAME_PREFIX,\n  DEFAULT_STYLES,\n  DEFAULT_COMPONENTS,\n  VALUE_LABELED_STYLES,\n  PartialThemeConfig,\n  PartialStylesConfig,\n  SelectComponentsType,\n  InputProps,\n  defaultTheme,\n} from './styles';\n\ntype AnyReactSelect<OptionType extends OptionTypeBase> =\n  | BasicSelect<OptionType>\n  | Async<OptionType>\n  | Creatable<OptionType>\n  | AsyncCreatable<OptionType>;\n\nexport type SupersetStyledSelectProps<\n  OptionType extends OptionTypeBase,\n  T extends WindowedSelectProps<OptionType> = WindowedSelectProps<OptionType>,\n> = T & {\n  // additional props for easier usage or backward compatibility\n  labelKey?: string;\n  valueKey?: string;\n  assistiveText?: string;\n  multi?: boolean;\n  clearable?: boolean;\n  sortable?: boolean;\n  ignoreAccents?: boolean;\n  creatable?: boolean;\n  selectRef?:\n    | React.RefCallback<AnyReactSelect<OptionType>>\n    | MutableRefObject<AnyReactSelect<OptionType>>;\n  getInputValue?: (selectBalue: ValueType<OptionType>) => string | undefined;\n  optionRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderedAsLabel?: boolean;\n  // callback for paste event\n  onPaste?: (e: SyntheticEvent) => void;\n  forceOverflow?: boolean;\n  // for simpler theme overrides\n  themeConfig?: PartialThemeConfig;\n  stylesConfig?: PartialStylesConfig;\n};\n\nfunction styled<\n  OptionType extends OptionTypeBase,\n  SelectComponentType extends\n    | WindowedSelectComponentType<OptionType>\n    | ComponentType<\n        SelectProps<OptionType>\n      > = WindowedSelectComponentType<OptionType>,\n>(SelectComponent: SelectComponentType) {\n  type SelectProps = SupersetStyledSelectProps<OptionType>;\n  type Components = SelectComponents<OptionType>;\n\n  const SortableSelectComponent = SortableContainer(SelectComponent, {\n    withRef: true,\n  });\n\n  // default components for the given OptionType\n  const supersetDefaultComponents: SelectComponentsConfig<OptionType> =\n    DEFAULT_COMPONENTS;\n\n  const getSortableMultiValue = (MultiValue: Components['MultiValue']) =>\n    SortableElement((props: MultiValueProps<OptionType>) => {\n      const onMouseDown = (e: SyntheticEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n      };\n      const innerProps = { onMouseDown };\n      return <MultiValue {...props} innerProps={innerProps} />;\n    });\n\n  /**\n   * Superset styled `Select` component. Apply Superset themed stylesheets and\n   * consolidate props API for backward compatibility with react-select v1.\n   */\n  function StyledSelect(selectProps: SelectProps) {\n    let stateManager: AnyReactSelect<OptionType>; // reference to react-select StateManager\n    const {\n      // additional props for Superset Select\n      selectRef,\n      labelKey = 'label',\n      valueKey = 'value',\n      themeConfig,\n      stylesConfig = {},\n      optionRenderer,\n      valueRenderer,\n      // whether value is rendered as `option-label` in input,\n      // useful for AdhocMetric and AdhocFilter\n      valueRenderedAsLabel: valueRenderedAsLabel_,\n      onPaste,\n      multi = false, // same as `isMulti`, used for backward compatibility\n      clearable, // same as `isClearable`\n      sortable = true, // whether to enable drag & drop sorting\n      forceOverflow, // whether the dropdown should be forcefully overflowing\n\n      // react-select props\n      className = DEFAULT_CLASS_NAME,\n      classNamePrefix = DEFAULT_CLASS_NAME_PREFIX,\n      options,\n      value: value_,\n      components: components_,\n      isMulti: isMulti_,\n      isClearable: isClearable_,\n      minMenuHeight = 100, // apply different defaults\n      maxMenuHeight = 220,\n      filterOption,\n      ignoreAccents = false, // default is `true`, but it is slow\n\n      getOptionValue = option =>\n        typeof option === 'string' ? option : option[valueKey],\n\n      getOptionLabel = option =>\n        typeof option === 'string'\n          ? option\n          : option[labelKey] || option[valueKey],\n\n      formatOptionLabel = (\n        option: OptionType,\n        { context }: FormatOptionLabelMeta<OptionType>,\n      ) => {\n        if (context === 'value') {\n          return valueRenderer ? valueRenderer(option) : getOptionLabel(option);\n        }\n        return optionRenderer ? optionRenderer(option) : getOptionLabel(option);\n      },\n\n      ...restProps\n    } = selectProps;\n\n    // `value` may be rendered values (strings), we want option objects\n    const value: OptionType[] = findValue(value_, options || [], valueKey);\n\n    // Add backward compatibility to v1 API\n    const isMulti = isMulti_ === undefined ? multi : isMulti_;\n    const isClearable = isClearable_ === undefined ? clearable : isClearable_;\n\n    // Sort is only applied when there are multiple selected values\n    const shouldAllowSort =\n      isMulti && sortable && Array.isArray(value) && value.length > 1;\n\n    const MaybeSortableSelect = shouldAllowSort\n      ? SortableSelectComponent\n      : SelectComponent;\n    const components = { ...supersetDefaultComponents, ...components_ };\n\n    // Make multi-select sortable as per https://react-select.netlify.app/advanced\n    if (shouldAllowSort) {\n      components.MultiValue = getSortableMultiValue(\n        components.MultiValue || defaultComponents.MultiValue,\n      );\n\n      const sortableContainerProps: Partial<SortableContainerProps> = {\n        getHelperDimensions: ({ node }) => node.getBoundingClientRect(),\n        axis: 'xy',\n        onSortEnd: ({ oldIndex, newIndex }) => {\n          const newValue = arrayMove(value, oldIndex, newIndex);\n          if (restProps.onChange) {\n            restProps.onChange(newValue, { action: 'set-value' });\n          }\n        },\n        distance: 4,\n      };\n      Object.assign(restProps, sortableContainerProps);\n    }\n\n    // When values are rendered as labels, adjust valueContainer padding\n    const valueRenderedAsLabel =\n      valueRenderedAsLabel_ === undefined ? isMulti : valueRenderedAsLabel_;\n    if (valueRenderedAsLabel && !stylesConfig.valueContainer) {\n      Object.assign(stylesConfig, VALUE_LABELED_STYLES);\n    }\n\n    // Handle onPaste event\n    if (onPaste) {\n      const Input =\n        (components.Input as SelectComponentsType['Input']) ||\n        (defaultComponents.Input as SelectComponentsType['Input']);\n      components.Input = (props: InputProps) => (\n        <Input {...props} onPaste={onPaste} />\n      );\n    }\n    // for CreaTable\n    if (SelectComponent === WindowedCreatableSelect) {\n      restProps.getNewOptionData = (inputValue: string, label: string) => ({\n        label: label || inputValue,\n        [valueKey]: inputValue,\n        isNew: true,\n      });\n    }\n\n    // handle forcing dropdown overflow\n    // use only when setting overflow:visible isn't possible on the container element\n    if (forceOverflow) {\n      Object.assign(restProps, {\n        closeMenuOnScroll: (e: Event) => {\n          // ensure menu is open\n          const menuIsOpen = (stateManager as BasicSelect<OptionType>)?.state\n            ?.menuIsOpen;\n          const target = e.target as HTMLElement;\n          return (\n            menuIsOpen &&\n            target &&\n            !target.classList?.contains('Select__menu-list')\n          );\n        },\n        menuPosition: 'fixed',\n      });\n    }\n\n    // Make sure always return StateManager for the refs.\n    // To get the real `Select` component, keep tap into `obj.select`:\n    //   - for normal <Select /> component: StateManager -> Select,\n    //   - for <Creatable />: StateManager -> Creatable -> Select\n    const setRef = (instance: any) => {\n      stateManager =\n        shouldAllowSort && instance && 'refs' in instance\n          ? instance.refs.wrappedInstance // obtain StateManger from SortableContainer\n          : instance;\n      if (typeof selectRef === 'function') {\n        selectRef(stateManager);\n      } else if (selectRef && 'current' in selectRef) {\n        selectRef.current = stateManager;\n      }\n    };\n\n    const theme = useTheme();\n\n    return (\n      <MaybeSortableSelect\n        ref={setRef}\n        className={className}\n        classNamePrefix={classNamePrefix}\n        isMulti={isMulti}\n        isClearable={isClearable}\n        options={options}\n        value={value}\n        minMenuHeight={minMenuHeight}\n        maxMenuHeight={maxMenuHeight}\n        filterOption={\n          // filterOption may be NULL\n          filterOption !== undefined\n            ? filterOption\n            : createFilter({ ignoreAccents })\n        }\n        styles={{ ...DEFAULT_STYLES, ...stylesConfig } as SelectProps['styles']}\n        // merge default theme from `react-select`, default theme for Superset,\n        // and the theme from props.\n        theme={reactSelectTheme =>\n          merge(reactSelectTheme, defaultTheme(theme), themeConfig)\n        }\n        formatOptionLabel={formatOptionLabel}\n        getOptionLabel={getOptionLabel}\n        getOptionValue={getOptionValue}\n        components={components}\n        {...restProps}\n      />\n    );\n  }\n\n  // React.memo makes sure the component does no rerender given the same props\n  return React.memo(StyledSelect);\n}\n\nexport const Select = styled(WindowedSelect);\nexport const CreatableSelect = styled(WindowedCreatableSelect);\nexport const AsyncCreatableSelect = styled(WindowedAsyncCreatableSelect);\nexport default Select;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  OptionTypeBase,\n  ValueType,\n  OptionsType,\n  GroupedOptionsType,\n} from 'react-select';\n\n/**\n * Find Option value that matches a possibly string value.\n *\n * Translate possible string values to `OptionType` objects, fallback to value\n * itself if cannot be found in the options list.\n *\n * Always returns an array.\n */\nexport function findValue<OptionType extends OptionTypeBase>(\n  value: ValueType<OptionType> | string,\n  options: GroupedOptionsType<OptionType> | OptionsType<OptionType> = [],\n  valueKey = 'value',\n): OptionType[] {\n  if (value === null || value === undefined || value === '') {\n    return [];\n  }\n  const isGroup = Array.isArray((options[0] || {}).options);\n  const flatOptions = isGroup\n    ? (options as GroupedOptionsType<OptionType>).flatMap(x => x.options || [])\n    : (options as OptionsType<OptionType>);\n\n  const find = (val: OptionType) => {\n    const realVal = (value || {}).hasOwnProperty(valueKey)\n      ? val[valueKey]\n      : val;\n    return (\n      flatOptions.find(x => x === realVal || x[valueKey] === realVal) || val\n    );\n  };\n\n  // If value is a single string, must return an Array so `cleanValue` won't be\n  // empty: https://github.com/JedWatson/react-select/blob/32ad5c040bdd96cd1ca71010c2558842d684629c/packages/react-select/src/utils.js#L64\n  return (Array.isArray(value) ? value : [value]).map(find);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components/DeprecatedSelect';\n\nexport default class OnPasteSelect extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onPaste = this.onPaste.bind(this);\n  }\n\n  onPaste(evt) {\n    if (!this.props.isMulti) {\n      return;\n    }\n    evt.preventDefault();\n    const clipboard = evt.clipboardData.getData('Text');\n    if (!clipboard) {\n      return;\n    }\n    const regex = `[${this.props.separator}]+`;\n    const values = clipboard.split(new RegExp(regex)).map(v => v.trim());\n    const validator = this.props.isValidNewOption;\n    const selected = this.props.value || [];\n    const existingOptions = {};\n    const existing = {};\n    this.props.options.forEach(v => {\n      existingOptions[v[this.props.valueKey]] = 1;\n    });\n    let options = [];\n    selected.forEach(v => {\n      options.push({ [this.props.labelKey]: v, [this.props.valueKey]: v });\n      existing[v] = 1;\n    });\n    options = options.concat(\n      values\n        .filter(v => {\n          const notExists = !existing[v];\n          existing[v] = 1;\n          return (\n            notExists &&\n            (validator ? validator({ [this.props.labelKey]: v }) : !!v)\n          );\n        })\n        .map(v => {\n          const opt = { [this.props.labelKey]: v, [this.props.valueKey]: v };\n          if (!existingOptions[v]) {\n            this.props.options.unshift(opt);\n          }\n          return opt;\n        }),\n    );\n    if (options.length) {\n      if (this.props.onChange) {\n        this.props.onChange(options);\n      }\n    }\n  }\n\n  render() {\n    const { selectWrap: SelectComponent, ...restProps } = this.props;\n    return <SelectComponent {...restProps} onPaste={this.onPaste} />;\n  }\n}\n\nOnPasteSelect.propTypes = {\n  separator: PropTypes.array,\n  selectWrap: PropTypes.elementType,\n  selectRef: PropTypes.func,\n  onChange: PropTypes.func.isRequired,\n  valueKey: PropTypes.string,\n  labelKey: PropTypes.string,\n  options: PropTypes.array,\n  isMulti: PropTypes.bool,\n  value: PropTypes.any,\n  isValidNewOption: PropTypes.func,\n  noResultsText: PropTypes.string,\n  forceOverflow: PropTypes.bool,\n};\nOnPasteSelect.defaultProps = {\n  separator: [',', '\\n', '\\t', ';'],\n  selectWrap: Select,\n  valueKey: 'value',\n  labelKey: 'label',\n  options: [],\n  isMulti: false,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport Select, { SelectProps } from 'antd/lib/select';\n\nexport type {\n  OptionType as NativeSelectOptionType,\n  SelectProps as NativeSelectProps,\n} from 'antd/lib/select';\n\nconst StyledNativeSelect = styled((props: SelectProps<any>) => (\n  <Select getPopupContainer={(trigger: any) => trigger.parentNode} {...props} />\n))`\n  display: block;\n`;\n\nconst StyledNativeGraySelect = styled(Select)`\n  &.ant-select-single {\n    .ant-select-selector {\n      height: 36px;\n      padding: 0 11px;\n      background-color: ${({ theme }) => theme.colors.grayscale.light3};\n      border: none;\n\n      .ant-select-selection-search-input {\n        height: 100%;\n      }\n\n      .ant-select-selection-item,\n      .ant-select-selection-placeholder {\n        line-height: 35px;\n        color: ${({ theme }) => theme.colors.grayscale.dark1};\n      }\n    }\n  }\n`;\n\nexport const NativeSelect = Object.assign(StyledNativeSelect, {\n  Option: Select.Option,\n});\n\nexport const NativeGraySelect = Object.assign(StyledNativeGraySelect, {\n  Option: Select.Option,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { debounce } from 'lodash';\nimport { max as d3Max } from 'd3-array';\nimport {\n  AsyncCreatableSelect,\n  CreatableSelect,\n} from 'src/components/DeprecatedSelect';\nimport Button from 'src/components/Button';\nimport {\n  css,\n  styled,\n  t,\n  SupersetClient,\n  ensureIsArray,\n  withTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\n\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { FormLabel } from 'src/components/Form';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl';\nimport ControlRow from 'src/explore/components/ControlRow';\nimport Control from 'src/explore/components/Control';\nimport { controls } from 'src/explore/controls';\nimport { getExploreUrl } from 'src/explore/exploreUtils';\nimport OnPasteSelect from 'src/components/DeprecatedSelect/OnPasteSelect';\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  FILTER_OPTIONS_LIMIT,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\n// a shortcut to a map key, used by many components\nexport const TIME_RANGE = TIME_FILTER_MAP.time_range;\n\nconst propTypes = {\n  chartId: PropTypes.number.isRequired,\n  origSelectedValues: PropTypes.object,\n  datasource: PropTypes.object.isRequired,\n  instantFiltering: PropTypes.bool,\n  filtersFields: PropTypes.arrayOf(\n    PropTypes.shape({\n      field: PropTypes.string,\n      label: PropTypes.string,\n    }),\n  ),\n  filtersChoices: PropTypes.objectOf(\n    PropTypes.arrayOf(\n      PropTypes.shape({\n        id: PropTypes.string,\n        text: PropTypes.string,\n        filter: PropTypes.string,\n        metric: PropTypes.number,\n      }),\n    ),\n  ),\n  onChange: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  showDateFilter: PropTypes.bool,\n  showSqlaTimeGrain: PropTypes.bool,\n  showSqlaTimeColumn: PropTypes.bool,\n};\nconst defaultProps = {\n  origSelectedValues: {},\n  onChange: () => {},\n  onFilterMenuOpen: () => {},\n  onFilterMenuClose: () => {},\n  showDateFilter: false,\n  showSqlaTimeGrain: false,\n  showSqlaTimeColumn: false,\n  instantFiltering: false,\n};\n\nconst StyledFilterContainer = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    flex-direction: column;\n    margin-bottom: ${theme.gridUnit * 2 + 2}px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    label {\n      display: flex;\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .filter-badge-container {\n      width: 30px;\n      padding-right: ${theme.gridUnit * 2 + 2}px;\n    }\n\n    .filter-badge-container + div {\n      width: 100%;\n    }\n  `}\n`;\n\nclass FilterBox extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selectedValues: props.origSelectedValues,\n      // this flag is used by non-instant filter, to make the apply button enabled/disabled\n      hasChanged: false,\n    };\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n    this.changeFilter = this.changeFilter.bind(this);\n    this.onFilterMenuOpen = this.onFilterMenuOpen.bind(this);\n    this.onOpenDateFilterControl = this.onOpenDateFilterControl.bind(this);\n    this.onFilterMenuClose = this.onFilterMenuClose.bind(this);\n  }\n\n  onFilterMenuOpen(column) {\n    return this.props.onFilterMenuOpen(this.props.chartId, column);\n  }\n\n  onFilterMenuClose(column) {\n    return this.props.onFilterMenuClose(this.props.chartId, column);\n  }\n\n  onOpenDateFilterControl() {\n    return this.onFilterMenuOpen(TIME_RANGE);\n  }\n\n  onCloseDateFilterControl = () => this.onFilterMenuClose(TIME_RANGE);\n\n  getControlData(controlName) {\n    const { selectedValues } = this.state;\n    const control = {\n      ...controls[controlName], // TODO: make these controls ('druid_time_origin', 'granularity', 'granularity_sqla', 'time_grain_sqla') accessible from getControlsForVizType.\n      name: controlName,\n      key: `control-${controlName}`,\n      value: selectedValues[TIME_FILTER_MAP[controlName]],\n      actions: { setControlValue: this.changeFilter },\n    };\n    const mapFunc = control.mapStateToProps;\n    return mapFunc ? { ...control, ...mapFunc(this.props) } : control;\n  }\n\n  /**\n   * Get known max value of a column\n   */\n  getKnownMax(key, choices) {\n    this.maxValueCache[key] = Math.max(\n      this.maxValueCache[key] || 0,\n      d3Max(choices || this.props.filtersChoices[key] || [], x => x.metric),\n    );\n    return this.maxValueCache[key];\n  }\n\n  clickApply() {\n    const { selectedValues } = this.state;\n    this.setState({ hasChanged: false }, () => {\n      this.props.onChange(selectedValues, false);\n    });\n  }\n\n  changeFilter(filter, options) {\n    const fltr = TIME_FILTER_MAP[filter] || filter;\n    let vals = null;\n    if (options !== null) {\n      if (Array.isArray(options)) {\n        vals = options.map(opt => (typeof opt === 'string' ? opt : opt.value));\n      } else if (Object.values(TIME_FILTER_MAP).includes(fltr)) {\n        vals = options.value ?? options;\n      } else {\n        // must use array member for legacy extra_filters's value\n        vals = ensureIsArray(options.value ?? options);\n      }\n    }\n\n    this.setState(\n      prevState => ({\n        selectedValues: {\n          ...prevState.selectedValues,\n          [fltr]: vals,\n        },\n        hasChanged: true,\n      }),\n      () => {\n        if (this.props.instantFiltering) {\n          this.props.onChange({ [fltr]: vals }, false);\n        }\n      },\n    );\n  }\n\n  /**\n   * Generate a debounce function that loads options for a specific column\n   */\n  debounceLoadOptions(key) {\n    if (!(key in this.debouncerCache)) {\n      this.debouncerCache[key] = debounce((input, callback) => {\n        this.loadOptions(key, input).then(callback);\n      }, SLOW_DEBOUNCE);\n    }\n    return this.debouncerCache[key];\n  }\n\n  /**\n   * Transform select options, add bar background\n   */\n  transformOptions(options, max) {\n    const maxValue = max === undefined ? d3Max(options, x => x.metric) : max;\n    return options.map(opt => {\n      const perc = Math.round((opt.metric / maxValue) * 100);\n      const color = 'lightgrey';\n      const backgroundImage = `linear-gradient(to right, ${color}, ${color} ${perc}%, rgba(0,0,0,0) ${perc}%`;\n      const style = { backgroundImage };\n      let label = opt.id;\n      if (label === true) {\n        label = BOOL_TRUE_DISPLAY;\n      } else if (label === false) {\n        label = BOOL_FALSE_DISPLAY;\n      }\n      return { value: opt.id, label, style };\n    });\n  }\n\n  async loadOptions(key, inputValue = '') {\n    const input = inputValue.toLowerCase();\n    const sortAsc = this.props.filtersFields.find(x => x.key === key).asc;\n    const formData = {\n      ...this.props.rawFormData,\n      adhoc_filters: inputValue\n        ? [\n            {\n              clause: 'WHERE',\n              expressionType: 'SIMPLE',\n              subject: key,\n              operator: 'ILIKE',\n              comparator: `%${input}%`,\n            },\n          ]\n        : null,\n    };\n\n    const { json } = await SupersetClient.get({\n      url: getExploreUrl({\n        formData,\n        endpointType: 'json',\n        method: 'GET',\n      }),\n    });\n    const options = (json?.data?.[key] || []).filter(x => x.id);\n    if (!options || options.length === 0) {\n      return [];\n    }\n    if (input) {\n      // sort those starts with search query to front\n      options.sort((a, b) => {\n        const labelA = a.id.toLowerCase();\n        const labelB = b.id.toLowerCase();\n        const textOrder = labelB.startsWith(input) - labelA.startsWith(input);\n        return textOrder === 0\n          ? (a.metric - b.metric) * (sortAsc ? 1 : -1)\n          : textOrder;\n      });\n    }\n    return this.transformOptions(options, this.getKnownMax(key, options));\n  }\n\n  renderDateFilter() {\n    const { showDateFilter } = this.props;\n    const label = TIME_FILTER_LABELS.time_range;\n    if (showDateFilter) {\n      return (\n        <div className=\"row space-1\">\n          <div\n            className=\"col-lg-12 col-xs-12\"\n            data-test=\"date-filter-container\"\n          >\n            <DateFilterControl\n              name={TIME_RANGE}\n              label={label}\n              description={t('Select start and end date')}\n              onChange={newValue => {\n                this.changeFilter(TIME_RANGE, newValue);\n              }}\n              onOpenDateFilterControl={this.onOpenDateFilterControl}\n              onCloseDateFilterControl={this.onCloseDateFilterControl}\n              value={this.state.selectedValues[TIME_RANGE] || 'No filter'}\n              endpoints={['inclusive', 'exclusive']}\n            />\n          </div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  renderDatasourceFilters() {\n    const { showSqlaTimeGrain, showSqlaTimeColumn } = this.props;\n    const datasourceFilters = [];\n    const sqlaFilters = [];\n    const druidFilters = [];\n    if (showSqlaTimeGrain) sqlaFilters.push('time_grain_sqla');\n    if (showSqlaTimeColumn) sqlaFilters.push('granularity_sqla');\n    if (sqlaFilters.length) {\n      datasourceFilters.push(\n        <ControlRow\n          key=\"sqla-filters\"\n          controls={sqlaFilters.map(control => (\n            <Control {...this.getControlData(control)} />\n          ))}\n        />,\n      );\n    }\n    if (druidFilters.length) {\n      datasourceFilters.push(\n        <ControlRow\n          key=\"druid-filters\"\n          controls={druidFilters.map(control => (\n            <Control {...this.getControlData(control)} />\n          ))}\n        />,\n      );\n    }\n    return datasourceFilters;\n  }\n\n  renderSelect(filterConfig) {\n    const { filtersChoices } = this.props;\n    const { selectedValues } = this.state;\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n\n    // Add created options to filtersChoices, even though it doesn't exist,\n    // or these options will exist in query sql but invisible to end user.\n    Object.keys(selectedValues)\n      .filter(key => key in filtersChoices)\n      .forEach(key => {\n        // empty values are ignored\n        if (!selectedValues[key]) {\n          return;\n        }\n        const choices = filtersChoices[key] || (filtersChoices[key] = []);\n        const choiceIds = new Set(choices.map(f => f.id));\n        const selectedValuesForKey = Array.isArray(selectedValues[key])\n          ? selectedValues[key]\n          : [selectedValues[key]];\n        selectedValuesForKey\n          .filter(value => value !== null && !choiceIds.has(value))\n          .forEach(value => {\n            choices.unshift({\n              filter: key,\n              id: value,\n              text: value,\n              metric: 0,\n            });\n          });\n      });\n    const {\n      key,\n      label,\n      [FILTER_CONFIG_ATTRIBUTES.MULTIPLE]: isMultiple,\n      [FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE]: defaultValue,\n      [FILTER_CONFIG_ATTRIBUTES.CLEARABLE]: isClearable,\n      [FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS]: searchAllOptions,\n    } = filterConfig;\n    const data = filtersChoices[key] || [];\n    let value = selectedValues[key] || null;\n\n    // Assign default value if required\n    if (value === undefined && defaultValue) {\n      // multiple values are separated by semicolons\n      value = isMultiple ? defaultValue.split(';') : defaultValue;\n    }\n\n    return (\n      <OnPasteSelect\n        cacheOptions\n        loadOptions={this.debounceLoadOptions(key)}\n        defaultOptions={this.transformOptions(data)}\n        key={key}\n        placeholder={t('Type or Select [%s]', label)}\n        isMulti={isMultiple}\n        isClearable={isClearable}\n        value={value}\n        options={this.transformOptions(data)}\n        onChange={newValue => {\n          // avoid excessive re-renders\n          if (newValue !== value) {\n            this.changeFilter(key, newValue);\n          }\n        }}\n        // TODO try putting this back once react-select is upgraded\n        // onFocus={() => this.onFilterMenuOpen(key)}\n        onMenuOpen={() => this.onFilterMenuOpen(key)}\n        onBlur={() => this.onFilterMenuClose(key)}\n        onMenuClose={() => this.onFilterMenuClose(key)}\n        selectWrap={\n          searchAllOptions && data.length >= FILTER_OPTIONS_LIMIT\n            ? AsyncCreatableSelect\n            : CreatableSelect\n        }\n        noResultsText={t('No results found')}\n        forceOverflow\n      />\n    );\n  }\n\n  renderFilters() {\n    const { filtersFields = [] } = this.props;\n    return filtersFields.map(filterConfig => {\n      const { label, key } = filterConfig;\n      return (\n        <StyledFilterContainer key={key} className=\"filter-container\">\n          <FormLabel htmlFor={`LABEL-${key}`}>{label}</FormLabel>\n          {this.renderSelect(filterConfig)}\n        </StyledFilterContainer>\n      );\n    });\n  }\n\n  render() {\n    const { instantFiltering, width, height } = this.props;\n    const { zIndex, gridUnit } = this.props.theme;\n    return (\n      <>\n        <Global\n          styles={css`\n            .dashboard .filter_box .slice_container > div:not(.alert) {\n              padding-top: 0;\n            }\n\n            .filter_box {\n              padding: ${gridUnit * 2 + 2}px 0;\n              overflow: visible !important;\n\n              &:hover {\n                z-index: ${zIndex.max};\n              }\n            }\n          `}\n        />\n        <div style={{ width, height, overflow: 'auto' }}>\n          {this.renderDateFilter()}\n          {this.renderDatasourceFilters()}\n          {this.renderFilters()}\n          {!instantFiltering && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              onClick={this.clickApply.bind(this)}\n              disabled={!this.state.hasChanged}\n            >\n              {t('Apply')}\n            </Button>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nFilterBox.propTypes = propTypes;\nFilterBox.defaultProps = defaultProps;\n\nexport default withTheme(FilterBox);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { kebabCase } from 'lodash';\nimport { t, useTheme, styled } from '@superset-ui/core';\nimport Tooltip from './Tooltip';\n\ninterface CertifiedIconWithTooltipProps {\n  certifiedBy?: string | null;\n  details?: string | null;\n  metricName: string;\n}\n\nconst StyledDiv = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction CertifiedIconWithTooltip({\n  certifiedBy,\n  details,\n  metricName,\n}: CertifiedIconWithTooltipProps) {\n  const theme = useTheme();\n  return (\n    <Tooltip\n      id={`${kebabCase(metricName)}-tooltip`}\n      title={\n        <div>\n          {certifiedBy && (\n            <StyledDiv>{t('Certified by %s', certifiedBy)}</StyledDiv>\n          )}\n          <div>{details}</div>\n        </div>\n      }\n    >\n      {/* TODO: move Icons to superset-ui to remove duplicated icon code here */}\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        enableBackground=\"new 0 0 24 24\"\n        height=\"14\"\n        viewBox=\"0 0 24 24\"\n        width=\"14\"\n      >\n        <g>\n          <path\n            fill={theme.colors.primary.base}\n            d=\"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z\"\n          />\n        </g>\n      </svg>\n    </Tooltip>\n  );\n}\n\nexport default CertifiedIconWithTooltip;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport { css, styled, SupersetTheme } from '@superset-ui/core';\nimport { Tooltip } from './Tooltip';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport { ColumnMeta } from '../types';\nimport { getColumnLabelText, getColumnTooltipNode } from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nexport type ColumnOptionProps = {\n  column: ColumnMeta;\n  showType?: boolean;\n  labelRef?: React.RefObject<any>;\n};\n\nconst StyleOverrides = styled.span`\n  display: flex;\n  align-items: center;\n  svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport function ColumnOption({\n  column,\n  labelRef,\n  showType = false,\n}: ColumnOptionProps) {\n  const { expression, column_name, type_generic } = column;\n  const hasExpression = expression && expression !== column_name;\n  const type = hasExpression ? 'expression' : type_generic;\n  const [tooltipText, setTooltipText] = useState<ReactNode>(column.column_name);\n\n  useLayoutEffect(() => {\n    setTooltipText(getColumnTooltipNode(column, labelRef));\n  }, [labelRef, column]);\n\n  return (\n    <StyleOverrides>\n      {showType && type !== undefined && <ColumnTypeLabel type={type} />}\n      <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n        <span\n          className=\"option-label column-option-label\"\n          css={(theme: SupersetTheme) =>\n            css`\n              margin-right: ${theme.gridUnit}px;\n            `\n          }\n          ref={labelRef}\n        >\n          {getColumnLabelText(column)}\n        </span>\n      </Tooltip>\n      {hasExpression && <SQLPopover sqlExpression={expression} />}\n      {column.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={column.metric_name}\n          certifiedBy={column.certified_by}\n          details={column.certification_details}\n        />\n      )}\n    </StyleOverrides>\n  );\n}\n\nexport default ColumnOption;\n","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldDerived(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldDerived;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldBoolean(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldBoolean;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldAbc(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldAbc;","var _path;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldNum(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldNum;","/* eslint-disable no-nested-ternary */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { css, GenericDataType, styled, t } from '@superset-ui/core';\nimport { ClockCircleOutlined, QuestionOutlined } from '@ant-design/icons';\n// TODO: move all icons to superset-ui/core\nimport FunctionSvg from './type-icons/field_derived.svg';\nimport BooleanSvg from './type-icons/field_boolean.svg';\nimport StringSvg from './type-icons/field_abc.svg';\nimport NumSvg from './type-icons/field_num.svg';\n\nexport type ColumnLabelExtendedType = 'expression' | '';\n\nexport type ColumnTypeLabelProps = {\n  type?: ColumnLabelExtendedType | GenericDataType;\n};\n\nconst TypeIconWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: ${theme.gridUnit * 6}px;\n    height: ${theme.gridUnit * 6}px;\n    margin-right: ${theme.gridUnit}px;\n\n    && svg {\n      margin-right: 0;\n      margin-left: 0;\n    }\n  `};\n`;\n\nexport function ColumnTypeLabel({ type }: ColumnTypeLabelProps) {\n  let typeIcon: ReactNode = (\n    <QuestionOutlined aria-label={t('unknown type icon')} />\n  );\n\n  if (type === '' || type === 'expression') {\n    typeIcon = <FunctionSvg aria-label={t('function type icon')} />;\n  } else if (type === GenericDataType.STRING) {\n    typeIcon = <StringSvg aria-label={t('string type icon')} />;\n  } else if (type === GenericDataType.NUMERIC) {\n    typeIcon = <NumSvg aria-label={t('numeric type icon')} />;\n  } else if (type === GenericDataType.BOOLEAN) {\n    typeIcon = <BooleanSvg aria-label={t('boolean type icon')} />;\n  } else if (type === GenericDataType.TEMPORAL) {\n    typeIcon = <ClockCircleOutlined aria-label={t('temporal type icon')} />;\n  }\n\n  return <TypeIconWrapper>{typeIcon}</TypeIconWrapper>;\n}\n\nexport default ColumnTypeLabel;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport {\n  css,\n  styled,\n  Metric,\n  SafeMarkdown,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport InfoTooltipWithTrigger from './InfoTooltipWithTrigger';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport Tooltip from './Tooltip';\nimport { getMetricTooltipNode } from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nconst FlexRowContainer = styled.div`\n  align-items: center;\n  display: flex;\n\n  > svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport interface MetricOptionProps {\n  metric: Omit<Metric, 'id'> & { label?: string };\n  openInNewWindow?: boolean;\n  showFormula?: boolean;\n  showType?: boolean;\n  url?: string;\n  labelRef?: React.RefObject<any>;\n  shouldShowTooltip?: boolean;\n}\n\nexport function MetricOption({\n  metric,\n  labelRef,\n  openInNewWindow = false,\n  showFormula = true,\n  showType = false,\n  shouldShowTooltip = true,\n  url = '',\n}: MetricOptionProps) {\n  const verbose = metric.verbose_name || metric.metric_name || metric.label;\n  const link = url ? (\n    <a href={url} target={openInNewWindow ? '_blank' : ''} rel=\"noreferrer\">\n      {verbose}\n    </a>\n  ) : (\n    verbose\n  );\n\n  const label = (\n    <span\n      className=\"option-label metric-option-label\"\n      css={(theme: SupersetTheme) =>\n        css`\n          margin-right: ${theme.gridUnit}px;\n        `\n      }\n      ref={labelRef}\n    >\n      {link}\n    </span>\n  );\n\n  const warningMarkdown = metric.warning_markdown || metric.warning_text;\n\n  const [tooltipText, setTooltipText] = useState<ReactNode>(metric.metric_name);\n\n  useLayoutEffect(() => {\n    setTooltipText(getMetricTooltipNode(metric, labelRef));\n  }, [labelRef, metric]);\n\n  return (\n    <FlexRowContainer className=\"metric-option\">\n      {showType && <ColumnTypeLabel type=\"expression\" />}\n      {shouldShowTooltip ? (\n        <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n          {label}\n        </Tooltip>\n      ) : (\n        label\n      )}\n      {showFormula && metric.expression && (\n        <SQLPopover sqlExpression={metric.expression} />\n      )}\n      {metric.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={metric.metric_name}\n          certifiedBy={metric.certified_by}\n          details={metric.certification_details}\n        />\n      )}\n      {warningMarkdown && (\n        <InfoTooltipWithTrigger\n          className=\"text-warning\"\n          icon=\"warning\"\n          tooltip={<SafeMarkdown source={warningMarkdown} />}\n          label={`warn-${metric.metric_name}`}\n          iconsStyle={{ marginLeft: 0 }}\n        />\n      )}\n    </FlexRowContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Popover } from 'antd';\nimport type { PopoverProps } from 'antd/lib/popover';\nimport AceEditor from 'react-ace';\nimport { CalculatorOutlined } from '@ant-design/icons';\nimport { css, styled, useTheme, t } from '@superset-ui/core';\nimport 'ace-builds/src-noconflict/mode-sql';\n\nconst StyledCalculatorIcon = styled(CalculatorOutlined)`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.base};\n    font-size: ${theme.typography.sizes.s}px;\n    & svg {\n      margin-left: ${theme.gridUnit}px;\n      margin-right: ${theme.gridUnit}px;\n    }\n  `}\n`;\n\nexport const SQLPopover = (props: PopoverProps & { sqlExpression: string }) => {\n  const theme = useTheme();\n  return (\n    <Popover\n      content={\n        <AceEditor\n          mode=\"sql\"\n          value={props.sqlExpression}\n          editorProps={{ $blockScrolling: true }}\n          setOptions={{\n            highlightActiveLine: false,\n            highlightGutterLine: false,\n          }}\n          minLines={2}\n          maxLines={6}\n          readOnly\n          wrapEnabled\n          style={{\n            border: `1px solid ${theme.colors.grayscale.light2}`,\n            background: theme.colors.secondary.light5,\n            maxWidth: theme.gridUnit * 100,\n          }}\n        />\n      }\n      placement=\"bottomLeft\"\n      arrowPointAtCenter\n      title={t('SQL expression')}\n      {...props}\n    >\n      <StyledCalculatorIcon />\n    </Popover>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\n\nimport { css, styled, t } from '@superset-ui/core';\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\n\nconst TooltipSectionWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: column;\n    font-size: ${theme.typography.sizes.s}px;\n    line-height: 1.2;\n\n    &:not(:last-of-type) {\n      margin-bottom: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\nconst TooltipSectionLabel = styled.span`\n  ${({ theme }) => css`\n    font-weight: ${theme.typography.weights.bold};\n  `}\n`;\n\nconst TooltipSection = ({\n  label,\n  text,\n}: {\n  label: ReactNode;\n  text: ReactNode;\n}) => (\n  <TooltipSectionWrapper>\n    <TooltipSectionLabel>{label}</TooltipSectionLabel>\n    <span>{text}</span>\n  </TooltipSectionWrapper>\n);\n\nexport const isLabelTruncated = (labelRef?: React.RefObject<any>): boolean =>\n  !!(labelRef?.current?.scrollWidth > labelRef?.current?.clientWidth);\n\nexport const getColumnLabelText = (column: ColumnMeta): string =>\n  column.verbose_name || column.column_name;\n\nexport const getColumnTooltipNode = (\n  column: ColumnMeta,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    (!column.column_name || !column.verbose_name) &&\n    !column.description &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      {column.column_name && (\n        <TooltipSection label={t('Column name')} text={column.column_name} />\n      )}\n      {column.verbose_name && (\n        <TooltipSection label={t('Label')} text={column.verbose_name} />\n      )}\n      {column.description && (\n        <TooltipSection label={t('Description')} text={column.description} />\n      )}\n    </>\n  );\n};\n\ntype MetricType = Omit<Metric, 'id'> & { label?: string };\n\nexport const getMetricTooltipNode = (\n  metric: MetricType,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    !metric.verbose_name &&\n    !metric.description &&\n    !metric.label &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      <TooltipSection label={t('Metric name')} text={metric.metric_name} />\n      {(metric.label || metric.verbose_name) && (\n        <TooltipSection\n          label={t('Label')}\n          text={metric.label || metric.verbose_name}\n        />\n      )}\n      {metric.description && (\n        <TooltipSection label={t('Description')} text={metric.description} />\n      )}\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  QueryMode,\n  DTTM_ALIAS,\n  GenericDataType,\n  QueryColumn,\n  DatasourceType,\n} from '@superset-ui/core';\nimport { ColumnMeta } from './types';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const TIME_FILTER_LABELS = {\n  time_range: t('Time Range'),\n  granularity_sqla: t('Time Column'),\n  time_grain_sqla: t('Time Grain'),\n  granularity: t('Time Granularity'),\n};\n\nexport const COLUMN_NAME_ALIASES: Record<string, string> = {\n  [DTTM_ALIAS]: t('Time'),\n};\n\nexport const DATASET_TIME_COLUMN_OPTION: ColumnMeta = {\n  verbose_name: COLUMN_NAME_ALIASES[DTTM_ALIAS],\n  column_name: DTTM_ALIAS,\n  type_generic: GenericDataType.TEMPORAL,\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into account',\n  ),\n};\n\nexport const QUERY_TIME_COLUMN_OPTION: QueryColumn = {\n  name: DTTM_ALIAS,\n  type: DatasourceType.Query,\n  is_dttm: false,\n};\n\nexport const QueryModeLabel = {\n  [QueryMode.aggregate]: t('Aggregate'),\n  [QueryMode.raw]: t('Raw records'),\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from './InfoTooltipWithTrigger';\nimport { Tooltip } from './Tooltip';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  hovered?: boolean;\n  required?: boolean;\n  warning?: string;\n  danger?: string;\n  onClick?: () => void;\n  tooltipOnClick?: () => void;\n};\n\nexport default function ControlHeader({\n  name,\n  description,\n  label,\n  tooltipOnClick,\n  onClick,\n  warning,\n  danger,\n  leftNode,\n  rightNode,\n  validationErrors = [],\n  renderTrigger = false,\n  hovered = false,\n  required = false,\n}: ControlHeaderProps) {\n  const renderOptionalIcons = () => {\n    if (hovered) {\n      return (\n        <span>\n          {description && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('description')}\n                tooltip={description}\n                placement=\"top\"\n                onClick={tooltipOnClick}\n              />{' '}\n            </span>\n          )}\n          {renderTrigger && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('bolt')}\n                tooltip={t('Changing this control takes effect instantly')}\n                placement=\"top\"\n                icon=\"bolt\"\n              />{' '}\n            </span>\n          )}\n        </span>\n      );\n    }\n    return null;\n  };\n\n  if (!label) {\n    return null;\n  }\n  const labelClass = validationErrors.length > 0 ? 'text-danger' : '';\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <label className=\"control-label\" htmlFor={name}>\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            className={labelClass}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <i className=\"fa fa-exclamation-circle text-warning\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors.length > 0 && (\n            <span>\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors.join(' ')}\n              >\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n          {required && (\n            <span className=\"text-danger m-l-4\">\n              <strong>*</strong>\n            </span>\n          )}\n        </label>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader from '../../components/ControlHeader';\n\n// [value, label]\nexport type RadioButtonOption = [\n  JsonValue,\n  Exclude<ReactNode, null | undefined | boolean>,\n];\n\nexport interface RadioButtonControlProps {\n  label?: ReactNode;\n  description?: string;\n  options: RadioButtonOption[];\n  hovered?: boolean;\n  value?: JsonValue;\n  onChange: (opt: RadioButtonOption[0]) => void;\n}\n\nexport default function RadioButtonControl({\n  value: initialValue,\n  options,\n  onChange,\n  ...props\n}: RadioButtonControlProps) {\n  const currentValue = initialValue || options[0][0];\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        '.btn svg': {\n          position: 'relative',\n          top: '0.2em',\n        },\n        '.btn:focus': {\n          outline: 'none',\n        },\n        '.control-label': {\n          color: theme.colors.grayscale.base,\n          marginBottom: theme.gridUnit,\n        },\n        '.control-label + .btn-group': {\n          marginTop: '1px',\n        },\n        '.btn-group .btn-default': {\n          color: theme.colors.grayscale.dark1,\n        },\n        '.btn-group .btn.active': {\n          background: theme.colors.grayscale.light4,\n          fontWeight: theme.typography.weights.bold,\n          boxShadow: 'none',\n        },\n      }}\n    >\n      <ControlHeader {...props} />\n      <div className=\"btn-group btn-group-sm\">\n        {options.map(([val, label]) => (\n          <button\n            key={JSON.stringify(val)}\n            type=\"button\"\n            className={`btn btn-default ${\n              val === currentValue ? 'active' : ''\n            }`}\n            onClick={() => {\n              onChange(val);\n            }}\n          >\n            {label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponentElement, useMemo } from 'react';\nimport {\n  FAST_DEBOUNCE,\n  JsonObject,\n  JsonValue,\n  useTheme,\n} from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { ControlFormItemNode } from './ControlFormItem';\n\nexport * from './ControlFormItem';\n\nexport type ControlFormRowProps = {\n  children: ControlFormItemNode | ControlFormItemNode[];\n};\n\nexport function ControlFormRow({ children }: ControlFormRowProps) {\n  const { gridUnit } = useTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexWrap: 'nowrap',\n        margin: -2 * gridUnit,\n        marginBottom: gridUnit,\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n\ntype ControlFormRowNode = FunctionComponentElement<ControlFormRowProps>;\n\nexport type ControlFormProps = {\n  /**\n   * Form field values dict.\n   */\n  value?: JsonObject;\n  onChange: (value: JsonObject) => void;\n  children: ControlFormRowNode | ControlFormRowNode[];\n};\n\n/**\n * Light weight form for control panel.\n */\nexport default function ControlForm({\n  onChange,\n  value,\n  children,\n}: ControlFormProps) {\n  const theme = useTheme();\n  const debouncedOnChange = useMemo(\n    () =>\n      ({\n        0: onChange,\n        [FAST_DEBOUNCE]: debounce(onChange, FAST_DEBOUNCE),\n      } as Record<number, typeof onChange>),\n    [onChange],\n  );\n\n  const updatedChildren = React.Children.map(children, row => {\n    if ('children' in row.props) {\n      const defaultWidth = Array.isArray(row.props.children)\n        ? `${100 / row.props.children.length}%`\n        : undefined;\n      return React.cloneElement(row, {\n        children: React.Children.map(row.props.children, item => {\n          const {\n            name,\n            width,\n            debounceDelay = FAST_DEBOUNCE,\n            onChange: onItemValueChange,\n          } = item.props;\n          return React.cloneElement(item, {\n            width: width || defaultWidth,\n            value: value?.[name],\n            // remove `debounceDelay` from rendered control item props\n            // so React DevTools don't throw a `invalid prop` warning.\n            debounceDelay: undefined,\n            onChange(fieldValue: JsonValue) {\n              // call `onChange` on each FormItem\n              if (onItemValueChange) {\n                onItemValueChange(fieldValue);\n              }\n              // propagate to the form\n              if (!(debounceDelay in debouncedOnChange)) {\n                debouncedOnChange[debounceDelay] = debounce(\n                  onChange,\n                  debounceDelay,\n                );\n              }\n              debouncedOnChange[debounceDelay]({\n                ...value,\n                [name]: fieldValue,\n              });\n            },\n          });\n        }),\n      });\n    }\n    return row;\n  });\n  return (\n    <div\n      css={{\n        label: {\n          textTransform: 'uppercase',\n          color: theme.colors.text.label,\n          fontSize: theme.typography.sizes.s,\n        },\n      }}\n    >\n      {updatedChildren}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode } from 'react';\nimport AntdSelect, { SelectProps as AntdSelectProps } from 'antd/lib/select';\n\nexport const { Option }: any = AntdSelect;\n\nexport type SelectOption<VT = string> = [VT, ReactNode];\n\nexport type SelectProps<VT> = Omit<AntdSelectProps<VT>, 'options'> & {\n  creatable?: boolean;\n  minWidth?: string | number;\n  options?: SelectOption<VT>[];\n};\n\n/**\n * AntD select with creatable options.\n */\nexport default function Select<VT extends string | number>({\n  creatable,\n  onSearch,\n  dropdownMatchSelectWidth = false,\n  minWidth = '100%',\n  showSearch: showSearch_ = true,\n  onChange,\n  options,\n  children,\n  value,\n  ...props\n}: SelectProps<VT>) {\n  const [searchValue, setSearchValue] = useState<string>();\n  // force show search if creatable\n  const showSearch = showSearch_ || creatable;\n  const handleSearch = showSearch\n    ? (input: string) => {\n        if (creatable) {\n          setSearchValue(input);\n        }\n        if (onSearch) {\n          onSearch(input);\n        }\n      }\n    : undefined;\n\n  const optionsHasSearchValue = options?.some(([val]) => val === searchValue);\n  const optionsHasValue = options?.some(([val]) => val === value);\n\n  const handleChange: SelectProps<VT>['onChange'] = showSearch\n    ? (val, opt) => {\n        // reset input value once selected\n        setSearchValue('');\n        if (onChange) {\n          onChange(val, opt);\n        }\n      }\n    : onChange;\n\n  return (\n    <AntdSelect<VT>\n      dropdownMatchSelectWidth={dropdownMatchSelectWidth}\n      showSearch={showSearch}\n      onSearch={handleSearch}\n      onChange={handleChange}\n      value={value}\n      {...props}\n      css={{\n        minWidth,\n      }}\n    >\n      {options?.map(([val, label]) => (\n        <Option value={val}>{label}</Option>\n      ))}\n      {children}\n      {value && !optionsHasValue && (\n        <Option key={value} value={value}>\n          {value}\n        </Option>\n      )}\n      {searchValue && !optionsHasSearchValue && (\n        <Option key={searchValue} value={searchValue}>\n          {/* Unfortunately AntD select does not support displaying different\n          label for option vs select value, so we can't use\n          `t('Create \"%s\"', searchValue)` here */}\n          {searchValue}\n        </Option>\n      )}\n    </AntdSelect>\n  );\n}\n\nSelect.Option = Option;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Slider, InputNumber, Input } from 'antd';\nimport Checkbox, { CheckboxProps } from 'antd/lib/checkbox';\nimport Select, { SelectOption } from '../Select';\nimport RadioButtonControl, {\n  RadioButtonOption,\n} from '../../shared-controls/components/RadioButtonControl';\n\nexport const ControlFormItemComponents = {\n  Slider,\n  InputNumber,\n  Input,\n  Select,\n  // Directly export Checkbox will result in \"using name from external module\" error\n  // ref: https://stackoverflow.com/questions/43900035/ts4023-exported-variable-x-has-or-is-using-name-y-from-external-module-but\n  Checkbox: Checkbox as React.ForwardRefExoticComponent<\n    CheckboxProps & React.RefAttributes<HTMLInputElement>\n  >,\n  RadioButtonControl,\n};\n\nexport type ControlType = keyof typeof ControlFormItemComponents;\n\nexport type ControlFormValueValidator<V> = (value: V) => string | false;\n\nexport type ControlFormItemSpec<T extends ControlType = ControlType> = {\n  controlType: T;\n  label: ReactNode;\n  description: ReactNode;\n  placeholder?: string;\n  required?: boolean;\n  validators?: ControlFormValueValidator<any>[];\n  width?: number | string;\n  /**\n   * Time to delay change propagation.\n   */\n  debounceDelay?: number;\n} & (T extends 'Select'\n  ? {\n      options: SelectOption<any>[];\n      value?: string;\n      defaultValue?: string;\n      creatable?: boolean;\n      minWidth?: number | string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : T extends 'RadioButtonControl'\n  ? {\n      options: RadioButtonOption[];\n      value?: string;\n      defaultValue?: string;\n    }\n  : T extends 'Checkbox'\n  ? {\n      value?: boolean;\n      defaultValue?: boolean;\n    }\n  : T extends 'InputNumber' | 'Slider'\n  ? {\n      min?: number;\n      max?: number;\n      step?: number;\n      value?: number;\n      defaultValue?: number;\n      validators?: ControlFormValueValidator<number>[];\n    }\n  : T extends 'Input'\n  ? {\n      controlType: 'Input';\n      value?: string;\n      defaultValue?: string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : {});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, FunctionComponentElement, ChangeEvent } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader, { ControlHeaderProps } from '../ControlHeader';\nimport InfoTooltipWithTrigger from '../InfoTooltipWithTrigger';\nimport { ControlFormItemComponents, ControlFormItemSpec } from './controls';\n\nexport * from './controls';\n\nexport type ControlFormItemProps = ControlFormItemSpec & {\n  name: string;\n  onChange?: (fieldValue: JsonValue) => void;\n};\n\nexport type ControlFormItemNode =\n  FunctionComponentElement<ControlFormItemProps>;\n\n/**\n * Accept `false` or `0`, but not empty string.\n */\nfunction isEmptyValue(value?: JsonValue) {\n  return value == null || value === '';\n}\n\nexport function ControlFormItem({\n  name,\n  label,\n  description,\n  width,\n  validators,\n  required,\n  onChange,\n  value: initialValue,\n  defaultValue,\n  controlType,\n  ...props\n}: ControlFormItemProps) {\n  const { gridUnit } = useTheme();\n  const [hovered, setHovered] = useState(false);\n  const [value, setValue] = useState(\n    initialValue === undefined ? defaultValue : initialValue,\n  );\n  const [validationErrors, setValidationErrors] =\n    useState<ControlHeaderProps['validationErrors']>();\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement> | JsonValue) => {\n    const fieldValue =\n      e && typeof e === 'object' && 'target' in e\n        ? e.target.type === 'checkbox' || e.target.type === 'radio'\n          ? e.target.checked\n          : e.target.value\n        : e;\n    const errors =\n      (validators\n        ?.map(validator =>\n          !required && isEmptyValue(fieldValue) ? false : validator(fieldValue),\n        )\n        .filter(x => !!x) as string[]) || [];\n    setValidationErrors(errors);\n    setValue(fieldValue);\n    if (errors.length === 0 && onChange) {\n      onChange(fieldValue as JsonValue);\n    }\n  };\n\n  const Control = ControlFormItemComponents[controlType];\n\n  return (\n    <div\n      css={{\n        margin: 2 * gridUnit,\n        width,\n      }}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      {controlType === 'Checkbox' ? (\n        <ControlFormItemComponents.Checkbox\n          checked={value as boolean}\n          onChange={handleChange}\n        >\n          {label}{' '}\n          {hovered && description && (\n            <InfoTooltipWithTrigger tooltip={description} />\n          )}\n        </ControlFormItemComponents.Checkbox>\n      ) : (\n        <>\n          {label && (\n            <ControlHeader\n              name={name}\n              label={label}\n              description={description}\n              validationErrors={validationErrors}\n              hovered={hovered}\n              required={required}\n            />\n          )}\n          {/* @ts-ignore */}\n          <Control {...props} value={value} onChange={handleChange} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default ControlFormItem;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType, t, validateNumber } from '@superset-ui/core';\nimport { FaAlignLeft } from '@react-icons/all-files/fa/FaAlignLeft';\nimport { FaAlignRight } from '@react-icons/all-files/fa/FaAlignRight';\nimport { FaAlignCenter } from '@react-icons/all-files/fa/FaAlignCenter';\nimport {\n  D3_FORMAT_DOCS,\n  D3_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n} from '../../../utils';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport { ColumnConfigFormLayout } from './types';\n\nexport type SharedColumnConfigProp =\n  | 'alignPositiveNegative'\n  | 'colorPositiveNegative'\n  | 'columnWidth'\n  | 'fractionDigits'\n  | 'd3NumberFormat'\n  | 'd3SmallNumberFormat'\n  | 'd3TimeFormat'\n  | 'horizontalAlign'\n  | 'truncateLongCells'\n  | 'showCellBars';\n\nconst d3NumberFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_FORMAT_DOCS,\n  options: D3_FORMAT_OPTIONS,\n  defaultValue: D3_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '14em',\n  debounceDelay: 500,\n};\n\nconst d3TimeFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_TIME_FORMAT_DOCS,\n  options: D3_TIME_FORMAT_OPTIONS,\n  defaultValue: D3_TIME_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '10em',\n  debounceDelay: 500,\n};\n\nconst fractionDigits: ControlFormItemSpec<'Slider'> = {\n  controlType: 'Slider',\n  label: t('Fraction digits'),\n  description: t('Number of decimal digits to round numbers to'),\n  min: 0,\n  step: 1,\n  max: 100,\n  defaultValue: 100,\n};\n\nconst columnWidth: ControlFormItemSpec<'InputNumber'> = {\n  controlType: 'InputNumber',\n  label: t('Min Width'),\n  description: t(\n    \"Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space\",\n  ),\n  width: 120,\n  placeholder: t('auto'),\n  debounceDelay: 400,\n  validators: [validateNumber],\n};\n\nconst horizontalAlign: ControlFormItemSpec<'RadioButtonControl'> & {\n  value?: 'left' | 'right' | 'center';\n  defaultValue?: 'left' | 'right' | 'center';\n} = {\n  controlType: 'RadioButtonControl',\n  label: t('Text align'),\n  description: t('Horizontal alignment'),\n  width: 130,\n  debounceDelay: 50,\n  defaultValue: 'left',\n  options: [\n    ['left', <FaAlignLeft title={t('Left')} />],\n    ['center', <FaAlignCenter title={t('Center')} />],\n    ['right', <FaAlignRight title={t('Right')} />],\n  ],\n};\n\nconst showCellBars: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Show cell bars'),\n  description: t('Whether to display a bar chart background in table columns'),\n  defaultValue: true,\n  debounceDelay: 200,\n};\n\nconst alignPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Align +/-'),\n  description: t(\n    'Whether to align positive and negative values in cell bar chart at 0',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\nconst colorPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Color +/-'),\n  description: t(\n    'Whether to colorize numeric values by if they are positive or negative',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\nconst truncateLongCells: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Truncate Cells'),\n  description: t('Truncate long cells to the \"min width\" set above'),\n  defaultValue: false,\n  debounceDelay: 400,\n};\n\n/**\n * All configurable column formatting properties.\n */\nexport const SHARED_COLUMN_CONFIG_PROPS = {\n  d3NumberFormat,\n  d3SmallNumberFormat: {\n    ...d3NumberFormat,\n    label: t('Small number format'),\n    description: t(\n      'D3 number format for numbers between -1.0 and 1.0, ' +\n        'useful when you want to have different significant digits for small and large numbers',\n    ),\n  },\n  d3TimeFormat,\n  fractionDigits,\n  columnWidth,\n  truncateLongCells,\n  horizontalAlign,\n  showCellBars,\n  alignPositiveNegative,\n  colorPositiveNegative,\n};\n\nexport type SharedColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n};\n\nexport const DEFAULT_CONFIG_FORM_LAYOUT: ColumnConfigFormLayout = {\n  [GenericDataType.STRING]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n    ['truncateLongCells'],\n  ],\n  [GenericDataType.NUMERIC]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'right' } },\n    ],\n    ['d3NumberFormat'],\n    ['d3SmallNumberFormat'],\n    ['alignPositiveNegative', 'colorPositiveNegative'],\n    ['showCellBars'],\n  ],\n  [GenericDataType.TEMPORAL]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n    ['d3TimeFormat'],\n  ],\n  [GenericDataType.BOOLEAN]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n  ],\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType } from '@superset-ui/core';\nimport ControlForm, {\n  ControlFormRow,\n  ControlFormItem,\n  ControlFormItemSpec,\n} from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\nimport {\n  ColumnConfig,\n  ColumnConfigFormLayout,\n  ColumnConfigInfo,\n} from './types';\n\nexport type ColumnConfigPopoverProps = {\n  column: ColumnConfigInfo;\n  configFormLayout: ColumnConfigFormLayout;\n  onChange: (value: ColumnConfig) => void;\n};\n\nexport default function ColumnConfigPopover({\n  column,\n  configFormLayout,\n  onChange,\n}: ColumnConfigPopoverProps) {\n  return (\n    <ControlForm onChange={onChange} value={column.config}>\n      {configFormLayout[\n        column.type === undefined ? GenericDataType.STRING : column.type\n      ].map((row, i) => (\n        <ControlFormRow key={i}>\n          {row.map(meta => {\n            const key = typeof meta === 'string' ? meta : meta.name;\n            const override =\n              typeof meta === 'string'\n                ? {}\n                : 'override' in meta\n                ? meta.override\n                : meta.config;\n            const props = {\n              ...(key in SHARED_COLUMN_CONFIG_PROPS\n                ? SHARED_COLUMN_CONFIG_PROPS[key as SharedColumnConfigProp]\n                : undefined),\n              ...override,\n            } as ControlFormItemSpec;\n            return <ControlFormItem key={key} name={key} {...props} />;\n          })}\n        </ControlFormRow>\n      ))}\n    </ControlForm>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Popover } from 'antd';\nimport ColumnTypeLabel from '../../../components/ColumnTypeLabel/ColumnTypeLabel';\nimport ColumnConfigPopover, {\n  ColumnConfigPopoverProps,\n} from './ColumnConfigPopover';\n\nexport type ColumnConfigItemProps = ColumnConfigPopoverProps;\n\nexport default React.memo(function ColumnConfigItem({\n  column,\n  onChange,\n  configFormLayout,\n}: ColumnConfigItemProps) {\n  const { colors, gridUnit } = useTheme();\n  const caretWidth = gridUnit * 6;\n  return (\n    <Popover\n      title={column.name}\n      content={() => (\n        <ColumnConfigPopover\n          column={column}\n          onChange={onChange}\n          configFormLayout={configFormLayout}\n        />\n      )}\n      trigger=\"click\"\n      placement=\"right\"\n    >\n      <div\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: 'pointer',\n          padding: `${gridUnit}px ${2 * gridUnit}px`,\n          borderBottom: `1px solid ${colors.grayscale.light2}`,\n          position: 'relative',\n          paddingRight: caretWidth,\n          '&:last-child': {\n            borderBottom: 'none',\n          },\n          '&:hover': {\n            background: colors.grayscale.light4,\n          },\n          '> .fa': {\n            color: colors.grayscale.light2,\n          },\n          '&:hover > .fa': {\n            color: colors.grayscale.light1,\n          },\n        }}\n      >\n        <ColumnTypeLabel type={column.type} />\n        {column.name}\n        <i\n          className=\"fa fa-caret-right\"\n          css={{\n            position: 'absolute',\n            right: 3 * gridUnit,\n            top: 3 * gridUnit,\n          }}\n        />\n      </div>\n    </Popover>\n  );\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  GenericDataType,\n  JsonObject,\n  StrictJsonValue,\n} from '@superset-ui/core';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\n\n/**\n * Column formatting configs.\n */\nexport type ColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n} & Record<string, StrictJsonValue>;\n\n/**\n * All required info about a column to render the\n * formatting.\n */\nexport interface ColumnConfigInfo {\n  name: string;\n  type?: GenericDataType;\n  config: JsonObject;\n}\n\nexport type ColumnConfigFormItem =\n  | SharedColumnConfigProp\n  | { name: SharedColumnConfigProp; override: Partial<ControlFormItemSpec> }\n  | { name: string; config: ControlFormItemSpec };\n\nexport type ColumnConfigFormLayout = Record<\n  GenericDataType,\n  ColumnConfigFormItem[][]\n>;\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport RadioButtonControl from './RadioButtonControl';\nimport ColumnConfigControl from './ColumnConfigControl';\n\nexport * from './RadioButtonControl';\nexport * from './ColumnConfigControl';\n\n/**\n * Shared chart controls. Can be referred via string shortcuts in chart control\n * configs.\n */\nexport default {\n  RadioButtonControl,\n  ColumnConfigControl,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport {\n  ChartDataResponseResult,\n  useTheme,\n  t,\n  GenericDataType,\n} from '@superset-ui/core';\nimport ControlHeader from '../../../components/ControlHeader';\nimport { ControlComponentProps } from '../types';\n\nimport ColumnConfigItem from './ColumnConfigItem';\nimport {\n  ColumnConfigInfo,\n  ColumnConfig,\n  ColumnConfigFormLayout,\n} from './types';\nimport { DEFAULT_CONFIG_FORM_LAYOUT } from './constants';\nimport { COLUMN_NAME_ALIASES } from '../../../constants';\n\nexport type ColumnConfigControlProps<T extends ColumnConfig> =\n  ControlComponentProps<Record<string, T>> & {\n    queryResponse?: ChartDataResponseResult;\n    configFormLayout?: ColumnConfigFormLayout;\n    appliedColumnNames?: string[];\n  };\n\n/**\n * Max number of columns to show by default.\n */\nconst MAX_NUM_COLS = 10;\n\n/**\n * Add per-column config to queried results.\n */\nexport default function ColumnConfigControl<T extends ColumnConfig>({\n  queryResponse,\n  appliedColumnNames = [],\n  value,\n  onChange,\n  configFormLayout = DEFAULT_CONFIG_FORM_LAYOUT,\n  ...props\n}: ColumnConfigControlProps<T>) {\n  const { colnames: _colnames, coltypes: _coltypes } = queryResponse || {};\n  let colnames: string[] = [];\n  let coltypes: GenericDataType[] = [];\n  if (appliedColumnNames.length === 0) {\n    colnames = _colnames || [];\n    coltypes = _coltypes || [];\n  } else {\n    const appliedCol = new Set(appliedColumnNames);\n    _colnames?.forEach((col, idx) => {\n      if (appliedCol.has(col)) {\n        colnames.push(col);\n        coltypes.push(_coltypes?.[idx] as GenericDataType);\n      }\n    });\n  }\n  const theme = useTheme();\n  const columnConfigs = useMemo(() => {\n    const configs: Record<string, ColumnConfigInfo> = {};\n    colnames?.forEach((col, idx) => {\n      configs[col] = {\n        name: COLUMN_NAME_ALIASES[col] || col,\n        type: coltypes?.[idx],\n        config: value?.[col] || {},\n      };\n    });\n    return configs;\n  }, [value, colnames, coltypes]);\n  const [showAllColumns, setShowAllColumns] = useState(false);\n\n  const getColumnInfo = (col: string) => columnConfigs[col] || {};\n  const setColumnConfig = (col: string, config: T) => {\n    if (onChange) {\n      // Only keep configs for known columns\n      const validConfigs: Record<string, T> =\n        colnames && value\n          ? Object.fromEntries(\n              Object.entries(value).filter(([key]) => colnames.includes(key)),\n            )\n          : { ...value };\n      onChange({\n        ...validConfigs,\n        [col]: config,\n      });\n    }\n  };\n\n  if (!colnames || colnames.length === 0) return null;\n\n  const needShowMoreButton = colnames.length > MAX_NUM_COLS + 2;\n  const cols =\n    needShowMoreButton && !showAllColumns\n      ? colnames.slice(0, MAX_NUM_COLS)\n      : colnames;\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      <div\n        css={{\n          border: `1px solid ${theme.colors.grayscale.light2}`,\n          borderRadius: theme.gridUnit,\n        }}\n      >\n        {cols.map(col => (\n          <ColumnConfigItem\n            key={col}\n            column={getColumnInfo(col)}\n            onChange={config => setColumnConfig(col, config as T)}\n            configFormLayout={configFormLayout}\n          />\n        ))}\n        {needShowMoreButton && (\n          <div\n            role=\"button\"\n            tabIndex={-1}\n            css={{\n              padding: theme.gridUnit * 2,\n              textAlign: 'center',\n              cursor: 'pointer',\n              textTransform: 'uppercase',\n              fontSize: theme.typography.sizes.xs,\n              color: theme.colors.text.label,\n              ':hover': {\n                backgroundColor: theme.colors.grayscale.light4,\n              },\n            }}\n            onClick={() => setShowAllColumns(!showAllColumns)}\n          >\n            {showAllColumns ? (\n              <>\n                <i className=\"fa fa-angle-up\" /> &nbsp; {t('Show less columns')}\n              </>\n            ) : (\n              <>\n                <i className=\"fa fa-angle-down\" /> &nbsp;\n                {t('Show all columns')}\n              </>\n            )}\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport {\n  FeatureFlag,\n  isFeatureEnabled,\n  QueryColumn,\n  t,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport {\n  ExtraControlProps,\n  SharedControlConfig,\n  Dataset,\n  Metric,\n  isDataset,\n} from '../types';\nimport { DATASET_TIME_COLUMN_OPTION, TIME_FILTER_LABELS } from '../constants';\nimport {\n  QUERY_TIME_COLUMN_OPTION,\n  defineSavedMetrics,\n  ColumnOption,\n  ColumnMeta,\n  FilterOption,\n  temporalColumnMixin,\n  datePickerInAdhocFilterMixin,\n  xAxisMixin,\n} from '..';\n\ntype Control = {\n  savedMetrics?: Metric[] | null;\n  default?: unknown;\n};\n\n/*\n * Note: Previous to the commit that introduced this comment, the shared controls module\n * would check feature flags at module execution time and expose a different control\n * configuration (component + props) depending on the status of drag-and-drop feature\n * flags.  This commit combines those configs, merging the required props for both the\n * drag-and-drop and non-drag-and-drop components, and renders a wrapper component that\n * checks feature flags at component render time to avoid race conditions between when\n * feature flags are set and when they're checked.\n */\n\nexport const dndGroupByControl: SharedControlConfig<\n  'DndColumnSelect' | 'SelectControl',\n  ColumnMeta\n> = {\n  type: 'DndColumnSelect',\n  label: t('Dimensions'),\n  multi: true,\n  freeForm: true,\n  clearable: true,\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a sort by metric ' +\n      'and series limit to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: (c: ColumnMeta) => <ColumnOption showType column={c} />,\n  valueRenderer: (c: ColumnMeta) => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n  allowAll: true,\n  filterOption: ({ data: opt }: FilterOption<ColumnMeta>, text: string) =>\n    opt.column_name?.toLowerCase().includes(text.toLowerCase()) ||\n    opt.verbose_name?.toLowerCase().includes(text.toLowerCase()) ||\n    false,\n  promptTextCreator: (label: unknown) => label,\n  mapStateToProps(state, controlState) {\n    const newState: ExtraControlProps = {};\n    const { datasource } = state;\n    if (datasource?.columns[0]?.hasOwnProperty('groupby')) {\n      const options = (datasource as Dataset).columns.filter(c => c.groupby);\n      if (controlState?.includeTime) {\n        options.unshift(DATASET_TIME_COLUMN_OPTION);\n      }\n      newState.options = options;\n      newState.savedMetrics = (datasource as Dataset).metrics || [];\n    } else {\n      const options = (datasource?.columns as QueryColumn[]) || [];\n      if (controlState?.includeTime) {\n        options.unshift(QUERY_TIME_COLUMN_OPTION);\n      }\n      newState.options = options;\n    }\n    return newState;\n  },\n  commaChoosesOption: false,\n};\n\nexport const dndColumnsControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Columns'),\n  description: t('One or many columns to pivot as columns'),\n};\n\nexport const dndSeriesControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Dimension'),\n  multi: false,\n  default: null,\n  description: t(\n    'Defines the grouping of entities. ' +\n      'Each series is shown as a specific color on the chart and ' +\n      'has a legend toggle',\n  ),\n};\n\nexport const dndEntityControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Entity'),\n  default: null,\n  multi: false,\n  validators: [validateNonEmpty],\n  description: t('This defines the element to be plotted on the chart'),\n};\n\nexport const dndAdhocFilterControl: SharedControlConfig<\n  'DndFilterSelect' | 'AdhocFilterControl'\n> = {\n  type: 'DndFilterSelect',\n  label: t('Filters'),\n  default: [],\n  description: '',\n  mapStateToProps: ({ datasource, form_data }) => ({\n    columns: isDataset(datasource)\n      ? datasource.columns.filter(c => c.filterable)\n      : datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    // current active adhoc metrics\n    selectedMetrics:\n      form_data.metrics || (form_data.metric ? [form_data.metric] : []),\n    datasource,\n  }),\n  provideFormDataToProps: true,\n  ...datePickerInAdhocFilterMixin,\n};\n\nexport const dndAdhocMetricsControl: SharedControlConfig<\n  'DndMetricSelect' | 'MetricsControl'\n> = {\n  type: 'DndMetricSelect',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n  description: t('One or many metrics to display'),\n};\n\nexport const dndAdhocMetricControl: typeof dndAdhocMetricsControl = {\n  ...dndAdhocMetricsControl,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport const dndAdhocMetricControl2: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Right Axis Metric'),\n  clearable: true,\n  description: t('Choose a metric for right axis'),\n};\n\nexport const dndSortByControl: SharedControlConfig<\n  'DndMetricSelect' | 'MetricsControl'\n> = {\n  type: 'DndMetricSelect',\n  label: t('Sort by'),\n  default: null,\n  description: t(\n    'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n      'If undefined reverts to the first metric (where appropriate).',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n};\n\nexport const dndSizeControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Bubble Size'),\n  description: t('Metric used to calculate bubble size'),\n  default: null,\n};\n\nexport const dndXControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('X Axis'),\n  description: t('Metric assigned to the [X] axis'),\n  default: null,\n};\n\nexport const dndYControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Y Axis'),\n  description: t('Metric assigned to the [Y] axis'),\n  default: null,\n};\n\nexport const dndSecondaryMetricControl: typeof dndAdhocMetricControl = {\n  ...dndAdhocMetricControl,\n  label: t('Color Metric'),\n  default: null,\n  validators: [],\n  description: t('A metric to use for color'),\n};\n\nexport const dndGranularitySqlaControl: typeof dndSeriesControl = {\n  ...dndSeriesControl,\n  ...temporalColumnMixin,\n  label: TIME_FILTER_LABELS.granularity_sqla,\n  description: t(\n    'The time column for the visualization. Note that you ' +\n      'can define arbitrary expression that return a DATETIME ' +\n      'column in the table. Also note that the ' +\n      'filter below is applied against this column or ' +\n      'expression',\n  ),\n  default: (c: Control) => c.default,\n  clearable: false,\n  canDelete: false,\n  ghostButtonText: t('Drop temporal column here'),\n  clickEnabledGhostButtonText: t('Drop a temporal column here or click'),\n  optionRenderer: (c: ColumnMeta) => <ColumnOption showType column={c} />,\n  valueRenderer: (c: ColumnMeta) => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n};\n\nexport const dndXAxisControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  ...xAxisMixin,\n};\n\nexport function withDndFallback(\n  DndComponent: React.ComponentType<any>,\n  FallbackComponent: React.ComponentType<any>,\n) {\n  return function DndControl(props: any) {\n    const enableExploreDnd = useMemo(\n      () => isFeatureEnabled(FeatureFlag.ENABLE_EXPLORE_DRAG_AND_DROP),\n      [],\n    );\n\n    return enableExploreDnd ? (\n      <DndComponent {...props} />\n    ) : (\n      <FallbackComponent {...props} />\n    );\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  hasGenericChartAxes,\n  NO_TIME_RANGE,\n  QueryFormData,\n  t,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { BaseControlConfig, ControlPanelState, ControlState } from '../types';\nimport { getTemporalColumns } from '../utils';\n\nconst getAxisLabel = (\n  formData: QueryFormData,\n): Record<'label' | 'description', string> =>\n  formData?.orientation === 'horizontal'\n    ? { label: t('Y-axis'), description: t('Dimension to use on y-axis.') }\n    : { label: t('X-axis'), description: t('Dimension to use on x-axis.') };\n\nexport const xAxisMixin = {\n  label: (state: ControlPanelState) => getAxisLabel(state?.form_data).label,\n  multi: false,\n  description: (state: ControlPanelState) =>\n    getAxisLabel(state?.form_data).description,\n  validators: [validateNonEmpty],\n  initialValue: (control: ControlState, state: ControlPanelState | null) => {\n    if (\n      hasGenericChartAxes &&\n      state?.form_data?.granularity_sqla &&\n      !state.form_data?.x_axis &&\n      !control?.value\n    ) {\n      return state.form_data.granularity_sqla;\n    }\n    return undefined;\n  },\n  default: undefined,\n};\n\nexport const temporalColumnMixin: Pick<BaseControlConfig, 'mapStateToProps'> = {\n  mapStateToProps: ({ datasource }) => {\n    const payload = getTemporalColumns(datasource);\n\n    return {\n      options: payload.temporalColumns,\n      default: payload.defaultTemporalColumn,\n      isTemporal: true,\n    };\n  },\n};\n\nexport const datePickerInAdhocFilterMixin: Pick<\n  BaseControlConfig,\n  'initialValue'\n> = {\n  initialValue: (control: ControlState, state: ControlPanelState | null) => {\n    // skip initialValue if\n    // 1) GENERIC_CHART_AXES is disabled\n    // 2) the time_range control is present (this is the case for legacy charts)\n    // 3) there was a time filter in adhoc filters\n    if (\n      !hasGenericChartAxes ||\n      state?.controls?.time_range?.value ||\n      ensureIsArray(control.value).findIndex(\n        (flt: any) => flt?.operator === 'TEMPORAL_RANGE',\n      ) > -1\n    ) {\n      return undefined;\n    }\n\n    // should migrate original granularity_sqla and time_range into adhoc filter\n    // 1) granularity_sqla and time_range are existed\n    if (state?.form_data?.granularity_sqla && state?.form_data?.time_range) {\n      return [\n        ...ensureIsArray(control.value),\n        {\n          clause: 'WHERE',\n          subject: state.form_data.granularity_sqla,\n          operator: 'TEMPORAL_RANGE',\n          comparator: state.form_data.time_range,\n          expressionType: 'SIMPLE',\n        },\n      ];\n    }\n\n    // should apply the default time filter into adhoc filter\n    // 1) temporal column is existed in current datasource\n    const temporalColumn =\n      state?.datasource &&\n      getTemporalColumns(state.datasource).defaultTemporalColumn;\n    if (hasGenericChartAxes && temporalColumn) {\n      return [\n        ...ensureIsArray(control.value),\n        {\n          clause: 'WHERE',\n          subject: temporalColumn,\n          operator: 'TEMPORAL_RANGE',\n          comparator: state?.common?.conf?.DEFAULT_TIME_FILTER || NO_TIME_RANGE,\n          expressionType: 'SIMPLE',\n        },\n      ];\n    }\n\n    return undefined;\n  },\n};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * This file exports all controls available for use in chart plugins internal to Superset.\n * It is not recommended to use the controls here for any third-party plugins.\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface.\n */\nimport { isEmpty } from 'lodash';\nimport {\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  SequentialScheme,\n  legacyValidateInteger,\n  ComparisonType,\n  isAdhocColumn,\n  isPhysicalColumn,\n  ensureIsArray,\n  isDefined,\n  hasGenericChartAxes,\n  NO_TIME_RANGE,\n} from '@superset-ui/core';\n\nimport {\n  formatSelectOptions,\n  D3_FORMAT_OPTIONS,\n  D3_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  DEFAULT_TIME_FORMAT,\n  DEFAULT_NUMBER_FORMAT,\n} from '../utils';\nimport { TIME_FILTER_LABELS } from '../constants';\nimport {\n  SharedControlConfig,\n  Dataset,\n  ColumnMeta,\n  ControlState,\n  ControlPanelState,\n} from '../types';\n\nimport {\n  dndAdhocFilterControl,\n  dndAdhocMetricControl,\n  dndAdhocMetricsControl,\n  dndGranularitySqlaControl,\n  dndSortByControl,\n  dndSecondaryMetricControl,\n  dndSizeControl,\n  dndXControl,\n  dndYControl,\n  dndColumnsControl,\n  dndEntityControl,\n  dndGroupByControl,\n  dndSeriesControl,\n  dndAdhocMetricControl2,\n  dndXAxisControl,\n} from './dndControls';\n\nexport { withDndFallback } from './dndControls';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nconst appContainer = document.getElementById('app');\nconst { user } = JSON.parse(\n  appContainer?.getAttribute('data-bootstrap') || '{}',\n);\n\ntype SelectDefaultOption = {\n  label: string;\n  value: string;\n};\n\nconst datasourceControl: SharedControlConfig<'DatasourceControl'> = {\n  type: 'DatasourceControl',\n  label: t('Datasource'),\n  default: null,\n  description: null,\n  mapStateToProps: ({ datasource, form_data }) => ({\n    datasource,\n    form_data,\n    user,\n  }),\n};\n\nconst viz_type: SharedControlConfig<'VizTypeControl'> = {\n  type: 'VizTypeControl',\n  label: t('Visualization Type'),\n  default: 'table',\n  description: t('The type of visualization to display'),\n};\n\nconst color_picker: SharedControlConfig<'ColorPickerControl'> = {\n  type: 'ColorPickerControl',\n  label: t('Fixed Color'),\n  description: t('Use this to define a static color for all circles'),\n  default: PRIMARY_COLOR,\n  renderTrigger: true,\n};\n\nconst linear_color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Linear Color Scheme'),\n  choices: () =>\n    (sequentialSchemeRegistry.values() as SequentialScheme[]).map(value => [\n      value.id,\n      value.label,\n    ]),\n  default: sequentialSchemeRegistry.getDefaultKey(),\n  clearable: false,\n  description: '',\n  renderTrigger: true,\n  schemes: () => sequentialSchemeRegistry.getMap(),\n  isLinear: true,\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst granularity: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.granularity,\n  default: 'one day',\n  choices: [\n    [null, t('all')],\n    ['PT5S', t('5 seconds')],\n    ['PT30S', t('30 seconds')],\n    ['PT1M', t('1 minute')],\n    ['PT5M', t('5 minutes')],\n    ['PT30M', t('30 minutes')],\n    ['PT1H', t('1 hour')],\n    ['PT6H', t('6 hour')],\n    ['P1D', t('1 day')],\n    ['P7D', t('7 days')],\n    ['P1W', t('week')],\n    ['week_starting_sunday', t('week starting Sunday')],\n    ['week_ending_saturday', t('week ending Saturday')],\n    ['P1M', t('month')],\n    ['P3M', t('quarter')],\n    ['P1Y', t('year')],\n  ],\n  description: t(\n    'The time granularity for the visualization. Note that you ' +\n      'can type and use simple natural language as in `10 seconds`, ' +\n      '`1 day` or `56 weeks`',\n  ),\n};\n\nconst time_grain_sqla: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  label: TIME_FILTER_LABELS.time_grain_sqla,\n  placeholder: t('None'),\n  initialValue: (control: ControlState, state: ControlPanelState) => {\n    if (!isDefined(state)) {\n      // If a chart is in a Dashboard, the ControlPanelState is empty.\n      return control.value;\n    }\n    // If a chart is a new one that isn't saved, metadata is null. In this\n    // case we want to default P1D. If the chart has been saved, we want\n    // to use whichever value was chosen, either nothing or valid a time grain.\n    return state?.metadata || 'time_grain_sqla' in (state?.form_data ?? {})\n      ? state?.form_data?.time_grain_sqla\n      : 'P1D';\n  },\n  description: t(\n    'The time granularity for the visualization. This ' +\n      'applies a date transformation to alter ' +\n      'your time column and defines a new time granularity. ' +\n      'The options here are defined on a per database ' +\n      'engine basis in the Superset source code.',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    choices: (datasource as Dataset)?.time_grain_sqla || [],\n  }),\n  visibility: ({ controls }) => {\n    if (!hasGenericChartAxes) {\n      return true;\n    }\n\n    const xAxis = controls?.x_axis;\n    const xAxisValue = xAxis?.value;\n    if (isAdhocColumn(xAxisValue)) {\n      return true;\n    }\n    if (isPhysicalColumn(xAxisValue)) {\n      return !!(xAxis?.options ?? []).find(\n        (col: ColumnMeta) => col?.column_name === xAxisValue,\n      )?.is_dttm;\n    }\n    return false;\n  },\n};\n\nconst time_range: SharedControlConfig<'DateFilterControl'> = {\n  type: 'DateFilterControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.time_range,\n  default: NO_TIME_RANGE, // this value is an empty filter constant so shouldn't translate it.\n  description: t(\n    'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n      '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n      'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n      'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n      \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n      'per the ISO 8601 format if specifying either the start and/or end time.',\n  ),\n};\n\nconst row_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Row limit'),\n  validators: [legacyValidateInteger],\n  default: 10000,\n  choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n  description: t('Limits the number of rows that get displayed.'),\n};\n\nconst order_desc: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Sort Descending'),\n  default: true,\n  description: t('Whether to sort descending or ascending'),\n  visibility: ({ controls }) =>\n    Boolean(\n      controls?.timeseries_limit_metric.value &&\n        !isEmpty(controls?.timeseries_limit_metric.value),\n    ),\n};\n\nconst limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  placeholder: t('None'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  clearable: true,\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst series_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  placeholder: t('None'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst y_axis_format: SharedControlConfig<'SelectControl', SelectDefaultOption> =\n  {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: DEFAULT_NUMBER_FORMAT,\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    tokenSeparators: ['\\n', '\\t', ';'],\n    filterOption: ({ data: option }, search) =>\n      option.label.includes(search) || option.value.includes(search),\n    mapStateToProps: state => {\n      const isPercentage =\n        state.controls?.comparison_type?.value === ComparisonType.Percentage;\n      return {\n        choices: isPercentage\n          ? D3_FORMAT_OPTIONS.filter(option => option[0].includes('%'))\n          : D3_FORMAT_OPTIONS,\n      };\n    },\n  };\n\nconst x_axis_time_format: SharedControlConfig<\n  'SelectControl',\n  SelectDefaultOption\n> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Time format'),\n  renderTrigger: true,\n  default: DEFAULT_TIME_FORMAT,\n  choices: D3_TIME_FORMAT_OPTIONS,\n  description: D3_TIME_FORMAT_DOCS,\n  filterOption: ({ data: option }, search) =>\n    option.label.includes(search) || option.value.includes(search),\n};\n\nconst color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Color Scheme'),\n  default: categoricalSchemeRegistry.getDefaultKey(),\n  renderTrigger: true,\n  choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n  description: t('The color scheme for rendering chart'),\n  schemes: () => categoricalSchemeRegistry.getMap(),\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst truncate_metric: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Truncate Metric'),\n  default: true,\n  description: t('Whether to truncate metrics'),\n};\n\nconst show_empty_columns: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Show empty columns'),\n  default: true,\n  description: t('Show empty columns'),\n};\n\nconst temporal_columns_lookup: SharedControlConfig<'HiddenControl'> = {\n  type: 'HiddenControl',\n  initialValue: (control: ControlState, state: ControlPanelState | null) =>\n    Object.fromEntries(\n      ensureIsArray<Record<string, any>>(state?.datasource?.columns)\n        .filter(option => option.is_dttm)\n        .map(option => [option.column_name ?? option.name, option.is_dttm]),\n    ),\n};\n\nexport default {\n  metrics: dndAdhocMetricsControl,\n  metric: dndAdhocMetricControl,\n  datasource: datasourceControl,\n  viz_type,\n  color_picker,\n  metric_2: dndAdhocMetricControl2,\n  linear_color_scheme,\n  secondary_metric: dndSecondaryMetricControl,\n  groupby: dndGroupByControl,\n  columns: dndColumnsControl,\n  granularity,\n  granularity_sqla: dndGranularitySqlaControl,\n  time_grain_sqla,\n  time_range,\n  row_limit,\n  limit,\n  timeseries_limit_metric: dndSortByControl,\n  orderby: dndSortByControl,\n  order_desc,\n  series: dndSeriesControl,\n  entity: dndEntityControl,\n  x: dndXControl,\n  y: dndYControl,\n  size: dndSizeControl,\n  y_axis_format,\n  x_axis_time_format,\n  adhoc_filters: dndAdhocFilterControl,\n  color_scheme,\n  series_columns: dndColumnsControl,\n  series_limit,\n  series_limit_metric: dndSortByControl,\n  legacy_order_by: dndSortByControl,\n  truncate_metric,\n  x_axis: dndXAxisControl,\n  show_empty_columns,\n  temporal_columns_lookup,\n};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement, ReactNode, ReactText } from 'react';\nimport type {\n  AdhocColumn,\n  Column,\n  DatasourceType,\n  JsonObject,\n  JsonValue,\n  Metric,\n  QueryFormColumn,\n  QueryFormData,\n  QueryFormMetric,\n  QueryResponse,\n} from '@superset-ui/core';\nimport { sharedControls, sharedControlComponents } from './shared-controls';\n\nexport type { Metric } from '@superset-ui/core';\nexport type { ControlFormItemSpec } from './components/ControlForm';\nexport type { ControlComponentProps } from './shared-controls/components/types';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyDict = Record<string, any>;\ninterface Action {\n  type: string;\n}\ninterface AnyAction extends Action, AnyDict {}\n\nexport type SharedControls = typeof sharedControls;\nexport type SharedControlAlias = keyof typeof sharedControls;\nexport type SharedControlComponents = typeof sharedControlComponents;\n\n/** ----------------------------------------------\n * Input data/props while rendering\n * ---------------------------------------------*/\nexport interface Owner {\n  first_name: string;\n  id: number;\n  last_name: string;\n  username: string;\n  email?: string;\n}\n\nexport type ColumnMeta = Omit<Column, 'id'> & {\n  id?: number;\n} & AnyDict;\n\nexport interface Dataset {\n  id: number;\n  type: DatasourceType;\n  columns: ColumnMeta[];\n  metrics: Metric[];\n  column_format: Record<string, string>;\n  verbose_map: Record<string, string>;\n  main_dttm_col: string;\n  // eg. ['[\"ds\", true]', 'ds [asc]']\n  order_by_choices?: [string, string][] | null;\n  time_grain_sqla?: string;\n  granularity_sqla?: string;\n  datasource_name: string | null;\n  name?: string;\n  description: string | null;\n  uid?: string;\n  owners?: Owner[];\n  filter_select?: boolean;\n  filter_select_enabled?: boolean;\n}\n\nexport interface ControlPanelState {\n  form_data: QueryFormData;\n  datasource: Dataset | QueryResponse | null;\n  controls: ControlStateMapping;\n  common: JsonObject;\n  metadata?: JsonObject | null;\n}\n\n/**\n * The action dispatcher will call Redux `dispatch` internally and return what's\n * returned from `dispatch`, which by default is the original or another action.\n */\nexport interface ActionDispatcher<\n  ARGS extends unknown[],\n  A extends Action = AnyAction,\n> {\n  (...args: ARGS): A;\n}\n\n/**\n * Mapping of action dispatchers\n */\nexport interface ControlPanelActionDispatchers {\n  setDatasource: ActionDispatcher<[Dataset]>;\n}\n\n/**\n * Additional control props obtained from `mapStateToProps`.\n */\nexport type ExtraControlProps = {\n  value?: JsonValue;\n} & AnyDict;\n\n// Ref:superset-frontend/src/explore/store.js\nexport type ControlState<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n> = ControlConfig<T, O> & ExtraControlProps;\n\nexport interface ControlStateMapping {\n  [key: string]: ControlState;\n}\n\n// Ref: superset-frontend/src/explore/components/ControlPanelsContainer.jsx\nexport interface ControlPanelsContainerProps extends AnyDict {\n  actions: ControlPanelActionDispatchers;\n  controls: ControlStateMapping;\n  exportState: AnyDict;\n  form_data: QueryFormData;\n}\n\n/** ----------------------------------------------\n * Config for a chart Control\n * ---------------------------------------------*/\n\n// Ref: superset-frontend/src/explore/components/controls/index.js\nexport type InternalControlType =\n  | 'AnnotationLayerControl'\n  | 'BoundsControl'\n  | 'CheckboxControl'\n  | 'CollectionControl'\n  | 'ColorPickerControl'\n  | 'ColorSchemeControl'\n  | 'DatasourceControl'\n  | 'DateFilterControl'\n  | 'FixedOrMetricControl'\n  | 'HiddenControl'\n  | 'SelectAsyncControl'\n  | 'SelectControl'\n  | 'SliderControl'\n  | 'SpatialControl'\n  | 'TextAreaControl'\n  | 'TextControl'\n  | 'TimeSeriesColumnControl'\n  | 'ViewportControl'\n  | 'VizTypeControl'\n  | 'MetricsControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl'\n  | 'DndColumnSelect'\n  | 'DndFilterSelect'\n  | 'DndMetricSelect'\n  | keyof SharedControlComponents; // expanded in `expandControlConfig`\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type ControlType = InternalControlType | React.ComponentType<any>;\n\nexport type TabOverride = 'data' | 'customize' | boolean;\n\n/**\n * Control config specifying how chart controls appear in the control panel, all\n * these configs will be passed to the UI component for control as props.\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n *    when changed. This should `true` for controls that only affect the rendering (client side)\n *    and don't affect the query or backend data processing as those require to re run a query\n *    and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n *    should return error messages when the value is not valid. The error message gets\n *    bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - shouldMapStateToProps: a function that receives the previous and current app state\n *   and determines if the control needs to recalculate it's props based on the new state.\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n *    to overwrite configuration at runtime. This is useful to alter a component based on\n *    anything external to it, like another control's value. For instance it's possible to\n *    show a warning based on the value of another component. It's also possible to bind\n *    arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, or 'customize' if you want it to show up on that tam. Otherwise sections with ALL\n     `renderTrigger: true` components will show up on the `Customize` tab.\n * - visibility: a function that uses control panel props to check whether a control should\n *    be visible.\n */\nexport interface BaseControlConfig<\n  T extends ControlType = ControlType,\n  O extends SelectOption = SelectOption,\n  V = JsonValue,\n> extends AnyDict {\n  type: T;\n  label?:\n    | ReactNode\n    | ((\n        state: ControlPanelState,\n        controlState: ControlState,\n        // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n        chartState?: AnyDict,\n      ) => ReactNode);\n  description?:\n    | ReactNode\n    | ((\n        state: ControlPanelState,\n        controlState: ControlState,\n        // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n        chartState?: AnyDict,\n      ) => ReactNode);\n  default?: V;\n  initialValue?: V;\n  renderTrigger?: boolean;\n  validators?: ControlValueValidator<T, O, V>[];\n  warning?: ReactNode;\n  error?: ReactNode;\n  /**\n   * Add additional props to chart control.\n   */\n  shouldMapStateToProps?: (\n    prevState: ControlPanelState,\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => boolean;\n  mapStateToProps?: (\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => ExtraControlProps;\n  visibility?: (\n    props: ControlPanelsContainerProps,\n    controlData: AnyDict,\n  ) => boolean;\n}\n\nexport interface ControlValueValidator<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n  V = unknown,\n> {\n  (value: V, state?: ControlState<T, O>): boolean | string;\n}\n\n/** --------------------------------------------\n * Additional Config for specific control Types\n * --------------------------------------------- */\nexport type SelectOption = AnyDict | string | [ReactText, ReactNode];\n\nexport type SelectControlType =\n  | 'SelectControl'\n  | 'SelectAsyncControl'\n  | 'MetricsControl'\n  | 'FixedOrMetricControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl';\n\n// via react-select/src/filters\nexport interface FilterOption<T extends SelectOption> {\n  label: string;\n  value: string;\n  data: T;\n}\n\n// Ref: superset-frontend/src/components/Select/SupersetStyledSelect.tsx\nexport interface SelectControlConfig<\n  O extends SelectOption = SelectOption,\n  T extends SelectControlType = SelectControlType,\n> extends BaseControlConfig<T, O> {\n  clearable?: boolean;\n  freeForm?: boolean;\n  multi?: boolean;\n  valueKey?: string;\n  labelKey?: string;\n  options?: O[];\n  optionRenderer?: (option: O) => ReactNode;\n  valueRenderer?: (option: O) => ReactNode;\n  filterOption?:\n    | ((option: FilterOption<O>, rawInput: string) => Boolean)\n    | null;\n}\n\nexport type SharedControlConfig<\n  T extends InternalControlType = InternalControlType,\n  O extends SelectOption = SelectOption,\n> = T extends SelectControlType\n  ? SelectControlConfig<O, T>\n  : BaseControlConfig<T>;\n\n/** --------------------------------------------\n * Custom controls\n * --------------------------------------------- */\nexport type CustomControlConfig<P = {}> = BaseControlConfig<\n  React.ComponentType<P>\n> &\n  // two run-time properties from superset-frontend/src/explore/components/Control.jsx\n  Omit<P, 'onChange' | 'hovered'>;\n\n// Catch-all ControlConfig\n//  - if T is known control types, return SharedControlConfig,\n//  - if T is object, assume a CustomComponent\n//  - otherwise assume it's a custom component control\nexport type ControlConfig<\n  T = AnyDict,\n  O extends SelectOption = SelectOption,\n> = T extends InternalControlType\n  ? SharedControlConfig<T, O>\n  : T extends object\n  ? CustomControlConfig<T> // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  : CustomControlConfig<any>;\n\n/** ===========================================================\n * Chart plugin control panel config\n * ========================================================= */\nexport type SharedSectionAlias =\n  | 'annotations'\n  | 'colorScheme'\n  | 'datasourceAndVizType'\n  | 'druidTimeSeries'\n  | 'sqlaTimeSeries'\n  | 'NVD3TimeSeries';\n\nexport interface OverrideSharedControlItem<\n  A extends SharedControlAlias = SharedControlAlias,\n> {\n  name: A;\n  override: Partial<SharedControls[A]>;\n}\n\nexport type CustomControlItem = {\n  name: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  config: BaseControlConfig<any, any, any>;\n};\n\n// use ReactElement instead of ReactNode because `string`, `number`, etc. may\n// interfere with other ControlSetItem types\nexport type ExpandedControlItem = CustomControlItem | ReactElement | null;\n\nexport type ControlSetItem =\n  | SharedControlAlias\n  | OverrideSharedControlItem\n  | ExpandedControlItem;\n\nexport type ControlSetRow = ControlSetItem[];\n\n// Ref:\n//  - superset-frontend/src/explore/components/ControlPanelsContainer.jsx\n//  - superset-frontend/src/explore/components/ControlPanelSection.jsx\nexport interface ControlPanelSectionConfig {\n  label?: ReactNode;\n  description?: ReactNode;\n  expanded?: boolean;\n  tabOverride?: TabOverride;\n  controlSetRows: ControlSetRow[];\n}\n\nexport interface StandardizedControls {\n  metrics: QueryFormMetric[];\n  columns: QueryFormColumn[];\n}\n\nexport interface StandardizedFormDataInterface {\n  // Controls not used in the current viz\n  controls: StandardizedControls;\n  // Transformation history\n  memorizedFormData: Map<string, QueryFormData>;\n}\n\nexport type QueryStandardizedFormData = QueryFormData & {\n  standardizedFormData: StandardizedFormDataInterface;\n};\n\nexport const isStandardizedFormData = (\n  formData: QueryFormData,\n): formData is QueryStandardizedFormData =>\n  formData?.standardizedFormData?.controls &&\n  formData?.standardizedFormData?.memorizedFormData &&\n  Array.isArray(formData.standardizedFormData.controls.metrics) &&\n  Array.isArray(formData.standardizedFormData.controls.columns);\n\nexport interface ControlPanelConfig {\n  controlPanelSections: (ControlPanelSectionConfig | null)[];\n  controlOverrides?: ControlOverrides;\n  sectionOverrides?: SectionOverrides;\n  onInit?: (state: ControlStateMapping) => void;\n  formDataOverrides?: (formData: QueryFormData) => QueryFormData;\n}\n\nexport type ControlOverrides = {\n  [P in SharedControlAlias]?: Partial<SharedControls[P]>;\n};\n\nexport type SectionOverrides = {\n  [P in SharedSectionAlias]?: Partial<ControlPanelSectionConfig>;\n};\n\n// Ref:\n//  - superset-frontend/src/explore/components/ConditionalFormattingControl.tsx\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '≥',\n  LESS_OR_EQUAL = '≤',\n  EQUAL = '=',\n  NOT_EQUAL = '≠',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = '≤ x ≤',\n  BETWEEN_OR_LEFT_EQUAL = '≤ x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ≤',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ColorFormatters = {\n  column: string;\n  getColorFromValue: (value: number) => string | undefined;\n}[];\n\nexport default {};\n\nexport function isColumnMeta(column: AnyDict): column is ColumnMeta {\n  return !!column && 'column_name' in column;\n}\n\nexport function isSavedExpression(\n  column: AdhocColumn | ColumnMeta,\n): column is ColumnMeta {\n  return (\n    'column_name' in column && 'expression' in column && !!column.expression\n  );\n}\n\nexport function isControlPanelSectionConfig(\n  section: ControlPanelSectionConfig | null,\n): section is ControlPanelSectionConfig {\n  return section !== null;\n}\n\nexport function isDataset(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is Dataset {\n  return !!datasource && 'columns' in datasource;\n}\n\nexport function isQueryResponse(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is QueryResponse {\n  return !!datasource && 'results' in datasource && 'sql' in datasource;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, smartDateFormatter, NumberFormats } from '@superset-ui/core';\n\n// D3 specific formatting config\nexport const D3_FORMAT_DOCS = t(\n  'D3 format syntax: https://github.com/d3/d3-format',\n);\n\nexport const D3_NUMBER_FORMAT_DESCRIPTION_VALUES_TEXT = t(\n  'Only applies when \"Label Type\" is set to show values.',\n);\nexport const D3_NUMBER_FORMAT_DESCRIPTION_PERCENTAGE_TEXT = t(\n  'Only applies when \"Label Type\" is not set to a percentage.',\n);\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS: [string, string][] = [\n  [NumberFormats.SMART_NUMBER, t('Adaptive formatting')],\n  ['~g', t('Original value')],\n  [',d', ',d (12345.432 => 12,345)'],\n  ['.1s', '.1s (12345.432 => 10k)'],\n  ['.3s', '.3s (12345.432 => 12.3k)'],\n  [',.1%', ',.1% (12345.432 => 1,234,543.2%)'],\n  ['.2%', '.2% (12345.432 => 1234543.20%)'],\n  ['.3%', '.3% (12345.432 => 1234543.200%)'],\n  ['.4r', '.4r (12345.432 => 12350)'],\n  [',.1f', ',.1f (12345.432 => 12,345.4)'],\n  [',.2f', ',.2f (12345.432 => 12,345.43)'],\n  [',.3f', ',.3f (12345.432 => 12,345.432)'],\n  ['+,', '+, (12345.432 => +12,345.432)'],\n  ['$,.2f', '$,.2f (12345.432 => $12,345.43)'],\n  ['DURATION', t('Duration in ms (66000 => 1m 6s)')],\n  ['DURATION_SUB', t('Duration in ms (1.40008 => 1ms 400µs 80ns)')],\n];\n\nexport const D3_TIME_FORMAT_DOCS = t(\n  'D3 time format syntax: https://github.com/d3/d3-time-format',\n);\n\nexport const D3_TIME_FORMAT_OPTIONS: [string, string][] = [\n  [smartDateFormatter.id, t('Adaptive formatting')],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nexport const DEFAULT_NUMBER_FORMAT = D3_FORMAT_OPTIONS[0][0];\nexport const DEFAULT_TIME_FORMAT = D3_TIME_FORMAT_OPTIONS[0][0];\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { QueryResponse, DEFAULT_METRICS } from '@superset-ui/core';\nimport { Dataset } from '../types';\n\nexport const defineSavedMetrics = (\n  datasource: Dataset | QueryResponse | null,\n) =>\n  datasource?.hasOwnProperty('metrics')\n    ? (datasource as Dataset)?.metrics || []\n    : DEFAULT_METRICS;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement } from 'react';\nimport { sharedControls, sharedControlComponents } from '../shared-controls';\nimport {\n  ControlType,\n  ControlSetItem,\n  ExpandedControlItem,\n  ControlOverrides,\n} from '../types';\n\nexport function expandControlType(controlType: ControlType) {\n  if (\n    typeof controlType === 'string' &&\n    controlType in sharedControlComponents\n  ) {\n    return sharedControlComponents[\n      controlType as keyof typeof sharedControlComponents\n    ];\n  }\n  return controlType;\n}\n\n/**\n * Expand a shorthand control config item to full config in the format of\n *   {\n *     name: ...,\n *     config: {\n *        type: ...,\n *        ...\n *     }\n *   }\n */\nexport function expandControlConfig(\n  control: ControlSetItem,\n  controlOverrides: ControlOverrides = {},\n): ExpandedControlItem {\n  // one of the named shared controls\n  if (typeof control === 'string' && control in sharedControls) {\n    const name = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...controlOverrides[name],\n      },\n    };\n  }\n  // JSX/React element or NULL\n  if (\n    !control ||\n    typeof control === 'string' ||\n    React.isValidElement(control)\n  ) {\n    return control as ReactElement;\n  }\n  // already fully expanded control config, e.g.\n  // {\n  //   name: 'metric',\n  //   config: {\n  //     type: 'SelectControl' | SelectComponent\n  //   }\n  // }\n  if ('name' in control && 'config' in control) {\n    return {\n      ...control,\n      config: {\n        ...control.config,\n        type: expandControlType(control.config.type as ControlType),\n      },\n    };\n  }\n  // apply overrides with shared controls\n  if ('override' in control && control.name in sharedControls) {\n    const { name, override } = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...override,\n      },\n    };\n  }\n  return null;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { makeSingleton, QueryFormData } from '@superset-ui/core';\nimport { isStandardizedFormData, StandardizedControls } from '../types';\n\nclass StandardizedControlsManager {\n  controls: StandardizedControls;\n\n  constructor() {\n    this.controls = {\n      metrics: [],\n      columns: [],\n    };\n  }\n\n  setStandardizedControls(formData: QueryFormData) {\n    if (isStandardizedFormData(formData)) {\n      const { controls } = formData.standardizedFormData;\n      this.controls = {\n        metrics: controls.metrics,\n        columns: controls.columns,\n      };\n    }\n  }\n\n  shiftMetric() {\n    return this.controls.metrics.shift();\n  }\n\n  shiftColumn() {\n    return this.controls.columns.shift();\n  }\n\n  popAllMetrics() {\n    return this.controls.metrics.splice(0, this.controls.metrics.length);\n  }\n\n  popAllColumns() {\n    return this.controls.columns.splice(0, this.controls.columns.length);\n  }\n\n  clear() {\n    this.controls = {\n      metrics: [],\n      columns: [],\n    };\n  }\n}\n\nexport const getStandardizedControls = makeSingleton(\n  StandardizedControlsManager,\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  isDefined,\n  QueryColumn,\n  ValueOf,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  ControlPanelState,\n  isDataset,\n  isQueryResponse,\n} from '@superset-ui/chart-controls';\n\nexport function getTemporalColumns(\n  datasource: ValueOf<Pick<ControlPanelState, 'datasource'>>,\n) {\n  const rv: {\n    temporalColumns: ColumnMeta[] | QueryColumn[];\n    defaultTemporalColumn: string | null | undefined;\n  } = {\n    temporalColumns: [],\n    defaultTemporalColumn: undefined,\n  };\n\n  if (isDataset(datasource)) {\n    rv.temporalColumns = ensureIsArray(datasource.columns).filter(\n      c => c.is_dttm,\n    );\n  }\n  if (isQueryResponse(datasource)) {\n    rv.temporalColumns = ensureIsArray(datasource.columns).filter(\n      c => c.is_dttm,\n    );\n  }\n\n  if (isDataset(datasource)) {\n    rv.defaultTemporalColumn = datasource.main_dttm_col;\n  }\n  if (!isDefined(rv.defaultTemporalColumn)) {\n    rv.defaultTemporalColumn =\n      (rv.temporalColumns[0] as ColumnMeta)?.column_name ??\n      (rv.temporalColumns[0] as QueryColumn)?.name;\n  }\n\n  return rv;\n}\n\nexport function isTemporalColumn(\n  columnName: string,\n  datasource: ValueOf<Pick<ControlPanelState, 'datasource'>>,\n): boolean {\n  const columns = getTemporalColumns(datasource).temporalColumns;\n  for (let i = 0; i < columns.length; i += 1) {\n    if (columns[i].column_name === columnName) {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// helper functions for select controls\n\nexport type Formattable = string | number;\n\nexport type Formatted = [Formattable, string];\n\n/** Turns an array of string/number options into options for a select input */\nexport function formatSelectOptions<T extends Formattable>(\n  options: (T | [T, string])[],\n): [T, string][] {\n  return options.map(opt => (Array.isArray(opt) ? opt : [opt, opt.toString()]));\n}\n\n/**\n * Outputs array of arrays\n *   >> formatSelectOptionsForRange(1, 5)\n *   >> [[1,'1'], [2,'2'], [3,'3'], [4,'4'], [5,'5']]\n */\nexport function formatSelectOptionsForRange(start: number, end: number) {\n  const options: Formatted[] = [];\n  for (let i = start; i <= end; i += 1) {\n    options.push([i, i.toString()]);\n  }\n  return options;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton } from '../..';\nimport { ChartControlPanel } from '../models/ChartControlPanel';\n\nclass ChartControlPanelRegistry extends Registry<\n  ChartControlPanel,\n  ChartControlPanel\n> {\n  constructor() {\n    super({ name: 'ChartControlPanel' });\n  }\n}\n\nconst getInstance = makeSingleton(ChartControlPanelRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ExtraFormData } from '../../query';\nimport { JsonObject } from '../..';\n\nexport type HandlerFunction = (...args: unknown[]) => void;\n\nexport enum Behavior {\n  INTERACTIVE_CHART = 'INTERACTIVE_CHART',\n  NATIVE_FILTER = 'NATIVE_FILTER',\n\n  /**\n   * Include `DRILL_TO_DETAIL` behavior if plugin handles `contextmenu` event\n   * when dimensions are right-clicked on.\n   */\n  DRILL_TO_DETAIL = 'DRILL_TO_DETAIL',\n}\n\nexport enum AppSection {\n  EXPLORE = 'EXPLORE',\n  DASHBOARD = 'DASHBOARD',\n  FILTER_BAR = 'FILTER_BAR',\n  FILTER_CONFIG_MODAL = 'FILTER_CONFIG_MODAL',\n  EMBEDDED = 'EMBEDDED',\n}\n\nexport type FilterState = { value?: any; [key: string]: any };\n\nexport type DataMask = {\n  extraFormData?: ExtraFormData;\n  filterState?: FilterState;\n  ownState?: JsonObject;\n};\n\nexport type SetDataMaskHook = {\n  ({ filterState, extraFormData, ownState }: DataMask): void;\n};\n\nexport interface PlainObject {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n}\n\nexport enum ChartLabel {\n  DEPRECATED = 'DEPRECATED',\n  FEATURED = 'FEATURED',\n}\n\nexport const chartLabelExplanations: Record<ChartLabel, string> = {\n  [ChartLabel.DEPRECATED]:\n    'This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.',\n  [ChartLabel.FEATURED]:\n    'This chart was tested and verified, so the overall experience should be stable.',\n};\n\nexport const chartLabelWeight: Record<ChartLabel, { weight: number }> = {\n  [ChartLabel.DEPRECATED]: {\n    weight: -0.1,\n  },\n  [ChartLabel.FEATURED]: {\n    weight: 0.1,\n  },\n};\n\nexport enum AxisType {\n  category = 'category',\n  value = 'value',\n  time = 'time',\n  log = 'log',\n}\n\nexport default {};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CategoricalColorScale from './CategoricalColorScale';\nimport { ColorsLookup } from './types';\nimport getCategoricalSchemeRegistry from './CategoricalSchemeRegistrySingleton';\nimport stringifyAndTrim from './stringifyAndTrim';\n\nexport default class CategoricalColorNamespace {\n  name: string;\n\n  forcedItems: ColorsLookup;\n\n  scales: {\n    [key: string]: CategoricalColorScale;\n  };\n\n  constructor(name: string) {\n    this.name = name;\n    this.scales = {};\n    this.forcedItems = {};\n  }\n\n  getScale(schemeId?: string) {\n    const id = schemeId ?? getCategoricalSchemeRegistry().getDefaultKey() ?? '';\n    const scheme = getCategoricalSchemeRegistry().get(id);\n    return new CategoricalColorScale(scheme?.colors ?? [], this.forcedItems);\n  }\n\n  /**\n   * Enforce specific color for given value\n   * This will apply across all color scales\n   * in this namespace.\n   * @param {*} value value\n   * @param {*} forcedColor color\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedItems[stringifyAndTrim(value)] = forcedColor;\n\n    return this;\n  }\n\n  resetColors() {\n    this.forcedItems = {};\n  }\n}\n\nconst namespaces: {\n  [key: string]: CategoricalColorNamespace;\n} = {};\n\nexport const DEFAULT_NAMESPACE = 'GLOBAL';\n\nexport function getNamespace(name: string = DEFAULT_NAMESPACE) {\n  const instance = namespaces[name];\n  if (instance) {\n    return instance;\n  }\n  const newInstance = new CategoricalColorNamespace(name);\n  namespaces[name] = newInstance;\n\n  return newInstance;\n}\n\nexport function getColor(\n  value?: string,\n  schemeId?: string,\n  namespace?: string,\n) {\n  return getNamespace(namespace).getScale(schemeId).getColor(value);\n}\n\n/*\n  Returns a new scale instance within the same namespace.\n  Especially useful when a chart is booting for the first time\n*/\nexport function getScale(scheme?: string, namespace?: string) {\n  return getNamespace(namespace).getScale(scheme);\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-dupe-class-members */\nimport { scaleOrdinal, ScaleOrdinal } from 'd3-scale';\nimport { ExtensibleFunction } from '../models';\nimport { ColorsLookup } from './types';\nimport stringifyAndTrim from './stringifyAndTrim';\nimport getSharedLabelColor from './SharedLabelColorSingleton';\nimport { getAnalogousColors } from './utils';\nimport { FeatureFlag, isFeatureEnabled } from '../utils';\n\n// Use type augmentation to correct the fact that\n// an instance of CategoricalScale is also a function\ninterface CategoricalColorScale {\n  (x: { toString(): string }, y?: number): string;\n}\n\nclass CategoricalColorScale extends ExtensibleFunction {\n  originColors: string[];\n\n  colors: string[];\n\n  scale: ScaleOrdinal<{ toString(): string }, string>;\n\n  parentForcedColors?: ColorsLookup;\n\n  forcedColors: ColorsLookup;\n\n  multiple: number;\n\n  /**\n   * Constructor\n   * @param {*} colors an array of colors\n   * @param {*} parentForcedColors optional parameter that comes from parent\n   * (usually CategoricalColorNamespace) and supersede this.forcedColors\n   */\n  constructor(colors: string[], parentForcedColors: ColorsLookup = {}) {\n    super((value: string, sliceId?: number) => this.getColor(value, sliceId));\n\n    this.originColors = colors;\n    this.colors = colors;\n    this.scale = scaleOrdinal<{ toString(): string }, string>();\n    this.scale.range(colors);\n    this.parentForcedColors = parentForcedColors;\n    this.forcedColors = {};\n    this.multiple = 0;\n  }\n\n  getColor(value?: string, sliceId?: number) {\n    const cleanedValue = stringifyAndTrim(value);\n    const sharedLabelColor = getSharedLabelColor();\n\n    // priority: parentForcedColors > forcedColors > labelColors\n    let color =\n      this.parentForcedColors?.[cleanedValue] ||\n      this.forcedColors?.[cleanedValue] ||\n      sharedLabelColor.getColorMap().get(cleanedValue);\n\n    if (isFeatureEnabled(FeatureFlag.USE_ANALAGOUS_COLORS)) {\n      const multiple = Math.floor(\n        this.domain().length / this.originColors.length,\n      );\n      if (multiple > this.multiple) {\n        this.multiple = multiple;\n        const newRange = getAnalogousColors(this.originColors, multiple);\n        this.range(this.originColors.concat(newRange));\n      }\n    }\n    const newColor = this.scale(cleanedValue);\n    if (!color) {\n      color = newColor;\n    }\n    sharedLabelColor.addSlice(cleanedValue, color, sliceId);\n\n    return color;\n  }\n\n  /**\n   * Enforce specific color for given value\n   * @param {*} value value\n   * @param {*} forcedColor forcedColor\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedColors[stringifyAndTrim(value)] = forcedColor;\n    return this;\n  }\n\n  /**\n   * Get a mapping of data values to colors\n   * @returns an object where the key is the data value and the value is the hex color code\n   */\n  getColorMap() {\n    const colorMap: { [key: string]: string | undefined } = {};\n    this.scale.domain().forEach(value => {\n      colorMap[value.toString()] = this.scale(value);\n    });\n\n    return {\n      ...colorMap,\n      ...this.forcedColors,\n      ...this.parentForcedColors,\n    };\n  }\n\n  /**\n   * Returns an exact copy of this scale. Changes to this scale will not affect the returned scale, and vice versa.\n   */\n  copy() {\n    const copy = new CategoricalColorScale(\n      this.scale.range(),\n      this.parentForcedColors,\n    );\n    copy.forcedColors = { ...this.forcedColors };\n    copy.domain(this.domain());\n    copy.unknown(this.unknown());\n\n    return copy;\n  }\n\n  /**\n   * Returns the scale's current domain.\n   */\n  domain(): { toString(): string }[];\n\n  /**\n   * Expands the domain to include the specified array of values.\n   */\n  domain(newDomain: { toString(): string }[]): this;\n\n  domain(newDomain?: { toString(): string }[]): unknown {\n    if (typeof newDomain === 'undefined') {\n      return this.scale.domain();\n    }\n\n    this.scale.domain(newDomain);\n    return this;\n  }\n\n  /**\n   * Returns the scale's current range.\n   */\n  range(): string[];\n\n  /**\n   * Sets the range of the ordinal scale to the specified array of values.\n   *\n   * The first element in the domain will be mapped to the first element in range, the second domain value to the second range value, and so on.\n   *\n   * If there are fewer elements in the range than in the domain, the scale will reuse values from the start of the range.\n   *\n   * @param range Array of range values.\n   */\n  range(newRange: string[]): this;\n\n  range(newRange?: string[]): unknown {\n    if (typeof newRange === 'undefined') {\n      return this.scale.range();\n    }\n\n    this.colors = newRange;\n    this.scale.range(newRange);\n    return this;\n  }\n\n  /**\n   * Returns the current unknown value, which defaults to \"implicit\".\n   */\n  unknown(): string | { name: 'implicit' };\n\n  /**\n   * Sets the output value of the scale for unknown input values and returns this scale.\n   * The implicit value enables implicit domain construction. scaleImplicit can be used as a convenience to set the implicit value.\n   *\n   * @param value Unknown value to be used or scaleImplicit to set implicit scale generation.\n   */\n  unknown(value: string | { name: 'implicit' }): this;\n\n  unknown(value?: string | { name: 'implicit' }): unknown {\n    if (typeof value === 'undefined') {\n      return this.scale.unknown();\n    }\n\n    this.scale.unknown(value);\n    return this;\n  }\n}\n\nexport default CategoricalColorScale;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { CategoricalColorNamespace } from '.';\nimport { makeSingleton } from '../utils';\n\nexport enum SharedLabelColorSource {\n  dashboard,\n  explore,\n}\nexport class SharedLabelColor {\n  sliceLabelMap: Map<number, string[]>;\n\n  colorMap: Map<string, string>;\n\n  source: SharedLabelColorSource;\n\n  constructor() {\n    // { sliceId1: [label1, label2, ...], sliceId2: [label1, label2, ...] }\n    this.sliceLabelMap = new Map();\n    this.colorMap = new Map();\n    this.source = SharedLabelColorSource.dashboard;\n  }\n\n  updateColorMap(colorNamespace?: string, colorScheme?: string) {\n    const categoricalNamespace =\n      CategoricalColorNamespace.getNamespace(colorNamespace);\n    const newColorMap = new Map();\n    this.colorMap.clear();\n    this.sliceLabelMap.forEach(labels => {\n      const colorScale = categoricalNamespace.getScale(colorScheme);\n      labels.forEach(label => {\n        const newColor = colorScale(label);\n        newColorMap.set(label, newColor);\n      });\n    });\n    this.colorMap = newColorMap;\n  }\n\n  getColorMap() {\n    return this.colorMap;\n  }\n\n  addSlice(label: string, color: string, sliceId?: number) {\n    if (\n      this.source !== SharedLabelColorSource.dashboard ||\n      sliceId === undefined\n    )\n      return;\n    const labels = this.sliceLabelMap.get(sliceId) || [];\n    if (!labels.includes(label)) {\n      labels.push(label);\n      this.sliceLabelMap.set(sliceId, labels);\n    }\n    this.colorMap.set(label, color);\n  }\n\n  removeSlice(sliceId: number) {\n    if (this.source !== SharedLabelColorSource.dashboard) return;\n    this.sliceLabelMap.delete(sliceId);\n    const newColorMap = new Map();\n    this.sliceLabelMap.forEach(labels => {\n      labels.forEach(label => {\n        newColorMap.set(label, this.colorMap.get(label));\n      });\n    });\n    this.colorMap = newColorMap;\n  }\n\n  reset() {\n    const copyColorMap = new Map(this.colorMap);\n    copyColorMap.forEach((_, label) => {\n      this.colorMap.set(label, '');\n    });\n  }\n\n  clear() {\n    this.sliceLabelMap.clear();\n    this.colorMap.clear();\n  }\n}\n\nconst getInstance = makeSingleton(SharedLabelColor);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Ensure value is a string\n * @param {any} value\n */\nexport default function stringifyAndTrim(value?: number | string) {\n  return String(value).trim();\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport tinycolor from 'tinycolor2';\n\nconst rgbRegex = /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/;\nexport function getContrastingColor(color: string, thresholds = 186) {\n  let r = 0;\n  let g = 0;\n  let b = 0;\n  if (color.length > 7) {\n    // rgb\n    const matchColor = rgbRegex.exec(color);\n    if (!matchColor) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(matchColor[1], 10);\n    g = parseInt(matchColor[2], 10);\n    b = parseInt(matchColor[3], 10);\n  } else {\n    // hex\n    let hex = color;\n    if (hex.startsWith('#')) {\n      hex = hex.substring(1);\n    }\n    // #FFF\n    if (hex.length === 3) {\n      hex = [hex[0], hex[0], hex[1], hex[1], hex[2], hex[2]].join('');\n    }\n    if (hex.length !== 6) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(hex.slice(0, 2), 16);\n    g = parseInt(hex.slice(2, 4), 16);\n    b = parseInt(hex.slice(4, 6), 16);\n  }\n\n  return r * 0.299 + g * 0.587 + b * 0.114 > thresholds ? '#000' : '#FFF';\n}\n\nexport function getAnalogousColors(colors: string[], results: number) {\n  const generatedColors: string[] = [];\n  // This is to solve the problem that the first three values generated by tinycolor.analogous\n  // may have the same or very close colors.\n  const ext = 3;\n  const analogousColors = colors.map(color => {\n    const result = tinycolor(color).analogous(results + ext);\n    return result.slice(ext);\n  });\n\n  // [[A, AA, AAA], [B, BB, BBB]] => [A, B, AA, BB, AAA, BBB]\n  while (analogousColors[analogousColors.length - 1]?.length) {\n    analogousColors.forEach(colors => {\n      const color = colors.shift() as tinycolor.Instance;\n      generatedColors.push(color.toHexString());\n    });\n  }\n\n  return generatedColors;\n}\n\nexport function addAlpha(color: string, opacity: number): string {\n  // opacity value should be between 0 and 1.\n  if (opacity > 1 || opacity < 0) {\n    throw new Error(`The opacity should between 0 and 1, but got: ${opacity}`);\n  }\n  // the alpha value is between 00 - FF\n  const alpha = `0${Math.round(opacity * 255)\n    .toString(16)\n    .toUpperCase()}`.slice(-2);\n\n  return `${color}${alpha}`;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Faster debounce delay for inputs without expensive operation.\n */\nexport const FAST_DEBOUNCE = 250;\n\n/**\n * Slower debounce delay for inputs with expensive API calls.\n */\nexport const SLOW_DEBOUNCE = 500;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/** The type of an imported module. Don't fully understand this, yet. */\nexport type Module = any;\n\n/**\n * This is where packages are stored. We use window, because it plays well with Webpack.\n * To avoid\n * Have to amend the type of window, because window's usual type doesn't describe these fields.\n */\ninterface ModuleReferencer {\n  [packageKey: string]: Promise<Module>;\n}\n\ndeclare const window: Window & typeof globalThis & ModuleReferencer;\n\nconst modulePromises: { [key: string]: Promise<Module> } = {};\n\nconst withNamespace = (name: string) => `__superset__/${name}`;\n\n/**\n * Dependency management using global variables, because for the life of me\n * I can't figure out how to hook into UMD from a dynamically imported package.\n *\n * This defines a dynamically imported js module that can be used to import from\n * multiple different plugins.\n *\n * When importing a common module (such as react or lodash or superset-ui)\n * from a plugin, the plugin's build config will be able to\n * reference these globals instead of rebuilding them.\n *\n * @param name the module's name (should match name in package.json)\n * @param promise the promise resulting from a call to `import(name)`\n */\nexport async function defineSharedModule(\n  name: string,\n  fetchModule: () => Promise<Module>,\n) {\n  // this field on window is used by dynamic plugins to reference the module\n  const moduleKey = withNamespace(name);\n\n  if (!window[moduleKey] && !modulePromises[name]) {\n    // if the module has not been loaded, load it\n    const modulePromise = fetchModule();\n    modulePromises[name] = modulePromise;\n    // wait for the module to load, and attach the result to window\n    // so that it can be referenced by plugins\n    window[moduleKey] = await modulePromise;\n  }\n\n  // we always return a reference to the promise.\n  // Multiple consumers can `.then()` or `await` the same promise,\n  // even long after it has completed,\n  // and it will always call back with the same reference.\n  return modulePromises[name];\n}\n\n/**\n * Define multiple shared modules at once, using a map of name -> `import(name)`\n *\n * @see defineSharedModule\n * @param moduleMap\n */\nexport async function defineSharedModules(moduleMap: {\n  [key: string]: () => Promise<Module>;\n}) {\n  return Promise.all(\n    Object.entries(moduleMap).map(([name, fetchModule]) =>\n      defineSharedModule(name, fetchModule),\n    ),\n  );\n}\n\n// only exposed for tests\nexport function reset() {\n  Object.keys(modulePromises).forEach(key => {\n    delete window[withNamespace(key)];\n    delete modulePromises[key];\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * A Registry which serves as a typed key:value store for Superset and for Plugins.\n *\n * Differences from the older Registry class:\n *\n * 1. The keys and values stored in this class are individually typed by TYPEMAP parameter.\n *    In the old Registry, all values are of the same type and keys are not enumerated.\n *    Though you can also use indexed or mapped types in a TYPEMAP.\n *\n * 2. This class does not have a separate async get and set methods or use loaders.\n *    Instead, TYPEMAP should specify async values and loaders explicitly when needed.\n *    The value can be anything! A string, a class, a function, an async function... anything!\n *\n * 3. This class does not implement Policies, that is a separate concern to be handled elsewhere.\n *\n *\n * Removing or altering types in a type map could be a potential breaking change, be careful!\n *\n * Listener methods have not been added because there isn't a use case yet.\n */\nclass TypedRegistry<TYPEMAP extends {}> {\n  name = 'TypedRegistry';\n\n  private records: TYPEMAP;\n\n  constructor(initialRecords: TYPEMAP) {\n    this.records = initialRecords;\n  }\n\n  get<K extends keyof TYPEMAP>(key: K): TYPEMAP[K] {\n    // The type construction above means that when you call this function,\n    // you get a really specific type back.\n    return this.records[key];\n  }\n\n  set<K extends keyof TYPEMAP>(key: K, value: TYPEMAP[K]) {\n    this.records[key] = value;\n  }\n}\n\nexport default TypedRegistry;\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport enum RollingType {\n  Mean = 'mean',\n  Sum = 'sum',\n  Std = 'std',\n  Cumsum = 'cumsum',\n}\nexport interface RollingWindow {\n  rolling_type?: RollingType;\n  rolling_periods?: number;\n  min_periods?: number;\n}\n\nexport enum ComparisonType {\n  Values = 'values',\n  Difference = 'difference',\n  Percentage = 'percentage',\n  Ratio = 'ratio',\n}\nexport interface TimeCompare {\n  time_compare?: string;\n  comparison_type?: ComparisonType;\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { AdhocFilter, DataMask } from '@superset-ui/core';\n\nexport interface NativeFilterColumn {\n  name: string;\n  displayName?: string;\n}\n\nexport interface NativeFilterScope {\n  rootPath: string[];\n  excluded: number[];\n}\n\n/** The target of a filter is the datasource/column being filtered */\nexport interface NativeFilterTarget {\n  datasetId: number;\n  column: NativeFilterColumn;\n\n  // maybe someday support this?\n  // show values from these columns in the filter options selector\n  // clarityColumns?: Column[];\n}\n\nexport enum NativeFilterType {\n  NATIVE_FILTER = 'NATIVE_FILTER',\n  DIVIDER = 'DIVIDER',\n}\n\nexport enum DataMaskType {\n  NativeFilters = 'nativeFilters',\n  CrossFilters = 'crossFilters',\n}\n\nexport type DataMaskState = { [id: string]: DataMask };\n\nexport type DataMaskWithId = { id: string } & DataMask;\nexport type DataMaskStateWithId = { [filterId: string]: DataMaskWithId };\n\nexport type FilterSet = {\n  id: number;\n  name: string;\n  nativeFilters: Filters;\n  dataMask: DataMaskStateWithId;\n};\n\nexport type FilterSets = {\n  [filtersSetId: string]: FilterSet;\n};\n\nexport type Filter = {\n  cascadeParentIds: string[];\n  defaultDataMask: DataMask;\n  id: string; // randomly generated at filter creation\n  name: string;\n  scope: NativeFilterScope;\n  filterType: string;\n  // for now there will only ever be one target\n  // when multiple targets are supported, change this to Target[]\n  targets: [Partial<NativeFilterTarget>];\n  controlValues: {\n    [key: string]: any;\n  };\n  sortMetric?: string | null;\n  adhoc_filters?: AdhocFilter[];\n  granularity_sqla?: string;\n  granularity?: string;\n  time_grain_sqla?: string;\n  time_range?: string;\n  requiredFirst?: boolean;\n  tabsInScope?: string[];\n  chartsInScope?: number[];\n  type: typeof NativeFilterType.NATIVE_FILTER;\n  description: string;\n};\n\nexport type FilterWithDataMask = Filter & { dataMask: DataMaskWithId };\n\nexport type Divider = Partial<Omit<Filter, 'id' | 'type'>> & {\n  id: string;\n  title: string;\n  description: string;\n  type: typeof NativeFilterType.DIVIDER;\n};\n\nexport function isNativeFilter(\n  filterElement: Filter | Divider,\n): filterElement is Filter {\n  return filterElement.type === NativeFilterType.NATIVE_FILTER;\n}\n\nexport function isNativeFilterWithDataMask(\n  filterElement: Filter | Divider,\n): filterElement is FilterWithDataMask {\n  return (\n    isNativeFilter(filterElement) &&\n    (filterElement as FilterWithDataMask).dataMask?.filterState?.value\n  );\n}\n\nexport function isFilterDivider(\n  filterElement: Filter | Divider,\n): filterElement is Divider {\n  return filterElement.type === NativeFilterType.DIVIDER;\n}\n\nexport type FilterConfiguration = Array<Filter | Divider>;\n\nexport type Filters = {\n  [filterId: string]: Filter | Divider;\n};\n\nexport type PartialFilters = {\n  [filterId: string]: Partial<Filters[keyof Filters]>;\n};\n\nexport type NativeFiltersState = {\n  filters: Filters;\n  filterSets: FilterSets;\n  focusedFilterId?: string;\n  hoveredFilterId?: string;\n};\n\nexport type DashboardComponentMetadata = {\n  nativeFilters: NativeFiltersState;\n  dataMask: DataMaskStateWithId;\n};\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TimeseriesDataRecord } from '../../chart';\nimport { AnnotationData } from './AnnotationLayer';\n\n/**\n * Generic data types, see enum of the same name in superset/utils/core.py.\n */\nexport enum GenericDataType {\n  NUMERIC = 0,\n  STRING = 1,\n  TEMPORAL = 2,\n  BOOLEAN = 3,\n}\n\n/**\n * Primitive types for data field values.\n */\nexport type DataRecordValue = number | string | boolean | Date | null;\n\nexport interface DataRecord {\n  [key: string]: DataRecordValue;\n}\n\n/**\n * Queried data for charts. The `queries` field from `POST /chart/data`.\n * See superset/charts/schemas.py for the class of the same name.\n */\nexport interface ChartDataResponseResult {\n  /**\n   * Data for the annotation layer.\n   */\n  annotation_data: AnnotationData | null;\n  cache_key: string | null;\n  cache_timeout: number | null;\n  cached_dttm: string | null;\n  /**\n   * Array of data records as dictionary\n   */\n  data: DataRecord[];\n  /**\n   * Name of each column, for retaining the order of the output columns.\n   */\n  colnames: string[];\n  /**\n   * Generic data types, based on the final output pandas dataframe.\n   */\n  coltypes: GenericDataType[];\n  error: string | null;\n  is_cached: boolean;\n  query: string;\n  rowcount: number;\n  stacktrace: string | null;\n  status:\n    | 'stopped'\n    | 'failed'\n    | 'pending'\n    | 'running'\n    | 'scheduled'\n    | 'success'\n    | 'timed_out';\n  from_dttm: number | null;\n  to_dttm: number | null;\n}\n\nexport interface TimeseriesChartDataResponseResult\n  extends ChartDataResponseResult {\n  data: TimeseriesDataRecord[];\n  label_map: Record<string, string[]>;\n}\n\n/**\n * Query response from /api/v1/chart/data\n */\nexport interface ChartDataResponse {\n  queries: ChartDataResponseResult[];\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { TypedRegistry } from '../models';\nimport { makeSingleton } from '../utils';\n\n/**\n * A function which returns text (or marked-up text)\n * If what you want is a react component, don't use this. Use React.ComponentType instead.\n */\ntype ReturningDisplayable<P = void> = (props: P) => string | React.ReactElement;\n\n/**\n * This type defines all available extensions of Superset's default UI.\n * Namespace the keys here to follow the form of 'some_domain.functonality.item'.\n * Take care to name your keys well, as the name describes what this extension point's role is in Superset.\n *\n * When defining a new option here, take care to keep any parameters to functions (or components) minimal.\n * Any removal or alteration to a parameter will be considered a breaking change.\n */\n\n// from src/views/components/Menu, not imported since this is a separate package\ninterface MenuObjectChildProps {\n  label: string;\n  name?: string;\n  icon?: string;\n  index?: number;\n  url?: string;\n  isFrontendRoute?: boolean;\n  perm?: string | boolean;\n  view?: string;\n  disable?: boolean;\n}\n\nexport interface SwitchProps {\n  isEditMode: boolean;\n  dbFetched: any;\n  disableSSHTunnelingForEngine?: boolean;\n  useSSHTunneling: boolean;\n  setUseSSHTunneling: React.Dispatch<React.SetStateAction<boolean>>;\n  setDB: React.Dispatch<any>;\n  isSSHTunneling: boolean;\n}\n\ntype ConfigDetailsProps = {\n  embeddedId: string;\n};\ntype RightMenuItemIconProps = {\n  menuChild: MenuObjectChildProps;\n};\n\nexport type Extensions = Partial<{\n  'alertsreports.header.icon': React.ComponentType;\n  'embedded.documentation.configuration_details': React.ComponentType<ConfigDetailsProps>;\n  'embedded.documentation.description': ReturningDisplayable;\n  'embedded.documentation.url': string;\n  'dashboard.nav.right': React.ComponentType;\n  'navbar.right-menu.item.icon': React.ComponentType<RightMenuItemIconProps>;\n  'navbar.right': React.ComponentType;\n  'report-modal.dropdown.item.icon': React.ComponentType;\n  'root.context.provider': React.ComponentType;\n  'welcome.message': React.ComponentType;\n  'welcome.banner': React.ComponentType;\n  'welcome.main.replacement': React.ComponentType;\n  'ssh_tunnel.form.switch': React.ComponentType<SwitchProps>;\n}>;\n\n/**\n * A registry containing extensions which can alter Superset's UI at specific points defined by Superset.\n * See SIP-87: https://github.com/apache/superset/issues/20615\n */\nclass ExtensionsRegistry extends TypedRegistry<Extensions> {\n  name = 'ExtensionsRegistry';\n}\n\nexport const getExtensionsRegistry = makeSingleton(ExtensionsRegistry, {});\n\n// Exporting this under the old name for backwards compatibility.\n// After downstream folks have migrated to `getExtensionsRegistry`, we should remove this.\nexport const getUiOverrideRegistry = getExtensionsRegistry;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function isEqualArray<T extends unknown[] | undefined | null>(\n  arrA: T,\n  arrB: T,\n) {\n  return (\n    arrA === arrB ||\n    (!arrA && !arrB) ||\n    !!(\n      arrA &&\n      arrB &&\n      arrA.length === arrB.length &&\n      arrA.every((x, i) => x === arrB[i])\n    )\n  );\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called integer()\n * @param v\n */\nexport default function legacyValidateInteger(v: unknown) {\n  if (\n    v &&\n    (Number.isNaN(Number(v)) || parseInt(v as string, 10) !== Number(v))\n  ) {\n    return t('is expected to be an integer');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called numeric()\n * @param v\n */\nexport default function numeric(v: unknown) {\n  if (v && Number.isNaN(Number(v))) {\n    return t('is expected to be a number');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateNonEmpty(v: unknown) {\n  if (\n    v === null ||\n    typeof v === 'undefined' ||\n    v === '' ||\n    (Array.isArray(v) && v.length === 0)\n  ) {\n    return t('cannot be empty');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateInteger(v: unknown) {\n  if (\n    (typeof v === 'string' &&\n      v.trim().length > 0 &&\n      Number.isFinite(Number(v.trim()))) ||\n    (typeof v === 'number' && Number.isFinite(v))\n  ) {\n    return false;\n  }\n\n  return t('is expected to be a number');\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t } from '@superset-ui/core';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { DatasourcesAction } from 'src/dashboard/actions/datasources';\nimport { ChartState } from 'src/explore/types';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport { HYDRATE_EXPLORE } from 'src/explore/actions/hydrateExplore';\nimport { now } from 'src/utils/dates';\nimport * as actions from './chartAction';\n\nexport const chart: ChartState = {\n  id: 0,\n  chartAlert: null,\n  chartStatus: 'loading',\n  chartStackTrace: null,\n  chartUpdateEndTime: null,\n  chartUpdateStartTime: 0,\n  latestQueryFormData: {},\n  sliceFormData: null,\n  queryController: null,\n  queriesResponse: null,\n  triggerQuery: true,\n  lastRendered: 0,\n};\n\ntype ChartActionHandler = (state: ChartState) => ChartState;\n\ntype AnyChartAction = Record<string, any>;\n\nexport default function chartReducer(\n  charts: Record<string, ChartState> = {},\n  action: AnyChartAction,\n) {\n  const actionHandlers: Record<string, ChartActionHandler> = {\n    [actions.ADD_CHART]() {\n      return {\n        ...chart,\n        ...action.chart,\n      };\n    },\n    [actions.CHART_UPDATE_SUCCEEDED](state) {\n      return {\n        ...state,\n        chartStatus: 'success',\n        chartAlert: null,\n        queriesResponse: action.queriesResponse,\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_UPDATE_STARTED](state) {\n      return {\n        ...state,\n        chartStatus: 'loading',\n        chartStackTrace: null,\n        chartAlert: null,\n        chartUpdateEndTime: null,\n        chartUpdateStartTime: now(),\n        queryController: action.queryController,\n      };\n    },\n    [actions.CHART_UPDATE_STOPPED](state) {\n      return {\n        ...state,\n        chartStatus: 'stopped',\n        chartAlert: t('Updating chart was stopped'),\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_RENDERING_SUCCEEDED](state) {\n      return { ...state, chartStatus: 'rendered', chartUpdateEndTime: now() };\n    },\n    [actions.CHART_RENDERING_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartStackTrace: action.stackTrace,\n        chartAlert: t(\n          'An error occurred while rendering the visualization: %s',\n          action.error,\n        ),\n      };\n    },\n    [actions.CHART_UPDATE_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartAlert: action.queriesResponse\n          ? action.queriesResponse?.[0]?.error\n          : t('Network error.'),\n        chartUpdateEndTime: now(),\n        queriesResponse: action.queriesResponse,\n        chartStackTrace: action.queriesResponse\n          ? action.queriesResponse?.[0]?.stacktrace\n          : null,\n      };\n    },\n    [actions.DYNAMIC_PLUGIN_CONTROLS_READY](state) {\n      const sliceFormData = getFormDataFromControls(action.controlsState);\n      return { ...state, sliceFormData };\n    },\n    [actions.TRIGGER_QUERY](state) {\n      return {\n        ...state,\n        triggerQuery: action.value,\n        chartStatus: 'loading',\n      };\n    },\n    [actions.RENDER_TRIGGERED](state) {\n      return { ...state, lastRendered: action.value };\n    },\n    [actions.UPDATE_QUERY_FORM_DATA](state) {\n      return { ...state, latestQueryFormData: action.value };\n    },\n    [actions.ANNOTATION_QUERY_STARTED](state) {\n      if (state.annotationQuery?.[action.annotation.name]) {\n        state.annotationQuery[action.annotation.name].abort();\n      }\n      const annotationQuery = {\n        ...state.annotationQuery,\n        [action.annotation.name]: action.queryController,\n      };\n      return {\n        ...state,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_SUCCESS](state) {\n      const annotationData = {\n        ...state.annotationData,\n        [action.annotation.name]: action.queryResponse.data,\n      };\n      const annotationError = { ...state.annotationError };\n      delete annotationError[action.annotation.name];\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_FAILED](state) {\n      const annotationData = { ...state.annotationData };\n      delete annotationData[action.annotation.name];\n      const annotationError = {\n        ...state.annotationError,\n        [action.annotation.name]: action.queryResponse\n          ? action.queryResponse.error\n          : t('Network error.'),\n      };\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n  };\n\n  /* eslint-disable no-param-reassign */\n  if (action.type === actions.REMOVE_CHART) {\n    delete charts[action.key];\n    return charts;\n  }\n  if (action.type === actions.UPDATE_CHART_ID) {\n    const { newId, key } = action;\n    charts[newId] = {\n      ...charts[key],\n      id: newId,\n    };\n    delete charts[key];\n    return charts;\n  }\n  if (action.type === HYDRATE_DASHBOARD || action.type === HYDRATE_EXPLORE) {\n    return { ...action.data.charts };\n  }\n  if (action.type === DatasourcesAction.SET_DATASOURCES) {\n    return Object.fromEntries(\n      Object.entries(charts).map(([chartId, chart]) => [\n        chartId,\n        // some charts may not have properly handled missing datasource,\n        // causing a JS error, so we reset error message and try to re-render\n        // the chart once the datasource is fully loaded\n        chart.chartStatus === 'failed' && chart.chartStackTrace\n          ? {\n              ...chart,\n              chartStatus: '',\n              chartStackTrace: null,\n              chartAlert: null,\n            }\n          : chart,\n      ]),\n    );\n  }\n\n  if (action.type in actionHandlers) {\n    return {\n      ...charts,\n      [action.key]: actionHandlers[action.type](charts[action.key]),\n    };\n  }\n\n  return charts;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\n\nexport const CheckboxChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z\"\n        fill={theme.colors.primary.base}\n      />\n      <path\n        d=\"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n};\n\nexport const CheckboxHalfChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light1}\n      />\n      <path d=\"M14 10H4V8H14V10Z\" fill=\"white\" />\n    </svg>\n  );\n};\n\nexport const CheckboxUnchecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light2}\n      />\n      <path d=\"M16 2V16H2V2H16V2Z\" fill=\"white\" />\n    </svg>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport { CheckboxChecked, CheckboxUnchecked } from 'src/components/Checkbox';\n\nexport interface CheckboxProps {\n  checked: boolean;\n  onChange: (val?: boolean) => void;\n  style?: React.CSSProperties;\n  className?: string;\n}\n\nconst Styles = styled.span`\n  &,\n  & svg {\n    vertical-align: top;\n  }\n`;\n\nexport default function Checkbox({\n  checked,\n  onChange,\n  style,\n  className,\n}: CheckboxProps) {\n  return (\n    <Styles\n      style={style}\n      onClick={() => {\n        onChange(!checked);\n      }}\n      role=\"checkbox\"\n      tabIndex={0}\n      aria-checked={checked}\n      aria-label=\"Checkbox\"\n      className={className || ''}\n    >\n      {checked ? <CheckboxChecked /> : <CheckboxUnchecked />}\n    </Styles>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  FunctionComponent,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n} from 'react';\nimport Alert from 'src/components/Alert';\nimport { SupersetClient, t, styled } from '@superset-ui/core';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport { ServerPagination, SortByType } from 'src/components/TableView/types';\nimport StyledModal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { useListViewResource } from 'src/views/CRUD/hooks';\nimport Dataset from 'src/types/Dataset';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Loading from 'src/components/Loading';\nimport { AntdInput } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  PAGE_SIZE as DATASET_PAGE_SIZE,\n  SORT_BY as DATASET_SORT_BY,\n} from 'src/views/CRUD/data/dataset/constants';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport FacePile from '../FacePile';\n\nconst CONFIRM_WARNING_MESSAGE = t(\n  'Warning! Changing the dataset may break the chart if the metadata does not exist.',\n);\n\nconst CHANGE_WARNING_MSG = t(\n  'Changing the dataset may break the chart if the chart relies ' +\n    'on columns or metadata that does not exist in the target dataset',\n);\n\ninterface Datasource {\n  type: string;\n  id: number;\n  uid: string;\n}\n\ninterface ChangeDatasourceModalProps {\n  addDangerToast: (msg: string) => void;\n  addSuccessToast: (msg: string) => void;\n  onChange: (uid: string) => void;\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => void;\n  show: boolean;\n}\n\nconst Modal = styled(StyledModal)`\n  .ant-modal-body {\n    display: flex;\n    flex-direction: column;\n  }\n`;\n\nconst ConfirmModalStyled = styled.div`\n  .btn-container {\n    display: flex;\n    justify-content: flex-end;\n    padding: 0px 15px;\n    margin: 10px 0 0 0;\n  }\n\n  .confirm-modal-container {\n    margin: 9px;\n  }\n`;\n\nconst StyledSpan = styled.span`\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.primary.dark1};\n  &: hover {\n    color: ${({ theme }) => theme.colors.primary.dark2};\n  }\n`;\n\nconst ChangeDatasourceModal: FunctionComponent<ChangeDatasourceModalProps> = ({\n  addDangerToast,\n  addSuccessToast,\n  onChange,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [filter, setFilter] = useState<any>(undefined);\n  const [pageIndex, setPageIndex] = useState<number>(0);\n  const [sortBy, setSortBy] = useState<SortByType>(DATASET_SORT_BY);\n  const [confirmChange, setConfirmChange] = useState(false);\n  const [confirmedDataset, setConfirmedDataset] = useState<Datasource>();\n  const searchRef = useRef<AntdInput>(null);\n\n  const {\n    state: { loading, resourceCollection, resourceCount },\n    fetchData,\n  } = useListViewResource<Dataset>('dataset', t('dataset'), addDangerToast);\n\n  const selectDatasource = useCallback((datasource: Datasource) => {\n    setConfirmChange(true);\n    setConfirmedDataset(datasource);\n  }, []);\n\n  const fetchDatasetPayload = {\n    pageIndex,\n    pageSize: DATASET_PAGE_SIZE,\n    filters: [],\n    sortBy,\n  };\n\n  useDebouncedEffect(\n    () => {\n      fetchData({\n        ...fetchDatasetPayload,\n        ...(filter && {\n          filters: [\n            {\n              id: 'table_name',\n              operator: 'ct',\n              value: filter,\n            },\n          ],\n        }),\n      });\n    },\n    SLOW_DEBOUNCE,\n    [filter, pageIndex, sortBy],\n  );\n\n  useEffect(() => {\n    const onEnterModal = async () => {\n      setTimeout(() => searchRef?.current?.focus(), 200);\n    };\n\n    if (show) {\n      onEnterModal();\n    }\n  }, [\n    addDangerToast,\n    fetchData,\n    onChange,\n    onDatasourceSave,\n    onHide,\n    selectDatasource,\n    show,\n  ]);\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const searchValue = event.target.value ?? '';\n    setFilter(searchValue);\n    setPageIndex(0);\n  };\n\n  const handleChangeConfirm = () => {\n    SupersetClient.get({\n      endpoint: `/datasource/get/${confirmedDataset?.type}/${confirmedDataset?.id}/`,\n    })\n      .then(({ json }) => {\n        onDatasourceSave(json);\n        onChange(`${confirmedDataset?.id}__table`);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(\n          ({ error, message }: { error: any; message: string }) => {\n            const errorMessage = error\n              ? error.error || error.statusText || error\n              : message;\n            addDangerToast(errorMessage);\n          },\n        );\n      });\n    onHide();\n    addSuccessToast(t('Successfully changed dataset!'));\n  };\n\n  const handlerCancelConfirm = () => {\n    setConfirmChange(false);\n  };\n\n  const columns = [\n    {\n      Cell: ({ row: { original } }: any) => (\n        <StyledSpan\n          role=\"button\"\n          tabIndex={0}\n          data-test=\"datasource-link\"\n          onClick={() => selectDatasource({ type: 'table', ...original })}\n        >\n          {original?.table_name}\n        </StyledSpan>\n      ),\n      Header: t('Name'),\n      accessor: 'table_name',\n    },\n    {\n      Header: t('Type'),\n      accessor: 'kind',\n      disableSortBy: true,\n    },\n    {\n      Header: t('Schema'),\n      accessor: 'schema',\n    },\n    {\n      Header: t('Connection'),\n      accessor: 'database.database_name',\n      disableSortBy: true,\n    },\n    {\n      Cell: ({\n        row: {\n          original: { owners = [] },\n        },\n      }: any) => <FacePile users={owners} />,\n      Header: t('Owners'),\n      id: 'owners',\n      disableSortBy: true,\n    },\n  ];\n\n  const onServerPagination = (args: ServerPagination) => {\n    setPageIndex(args.pageIndex);\n    if (args.sortBy) {\n      // ensure default sort by\n      setSortBy(args.sortBy.length > 0 ? args.sortBy : DATASET_SORT_BY);\n    }\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      responsive\n      title={t('Swap dataset')}\n      width={confirmChange ? '432px' : ''}\n      height={confirmChange ? 'auto' : '540px'}\n      hideFooter={!confirmChange}\n      footer={\n        <>\n          {confirmChange && (\n            <ConfirmModalStyled>\n              <div className=\"btn-container\">\n                <Button onClick={handlerCancelConfirm}>{t('Cancel')}</Button>\n                <Button\n                  className=\"proceed-btn\"\n                  buttonStyle=\"primary\"\n                  onClick={handleChangeConfirm}\n                >\n                  {t('Proceed')}\n                </Button>\n              </div>\n            </ConfirmModalStyled>\n          )}\n        </>\n      }\n    >\n      <>\n        {!confirmChange && (\n          <>\n            <Alert\n              roomBelow\n              type=\"warning\"\n              css={theme => ({ marginBottom: theme.gridUnit * 4 })}\n              message={\n                <>\n                  <strong>{t('Warning!')}</strong> {CHANGE_WARNING_MSG}\n                </>\n              }\n            />\n            <Input\n              ref={searchRef}\n              type=\"text\"\n              value={filter}\n              placeholder={t('Search / Filter')}\n              onChange={changeSearch}\n            />\n            {loading && <Loading />}\n            {!loading && (\n              <TableView\n                columns={columns}\n                data={resourceCollection}\n                pageSize={DATASET_PAGE_SIZE}\n                initialPageIndex={pageIndex}\n                initialSortBy={sortBy}\n                totalCount={resourceCount}\n                onServerPagination={onServerPagination}\n                className=\"table-condensed\"\n                emptyWrapperType={EmptyWrapperType.Small}\n                serverPagination\n                isPaginationSticky\n                scrollTable\n              />\n            )}\n          </>\n        )}\n        {confirmChange && <>{CONFIRM_WARNING_MESSAGE}</>}\n      </>\n    </Modal>\n  );\n};\n\nexport default withToasts(ChangeDatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponent, useState, useRef } from 'react';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { styled, t, SupersetClient } from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\n\nconst DatasourceEditor = AsyncEsmComponent(() => import('./DatasourceEditor'));\n\nconst StyledDatasourceModal = styled(Modal)`\n  .modal-content {\n    height: 900px;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .modal-header {\n    flex: 0 1 auto;\n  }\n  .modal-body {\n    flex: 1 1 auto;\n    overflow: auto;\n  }\n\n  .modal-footer {\n    flex: 0 1 auto;\n  }\n`;\n\ninterface DatasourceModalProps {\n  addSuccessToast: (msg: string) => void;\n  datasource: any;\n  onChange: () => {};\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => {};\n  show: boolean;\n}\n\nfunction buildExtraJsonObject(item: Record<string, unknown>) {\n  const certification =\n    item?.certified_by || item?.certification_details\n      ? {\n          certified_by: item?.certified_by,\n          details: item?.certification_details,\n        }\n      : undefined;\n  return JSON.stringify({\n    certification,\n    warning_markdown: item?.warning_markdown,\n  });\n}\n\nconst DatasourceModal: FunctionComponent<DatasourceModalProps> = ({\n  addSuccessToast,\n  datasource,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [currentDatasource, setCurrentDatasource] = useState(datasource);\n  const [errors, setErrors] = useState<any[]>([]);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const dialog = useRef<any>(null);\n  const [modal, contextHolder] = Modal.useModal();\n\n  const onConfirmSave = () => {\n    // Pull out extra fields into the extra object\n    const schema =\n      currentDatasource.tableSelector?.schema ||\n      currentDatasource.databaseSelector?.schema ||\n      currentDatasource.schema;\n\n    setIsSaving(true);\n    SupersetClient.post({\n      endpoint: '/datasource/save/',\n      postPayload: {\n        data: {\n          ...currentDatasource,\n          schema,\n          metrics: currentDatasource?.metrics?.map(\n            (metric: Record<string, unknown>) => ({\n              ...metric,\n              extra: buildExtraJsonObject(metric),\n            }),\n          ),\n          columns: currentDatasource?.columns?.map(\n            (column: Record<string, unknown>) => ({\n              ...column,\n              extra: buildExtraJsonObject(column),\n            }),\n          ),\n          type: currentDatasource.type || currentDatasource.datasource_type,\n          owners: currentDatasource.owners.map(\n            (o: Record<string, number>) => o.value || o.id,\n          ),\n        },\n      },\n    })\n      .then(({ json }) => {\n        addSuccessToast(t('The dataset has been saved'));\n        onDatasourceSave({\n          ...json,\n          owners: currentDatasource.owners,\n        });\n        onHide();\n      })\n      .catch(response => {\n        setIsSaving(false);\n        getClientErrorObject(response).then(({ error }) => {\n          modal.error({\n            title: t('Error'),\n            content: error || t('An error has occurred'),\n            okButtonProps: { danger: true, className: 'btn-danger' },\n          });\n        });\n      });\n  };\n\n  const onDatasourceChange = (data: Record<string, any>, err: Array<any>) => {\n    setCurrentDatasource({\n      ...data,\n      metrics: data?.metrics.map((metric: Record<string, unknown>) => ({\n        ...metric,\n        is_certified: metric?.certified_by || metric?.certification_details,\n      })),\n    });\n    setErrors(err);\n  };\n\n  const renderSaveDialog = () => (\n    <div>\n      <Alert\n        css={theme => ({\n          marginTop: theme.gridUnit * 4,\n          marginBottom: theme.gridUnit * 4,\n        })}\n        type=\"warning\"\n        showIcon\n        message={t(`The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.`)}\n      />\n      {t('Are you sure you want to save and apply changes?')}\n    </div>\n  );\n\n  const onClickSave = () => {\n    dialog.current = modal.confirm({\n      title: t('Confirm save'),\n      content: renderSaveDialog(),\n      onOk: onConfirmSave,\n      icon: null,\n      okText: t('OK'),\n      cancelText: t('Cancel'),\n    });\n  };\n\n  const showLegacyDatasourceEditor = !isFeatureEnabled(\n    FeatureFlag.DISABLE_LEGACY_DATASOURCE_EDITOR,\n  );\n\n  return (\n    <StyledDatasourceModal\n      show={show}\n      onHide={onHide}\n      title={\n        <span>\n          {t('Edit Dataset ')}\n          <strong>{currentDatasource.table_name}</strong>\n        </span>\n      }\n      maskClosable={!isEditing}\n      footer={\n        <>\n          {showLegacyDatasourceEditor && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"default\"\n              data-test=\"datasource-modal-legacy-edit\"\n              className=\"m-r-5\"\n              onClick={() => {\n                window.location.href =\n                  currentDatasource.edit_url || currentDatasource.url;\n              }}\n            >\n              {t('Use legacy datasource editor')}\n            </Button>\n          )}\n          <Button\n            data-test=\"datasource-modal-cancel\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={onHide}\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            data-test=\"datasource-modal-save\"\n            onClick={onClickSave}\n            disabled={\n              isSaving ||\n              errors.length > 0 ||\n              currentDatasource.is_managed_externally\n            }\n            tooltip={\n              currentDatasource.is_managed_externally\n                ? t(\n                    \"This dataset is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {t('Save')}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <DatasourceEditor\n        showLoadingForImport\n        height={500}\n        datasource={currentDatasource}\n        onChange={onDatasourceChange}\n        setIsEditing={setIsEditing}\n      />\n      {contextHolder}\n    </StyledDatasourceModal>\n  );\n};\n\nexport default withToasts(DatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DatePicker as AntdDatePicker } from 'antd';\nimport { styled } from '@superset-ui/core';\n\nconst AntdRangePicker = AntdDatePicker.RangePicker;\n\nexport const RangePicker = styled(AntdRangePicker)`\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DatePicker = AntdDatePicker;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport {\n  ChartMetadata,\n  defineSharedModules,\n  getChartMetadataRegistry,\n  logging,\n  makeApi,\n} from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { omitBy } from 'lodash';\n\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport type PluginContextType = {\n  loading: boolean;\n  /** These are actually only the dynamic plugins */\n  dynamicPlugins: {\n    [key: string]: {\n      key: string;\n      mounting: boolean;\n      error: null | Error;\n    };\n  };\n  keys: string[];\n  /** Mounted means the plugin's js bundle has been imported */\n  mountedPluginMetadata: Record<string, ChartMetadata>;\n  fetchAll: () => void;\n};\n\nconst dummyPluginContext: PluginContextType = {\n  loading: true,\n  dynamicPlugins: {},\n  keys: [],\n  mountedPluginMetadata: {},\n  fetchAll: () => {},\n};\n\n/**\n * It is highly recommended to use the usePluginContext hook instead.\n * @see usePluginContext\n */\nexport const PluginContext = React.createContext(dummyPluginContext);\n\n/**\n * The plugin context provides info about what dynamic plugins are available.\n * It also provides loading info for the plugins' javascript bundles.\n *\n * Note: This does not include any information about static plugins.\n * Those are compiled into the Superset bundle at build time.\n * Dynamic plugins are added by the end user and can be any webhosted javascript.\n */\nexport const usePluginContext = () => useContext(PluginContext);\n\n// the plugin returned from the API\ntype Plugin = {\n  name: string;\n  key: string;\n  bundle_url: string;\n  id: number;\n};\n\n// when a plugin completes loading\ntype CompleteAction = {\n  type: 'complete';\n  key: string;\n  error: null | Error;\n};\n\n// when plugins start loading\ntype BeginAction = {\n  type: 'begin';\n  keys: string[];\n};\n\ntype ChangedKeysAction = {\n  type: 'changed keys';\n};\n\ntype PluginAction = BeginAction | CompleteAction | ChangedKeysAction;\n\nfunction getRegistryData() {\n  return {\n    keys: metadataRegistry.keys(),\n    mountedPluginMetadata: omitBy(\n      metadataRegistry.getMap(),\n      value => value === undefined,\n    ) as Record<string, ChartMetadata>, // cast required to get rid of undefined values\n  };\n}\n\nfunction pluginContextReducer(\n  state: PluginContextType,\n  action: PluginAction,\n): PluginContextType {\n  switch (action.type) {\n    case 'begin': {\n      const plugins = { ...state.dynamicPlugins };\n      action.keys.forEach(key => {\n        plugins[key] = { key, error: null, mounting: true };\n      });\n      return {\n        ...state,\n        loading: action.keys.length > 0,\n        dynamicPlugins: plugins,\n      };\n    }\n    case 'complete': {\n      return {\n        ...state,\n        loading: Object.values(state.dynamicPlugins).some(\n          plugin => plugin.mounting && plugin.key !== action.key,\n        ),\n        dynamicPlugins: {\n          ...state.dynamicPlugins,\n          [action.key]: {\n            key: action.key,\n            mounting: false,\n            error: action.error,\n          },\n        },\n      };\n    }\n    case 'changed keys': {\n      return {\n        ...state,\n        ...getRegistryData(),\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nconst pluginApi = makeApi<{}, { result: Plugin[] }>({\n  method: 'GET',\n  endpoint: '/dynamic-plugins/api/read',\n});\n\nconst sharedModules = {\n  react: () => import('react'),\n  lodash: () => import('lodash'),\n  'react-dom': () => import('react-dom'),\n  '@superset-ui/chart-controls': () => import('@superset-ui/chart-controls'),\n  '@superset-ui/core': () => import('@superset-ui/core'),\n};\n\nexport const DynamicPluginProvider: React.FC = ({ children }) => {\n  const [pluginState, dispatch] = useReducer(\n    pluginContextReducer,\n    dummyPluginContext,\n    state => ({\n      ...state,\n      ...getRegistryData(),\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      fetchAll,\n      loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS),\n      // TODO: Write fetchByKeys\n    }),\n  );\n\n  // For now, we fetch all the plugins at the same time.\n  // In the future it would be nice to fetch on an as-needed basis.\n  // That will most likely depend on having a json manifest for each plugin.\n  async function fetchAll() {\n    try {\n      await defineSharedModules(sharedModules);\n      const { result: plugins } = await pluginApi({});\n      dispatch({ type: 'begin', keys: plugins.map(plugin => plugin.key) });\n      await Promise.all(\n        plugins.map(async plugin => {\n          let error: Error | null = null;\n          try {\n            await import(/* webpackIgnore: true */ plugin.bundle_url);\n          } catch (err) {\n            logging.error(\n              `Failed to load plugin ${plugin.key} with the following error:`,\n              err.stack,\n            );\n            error = err;\n          }\n          dispatch({\n            type: 'complete',\n            key: plugin.key,\n            error,\n          });\n        }),\n      );\n    } catch (error) {\n      logging.error('Failed to load dynamic plugins', error.stack || error);\n    }\n  }\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS)) {\n      fetchAll();\n    }\n    const registryListener = () => {\n      dispatch({ type: 'changed keys' });\n    };\n    metadataRegistry.addListener(registryListener);\n    return () => {\n      metadataRegistry.removeListener(registryListener);\n    };\n  }, []);\n\n  return (\n    <PluginContext.Provider value={pluginState}>\n      {children}\n    </PluginContext.Provider>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport {\n  getCategoricalSchemeRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Avatar } from 'src/components';\nimport { getRandomColor } from './utils';\n\ninterface FacePileProps {\n  users: { first_name: string; last_name: string; id: number }[];\n  maxCount?: number;\n}\n\nconst colorList = getCategoricalSchemeRegistry().get()?.colors ?? [];\n\nconst customAvatarStyler = (theme: SupersetTheme) => `\n  width: ${theme.gridUnit * 6}px;\n  height: ${theme.gridUnit * 6}px;\n  line-height: ${theme.gridUnit * 6}px;\n  font-size: ${theme.typography.sizes.m}px;\n`;\n\nconst StyledAvatar = styled(Avatar)`\n  ${({ theme }) => customAvatarStyler(theme)}\n`;\n\n// to apply styling to the maxCount avatar\nconst StyledGroup = styled(Avatar.Group)`\n  .ant-avatar {\n    ${({ theme }) => customAvatarStyler(theme)}\n  }\n`;\n\nexport default function FacePile({ users, maxCount = 4 }: FacePileProps) {\n  return (\n    <StyledGroup maxCount={maxCount}>\n      {users.map(({ first_name, last_name, id }) => {\n        const name = `${first_name} ${last_name}`;\n        const uniqueKey = `${id}-${first_name}-${last_name}`;\n        const color = getRandomColor(uniqueKey, colorList);\n        return (\n          <Tooltip key={name} title={name} placement=\"top\">\n            <StyledAvatar\n              key={name}\n              style={{\n                backgroundColor: color,\n                borderColor: color,\n              }}\n            >\n              {first_name?.[0]?.toLocaleUpperCase()}\n              {last_name?.[0]?.toLocaleUpperCase()}\n            </StyledAvatar>\n          </Tooltip>\n        );\n      })}\n    </StyledGroup>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// https://en.wikipedia.org/wiki/Linear_congruential_generator\nfunction stringAsciiPRNG(value: string, m: number) {\n  // Xn+1 = (a * Xn + c) % m\n  // 0 < a < m\n  // 0 <= c < m\n  // 0 <= X0 < m\n\n  const charCodes = [...value].map(letter => letter.charCodeAt(0));\n  const len = charCodes.length;\n\n  const a = (len % (m - 1)) + 1;\n  const c = charCodes.reduce((current, next) => current + next) % m;\n\n  let random = charCodes[0] % m;\n\n  [...new Array(len)].forEach(() => {\n    random = (a * random + c) % m;\n  });\n\n  return random;\n}\n\nexport function getRandomColor(sampleValue: string, colorList: string[]) {\n  // if no value is passed, always return transparent color for consistency\n  if (!sampleValue) return 'transparent';\n\n  // value based random color index,\n  // ensuring the same sampleValue always resolves to the same color\n  return colorList[stringAsciiPRNG(sampleValue, colorList.length)];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Popover } from 'antd';\n\nexport { PopoverProps } from 'antd/lib/popover';\nexport { TooltipPlacement } from 'antd/lib/tooltip';\n\n// Eventually Popover can be wrapped and customized in this file\n// for now we're just redirecting\nexport default Popover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { MouseEventHandler, ReactNode } from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\n\nexport interface PopoverSectionProps {\n  title: string;\n  isSelected?: boolean;\n  onSelect?: MouseEventHandler<HTMLDivElement>;\n  info?: string;\n  children?: ReactNode;\n}\n\nexport default function PopoverSection({\n  title,\n  isSelected,\n  children,\n  onSelect,\n  info,\n}: PopoverSectionProps) {\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        paddingBottom: theme.gridUnit * 2,\n        opacity: isSelected ? 1 : theme.opacity.mediumHeavy,\n      }}\n    >\n      <div\n        role=\"button\"\n        tabIndex={0}\n        onClick={onSelect}\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: onSelect ? 'pointer' : 'default',\n        }}\n      >\n        <strong data-test=\"popover-title\">{title}</strong>\n        {info && (\n          <Tooltip title={info} css={{ marginLeft: theme.gridUnit }}>\n            <Icons.InfoSolidSmall\n              role=\"img\"\n              width={14}\n              height={14}\n              iconColor={theme.colors.grayscale.light1}\n            />\n          </Tooltip>\n        )}\n        <Icons.Check\n          role=\"img\"\n          iconColor={\n            isSelected ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n        />\n      </div>\n      <div\n        css={{\n          marginLeft: theme.gridUnit,\n          marginTop: theme.gridUnit,\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { createContext, useContext, useState } from 'react';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\n\ninterface UiConfigType {\n  hideTitle: boolean;\n  hideTab: boolean;\n  hideNav: boolean;\n  hideChartControls: boolean;\n}\ninterface EmbeddedUiConfigProviderProps {\n  children: JSX.Element;\n}\n\nexport const UiConfigContext = createContext<UiConfigType>({\n  hideTitle: false,\n  hideTab: false,\n  hideNav: false,\n  hideChartControls: false,\n});\n\nexport const useUiConfig = () => useContext(UiConfigContext);\n\nexport const EmbeddedUiConfigProvider: React.FC<EmbeddedUiConfigProviderProps> =\n  ({ children }) => {\n    const config = getUrlParam(URL_PARAMS.uiConfig) || 0;\n    const [embeddedConfig] = useState({\n      hideTitle: (config & 1) !== 0,\n      hideTab: (config & 2) !== 0,\n      hideNav: (config & 4) !== 0,\n      hideChartControls: (config & 8) !== 0,\n    });\n\n    return (\n      <UiConfigContext.Provider value={embeddedConfig}>\n        {children}\n      </UiConfigContext.Provider>\n    );\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { makeApi, CategoricalColorNamespace } from '@superset-ui/core';\nimport { isString } from 'lodash';\nimport { getErrorText } from 'src/utils/getClientErrorObject';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport {\n  DashboardInfo,\n  FilterBarOrientation,\n  RootState,\n} from 'src/dashboard/types';\nimport { ChartConfiguration } from 'src/dashboard/reducers/types';\nimport { onSave } from './dashboardState';\n\nexport const DASHBOARD_INFO_UPDATED = 'DASHBOARD_INFO_UPDATED';\n\nexport function updateColorSchema(\n  metadata: Record<string, any>,\n  labelColors: Record<string, string>,\n) {\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n  const colorMap = isString(labelColors)\n    ? JSON.parse(labelColors)\n    : labelColors;\n  Object.keys(colorMap).forEach(label => {\n    categoricalNamespace.setColor(label, colorMap[label]);\n  });\n}\n\n// updates partially changed dashboard info\nexport function dashboardInfoChanged(newInfo: { metadata: any }) {\n  const { metadata } = newInfo;\n\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n\n  categoricalNamespace.resetColors();\n\n  if (metadata?.shared_label_colors) {\n    updateColorSchema(metadata, metadata?.shared_label_colors);\n  }\n\n  if (metadata?.label_colors) {\n    updateColorSchema(metadata, metadata?.label_colors);\n  }\n\n  return { type: DASHBOARD_INFO_UPDATED, newInfo };\n}\nexport const SET_CHART_CONFIG_BEGIN = 'SET_CHART_CONFIG_BEGIN';\nexport interface SetChartConfigBegin {\n  type: typeof SET_CHART_CONFIG_BEGIN;\n  chartConfiguration: ChartConfiguration;\n}\nexport const SET_CHART_CONFIG_COMPLETE = 'SET_CHART_CONFIG_COMPLETE';\nexport interface SetChartConfigComplete {\n  type: typeof SET_CHART_CONFIG_COMPLETE;\n  chartConfiguration: ChartConfiguration;\n}\nexport const SET_CHART_CONFIG_FAIL = 'SET_CHART_CONFIG_FAIL';\nexport interface SetChartConfigFail {\n  type: typeof SET_CHART_CONFIG_FAIL;\n  chartConfiguration: ChartConfiguration;\n}\nexport const setChartConfiguration =\n  (chartConfiguration: ChartConfiguration) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    dispatch({\n      type: SET_CHART_CONFIG_BEGIN,\n      chartConfiguration,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          chart_configuration: chartConfiguration,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SET_CHART_CONFIG_COMPLETE,\n        chartConfiguration,\n      });\n    } catch (err) {\n      dispatch({ type: SET_CHART_CONFIG_FAIL, chartConfiguration });\n    }\n  };\n\nexport const SET_FILTER_BAR_ORIENTATION = 'SET_FILTER_BAR_ORIENTATION';\nexport interface SetFilterBarOrientation {\n  type: typeof SET_FILTER_BAR_ORIENTATION;\n  filterBarOrientation: FilterBarOrientation;\n}\nexport function setFilterBarOrientation(\n  filterBarOrientation: FilterBarOrientation,\n) {\n  return { type: SET_FILTER_BAR_ORIENTATION, filterBarOrientation };\n}\n\nexport const SET_CROSS_FILTERS_ENABLED = 'SET_CROSS_FILTERS_ENABLED';\nexport interface SetCrossFiltersEnabled {\n  type: typeof SET_CROSS_FILTERS_ENABLED;\n  crossFiltersEnabled: boolean;\n}\nexport function setCrossFiltersEnabled(crossFiltersEnabled: boolean) {\n  return { type: SET_CROSS_FILTERS_ENABLED, crossFiltersEnabled };\n}\n\nexport function saveFilterBarOrientation(orientation: FilterBarOrientation) {\n  return async (dispatch: Dispatch, getState: () => RootState) => {\n    const { id, metadata } = getState().dashboardInfo;\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: Partial<DashboardInfo>; last_modified_time: number }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          filter_bar_orientation: orientation,\n        }),\n      });\n      const updatedDashboard = response.result;\n      const lastModifiedTime = response.last_modified_time;\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        if (metadata.filter_bar_orientation) {\n          dispatch(setFilterBarOrientation(metadata.filter_bar_orientation));\n        }\n      }\n      if (lastModifiedTime) {\n        dispatch(onSave(lastModifiedTime));\n      }\n    } catch (errorObject) {\n      const errorText = await getErrorText(errorObject, 'dashboard');\n      dispatch(addDangerToast(errorText));\n      throw errorObject;\n    }\n  };\n}\n\nexport function saveCrossFiltersSetting(crossFiltersEnabled: boolean) {\n  return async (dispatch: Dispatch, getState: () => RootState) => {\n    const { id, metadata } = getState().dashboardInfo;\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: Partial<DashboardInfo>; last_modified_time: number }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          cross_filters_enabled: crossFiltersEnabled,\n        }),\n      });\n      const updatedDashboard = response.result;\n      const lastModifiedTime = response.last_modified_time;\n      if (updatedDashboard.json_metadata) {\n        const metadata = JSON.parse(updatedDashboard.json_metadata);\n        dispatch(setCrossFiltersEnabled(metadata.cross_filters_enabled));\n      }\n      if (lastModifiedTime) {\n        dispatch(onSave(lastModifiedTime));\n      }\n    } catch (errorObject) {\n      const errorText = await getErrorText(errorObject, 'dashboard');\n      dispatch(addDangerToast(errorText));\n      throw errorObject;\n    }\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { SupersetClient } from '@superset-ui/core';\nimport { Datasource, RootState } from 'src/dashboard/types';\n\n// update datasources index for Dashboard\nexport enum DatasourcesAction {\n  SET_DATASOURCES = 'SET_DATASOURCES',\n  SET_DATASOURCE = 'SET_DATASOURCE',\n}\n\nexport type DatasourcesActionPayload =\n  | {\n      type: DatasourcesAction.SET_DATASOURCES;\n      datasources: Datasource[] | null;\n    }\n  | {\n      type: DatasourcesAction.SET_DATASOURCE;\n      key: Datasource['uid'];\n      datasource: Datasource;\n    };\n\nexport function setDatasources(datasources: Datasource[] | null) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCES,\n    datasources,\n  };\n}\n\nexport function setDatasource(datasource: Datasource, key: string) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCE,\n    key,\n    datasource,\n  };\n}\n\nexport function fetchDatasourceMetadata(key: string) {\n  return (dispatch: Dispatch, getState: () => RootState) => {\n    const { datasources } = getState();\n    const datasource = datasources[key];\n\n    if (datasource) {\n      return dispatch(setDatasource(datasource, key));\n    }\n\n    return SupersetClient.get({\n      endpoint: `/superset/fetch_datasource_metadata?datasourceKey=${key}`,\n    }).then(({ json }) => dispatch(setDatasource(json as Datasource, key)));\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  FilterConfiguration,\n  Filters,\n  FilterSet,\n  FilterSets,\n  makeApi,\n} from '@superset-ui/core';\nimport { Dispatch } from 'redux';\nimport {\n  SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n  setDataMaskForFilterConfigComplete,\n} from 'src/dataMask/actions';\nimport { HYDRATE_DASHBOARD } from './hydrate';\nimport { dashboardInfoChanged } from './dashboardInfo';\nimport { FilterSetFullData } from '../reducers/types';\nimport { DashboardInfo, RootState } from '../types';\n\nexport const SET_FILTER_CONFIG_BEGIN = 'SET_FILTER_CONFIG_BEGIN';\nexport interface SetFilterConfigBegin {\n  type: typeof SET_FILTER_CONFIG_BEGIN;\n  filterConfig: FilterConfiguration;\n}\n\nexport const SET_FILTER_CONFIG_COMPLETE = 'SET_FILTER_CONFIG_COMPLETE';\nexport interface SetFilterConfigComplete {\n  type: typeof SET_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_CONFIG_FAIL = 'SET_FILTER_CONFIG_FAIL';\nexport interface SetFilterConfigFail {\n  type: typeof SET_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_IN_SCOPE_STATUS_OF_FILTERS = 'SET_IN_SCOPE_STATUS_OF_FILTERS';\nexport interface SetInScopeStatusOfFilters {\n  type: typeof SET_IN_SCOPE_STATUS_OF_FILTERS;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_SETS_BEGIN = 'SET_FILTER_SETS_BEGIN';\nexport interface SetFilterSetsBegin {\n  type: typeof SET_FILTER_SETS_BEGIN;\n}\nexport const SET_FILTER_SETS_COMPLETE = 'SET_FILTER_SETS_COMPLETE';\nexport interface SetFilterSetsComplete {\n  type: typeof SET_FILTER_SETS_COMPLETE;\n  filterSets: FilterSet[];\n}\nexport const SET_FILTER_SETS_FAIL = 'SET_FILTER_SETS_FAIL';\nexport interface SetFilterSetsFail {\n  type: typeof SET_FILTER_SETS_FAIL;\n}\n\nexport const CREATE_FILTER_SET_BEGIN = 'CREATE_FILTER_SET_BEGIN';\nexport interface CreateFilterSetBegin {\n  type: typeof CREATE_FILTER_SET_BEGIN;\n}\nexport const CREATE_FILTER_SET_COMPLETE = 'CREATE_FILTER_SET_COMPLETE';\nexport interface CreateFilterSetComplete {\n  type: typeof CREATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const CREATE_FILTER_SET_FAIL = 'CREATE_FILTER_SET_FAIL';\nexport interface CreateFilterSetFail {\n  type: typeof CREATE_FILTER_SET_FAIL;\n}\n\nexport const DELETE_FILTER_SET_BEGIN = 'DELETE_FILTER_SET_BEGIN';\nexport interface DeleteFilterSetBegin {\n  type: typeof DELETE_FILTER_SET_BEGIN;\n}\nexport const DELETE_FILTER_SET_COMPLETE = 'DELETE_FILTER_SET_COMPLETE';\nexport interface DeleteFilterSetComplete {\n  type: typeof DELETE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const DELETE_FILTER_SET_FAIL = 'DELETE_FILTER_SET_FAIL';\nexport interface DeleteFilterSetFail {\n  type: typeof DELETE_FILTER_SET_FAIL;\n}\n\nexport const UPDATE_FILTER_SET_BEGIN = 'UPDATE_FILTER_SET_BEGIN';\nexport interface UpdateFilterSetBegin {\n  type: typeof UPDATE_FILTER_SET_BEGIN;\n}\nexport const UPDATE_FILTER_SET_COMPLETE = 'UPDATE_FILTER_SET_COMPLETE';\nexport interface UpdateFilterSetComplete {\n  type: typeof UPDATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const UPDATE_FILTER_SET_FAIL = 'UPDATE_FILTER_SET_FAIL';\nexport interface UpdateFilterSetFail {\n  type: typeof UPDATE_FILTER_SET_FAIL;\n}\n\nexport const setFilterConfiguration =\n  (filterConfig: FilterConfiguration) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    dispatch({\n      type: SET_FILTER_CONFIG_BEGIN,\n      filterConfig,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n    const oldFilters = getState().nativeFilters?.filters;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const oldFilter = oldFilters[filter.id];\n      if (!oldFilter) {\n        return filter;\n      }\n      return { ...oldFilter, ...filter };\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          native_filter_configuration: mergedFilterConfig,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SET_FILTER_CONFIG_COMPLETE,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch(\n        setDataMaskForFilterConfigComplete(mergedFilterConfig, oldFilters),\n      );\n    } catch (err) {\n      dispatch({\n        type: SET_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch({\n        type: SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n    }\n  };\n\nexport const setInScopeStatusOfFilters =\n  (\n    filterScopes: {\n      filterId: string;\n      chartsInScope: number[];\n      tabsInScope: string[];\n    }[],\n  ) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    const filters = getState().nativeFilters?.filters;\n    const filtersWithScopes = filterScopes.map(scope => ({\n      ...filters[scope.filterId],\n      chartsInScope: scope.chartsInScope,\n      tabsInScope: scope.tabsInScope,\n    }));\n    dispatch({\n      type: SET_IN_SCOPE_STATUS_OF_FILTERS,\n      filterConfig: filtersWithScopes,\n    });\n    // need to update native_filter_configuration in the dashboard metadata\n    const { metadata } = getState().dashboardInfo;\n    const filterConfig: FilterConfiguration =\n      metadata.native_filter_configuration;\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const filterWithScope = filtersWithScopes.find(\n        scope => scope.id === filter.id,\n      );\n      if (!filterWithScope) {\n        return filter;\n      }\n      return { ...filterWithScope, ...filter };\n    });\n    metadata.native_filter_configuration = mergedFilterConfig;\n    dispatch(\n      dashboardInfoChanged({\n        metadata,\n      }),\n    );\n  };\n\ntype BootstrapData = {\n  nativeFilters: {\n    filters: Filters;\n    filterSets: FilterSets;\n    filtersState: object;\n  };\n};\n\nexport interface SetBootstrapData {\n  type: typeof HYDRATE_DASHBOARD;\n  data: BootstrapData;\n}\n\nexport const getFilterSets =\n  (dashboardId: number) => async (dispatch: Dispatch) => {\n    const fetchFilterSets = makeApi<\n      null,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'GET',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: SET_FILTER_SETS_BEGIN,\n    });\n\n    const response = await fetchFilterSets(null);\n\n    dispatch({\n      type: SET_FILTER_SETS_COMPLETE,\n      filterSets: response.ids.map((id, i) => ({\n        ...response.result[i].params,\n        id,\n        name: response.result[i].name,\n      })),\n    });\n  };\n\nexport const createFilterSet =\n  (filterSet: Omit<FilterSet, 'id'>) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'POST',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & { name?: string } =\n      {\n        ...filterSet,\n      };\n\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      owner_type: 'Dashboard',\n      owner_id: dashboardId,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const updateFilterSet =\n  (filterSet: FilterSet) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {}\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSet.id}`,\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & {\n      name?: string;\n      id?: number;\n    } = {\n      ...filterSet,\n    };\n\n    delete serverFilterSet.id;\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const deleteFilterSet =\n  (filterSetId: number) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const deleteFilterSets = makeApi<{}, {}>({\n      method: 'DELETE',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSetId}`,\n    });\n\n    dispatch({\n      type: DELETE_FILTER_SET_BEGIN,\n    });\n\n    await deleteFilterSets({});\n\n    dispatch({\n      type: DELETE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const SET_FOCUSED_NATIVE_FILTER = 'SET_FOCUSED_NATIVE_FILTER';\nexport interface SetFocusedNativeFilter {\n  type: typeof SET_FOCUSED_NATIVE_FILTER;\n  id: string;\n}\nexport const UNSET_FOCUSED_NATIVE_FILTER = 'UNSET_FOCUSED_NATIVE_FILTER';\nexport interface UnsetFocusedNativeFilter {\n  type: typeof UNSET_FOCUSED_NATIVE_FILTER;\n}\n\nexport function setFocusedNativeFilter(id: string): SetFocusedNativeFilter {\n  return {\n    type: SET_FOCUSED_NATIVE_FILTER,\n    id,\n  };\n}\nexport function unsetFocusedNativeFilter(): UnsetFocusedNativeFilter {\n  return {\n    type: UNSET_FOCUSED_NATIVE_FILTER,\n  };\n}\n\nexport const SET_HOVERED_NATIVE_FILTER = 'SET_HOVERED_NATIVE_FILTER';\nexport interface SetHoveredNativeFilter {\n  type: typeof SET_HOVERED_NATIVE_FILTER;\n  id: string;\n}\nexport const UNSET_HOVERED_NATIVE_FILTER = 'UNSET_HOVERED_NATIVE_FILTER';\nexport interface UnsetHoveredNativeFilter {\n  type: typeof UNSET_HOVERED_NATIVE_FILTER;\n}\n\nexport function setHoveredNativeFilter(id: string): SetHoveredNativeFilter {\n  return {\n    type: SET_HOVERED_NATIVE_FILTER,\n    id,\n  };\n}\nexport function unsetHoveredNativeFilter(): UnsetHoveredNativeFilter {\n  return {\n    type: UNSET_HOVERED_NATIVE_FILTER,\n  };\n}\n\nexport type AnyFilterAction =\n  | SetFilterConfigBegin\n  | SetFilterConfigComplete\n  | SetFilterConfigFail\n  | SetFilterSetsBegin\n  | SetFilterSetsComplete\n  | SetFilterSetsFail\n  | SetInScopeStatusOfFilters\n  | SetBootstrapData\n  | SetFocusedNativeFilter\n  | UnsetFocusedNativeFilter\n  | SetHoveredNativeFilter\n  | UnsetHoveredNativeFilter\n  | CreateFilterSetBegin\n  | CreateFilterSetComplete\n  | CreateFilterSetFail\n  | DeleteFilterSetBegin\n  | DeleteFilterSetComplete\n  | DeleteFilterSetFail\n  | UpdateFilterSetBegin\n  | UpdateFilterSetComplete\n  | UpdateFilterSetFail;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FormInstance } from 'src/components';\nimport shortid from 'shortid';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport {\n  Filter,\n  FilterConfiguration,\n  NativeFilterType,\n  Divider,\n  NativeFilterTarget,\n  logging,\n} from '@superset-ui/core';\nimport { DASHBOARD_ROOT_ID } from 'src/dashboard/util/constants';\nimport { FilterRemoval, NativeFiltersForm } from './types';\n\nexport const REMOVAL_DELAY_SECS = 5;\n\nexport const hasCircularDependency = (\n  dependencyMap: Map<string, string[]>,\n  filterId: string,\n  trace: string[] = [],\n): boolean => {\n  if (trace.includes(filterId)) {\n    return true;\n  }\n  const dependencies = dependencyMap.get(filterId);\n  if (dependencies) {\n    return dependencies.some(dependency =>\n      hasCircularDependency(dependencyMap, dependency, [...trace, filterId]),\n    );\n  }\n  return false;\n};\n\nexport const validateForm = async (\n  form: FormInstance<NativeFiltersForm>,\n  currentFilterId: string,\n  setCurrentFilterId: Function,\n) => {\n  try {\n    let formValues: NativeFiltersForm;\n    try {\n      formValues = (await form.validateFields()) as NativeFiltersForm;\n    } catch (error) {\n      // In Jest tests in chain of tests, Ant generate `outOfDate` error so need to catch it here\n      if (!error?.errorFields?.length && error?.outOfDate) {\n        formValues = error.values;\n      } else {\n        throw error;\n      }\n    }\n    return formValues;\n  } catch (error) {\n    logging.warn('Filter configuration failed:', error);\n\n    if (!error.errorFields || !error.errorFields.length) return null; // not a validation error\n\n    // the name is in array format since the fields are nested\n    type ErrorFields = { name: ['filters', string, string] }[];\n    const errorFields = error.errorFields as ErrorFields;\n    // filter id is the second item in the field name\n    if (!errorFields.some(field => field.name[1] === currentFilterId)) {\n      // switch to the first tab that had a validation error\n      const filterError = errorFields.find(\n        field => field.name[0] === 'filters',\n      );\n      if (filterError) {\n        const filterId = filterError.name[1];\n        setCurrentFilterId(filterId);\n      }\n    }\n    return null;\n  }\n};\n\nexport const createHandleSave =\n  (\n    filterConfigMap: Record<string, Filter | Divider>,\n    filterIds: string[],\n    removedFilters: Record<string, FilterRemoval>,\n    saveForm: Function,\n    values: NativeFiltersForm,\n  ) =>\n  async () => {\n    const newFilterConfig: FilterConfiguration = filterIds\n      .filter(id => !removedFilters[id])\n      .map(id => {\n        // create a filter config object from the form inputs\n        const formInputs = values.filters?.[id];\n        // if user didn't open a filter, return the original config\n        if (!formInputs) return filterConfigMap[id];\n        if (formInputs.type === NativeFilterType.DIVIDER) {\n          return {\n            id,\n            type: NativeFilterType.DIVIDER,\n            scope: {\n              rootPath: [DASHBOARD_ROOT_ID],\n              excluded: [],\n            },\n            title: formInputs.title,\n            description: formInputs.description,\n          };\n        }\n        const target: Partial<NativeFilterTarget> = {};\n        if (formInputs.dataset) {\n          target.datasetId = formInputs.dataset.value;\n        }\n        if (formInputs.dataset && formInputs.column) {\n          target.column = { name: formInputs.column };\n        }\n        return {\n          id,\n          adhoc_filters: formInputs.adhoc_filters,\n          time_range: formInputs.time_range,\n          controlValues: formInputs.controlValues ?? {},\n          granularity_sqla: formInputs.granularity_sqla,\n          requiredFirst: Object.values(formInputs.requiredFirst ?? {}).find(\n            rf => rf,\n          ),\n          name: formInputs.name,\n          filterType: formInputs.filterType,\n          // for now there will only ever be one target\n          targets: [target],\n          defaultDataMask: formInputs.defaultDataMask ?? getInitialDataMask(),\n          cascadeParentIds: formInputs.dependencies || [],\n          scope: formInputs.scope,\n          sortMetric: formInputs.sortMetric,\n          type: formInputs.type,\n          description: (formInputs.description || '').trim(),\n        };\n      });\n\n    await saveForm(newFilterConfig);\n  };\n\nexport const createHandleRemoveItem =\n  (\n    setRemovedFilters: (\n      value:\n        | ((\n            prevState: Record<string, FilterRemoval>,\n          ) => Record<string, FilterRemoval>)\n        | Record<string, FilterRemoval>,\n    ) => void,\n    setOrderedFilters: (\n      val: string[] | ((prevState: string[]) => string[]),\n    ) => void,\n    setSaveAlertVisible: Function,\n  ) =>\n  (filterId: string) => {\n    const completeFilterRemoval = (filterId: string) => {\n      // the filter state will actually stick around in the form,\n      // and the filterConfig/newFilterIds, but we use removedFilters\n      // to mark it as removed.\n      setRemovedFilters(removedFilters => ({\n        ...removedFilters,\n        [filterId]: { isPending: false },\n      }));\n      setOrderedFilters((orderedFilters: string[]) =>\n        orderedFilters.filter(filter => filter !== filterId),\n      );\n    };\n\n    // first set up the timer to completely remove it\n    const timerId = window.setTimeout(() => {\n      completeFilterRemoval(filterId);\n    }, REMOVAL_DELAY_SECS * 1000);\n    // mark the filter state as \"removal in progress\"\n    setRemovedFilters(removedFilters => ({\n      ...removedFilters,\n      [filterId]: { isPending: true, timerId },\n    }));\n    setSaveAlertVisible(false);\n  };\n\nexport const NATIVE_FILTER_PREFIX = 'NATIVE_FILTER-';\nexport const NATIVE_FILTER_DIVIDER_PREFIX = 'NATIVE_FILTER_DIVIDER-';\nexport const generateFilterId = (type: NativeFilterType) => {\n  const prefix =\n    type === NativeFilterType.NATIVE_FILTER\n      ? NATIVE_FILTER_PREFIX\n      : NATIVE_FILTER_DIVIDER_PREFIX;\n  return `${prefix}${shortid.generate()}`;\n};\n\nexport const getFilterIds = (config: FilterConfiguration) =>\n  config.map(filter => filter.id);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  Behavior,\n  DataMaskStateWithId,\n  EXTRA_FORM_DATA_APPEND_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_KEYS,\n  ExtraFormData,\n  FeatureFlag,\n  Filter,\n  getChartMetadataRegistry,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { DashboardLayout } from 'src/dashboard/types';\nimport extractUrlParams from 'src/dashboard/util/extractUrlParams';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { CHART_TYPE, TAB_TYPE } from '../../util/componentTypes';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\n\nexport const getFormData = ({\n  datasetId,\n  dependencies = {},\n  groupby,\n  defaultDataMask,\n  controlValues,\n  filterType,\n  sortMetric,\n  adhoc_filters,\n  time_range,\n  granularity_sqla,\n  type,\n}: Partial<Filter> & {\n  datasetId?: number;\n  dependencies?: object;\n  groupby?: string;\n  adhoc_filters?: AdhocFilter[];\n  time_range?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: {\n    datasource?: string;\n    groupby?: string[];\n    sortMetric?: string;\n  } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  if (sortMetric) {\n    otherProps.sortMetric = sortMetric;\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: adhoc_filters ?? [],\n    extra_filters: [],\n    extra_form_data: dependencies,\n    granularity_sqla,\n    metrics: ['count'],\n    row_limit: 1000,\n    showSearch: true,\n    defaultValue: defaultDataMask?.filterState?.value,\n    time_range,\n    url_params: extractUrlParams('regular'),\n    inView: true,\n    viz_type: filterType,\n    type,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData = {},\n): ExtraFormData {\n  const mergedExtra: ExtraFormData = {};\n  EXTRA_FORM_DATA_APPEND_KEYS.forEach((key: string) => {\n    const mergedValues = [\n      ...(originalExtra[key] || []),\n      ...(newExtra[key] || []),\n    ];\n    if (mergedValues.length) {\n      mergedExtra[key] = mergedValues;\n    }\n  });\n  EXTRA_FORM_DATA_OVERRIDE_KEYS.forEach((key: string) => {\n    const originalValue = originalExtra[key];\n    if (originalValue !== undefined) {\n      mergedExtra[key] = originalValue;\n    }\n    const newValue = newExtra[key];\n    if (newValue !== undefined) {\n      mergedExtra[key] = newValue;\n    }\n  });\n  return mergedExtra;\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.INTERACTIVE_CHART,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    extraFormData = mergeExtraFormData(\n      extraFormData,\n      dataMask[key]?.extraFormData ?? {},\n    );\n  });\n  return extraFormData;\n}\n\nexport function nativeFilterGate(behaviors: Behavior[]): boolean {\n  return (\n    !behaviors.includes(Behavior.NATIVE_FILTER) ||\n    (isFeatureEnabled(FeatureFlag.DASHBOARD_FILTERS_EXPERIMENTAL) &&\n      isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n      behaviors.includes(Behavior.INTERACTIVE_CHART))\n  );\n}\n\nconst isComponentATab = (\n  dashboardLayout: DashboardLayout,\n  componentId: string,\n) => dashboardLayout?.[componentId]?.type === TAB_TYPE;\n\nconst findTabsWithChartsInScopeHelper = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n  componentId: string,\n  tabIds: string[],\n  tabsToHighlight: Set<string>,\n) => {\n  if (\n    dashboardLayout?.[componentId]?.type === CHART_TYPE &&\n    chartsInScope.includes(dashboardLayout[componentId]?.meta?.chartId)\n  ) {\n    tabIds.forEach(tabsToHighlight.add, tabsToHighlight);\n  }\n  if (\n    dashboardLayout?.[componentId]?.children?.length === 0 ||\n    (isComponentATab(dashboardLayout, componentId) &&\n      tabsToHighlight.has(componentId))\n  ) {\n    return;\n  }\n  dashboardLayout[componentId]?.children.forEach(childId =>\n    findTabsWithChartsInScopeHelper(\n      dashboardLayout,\n      chartsInScope,\n      childId,\n      isComponentATab(dashboardLayout, childId) ? [...tabIds, childId] : tabIds,\n      tabsToHighlight,\n    ),\n  );\n};\n\nexport const findTabsWithChartsInScope = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n) => {\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const hasTopLevelTabs = rootChildId !== DASHBOARD_GRID_ID;\n  const tabsInScope = new Set<string>();\n  if (hasTopLevelTabs) {\n    dashboardLayout[rootChildId]?.children?.forEach(tabId =>\n      findTabsWithChartsInScopeHelper(\n        dashboardLayout,\n        chartsInScope,\n        tabId,\n        [tabId],\n        tabsInScope,\n      ),\n    );\n  } else {\n    Object.values(dashboardLayout)\n      .filter(element => element?.type === TAB_TYPE)\n      .forEach(element =>\n        findTabsWithChartsInScopeHelper(\n          dashboardLayout,\n          chartsInScope,\n          element.id,\n          [element.id],\n          tabsInScope,\n        ),\n      );\n  }\n  return tabsInScope;\n};\n","/* eslint-disable import/prefer-default-export */\nimport { DatasourceType } from '@superset-ui/core';\nimport { Datasource } from 'src/dashboard/types';\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const PLACEHOLDER_DATASOURCE: Datasource = {\n  id: 0,\n  type: DatasourceType.Table,\n  uid: '_placeholder_',\n  datasource_name: '',\n  table_name: '',\n  columns: [],\n  column_types: [],\n  metrics: [],\n  column_format: {},\n  verbose_map: {},\n  main_dttm_col: '',\n  description: '',\n};\n\nexport const MAIN_HEADER_HEIGHT = 53;\nexport const CLOSED_FILTER_BAR_WIDTH = 32;\nexport const OPEN_FILTER_BAR_WIDTH = 260;\nexport const OPEN_FILTER_BAR_MAX_WIDTH = 550;\nexport const FILTER_BAR_HEADER_HEIGHT = 80;\nexport const FILTER_BAR_TABS_HEIGHT = 46;\nexport const BUILDER_SIDEPANEL_WIDTH = 374;\nexport const OVERWRITE_INSPECT_FIELDS = ['css', 'json_metadata.filter_scopes'];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AnyFilterAction,\n  SET_FILTER_CONFIG_COMPLETE,\n  SET_IN_SCOPE_STATUS_OF_FILTERS,\n  SET_FILTER_SETS_COMPLETE,\n  SET_FOCUSED_NATIVE_FILTER,\n  UNSET_FOCUSED_NATIVE_FILTER,\n  SET_HOVERED_NATIVE_FILTER,\n  UNSET_HOVERED_NATIVE_FILTER,\n} from 'src/dashboard/actions/nativeFilters';\nimport {\n  FilterSet,\n  FilterConfiguration,\n  NativeFiltersState,\n} from '@superset-ui/core';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport function getInitialState({\n  filterSetsConfig,\n  filterConfig,\n  state: prevState,\n}: {\n  filterSetsConfig?: FilterSet[];\n  filterConfig?: FilterConfiguration;\n  state?: NativeFiltersState;\n}): NativeFiltersState {\n  const state: Partial<NativeFiltersState> = {};\n\n  const filters = {};\n  if (filterConfig) {\n    filterConfig.forEach(filter => {\n      const { id } = filter;\n      filters[id] = filter;\n    });\n    state.filters = filters;\n  } else {\n    state.filters = prevState?.filters ?? {};\n  }\n\n  if (filterSetsConfig) {\n    const filterSets = {};\n    filterSetsConfig.forEach(filtersSet => {\n      const { id } = filtersSet;\n      filterSets[id] = filtersSet;\n    });\n    state.filterSets = filterSets;\n  } else {\n    state.filterSets = prevState?.filterSets ?? {};\n  }\n  state.focusedFilterId = undefined;\n  return state as NativeFiltersState;\n}\n\nexport default function nativeFilterReducer(\n  state: NativeFiltersState = {\n    filters: {},\n    filterSets: {},\n  },\n  action: AnyFilterAction,\n) {\n  switch (action.type) {\n    case HYDRATE_DASHBOARD:\n      return {\n        filters: action.data.nativeFilters.filters,\n        filterSets: action.data.nativeFilters.filterSets,\n      };\n\n    case SET_FILTER_CONFIG_COMPLETE:\n    case SET_IN_SCOPE_STATUS_OF_FILTERS:\n      return getInitialState({ filterConfig: action.filterConfig, state });\n\n    case SET_FILTER_SETS_COMPLETE:\n      return getInitialState({\n        filterSetsConfig: action.filterSets,\n        state,\n      });\n\n    case SET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: action.id,\n      };\n\n    case UNSET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: undefined,\n      };\n\n    case SET_HOVERED_NATIVE_FILTER:\n      return {\n        ...state,\n        hoveredFilterId: action.id,\n      };\n\n    case UNSET_HOVERED_NATIVE_FILTER:\n      return {\n        ...state,\n        hoveredFilterId: undefined,\n      };\n    // TODO handle SET_FILTER_CONFIG_FAIL action\n    default:\n      return state;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ChartProps,\n  DataMaskStateWithId,\n  ExtraFormData,\n  GenericDataType,\n  JsonObject,\n  NativeFiltersState,\n} from '@superset-ui/core';\nimport { Dataset } from '@superset-ui/chart-controls';\nimport { chart } from 'src/components/Chart/chartReducer';\nimport componentTypes from 'src/dashboard/util/componentTypes';\nimport { UrlParamEntries } from 'src/utils/urlUtils';\n\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { ChartState } from '../explore/types';\n\nexport { Dashboard } from 'src/types/Dashboard';\n\nexport type ChartReducerInitialState = typeof chart;\n\n// chart query built from initialState\n// Ref: https://github.com/apache/superset/blob/dcac860f3e5528ecbc39e58f045c7388adb5c3d0/superset-frontend/src/dashboard/reducers/getInitialState.js#L120\nexport interface ChartQueryPayload extends Partial<ChartReducerInitialState> {\n  id: number;\n  form_data?: ChartProps['rawFormData'];\n  [key: string]: unknown;\n}\n\n/** Chart state of redux */\nexport type Chart = ChartState & {\n  form_data: {\n    viz_type: string;\n    datasource: string;\n  };\n};\n\nexport enum FilterBarOrientation {\n  VERTICAL = 'VERTICAL',\n  HORIZONTAL = 'HORIZONTAL',\n}\n\nexport type ActiveTabs = string[];\nexport type DashboardLayout = { [key: string]: LayoutItem };\nexport type DashboardLayoutState = { present: DashboardLayout };\nexport type DashboardState = {\n  preselectNativeFilters?: JsonObject;\n  editMode: boolean;\n  isPublished: boolean;\n  directPathToChild: string[];\n  activeTabs: ActiveTabs;\n  fullSizeChartId: number | null;\n  isRefreshing: boolean;\n  isFiltersRefreshing: boolean;\n  hasUnsavedChanges: boolean;\n  dashboardIsSaving: boolean;\n  colorScheme: string;\n  sliceIds: number[];\n  directPathLastUpdated: number;\n  focusedFilterField?: {\n    chartId: number;\n    column: string;\n  };\n  overwriteConfirmMetadata?: {\n    updatedAt: string;\n    updatedBy: string;\n    overwriteConfirmItems: {\n      keyPath: string;\n      oldValue: string;\n      newValue: string;\n    }[];\n    dashboardId: number;\n    data: JsonObject;\n  };\n};\nexport type DashboardInfo = {\n  id: number;\n  common: {\n    flash_messages: string[];\n    conf: JsonObject;\n  };\n  userId: string;\n  dash_edit_perm: boolean;\n  json_metadata: string;\n  metadata: {\n    native_filter_configuration: JsonObject;\n    show_native_filters: boolean;\n    chart_configuration: JsonObject;\n    color_scheme: string;\n    color_namespace: string;\n    color_scheme_domain: string[];\n    label_colors: JsonObject;\n    shared_label_colors: JsonObject;\n    cross_filters_enabled: boolean;\n  };\n  crossFiltersEnabled: boolean;\n  filterBarOrientation: FilterBarOrientation;\n};\n\nexport type ChartsState = { [key: string]: Chart };\n\nexport type Datasource = Dataset & {\n  uid: string;\n  column_types: GenericDataType[];\n  table_name: string;\n};\nexport type DatasourcesState = {\n  [key: string]: Datasource;\n};\n\n/** Root state of redux */\nexport type RootState = {\n  datasources: DatasourcesState;\n  sliceEntities: JsonObject;\n  charts: ChartsState;\n  dashboardLayout: DashboardLayoutState;\n  dashboardFilters: {};\n  dashboardState: DashboardState;\n  dashboardInfo: DashboardInfo;\n  dataMask: DataMaskStateWithId;\n  impressionId: string;\n  nativeFilters: NativeFiltersState;\n  user: UserWithPermissionsAndRoles;\n};\n\n/** State of dashboardLayout in redux */\nexport type Layout = { [key: string]: LayoutItem };\n\n/** State of charts in redux */\nexport type Charts = { [key: number]: Chart };\n\ntype ComponentTypesKeys = keyof typeof componentTypes;\nexport type ComponentType = typeof componentTypes[ComponentTypesKeys];\n\n/** State of dashboardLayout item in redux */\nexport type LayoutItem = {\n  children: string[];\n  parents: string[];\n  type: ComponentType;\n  id: string;\n  meta: {\n    chartId: number;\n    defaultText?: string;\n    height: number;\n    placeholder?: string;\n    sliceName?: string;\n    sliceNameOverride?: string;\n    text?: string;\n    uuid: string;\n    width: number;\n  };\n};\n\ntype ActiveFilter = {\n  scope: number[];\n  values: ExtraFormData;\n};\n\nexport type ActiveFilters = {\n  [key: string]: ActiveFilter;\n};\n\nexport interface DashboardPermalinkState {\n  dataMask: DataMaskStateWithId;\n  activeTabs: string[];\n  anchor: string;\n  urlParams?: UrlParamEntries;\n}\n\nexport interface DashboardPermalinkValue {\n  dashboardId: string;\n  state: DashboardPermalinkState;\n}\n\nexport type EmbeddedDashboard = {\n  uuid: string;\n  dashboard_id: string;\n  allowed_domains: string[];\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const CHART_TYPE = 'CHART';\nexport const COLUMN_TYPE = 'COLUMN';\nexport const DASHBOARD_HEADER_TYPE = 'HEADER';\nexport const DASHBOARD_GRID_TYPE = 'GRID';\nexport const DASHBOARD_ROOT_TYPE = 'ROOT';\nexport const DIVIDER_TYPE = 'DIVIDER';\nexport const HEADER_TYPE = 'HEADER';\nexport const MARKDOWN_TYPE = 'MARKDOWN';\nexport const NEW_COMPONENT_SOURCE_TYPE = 'NEW_COMPONENT_SOURCE';\nexport const ROW_TYPE = 'ROW';\nexport const TABS_TYPE = 'TABS';\nexport const TAB_TYPE = 'TAB';\n// Dynamic type proposes lazy loading of custom dashboard components that can be added in separate repository\nexport const DYNAMIC_TYPE = 'DYNAMIC';\n\nexport default {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DASHBOARD_HEADER_TYPE,\n  DASHBOARD_GRID_TYPE,\n  DASHBOARD_ROOT_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  NEW_COMPONENT_SOURCE_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { FeatureFlag, isFeatureEnabled } from '@superset-ui/core';\n\nexport const isCrossFiltersEnabled = (\n  metadataCrossFiltersEnabled: boolean | undefined,\n): boolean =>\n  isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n  (metadataCrossFiltersEnabled === undefined || metadataCrossFiltersEnabled);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport querystring from 'query-string';\nimport { JsonObject } from '@superset-ui/core';\n\nconst reservedQueryParams = new Set(['standalone', 'edit']);\n\nexport type UrlParamType = 'reserved' | 'regular' | 'all';\n\n/**\n * Returns the url params that are used to customize queries\n */\nexport default function extractUrlParams(\n  urlParamType: UrlParamType,\n): JsonObject {\n  const queryParams = querystring.parse(window.location.search);\n  return Object.entries(queryParams).reduce((acc, [key, value]) => {\n    if (\n      (urlParamType === 'regular' && reservedQueryParams.has(key)) ||\n      (urlParamType === 'reserved' && !reservedQueryParams.has(key))\n    )\n      return acc;\n    // if multiple url params share the same key (?foo=bar&foo=baz), they will appear as an array.\n    // Only one value can be used for a given query param, so we just take the first one.\n    if (Array.isArray(value)) {\n      return {\n        ...acc,\n        [key]: value[0],\n      };\n    }\n    return { ...acc, [key]: value };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ninterface ILayoutItem {\n  [key: string]: {\n    id: string;\n    children: string[];\n  };\n}\n\ninterface IStructure {\n  childId: string;\n  layout: ILayoutItem;\n}\n\nfunction findParentId(structure: IStructure): string | null {\n  let parentId = null;\n  if (structure) {\n    const { childId, layout = {} } = structure;\n    // default assignment to layout only works if value is undefined, not null\n    if (layout) {\n      const ids = Object.keys(layout);\n      for (let i = 0; i <= ids.length - 1; i += 1) {\n        const id = ids[i];\n        const component = layout[id] || {};\n        if (id !== childId && component?.children?.includes?.(childId)) {\n          parentId = id;\n          break;\n        }\n      }\n    }\n  }\n  return parentId;\n}\n\nconst cache = {};\nexport default function findParentIdWithCache(\n  structure: IStructure,\n): string | null {\n  let parentId = null;\n  if (structure) {\n    const { childId, layout = {} } = structure;\n    if (cache[childId]) {\n      const lastParent = layout?.[cache[childId]] || {};\n      if (lastParent?.children && lastParent?.children?.includes?.(childId)) {\n        return lastParent.id;\n      }\n    }\n    parentId = findParentId({ childId, layout });\n    cache[childId] = parentId;\n  }\n  return parentId;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { NativeFilterScope } from '@superset-ui/core';\nimport { CHART_TYPE } from './componentTypes';\nimport { ChartsState, Layout } from '../types';\n\nexport function getChartIdsInFilterScope(\n  filterScope: NativeFilterScope,\n  charts: ChartsState,\n  layout: Layout,\n) {\n  const layoutItems = Object.values(layout);\n  return Object.values(charts)\n    .filter(\n      chart =>\n        !filterScope.excluded.includes(chart.id) &&\n        layoutItems\n          .find(\n            layoutItem =>\n              layoutItem?.type === CHART_TYPE &&\n              layoutItem.meta?.chartId === chart.id,\n          )\n          ?.parents?.some(elementId =>\n            filterScope.rootPath.includes(elementId),\n          ),\n    )\n    .map(chart => chart.id);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\ninterface GetDashboardFilterKeyProps {\n  chartId: string;\n  column: string;\n}\n\nexport function getDashboardFilterKey({\n  chartId,\n  column,\n}: GetDashboardFilterKeyProps) {\n  return `${chartId}_${column}`;\n}\n\nconst filterKeySplitter = /^([0-9]+)_(.*)$/;\n\nexport function getChartIdAndColumnFromFilterKey(key: string) {\n  const match = filterKeySplitter.exec(key);\n  if (!match) throw new Error('Cannot parse invalid filter key');\n  return { chartId: parseInt(match[1], 10), column: match[2] };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function getLocationHash() {\n  return (window.location.hash || '#').substring(1);\n}\n","import {\n  ColorSchemeConfig,\n  FeatureFlagMap,\n  JsonObject,\n  LanguagePack,\n  Locale,\n  SequentialSchemeConfig,\n} from '@superset-ui/core';\nimport { isPlainObject } from 'lodash';\nimport { FlashMessage } from '../components/FlashProvider';\nimport { Languages } from '../views/components/LanguagePicker';\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type User = {\n  createdOn?: string;\n  email?: string;\n  firstName: string;\n  isActive: boolean;\n  isAnonymous: boolean;\n  lastName: string;\n  userId?: number; // optional because guest user doesn't have a user id\n  username: string;\n};\n\nexport type UserRoles = Record<string, [string, string][]>;\nexport interface PermissionsAndRoles {\n  permissions: {\n    database_access?: string[];\n    datasource_access?: string[];\n  };\n  roles: UserRoles;\n}\n\nexport type UserWithPermissionsAndRoles = User & PermissionsAndRoles;\n\nexport type UndefinedUser = {};\n\nexport type BootstrapUser = UserWithPermissionsAndRoles | undefined;\n\nexport type Dashboard = {\n  dttm: number;\n  id: number;\n  url: string;\n  title: string;\n  creator?: string;\n  creator_url?: string;\n};\n\nexport type DashboardData = {\n  dashboard_title?: string;\n  created_on_delta_humanized?: string;\n  url: string;\n};\n\nexport type DashboardResponse = {\n  result: DashboardData[];\n};\n\nexport type ChartData = {\n  slice_name: string;\n  created_on_delta_humanized?: string;\n  url: string;\n};\n\nexport type ChartResponse = {\n  result: ChartData[];\n};\n\nexport interface BrandProps {\n  path: string;\n  icon: string;\n  alt: string;\n  tooltip: string;\n  text: string;\n}\n\nexport interface NavBarProps {\n  show_watermark: boolean;\n  bug_report_url?: string;\n  bug_report_text?: string;\n  bug_report_icon?: string;\n  version_string?: string;\n  version_sha?: string;\n  build_number?: string;\n  documentation_url?: string;\n  documentation_text?: string;\n  documentation_icon?: string;\n  languages: Languages;\n  show_language_picker: boolean;\n  user_is_anonymous: boolean;\n  user_info_url: string;\n  user_login_url: string;\n  user_logout_url: string;\n  user_profile_url: string | null;\n  locale: string;\n}\n\nexport interface MenuObjectChildProps {\n  label: string;\n  name?: string;\n  icon?: string;\n  index?: number;\n  url?: string;\n  isFrontendRoute?: boolean;\n  perm?: string | boolean;\n  view?: string;\n  disable?: boolean;\n}\n\nexport interface MenuObjectProps extends MenuObjectChildProps {\n  childs?: (MenuObjectChildProps | string)[];\n  isHeader?: boolean;\n}\n\nexport interface MenuData {\n  menu: MenuObjectProps[];\n  brand: BrandProps;\n  navbar_right: NavBarProps;\n  settings: MenuObjectProps[];\n  environment_tag: {\n    text: string;\n    color: string;\n  };\n}\n\nexport interface CommonBootstrapData {\n  flash_messages: FlashMessage[];\n  conf: JsonObject;\n  locale: Locale;\n  feature_flags: FeatureFlagMap;\n  language_pack: LanguagePack;\n  extra_categorical_color_schemes: ColorSchemeConfig[];\n  extra_sequential_color_schemes: SequentialSchemeConfig[];\n  theme_overrides: JsonObject;\n  menu_data: MenuData;\n}\n\nexport interface BootstrapData {\n  user?: BootstrapUser;\n  common: CommonBootstrapData;\n  config?: any;\n  embedded?: {\n    dashboard_id: string;\n  };\n}\n\nexport function isUser(user: any): user is User {\n  return isPlainObject(user) && 'username' in user;\n}\n\nexport function isUserWithPermissionsAndRoles(\n  user: any,\n): user is UserWithPermissionsAndRoles {\n  return isUser(user) && 'permissions' in user && 'roles' in user;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isUserWithPermissionsAndRoles,\n  UndefinedUser,\n  UserWithPermissionsAndRoles,\n} from 'src/types/bootstrapTypes';\nimport { Dashboard } from 'src/types/Dashboard';\nimport { findPermission } from 'src/utils/findPermission';\n\n// this should really be a config value,\n// but is hardcoded in backend logic already, so...\nconst ADMIN_ROLE_NAME = 'admin';\nconst SQL_LAB_ROLE = 'sql_lab';\n\nexport const isUserAdmin = (\n  user?: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  Object.keys(user.roles || {}).some(\n    role => role.toLowerCase() === ADMIN_ROLE_NAME,\n  );\n\nconst isUserDashboardOwner = (\n  dashboard: Dashboard,\n  user: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  dashboard.owners.some(owner => owner.id === user.userId);\n\nexport const canUserEditDashboard = (\n  dashboard: Dashboard,\n  user?: UserWithPermissionsAndRoles | UndefinedUser | null,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  (isUserAdmin(user) || isUserDashboardOwner(dashboard, user)) &&\n  findPermission('can_write', 'Dashboard', user.roles);\n\nexport function canUserAccessSqlLab(\n  user?: UserWithPermissionsAndRoles | UndefinedUser,\n) {\n  return (\n    isUserAdmin(user) ||\n    (isUserWithPermissionsAndRoles(user) &&\n      Object.keys(user.roles || {}).some(\n        role => role.toLowerCase() === SQL_LAB_ROLE,\n      ))\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DataMask, FilterConfiguration, Filters } from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from '../featureFlags';\nimport { getInitialDataMask } from './reducer';\n\nexport const CLEAR_DATA_MASK_STATE = 'CLEAR_DATA_MASK_STATE';\nexport interface ClearDataMaskState {\n  type: typeof CLEAR_DATA_MASK_STATE;\n}\n\nexport const UPDATE_DATA_MASK = 'UPDATE_DATA_MASK';\nexport interface UpdateDataMask {\n  type: typeof UPDATE_DATA_MASK;\n  filterId: string | number;\n  dataMask: DataMask;\n}\n\nexport const INIT_DATAMASK = 'INIT_DATAMASK';\nexport interface INITDATAMASK {\n  type: typeof INIT_DATAMASK;\n  dataMask: DataMask;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE';\n\nexport interface SetDataMaskForFilterConfigComplete {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n  filters?: Filters;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL';\n\nexport interface SetDataMaskForFilterConfigFail {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport function setDataMaskForFilterConfigComplete(\n  filterConfig: FilterConfiguration,\n  filters?: Filters,\n): SetDataMaskForFilterConfigComplete {\n  return {\n    type: SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n    filterConfig,\n    filters,\n  };\n}\nexport function updateDataMask(\n  filterId: string | number,\n  dataMask: DataMask,\n): UpdateDataMask {\n  // Only apply data mask if one of the relevant features is enabled\n  const isFeatureFlagActive =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) ||\n    isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS);\n  return {\n    type: UPDATE_DATA_MASK,\n    filterId,\n    dataMask: isFeatureFlagActive ? dataMask : {},\n  };\n}\n\nexport function clearDataMask(filterId: string | number) {\n  return updateDataMask(filterId, getInitialDataMask(filterId));\n}\n\nexport function clearDataMaskState(): ClearDataMaskState {\n  return {\n    type: CLEAR_DATA_MASK_STATE,\n  };\n}\n\nexport type AnyDataMaskAction =\n  | ClearDataMaskState\n  | UpdateDataMask\n  | SetDataMaskForFilterConfigFail\n  | SetDataMaskForFilterConfigComplete;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\n// <- When we work with Immer, we need reassign, so disabling lint\nimport produce from 'immer';\nimport {\n  DataMask,\n  DataMaskStateWithId,\n  DataMaskWithId,\n  FeatureFlag,\n  Filter,\n  FilterConfiguration,\n  Filters,\n} from '@superset-ui/core';\nimport { NATIVE_FILTER_PREFIX } from 'src/dashboard/components/nativeFilters/FiltersConfigModal/utils';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  AnyDataMaskAction,\n  CLEAR_DATA_MASK_STATE,\n  SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n  UPDATE_DATA_MASK,\n} from './actions';\nimport { areObjectsEqual } from '../reduxUtils';\n\nexport function getInitialDataMask(\n  id?: string | number,\n  moreProps?: DataMask,\n): DataMask;\nexport function getInitialDataMask(\n  id: string | number,\n  moreProps: DataMask = {},\n): DataMaskWithId {\n  let otherProps = {};\n  if (id) {\n    otherProps = {\n      id,\n    };\n  }\n  return {\n    ...otherProps,\n    extraFormData: {},\n    filterState: {},\n    ownState: {},\n    ...moreProps,\n  } as DataMaskWithId;\n}\n\nfunction fillNativeFilters(\n  filterConfig: FilterConfiguration,\n  mergedDataMask: DataMaskStateWithId,\n  draftDataMask: DataMaskStateWithId,\n  initialDataMask?: DataMaskStateWithId,\n  currentFilters?: Filters,\n) {\n  filterConfig.forEach((filter: Filter) => {\n    const dataMask = initialDataMask || {};\n    mergedDataMask[filter.id] = {\n      ...getInitialDataMask(filter.id), // take initial data\n      ...filter.defaultDataMask, // if something new came from BE - take it\n      ...dataMask[filter.id],\n    };\n    if (\n      currentFilters &&\n      !areObjectsEqual(\n        filter.defaultDataMask,\n        currentFilters[filter.id]?.defaultDataMask,\n        { ignoreUndefined: true },\n      )\n    ) {\n      mergedDataMask[filter.id] = {\n        ...mergedDataMask[filter.id],\n        ...filter.defaultDataMask,\n      };\n    }\n  });\n\n  // Get back all other non-native filters\n  Object.values(draftDataMask).forEach(filter => {\n    if (!String(filter?.id).startsWith(NATIVE_FILTER_PREFIX)) {\n      mergedDataMask[filter?.id] = filter;\n    }\n  });\n}\n\nconst dataMaskReducer = produce(\n  (draft: DataMaskStateWithId, action: AnyDataMaskAction) => {\n    const cleanState = {};\n    switch (action.type) {\n      case CLEAR_DATA_MASK_STATE:\n        return cleanState;\n      case UPDATE_DATA_MASK:\n        draft[action.filterId] = {\n          ...getInitialDataMask(action.filterId),\n          ...draft[action.filterId],\n          ...action.dataMask,\n        };\n        return draft;\n      // TODO: update hydrate to .ts\n      // @ts-ignore\n      case HYDRATE_DASHBOARD:\n        if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n          Object.keys(\n            // @ts-ignore\n            action.data.dashboardInfo?.metadata?.chart_configuration,\n          ).forEach(id => {\n            cleanState[id] = {\n              ...getInitialDataMask(id), // take initial data\n            };\n          });\n        }\n        fillNativeFilters(\n          // @ts-ignore\n          action.data.dashboardInfo?.metadata?.native_filter_configuration ??\n            [],\n          cleanState,\n          draft,\n          // @ts-ignore\n          action.data.dataMask,\n        );\n        return cleanState;\n      case SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:\n        fillNativeFilters(\n          action.filterConfig ?? [],\n          cleanState,\n          draft,\n          action.filters,\n        );\n        return cleanState;\n\n      default:\n        return draft;\n    }\n  },\n  {},\n);\n\nexport default dataMaskReducer;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ControlStateMapping } from '@superset-ui/chart-controls';\n\nimport {\n  ChartState,\n  ExplorePageInitialData,\n  ExplorePageState,\n} from 'src/explore/types';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { getControlsState } from 'src/explore/store';\nimport { Dispatch } from 'redux';\nimport {\n  ensureIsArray,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  NO_TIME_RANGE,\n} from '@superset-ui/core';\nimport {\n  getFormDataFromControls,\n  applyMapStateToPropsToControl,\n} from 'src/explore/controlUtils';\nimport { getDatasourceUid } from 'src/utils/getDatasourceUid';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { findPermission } from 'src/utils/findPermission';\n\nenum ColorSchemeType {\n  CATEGORICAL = 'CATEGORICAL',\n  SEQUENTIAL = 'SEQUENTIAL',\n}\n\nexport const HYDRATE_EXPLORE = 'HYDRATE_EXPLORE';\nexport const hydrateExplore =\n  ({\n    form_data,\n    slice,\n    dataset,\n    metadata,\n    saveAction = null,\n  }: ExplorePageInitialData) =>\n  (dispatch: Dispatch, getState: () => ExplorePageState) => {\n    const { user, datasources, charts, sliceEntities, common, explore } =\n      getState();\n\n    const sliceId = getUrlParam(URL_PARAMS.sliceId);\n    const dashboardId = getUrlParam(URL_PARAMS.dashboardId);\n    const fallbackSlice = sliceId ? sliceEntities?.slices?.[sliceId] : null;\n    const initialSlice = slice ?? fallbackSlice;\n    const initialFormData = form_data ?? initialSlice?.form_data;\n    if (!initialFormData.viz_type) {\n      const defaultVizType = common?.conf.DEFAULT_VIZ_TYPE || 'table';\n      initialFormData.viz_type =\n        getUrlParam(URL_PARAMS.vizType) || defaultVizType;\n    }\n    if (!initialFormData.time_range) {\n      initialFormData.time_range =\n        common?.conf?.DEFAULT_TIME_FILTER || NO_TIME_RANGE;\n    }\n    if (dashboardId) {\n      initialFormData.dashboardId = dashboardId;\n    }\n    const initialDatasource = dataset;\n\n    const initialExploreState = {\n      form_data: initialFormData,\n      slice: initialSlice,\n      datasource: initialDatasource,\n    };\n    const initialControls = getControlsState(\n      initialExploreState,\n      initialFormData,\n    ) as ControlStateMapping;\n    const colorSchemeKey = initialControls.color_scheme && 'color_scheme';\n    const linearColorSchemeKey =\n      initialControls.linear_color_scheme && 'linear_color_scheme';\n    // if the selected color scheme does not exist anymore\n    // fallbacks and selects the available default one\n    const verifyColorScheme = (type: ColorSchemeType) => {\n      const schemes =\n        type === 'CATEGORICAL'\n          ? getCategoricalSchemeRegistry()\n          : getSequentialSchemeRegistry();\n      const key =\n        type === 'CATEGORICAL' ? colorSchemeKey : linearColorSchemeKey;\n      const registryDefaultScheme = schemes.defaultKey;\n      const defaultScheme =\n        type === 'CATEGORICAL' ? 'supersetColors' : 'superset_seq_1';\n      const currentScheme = initialFormData[key];\n      const colorSchemeExists = !!schemes.get(currentScheme, true);\n\n      if (currentScheme && !colorSchemeExists) {\n        initialControls[key].value = registryDefaultScheme || defaultScheme;\n      }\n    };\n\n    if (colorSchemeKey) verifyColorScheme(ColorSchemeType.CATEGORICAL);\n    if (linearColorSchemeKey) verifyColorScheme(ColorSchemeType.SEQUENTIAL);\n\n    const exploreState = {\n      // note this will add `form_data` to state,\n      // which will be manipulable by future reducers.\n      can_add: findPermission('can_write', 'Chart', user?.roles),\n      can_download: findPermission('can_csv', 'Superset', user?.roles),\n      can_overwrite: ensureIsArray(slice?.owners).includes(\n        user?.userId as number,\n      ),\n      isDatasourceMetaLoading: false,\n      isStarred: false,\n      triggerRender: false,\n      // duplicate datasource in exploreState - it's needed by getControlsState\n      datasource: initialDatasource,\n      // Initial control state will skip `control.mapStateToProps`\n      // because `bootstrapData.controls` is undefined.\n      controls: initialControls,\n      form_data: initialFormData,\n      slice: initialSlice,\n      controlsTransferred: explore.controlsTransferred,\n      standalone: getUrlParam(URL_PARAMS.standalone),\n      force: getUrlParam(URL_PARAMS.force),\n      metadata,\n      saveAction,\n      common,\n    };\n\n    // apply initial mapStateToProps for all controls, must execute AFTER\n    // bootstrapState has initialized `controls`. Order of execution is not\n    // guaranteed, so controls shouldn't rely on each other's mapped state.\n    Object.entries(exploreState.controls).forEach(([key, controlState]) => {\n      exploreState.controls[key] = applyMapStateToPropsToControl(\n        controlState,\n        exploreState,\n      );\n    });\n    const sliceFormData = initialSlice\n      ? getFormDataFromControls(initialControls)\n      : null;\n\n    const chartKey: number = getChartKey(initialExploreState);\n    const chart: ChartState = {\n      id: chartKey,\n      chartAlert: null,\n      chartStatus: null,\n      chartStackTrace: null,\n      chartUpdateEndTime: null,\n      chartUpdateStartTime: 0,\n      latestQueryFormData: getFormDataFromControls(exploreState.controls),\n      sliceFormData,\n      queryController: null,\n      queriesResponse: null,\n      triggerQuery: false,\n      lastRendered: 0,\n    };\n\n    return dispatch({\n      type: HYDRATE_EXPLORE,\n      data: {\n        charts: {\n          ...charts,\n          [chartKey]: chart,\n        },\n        datasources: {\n          ...datasources,\n          [getDatasourceUid(initialDatasource)]: initialDatasource,\n        },\n        saveModal: {\n          dashboards: [],\n          saveModalAlert: null,\n          isVisible: false,\n        },\n        explore: exploreState,\n      },\n    });\n  };\n\nexport type HydrateExplore = {\n  type: typeof HYDRATE_EXPLORE;\n  data: ExplorePageState;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { List, ListItemProps } from 'src/components';\n\nexport interface CustomListItemProps extends ListItemProps {\n  selectable: boolean;\n}\n\nexport default function CustomListItem(props: CustomListItemProps) {\n  const { selectable, children, ...rest } = props;\n  const theme = useTheme();\n  const css = {\n    '&.ant-list-item': {\n      padding: `${theme.gridUnit + 2}px ${theme.gridUnit * 3}px`,\n      ':first-of-type': {\n        borderTopLeftRadius: theme.gridUnit,\n        borderTopRightRadius: theme.gridUnit,\n      },\n      ':last-of-type': {\n        borderBottomLeftRadius: theme.gridUnit,\n        borderBottomRightRadius: theme.gridUnit,\n      },\n    },\n  };\n\n  if (selectable) {\n    css['&:hover'] = {\n      cursor: 'pointer',\n      backgroundColor: theme.colors.grayscale.light4,\n    };\n  }\n\n  return (\n    <List.Item {...rest} css={css}>\n      {children}\n    </List.Item>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport { connect } from 'react-redux';\nimport { t, withTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { runAnnotationQuery } from 'src/components/Chart/chartAction';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport ControlPopover, {\n  getSectionContainerElement,\n} from '../ControlPopover/ControlPopover';\n\nconst AnnotationLayer = AsyncEsmComponent(\n  () => import('./AnnotationLayer'),\n  // size of overlay inner content\n  () => <div style={{ width: 450, height: 368 }} />,\n);\n\nconst propTypes = {\n  colorScheme: PropTypes.string.isRequired,\n  annotationError: PropTypes.object,\n  annotationQuery: PropTypes.object,\n  vizType: PropTypes.string,\n\n  validationErrors: PropTypes.array,\n  name: PropTypes.string.isRequired,\n  actions: PropTypes.object,\n  value: PropTypes.arrayOf(PropTypes.object),\n  onChange: PropTypes.func,\n  refreshAnnotationData: PropTypes.func,\n};\n\nconst defaultProps = {\n  vizType: '',\n  value: [],\n  annotationError: {},\n  annotationQuery: {},\n  onChange: () => {},\n};\n\nclass AnnotationLayerControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popoverVisible: {},\n      addedAnnotationIndex: null,\n    };\n    this.addAnnotationLayer = this.addAnnotationLayer.bind(this);\n    this.removeAnnotationLayer = this.removeAnnotationLayer.bind(this);\n    this.handleVisibleChange = this.handleVisibleChange.bind(this);\n  }\n\n  componentDidMount() {\n    // preload the AnnotationLayer component and dependent libraries i.e. mathjs\n    AnnotationLayer.preload();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const { name, annotationError, validationErrors, value } = nextProps;\n    if (Object.keys(annotationError).length && !validationErrors.length) {\n      this.props.actions.setControlValue(\n        name,\n        value,\n        Object.keys(annotationError),\n      );\n    }\n    if (!Object.keys(annotationError).length && validationErrors.length) {\n      this.props.actions.setControlValue(name, value, []);\n    }\n  }\n\n  addAnnotationLayer(originalAnnotation, newAnnotation) {\n    let annotations = this.props.value;\n    if (annotations.includes(originalAnnotation)) {\n      annotations = annotations.map(anno =>\n        anno === originalAnnotation ? newAnnotation : anno,\n      );\n    } else {\n      annotations = [...annotations, newAnnotation];\n      this.setState({ addedAnnotationIndex: annotations.length - 1 });\n    }\n\n    this.props.refreshAnnotationData({\n      annotation: newAnnotation,\n      force: true,\n    });\n\n    this.props.onChange(annotations);\n  }\n\n  handleVisibleChange(visible, popoverKey) {\n    this.setState(prevState => ({\n      popoverVisible: { ...prevState.popoverVisible, [popoverKey]: visible },\n    }));\n  }\n\n  removeAnnotationLayer(annotation) {\n    const annotations = this.props.value.filter(anno => anno !== annotation);\n    // So scrollbar doesnt get stuck on hidden\n    const element = getSectionContainerElement();\n    if (element) {\n      element.style.setProperty('overflow-y', 'auto', 'important');\n    }\n    this.props.onChange(annotations);\n  }\n\n  renderPopover(popoverKey, annotation, error) {\n    const id = annotation?.name || '_new';\n\n    return (\n      <div id={`annotation-pop-${id}`} data-test=\"popover-content\">\n        <AnnotationLayer\n          {...annotation}\n          error={error}\n          colorScheme={this.props.colorScheme}\n          vizType={this.props.vizType}\n          addAnnotationLayer={newAnnotation =>\n            this.addAnnotationLayer(annotation, newAnnotation)\n          }\n          removeAnnotationLayer={() => this.removeAnnotationLayer(annotation)}\n          close={() => {\n            this.handleVisibleChange(false, popoverKey);\n            this.setState({ addedAnnotationIndex: null });\n          }}\n        />\n      </div>\n    );\n  }\n\n  renderInfo(anno) {\n    const { annotationError, annotationQuery, theme } = this.props;\n    if (annotationQuery[anno.name]) {\n      return (\n        <i\n          className=\"fa fa-refresh\"\n          style={{ color: theme.colors.primary.base }}\n          aria-hidden\n        />\n      );\n    }\n    if (annotationError[anno.name]) {\n      return (\n        <InfoTooltipWithTrigger\n          label=\"validation-errors\"\n          bsStyle=\"danger\"\n          tooltip={annotationError[anno.name]}\n        />\n      );\n    }\n    if (!anno.show) {\n      return <span style={{ color: theme.colors.error.base }}> Hidden </span>;\n    }\n    return '';\n  }\n\n  render() {\n    const { addedAnnotationIndex } = this.state;\n    const addedAnnotation = this.props.value[addedAnnotationIndex];\n\n    const annotations = this.props.value.map((anno, i) => (\n      <ControlPopover\n        key={i}\n        trigger=\"click\"\n        title={t('Edit annotation layer')}\n        css={theme => ({\n          '&:hover': {\n            cursor: 'pointer',\n            backgroundColor: theme.colors.grayscale.light4,\n          },\n        })}\n        content={this.renderPopover(\n          i,\n          anno,\n          this.props.annotationError[anno.name],\n        )}\n        visible={this.state.popoverVisible[i]}\n        onVisibleChange={visible => this.handleVisibleChange(visible, i)}\n      >\n        <CustomListItem selectable>\n          <span>{anno.name}</span>\n          <span style={{ float: 'right' }}>{this.renderInfo(anno)}</span>\n        </CustomListItem>\n      </ControlPopover>\n    ));\n\n    const addLayerPopoverKey = 'add';\n    return (\n      <div>\n        <List bordered css={theme => ({ borderRadius: theme.gridUnit })}>\n          {annotations}\n          <ControlPopover\n            trigger=\"click\"\n            content={this.renderPopover(addLayerPopoverKey, addedAnnotation)}\n            title={t('Add annotation layer')}\n            visible={this.state.popoverVisible[addLayerPopoverKey]}\n            destroyTooltipOnHide\n            onVisibleChange={visible =>\n              this.handleVisibleChange(visible, addLayerPopoverKey)\n            }\n          >\n            <CustomListItem selectable>\n              <i\n                data-test=\"add-annotation-layer-button\"\n                className=\"fa fa-plus\"\n              />{' '}\n              &nbsp; {t('Add annotation layer')}\n            </CustomListItem>\n          </ControlPopover>\n        </List>\n      </div>\n    );\n  }\n}\n\nAnnotationLayerControl.propTypes = propTypes;\nAnnotationLayerControl.defaultProps = defaultProps;\n\n// Tried to hook this up through stores/control.jsx instead of using redux\n// directly, could not figure out how to get access to the color_scheme\nfunction mapStateToProps({ charts, explore }) {\n  const chartKey = getChartKey(explore);\n  const chart = charts[chartKey] || charts[0] || {};\n\n  return {\n    // eslint-disable-next-line camelcase\n    colorScheme: explore.controls?.color_scheme?.value,\n    annotationError: chart.annotationError,\n    annotationQuery: chart.annotationQuery,\n    vizType: explore.controls.viz_type.value,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    refreshAnnotationData: annotationObj =>\n      dispatch(runAnnotationQuery(annotationObj)),\n  };\n}\n\nconst themedAnnotationLayerControl = withTheme(AnnotationLayerControl);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(themedAnnotationLayerControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { InputNumber } from 'src/components/Input';\nimport { t, styled } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ntype ValueType = (number | null)[];\n\nexport type BoundsControlProps = {\n  onChange?: (value: ValueType) => void;\n  value?: ValueType;\n};\n\nconst StyledDiv = styled.div`\n  display: flex;\n`;\n\nconst MinInput = styled(InputNumber)`\n  flex: 1;\n  margin-right: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst MaxInput = styled(InputNumber)`\n  flex: 1;\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst parseNumber = (value: undefined | number | string | null) =>\n  value === null || Number.isNaN(Number(value)) ? null : Number(value);\n\nexport default function BoundsControl({\n  onChange = () => {},\n  value = [null, null],\n  ...props\n}: BoundsControlProps) {\n  const [minMax, setMinMax] = useState<ValueType>([\n    parseNumber(value[0]),\n    parseNumber(value[1]),\n  ]);\n  const min = value[0];\n  const max = value[1];\n  const debouncedOnChange = useRef(debounce(onChange, 300)).current;\n\n  const update = (mm: ValueType) => {\n    setMinMax(mm);\n    debouncedOnChange([\n      mm[0] === undefined ? null : mm[0],\n      mm[1] === undefined ? null : mm[1],\n    ]);\n  };\n\n  useEffect(() => {\n    setMinMax([parseNumber(min), parseNumber(max)]);\n  }, [min, max]);\n\n  const onMinChange = (value: number | string | undefined) => {\n    update([parseNumber(value), minMax[1]]);\n  };\n\n  const onMaxChange = (value: number | string | undefined) => {\n    update([minMax[0], parseNumber(value)]);\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <StyledDiv>\n        <MinInput\n          data-test=\"min-bound\"\n          placeholder={t('Min')}\n          // emit (string | number | undefined)\n          onChange={onMinChange}\n          // accept (number | undefined)\n          value={minMax[0] === null ? undefined : minMax[0]}\n        />\n        <MaxInput\n          data-test=\"max-bound\"\n          placeholder={t('Max')}\n          // emit (number | string | undefined)\n          onChange={onMaxChange}\n          // accept (number | undefined)\n          value={minMax[1] === null ? undefined : minMax[1]}\n        />\n      </StyledDiv>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport shortid from 'shortid';\nimport { t, withTheme } from '@superset-ui/core';\nimport {\n  SortableContainer,\n  SortableHandle,\n  SortableElement,\n  arrayMove,\n} from 'react-sortable-hoc';\nimport Icons from 'src/components/Icons';\nimport {\n  HeaderContainer,\n  AddIconButton,\n} from 'src/explore/components/controls/OptionControls';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport controlMap from '..';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  placeholder: PropTypes.string,\n  addTooltip: PropTypes.string,\n  itemGenerator: PropTypes.func,\n  keyAccessor: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.array]),\n  isFloat: PropTypes.bool,\n  isInt: PropTypes.bool,\n  controlName: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  label: null,\n  description: null,\n  onChange: () => {},\n  placeholder: t('Empty collection'),\n  itemGenerator: () => ({ key: shortid.generate() }),\n  keyAccessor: o => o.key,\n  value: [],\n  addTooltip: t('Add an item'),\n};\nconst SortableListItem = SortableElement(CustomListItem);\nconst SortableList = SortableContainer(List);\nconst SortableDragger = SortableHandle(() => (\n  <i\n    role=\"img\"\n    aria-label=\"drag\"\n    className=\"fa fa-bars text-primary\"\n    style={{ cursor: 'ns-resize' }}\n  />\n));\n\nclass CollectionControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onAdd = this.onAdd.bind(this);\n  }\n\n  onChange(i, value) {\n    const newValue = [...this.props.value];\n    newValue[i] = { ...this.props.value[i], ...value };\n    this.props.onChange(newValue);\n  }\n\n  onAdd() {\n    this.props.onChange(this.props.value.concat([this.props.itemGenerator()]));\n  }\n\n  onSortEnd({ oldIndex, newIndex }) {\n    this.props.onChange(arrayMove(this.props.value, oldIndex, newIndex));\n  }\n\n  removeItem(i) {\n    this.props.onChange(this.props.value.filter((o, ix) => i !== ix));\n  }\n\n  renderList() {\n    if (this.props.value.length === 0) {\n      return <div className=\"text-muted\">{this.props.placeholder}</div>;\n    }\n    const Control = controlMap[this.props.controlName];\n    return (\n      <SortableList\n        useDragHandle\n        lockAxis=\"y\"\n        onSortEnd={this.onSortEnd.bind(this)}\n        bordered\n        css={theme => ({\n          borderRadius: theme.gridUnit,\n        })}\n      >\n        {this.props.value.map((o, i) => {\n          // label relevant only for header, not here\n          const { label, ...commonProps } = this.props;\n          return (\n            <SortableListItem\n              className=\"clearfix\"\n              css={{ justifyContent: 'flex-start' }}\n              key={this.props.keyAccessor(o)}\n              index={i}\n            >\n              <SortableDragger />\n              <div\n                css={theme => ({\n                  flex: 1,\n                  marginLeft: theme.gridUnit * 2,\n                  marginRight: theme.gridUnit * 2,\n                })}\n              >\n                <Control\n                  {...commonProps}\n                  {...o}\n                  onChange={this.onChange.bind(this, i)}\n                />\n              </div>\n              <InfoTooltipWithTrigger\n                icon=\"times\"\n                label=\"remove-item\"\n                tooltip={t('Remove item')}\n                bsStyle=\"primary\"\n                onClick={this.removeItem.bind(this, i)}\n              />\n            </SortableListItem>\n          );\n        })}\n      </SortableList>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div data-test=\"CollectionControl\" className=\"CollectionControl\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          <AddIconButton onClick={this.onAdd}>\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>\n        </HeaderContainer>\n        {this.renderList()}\n      </div>\n    );\n  }\n}\n\nCollectionControl.propTypes = propTypes;\nCollectionControl.defaultProps = defaultProps;\n\nexport default withTheme(CollectionControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SketchPicker } from 'react-color';\nimport { getCategoricalSchemeRegistry, styled } from '@superset-ui/core';\nimport Popover from 'src/components/Popover';\nimport ControlHeader from '../ControlHeader';\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n};\n\nconst swatchCommon = {\n  position: 'absolute',\n  width: '50px',\n  height: '20px',\n  top: '0px',\n  left: '0px',\n  right: '0px',\n  bottom: '0px',\n};\n\nconst StyledSwatch = styled.div`\n  ${({ theme }) => `\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${theme.gridUnit}px;\n      borderRadius: ${theme.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}\n`;\n\nconst styles = {\n  color: {\n    ...swatchCommon,\n    borderRadius: '2px',\n  },\n  checkerboard: {\n    ...swatchCommon,\n    background:\n      'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==\") left center',\n  },\n};\nexport default class ColorPickerControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(col) {\n    this.props.onChange(col.rgb);\n  }\n\n  renderPopover() {\n    const presetColors = getCategoricalSchemeRegistry()\n      .get()\n      .colors.filter((s, i) => i < 7);\n    return (\n      <div id=\"filter-popover\" className=\"color-popover\">\n        <SketchPicker\n          color={this.props.value}\n          onChange={this.onChange}\n          presetColors={presetColors}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const c = this.props.value || { r: 0, g: 0, b: 0, a: 0 };\n    const colStyle = {\n      ...styles.color,\n      background: `rgba(${c.r}, ${c.g}, ${c.b}, ${c.a})`,\n    };\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n        >\n          <StyledSwatch>\n            <div style={styles.checkerboard} />\n            <div style={colStyle} />\n          </StyledSwatch>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nColorPickerControl.propTypes = propTypes;\nColorPickerControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { isObject } from 'lodash';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport Button from 'src/components/Button';\n\ninterface SimpleDataSource {\n  id: string;\n  sql: string;\n  type: string;\n}\n\ninterface ViewQueryModalFooterProps {\n  closeModal?: Function;\n  changeDatasource?: Function;\n  datasource?: SimpleDataSource;\n}\n\nconst CLOSE = t('Close');\nconst SAVE_AS_DATASET = t('Save as Dataset');\nconst OPEN_IN_SQL_LAB = t('Open in SQL Lab');\n\nconst ViewQueryModalFooter: React.FC<ViewQueryModalFooterProps> = (props: {\n  closeModal: () => void;\n  changeDatasource: () => void;\n  datasource: SimpleDataSource;\n}) => {\n  const viewInSQLLab = (id: string, type: string, sql: string) => {\n    const payload = {\n      datasourceKey: `${id}__${type}`,\n      sql,\n    };\n    SupersetClient.postForm('/superset/sqllab/', payload);\n  };\n\n  const openSQL = () => {\n    const { datasource } = props;\n    if (isObject(datasource)) {\n      const { id, type, sql } = datasource;\n      viewInSQLLab(id, type, sql);\n    }\n  };\n  return (\n    <div>\n      <Button\n        onClick={() => {\n          props?.closeModal?.();\n          props?.changeDatasource?.();\n        }}\n      >\n        {SAVE_AS_DATASET}\n      </Button>\n      <Button onClick={() => openSQL()}>{OPEN_IN_SQL_LAB}</Button>\n      <Button\n        buttonStyle=\"primary\"\n        onClick={() => {\n          props?.closeModal?.();\n        }}\n      >\n        {CLOSE}\n      </Button>\n    </div>\n  );\n};\n\nexport default ViewQueryModalFooter;\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  DatasourceType,\n  SupersetClient,\n  styled,\n  t,\n  withTheme,\n} from '@superset-ui/core';\nimport { getTemporalColumns } from '@superset-ui/chart-controls';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { AntdDropdown } from 'src/components';\nimport { Menu } from 'src/components/Menu';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  ChangeDatasourceModal,\n  DatasourceModal,\n} from 'src/components/Datasource';\nimport Button from 'src/components/Button';\nimport ErrorAlert from 'src/components/ErrorMessage/ErrorAlert';\nimport WarningIconWithTooltip from 'src/components/WarningIconWithTooltip';\nimport { URL_PARAMS } from 'src/constants';\nimport { getDatasourceAsSaveableDataset } from 'src/utils/datasourceUtils';\nimport {\n  canUserAccessSqlLab,\n  isUserAdmin,\n} from 'src/dashboard/util/permissionUtils';\nimport ModalTrigger from 'src/components/ModalTrigger';\nimport ViewQueryModalFooter from 'src/explore/components/controls/ViewQueryModalFooter';\nimport ViewQuery from 'src/explore/components/controls/ViewQuery';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { isString } from 'lodash';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  form_data: PropTypes.object.isRequired,\n  isEditable: PropTypes.bool,\n  onDatasourceSave: PropTypes.func,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n  isEditable: true,\n};\n\nconst Styles = styled.div`\n  .data-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    padding: ${({ theme }) => 4 * theme.gridUnit}px;\n    padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .error-alert {\n    margin: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .ant-dropdown-trigger {\n    margin-left: ${({ theme }) => 2 * theme.gridUnit}px;\n    box-shadow: none;\n    &:active {\n      box-shadow: none;\n    }\n  }\n  .btn-group .open .dropdown-toggle {\n    box-shadow: none;\n    &.button-default {\n      background: none;\n    }\n  }\n  i.angle {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n  svg.datasource-modal-trigger {\n    color: ${({ theme }) => theme.colors.primary.base};\n    cursor: pointer;\n  }\n  .title-select {\n    flex: 1 1 100%;\n    display: inline-block;\n    background-color: ${({ theme }) => theme.colors.grayscale.light3};\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    border-radius: ${({ theme }) => theme.borderRadius}px;\n    text-align: center;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n  }\n  .datasource-svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    flex: none;\n  }\n  span[aria-label='dataset-physical'] {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  span[aria-label='more-vert'] {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst CHANGE_DATASET = 'change_dataset';\nconst VIEW_IN_SQL_LAB = 'view_in_sql_lab';\nconst EDIT_DATASET = 'edit_dataset';\nconst QUERY_PREVIEW = 'query_preview';\nconst SAVE_AS_DATASET = 'save_as_dataset';\n\n// If the string is longer than this value's number characters we add\n// a tooltip for user can see the full name by hovering over the visually truncated string in UI\nconst VISIBLE_TITLE_LENGTH = 25;\n\n// Assign icon for each DatasourceType.  If no icon assingment is found in the lookup, no icon will render\nexport const datasourceIconLookup = {\n  [DatasourceType.Query]: (\n    <Icons.ConsoleSqlOutlined className=\"datasource-svg\" />\n  ),\n  [DatasourceType.Table]: <Icons.DatasetPhysical className=\"datasource-svg\" />,\n};\n\n// Render title for datasource with tooltip only if text is longer than VISIBLE_TITLE_LENGTH\nexport const renderDatasourceTitle = (displayString, tooltip) =>\n  displayString?.length > VISIBLE_TITLE_LENGTH ? (\n    // Add a tooltip only for long names that will be visually truncated\n    <Tooltip title={tooltip}>\n      <span className=\"title-select\">{displayString}</span>\n    </Tooltip>\n  ) : (\n    <span title={tooltip} className=\"title-select\">\n      {displayString}\n    </span>\n  );\n\n// Different data source types use different attributes for the display title\nexport const getDatasourceTitle = datasource => {\n  if (datasource?.type === 'query') return datasource?.sql;\n  return datasource?.name || '';\n};\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n      showSaveDatasetModal: false,\n    };\n  }\n\n  onDatasourceSave = datasource => {\n    this.props.actions.changeDatasource(datasource);\n    const { temporalColumns, defaultTemporalColumn } =\n      getTemporalColumns(datasource);\n    const { columns } = datasource;\n    // the current granularity_sqla might not be a temporal column anymore\n    const timeCol = this.props.form_data?.granularity_sqla;\n    const isGranularitySqalTemporal = columns.find(\n      ({ column_name }) => column_name === timeCol,\n    )?.is_dttm;\n    // the current main_dttm_col might not be a temporal column anymore\n    const isDefaultTemporal = columns.find(\n      ({ column_name }) => column_name === defaultTemporalColumn,\n    )?.is_dttm;\n\n    // if the current granularity_sqla is empty or it is not a temporal column anymore\n    // let's update the control value\n    if (datasource.type === 'table' && !isGranularitySqalTemporal) {\n      const temporalColumn = isDefaultTemporal\n        ? defaultTemporalColumn\n        : temporalColumns?.[0];\n      this.props.actions.setControlValue(\n        'granularity_sqla',\n        temporalColumn || null,\n      );\n    }\n\n    if (this.props.onDatasourceSave) {\n      this.props.onDatasourceSave(datasource);\n    }\n  };\n\n  toggleShowDatasource = () => {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource,\n    }));\n  };\n\n  toggleChangeDatasourceModal = () => {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal,\n    }));\n  };\n\n  toggleEditDatasourceModal = () => {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal,\n    }));\n  };\n\n  toggleSaveDatasetModal = () => {\n    this.setState(({ showSaveDatasetModal }) => ({\n      showSaveDatasetModal: !showSaveDatasetModal,\n    }));\n  };\n\n  handleMenuItemClick = ({ key }) => {\n    switch (key) {\n      case CHANGE_DATASET:\n        this.toggleChangeDatasourceModal();\n        break;\n\n      case EDIT_DATASET:\n        this.toggleEditDatasourceModal();\n        break;\n\n      case VIEW_IN_SQL_LAB:\n        {\n          const { datasource } = this.props;\n          const payload = {\n            datasourceKey: `${datasource.id}__${datasource.type}`,\n            sql: datasource.sql,\n          };\n          SupersetClient.postForm('/superset/sqllab/', {\n            form_data: safeStringify(payload),\n          });\n        }\n        break;\n\n      case SAVE_AS_DATASET:\n        this.toggleSaveDatasetModal();\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  render() {\n    const {\n      showChangeDatasourceModal,\n      showEditDatasourceModal,\n      showSaveDatasetModal,\n    } = this.state;\n    const { datasource, onChange, theme } = this.props;\n    const isMissingDatasource = !datasource?.id;\n    let isMissingParams = false;\n    if (isMissingDatasource) {\n      const datasourceId = getUrlParam(URL_PARAMS.datasourceId);\n      const sliceId = getUrlParam(URL_PARAMS.sliceId);\n\n      if (!datasourceId && !sliceId) {\n        isMissingParams = true;\n      }\n    }\n\n    const { user } = this.props;\n    const allowEdit =\n      datasource.owners?.map(o => o.id || o.value).includes(user.userId) ||\n      isUserAdmin(user);\n\n    const canAccessSqlLab = canUserAccessSqlLab(user);\n\n    const editText = t('Edit dataset');\n\n    const defaultDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        {this.props.isEditable && !isMissingDatasource && (\n          <Menu.Item\n            key={EDIT_DATASET}\n            data-test=\"edit-dataset\"\n            disabled={!allowEdit}\n          >\n            {!allowEdit ? (\n              <Tooltip\n                title={t(\n                  'You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.',\n                )}\n              >\n                {editText}\n              </Tooltip>\n            ) : (\n              editText\n            )}\n          </Menu.Item>\n        )}\n        <Menu.Item key={CHANGE_DATASET}>{t('Swap dataset')}</Menu.Item>\n        {!isMissingDatasource && canAccessSqlLab && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n      </Menu>\n    );\n\n    const queryDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        <Menu.Item key={QUERY_PREVIEW}>\n          <ModalTrigger\n            triggerNode={\n              <span data-test=\"view-query-menu-item\">{t('Query preview')}</span>\n            }\n            modalTitle={t('Query preview')}\n            modalBody={\n              <ViewQuery\n                sql={datasource?.sql || datasource?.select_star || ''}\n              />\n            }\n            modalFooter={\n              <ViewQueryModalFooter\n                changeDatasource={this.toggleSaveDatasetModal}\n                datasource={datasource}\n              />\n            }\n            draggable={false}\n            resizable={false}\n            responsive\n          />\n        </Menu.Item>\n        {canAccessSqlLab && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n        <Menu.Item key={SAVE_AS_DATASET}>{t('Save as dataset')}</Menu.Item>\n      </Menu>\n    );\n\n    const { health_check_message: healthCheckMessage } = datasource;\n\n    let extra;\n    if (datasource?.extra) {\n      if (isString(datasource.extra)) {\n        try {\n          extra = JSON.parse(datasource.extra);\n        } catch {} // eslint-disable-line no-empty\n      } else {\n        extra = datasource.extra; // eslint-disable-line prefer-destructuring\n      }\n    }\n\n    const titleText = isMissingDatasource\n      ? t('Missing dataset')\n      : getDatasourceTitle(datasource);\n\n    const tooltip = titleText;\n\n    return (\n      <Styles data-test=\"datasource-control\" className=\"DatasourceControl\">\n        <div className=\"data-container\">\n          {datasourceIconLookup[datasource?.type]}\n          {renderDatasourceTitle(titleText, tooltip)}\n          {healthCheckMessage && (\n            <Tooltip title={healthCheckMessage}>\n              <Icons.AlertSolid iconColor={theme.colors.warning.base} />\n            </Tooltip>\n          )}\n          {extra?.warning_markdown && (\n            <WarningIconWithTooltip warningMarkdown={extra.warning_markdown} />\n          )}\n          <AntdDropdown\n            overlay={\n              datasource.type === DatasourceType.Query\n                ? queryDatasourceMenu\n                : defaultDatasourceMenu\n            }\n            trigger={['click']}\n            data-test=\"datasource-menu\"\n          >\n            <Icons.MoreVert\n              className=\"datasource-modal-trigger\"\n              data-test=\"datasource-menu-trigger\"\n            />\n          </AntdDropdown>\n        </div>\n        {/* missing dataset */}\n        {isMissingDatasource && isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing URL parameters')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The URL is missing the dataset_id or slice_id parameters.',\n                    )}\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {isMissingDatasource && !isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing dataset')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The dataset linked to this chart may have been deleted.',\n                    )}\n                  </p>\n                  <p>\n                    <Button\n                      buttonStyle=\"primary\"\n                      onClick={() =>\n                        this.handleMenuItemClick({ key: CHANGE_DATASET })\n                      }\n                    >\n                      {t('Swap dataset')}\n                    </Button>\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {showEditDatasourceModal && (\n          <DatasourceModal\n            datasource={datasource}\n            show={showEditDatasourceModal}\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleEditDatasourceModal}\n          />\n        )}\n        {showChangeDatasourceModal && (\n          <ChangeDatasourceModal\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleChangeDatasourceModal}\n            show={showChangeDatasourceModal}\n            onChange={onChange}\n          />\n        )}\n        {showSaveDatasetModal && (\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={this.toggleSaveDatasetModal}\n            buttonTextOnSave={t('Save')}\n            buttonTextOnOverwrite={t('Overwrite')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={getDatasourceAsSaveableDataset(datasource)}\n            openWindow={false}\n            formData={this.props.form_data}\n          />\n        )}\n      </Styles>\n    );\n  }\n}\n\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;\n\nexport default withTheme(DatasourceControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  FocusEvent,\n  KeyboardEvent,\n  useCallback,\n  useState,\n} from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst TitleLabel = styled.span`\n  display: inline-block;\n  padding: 2px 0;\n`;\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport interface AdhocMetricEditPopoverTitleProps {\n  title?: {\n    label?: string;\n    hasCustomLabel?: boolean;\n  };\n  isEditDisabled?: boolean;\n  onChange: ChangeEventHandler<HTMLInputElement>;\n}\n\nconst AdhocMetricEditPopoverTitle: React.FC<AdhocMetricEditPopoverTitleProps> =\n  ({ title, isEditDisabled, onChange }) => {\n    const [isHovered, setIsHovered] = useState(false);\n    const [isEditMode, setIsEditMode] = useState(false);\n\n    const defaultLabel = t('My metric');\n\n    const handleMouseOver = useCallback(() => setIsHovered(true), []);\n    const handleMouseOut = useCallback(() => setIsHovered(false), []);\n    const handleClick = useCallback(() => setIsEditMode(true), []);\n    const handleBlur = useCallback(() => setIsEditMode(false), []);\n\n    const handleKeyPress = useCallback(\n      (ev: KeyboardEvent<HTMLInputElement>) => {\n        if (ev.key === 'Enter') {\n          ev.preventDefault();\n          handleBlur();\n        }\n      },\n      [handleBlur],\n    );\n\n    const handleInputBlur = useCallback(\n      (e: FocusEvent<HTMLInputElement>) => {\n        if (e.target.value === '') {\n          onChange(e);\n        }\n\n        handleBlur();\n      },\n      [onChange, handleBlur],\n    );\n\n    if (isEditDisabled) {\n      return (\n        <span data-test=\"AdhocMetricTitle\">{title?.label || defaultLabel}</span>\n      );\n    }\n\n    if (isEditMode) {\n      return (\n        <StyledInput\n          type=\"text\"\n          placeholder={title?.label}\n          value={title?.hasCustomLabel ? title.label : ''}\n          autoFocus\n          onChange={onChange}\n          onBlur={handleInputBlur}\n          onKeyPress={handleKeyPress}\n          data-test=\"AdhocMetricEditTitle#input\"\n        />\n      );\n    }\n\n    return (\n      <Tooltip placement=\"top\" title={t('Click to edit label')}>\n        <span\n          className=\"AdhocMetricEditPopoverTitle inline-editable\"\n          data-test=\"AdhocMetricEditTitle#trigger\"\n          onMouseOver={handleMouseOver}\n          onMouseOut={handleMouseOut}\n          onClick={handleClick}\n          onBlur={handleBlur}\n          role=\"button\"\n          tabIndex={0}\n        >\n          <TitleLabel>{title?.label || defaultLabel}</TitleLabel>\n          &nbsp;\n          <i\n            className=\"fa fa-pencil\"\n            style={{ color: isHovered ? 'black' : 'grey' }}\n          />\n        </span>\n      </Tooltip>\n    );\n  };\n\nexport default AdhocMetricEditPopoverTitle;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  isDefined,\n  t,\n  styled,\n  ensureIsArray,\n  DatasourceType,\n} from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { noOp } from 'src/utils/common';\nimport {\n  AGGREGATES_OPTIONS,\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport columnType from 'src/explore/components/controls/MetricControl/columnType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  StyledMetricOption,\n  StyledColumnOption,\n} from 'src/explore/components/optionRenderers';\n\nconst propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  getCurrentTab: PropTypes.func,\n  getCurrentLabel: PropTypes.func,\n  adhocMetric: PropTypes.instanceOf(AdhocMetric).isRequired,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  isNewMetric: PropTypes.bool,\n  isLabelModified: PropTypes.bool,\n};\n\nconst defaultProps = {\n  columns: [],\n  getCurrentTab: noOp,\n  isNewMetric: false,\n};\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nexport const SAVED_TAB_KEY = 'SAVED';\n\nexport default class AdhocMetricEditPopover extends React.PureComponent {\n  // \"Saved\" is a default tab unless there are no saved metrics for dataset\n  defaultActiveTabKey = this.getDefaultTab();\n\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onResetStateAndClose = this.onResetStateAndClose.bind(this);\n    this.onColumnChange = this.onColumnChange.bind(this);\n    this.onAggregateChange = this.onAggregateChange.bind(this);\n    this.onSavedMetricChange = this.onSavedMetricChange.bind(this);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n    this.refreshAceEditor = this.refreshAceEditor.bind(this);\n    this.getDefaultTab = this.getDefaultTab.bind(this);\n\n    this.state = {\n      adhocMetric: this.props.adhocMetric,\n      savedMetric: this.props.savedMetric,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n    };\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidMount() {\n    this.props.getCurrentTab(this.defaultActiveTabKey);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      prevState.adhocMetric?.sqlExpression !==\n        this.state.adhocMetric?.sqlExpression ||\n      prevState.adhocMetric?.aggregate !== this.state.adhocMetric?.aggregate ||\n      prevState.adhocMetric?.column?.column_name !==\n        this.state.adhocMetric?.column?.column_name ||\n      prevState.savedMetric?.metric_name !== this.state.savedMetric?.metric_name\n    ) {\n      this.props.getCurrentLabel({\n        savedMetricLabel:\n          this.state.savedMetric?.verbose_name ||\n          this.state.savedMetric?.metric_name,\n        adhocMetricLabel: this.state.adhocMetric?.getDefaultLabel(),\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  getDefaultTab() {\n    const { adhocMetric, savedMetric, savedMetricsOptions, isNewMetric } =\n      this.props;\n    if (isDefined(adhocMetric.column) || isDefined(adhocMetric.sqlExpression)) {\n      return adhocMetric.expressionType;\n    }\n    if (\n      (isNewMetric || savedMetric.metric_name) &&\n      Array.isArray(savedMetricsOptions) &&\n      savedMetricsOptions.length > 0\n    ) {\n      return SAVED_TAB_KEY;\n    }\n    return adhocMetric.expressionType;\n  }\n\n  onSave() {\n    const { adhocMetric, savedMetric } = this.state;\n\n    const metric = savedMetric?.metric_name ? savedMetric : adhocMetric;\n    const oldMetric = this.props.savedMetric?.metric_name\n      ? this.props.savedMetric\n      : this.props.adhocMetric;\n    this.props.onChange(\n      {\n        ...metric,\n      },\n      oldMetric,\n    );\n    this.props.onClose();\n  }\n\n  onResetStateAndClose() {\n    this.setState(\n      {\n        adhocMetric: this.props.adhocMetric,\n        savedMetric: this.props.savedMetric,\n      },\n      this.props.onClose,\n    );\n  }\n\n  onColumnChange(columnName) {\n    const column = this.props.columns.find(\n      column => column.column_name === columnName,\n    );\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onAggregateChange(aggregate) {\n    // we construct this object explicitly to overwrite the value in the case aggregate is null\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        aggregate,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onSavedMetricChange(savedMetricName) {\n    const savedMetric = this.props.savedMetricsOptions.find(\n      metric => metric.metric_name === savedMetricName,\n    );\n    this.setState(prevState => ({\n      savedMetric,\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column: undefined,\n        aggregate: undefined,\n        sqlExpression: undefined,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    }));\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(tab) {\n    this.refreshAceEditor();\n    this.props.getCurrentTab(tab);\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  refreshAceEditor() {\n    setTimeout(() => {\n      if (this.aceEditorRef) {\n        this.aceEditorRef.editor.resize();\n      }\n    }, 0);\n  }\n\n  renderColumnOption(option) {\n    const column = { ...option };\n    if (column.metric_name && !column.verbose_name) {\n      column.verbose_name = column.metric_name;\n    }\n    return <StyledColumnOption column={column} showType />;\n  }\n\n  renderMetricOption(savedMetric) {\n    return <StyledMetricOption metric={savedMetric} showType />;\n  }\n\n  render() {\n    const {\n      adhocMetric: propsAdhocMetric,\n      savedMetric: propsSavedMetric,\n      columns,\n      savedMetricsOptions,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      isNewMetric,\n      isLabelModified,\n      ...popoverProps\n    } = this.props;\n    const { adhocMetric, savedMetric } = this.state;\n    const keywords = sqlKeywords.concat(\n      columns.map(column => ({\n        name: column.column_name,\n        value: column.column_name,\n        score: 50,\n        meta: 'column',\n      })),\n    );\n\n    const columnValue =\n      (adhocMetric.column && adhocMetric.column.column_name) ||\n      adhocMetric.inferSqlExpressionColumn();\n\n    // autofocus on column if there's no value in column; otherwise autofocus on aggregate\n    const columnSelectProps = {\n      ariaLabel: t('Select column'),\n      placeholder: t('%s column(s)', columns.length),\n      value: columnValue,\n      onChange: this.onColumnChange,\n      allowClear: true,\n      autoFocus: !columnValue,\n    };\n\n    const aggregateSelectProps = {\n      ariaLabel: t('Select aggregate options'),\n      placeholder: t('%s aggregates(s)', AGGREGATES_OPTIONS.length),\n      value: adhocMetric.aggregate || adhocMetric.inferSqlExpressionAggregate(),\n      onChange: this.onAggregateChange,\n      allowClear: true,\n      autoFocus: !!columnValue,\n    };\n\n    const savedSelectProps = {\n      ariaLabel: t('Select saved metrics'),\n      placeholder: t('%s saved metric(s)', savedMetricsOptions?.length ?? 0),\n      value: savedMetric?.metric_name,\n      onChange: this.onSavedMetricChange,\n      allowClear: true,\n      autoFocus: true,\n    };\n\n    const stateIsValid = adhocMetric.isValid() || savedMetric?.metric_name;\n    const hasUnsavedChanges =\n      isLabelModified ||\n      isNewMetric ||\n      !adhocMetric.equals(propsAdhocMetric) ||\n      (!(\n        typeof savedMetric?.metric_name === 'undefined' &&\n        typeof propsSavedMetric?.metric_name === 'undefined'\n      ) &&\n        savedMetric?.metric_name !== propsSavedMetric?.metric_name);\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Form\n        layout=\"vertical\"\n        id=\"metrics-edit-popover\"\n        data-test=\"metrics-edit-popover\"\n        {...popoverProps}\n      >\n        <Tabs\n          id=\"adhoc-metric-edit-tabs\"\n          data-test=\"adhoc-metric-edit-tabs\"\n          defaultActiveKey={this.defaultActiveTabKey}\n          className=\"adhoc-metric-edit-tabs\"\n          style={{ height: this.state.height, width: this.state.width }}\n          onChange={this.onTabChange}\n          allowOverflow\n        >\n          <Tabs.TabPane key={SAVED_TAB_KEY} tab={t('Saved')}>\n            {ensureIsArray(savedMetricsOptions).length > 0 ? (\n              <FormItem label={t('Saved metric')}>\n                <StyledSelect\n                  options={ensureIsArray(savedMetricsOptions).map(\n                    savedMetric => ({\n                      value: savedMetric.metric_name,\n                      label: savedMetric.metric_name,\n                      customLabel: this.renderMetricOption(savedMetric),\n                      key: savedMetric.id,\n                    }),\n                  )}\n                  {...savedSelectProps}\n                />\n              </FormItem>\n            ) : datasource.type === DatasourceType.Table ? (\n              <EmptyStateSmall\n                image=\"empty.svg\"\n                title={t('No saved metrics found')}\n                description={t(\n                  'Add metrics to dataset in \"Edit datasource\" modal',\n                )}\n              />\n            ) : (\n              <EmptyStateSmall\n                image=\"empty.svg\"\n                title={t('No saved metrics found')}\n                description={\n                  <>\n                    <span\n                      tabIndex={0}\n                      role=\"button\"\n                      onClick={() => {\n                        this.props.handleDatasetModal(true);\n                        this.props.onClose();\n                      }}\n                    >\n                      {t('Create a dataset')}\n                    </span>\n                    {t(' to add metrics')}\n                  </>\n                }\n              />\n            )}\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Simple ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Simple')}\n                </Tooltip>\n              ) : (\n                t('Simple')\n              )\n            }\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <FormItem label={t('column')}>\n              <Select\n                options={columns.map(column => ({\n                  value: column.column_name,\n                  label: column.verbose_name || column.column_name,\n                  key: column.id,\n                  customLabel: this.renderColumnOption(column),\n                }))}\n                {...columnSelectProps}\n              />\n            </FormItem>\n            <FormItem label={t('aggregate')}>\n              <Select\n                options={AGGREGATES_OPTIONS.map(option => ({\n                  value: option,\n                  label: option,\n                  key: option,\n                }))}\n                {...aggregateSelectProps}\n              />\n            </FormItem>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SQL}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Custom SQL ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Custom SQL')}\n                </Tooltip>\n              ) : (\n                t('Custom SQL')\n              )\n            }\n            data-test=\"adhoc-metric-edit-tab#custom\"\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <SQLEditor\n              data-test=\"sql-editor\"\n              showLoadingForImport\n              ref={this.handleAceEditorRef}\n              keywords={keywords}\n              height={`${this.state.height - 80}px`}\n              onChange={this.onSqlExpressionChange}\n              width=\"100%\"\n              showGutter={false}\n              value={\n                adhocMetric.sqlExpression ||\n                adhocMetric.translateToSql({ transformCountDistinct: true })\n              }\n              editorProps={{ $blockScrolling: true }}\n              enableLiveAutocompletion\n              className=\"filter-sql-editor\"\n              wrapEnabled\n            />\n          </Tabs.TabPane>\n        </Tabs>\n        <div>\n          <Button\n            buttonSize=\"small\"\n            onClick={this.onResetStateAndClose}\n            data-test=\"AdhocMetricEdit#cancel\"\n            cta\n          >\n            {t('Close')}\n          </Button>\n          <Button\n            disabled={!stateIsValid || !hasUnsavedChanges}\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            data-test=\"AdhocMetricEdit#save\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <i\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </Form>\n    );\n  }\n}\nAdhocMetricEditPopover.propTypes = propTypes;\nAdhocMetricEditPopover.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Metric, t } from '@superset-ui/core';\nimport AdhocMetricEditPopoverTitle from 'src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport {\n  ISaveableDatasource,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { Datasource } from 'src/explore/types';\nimport AdhocMetricEditPopover, {\n  SAVED_TAB_KEY,\n} from './AdhocMetricEditPopover';\nimport AdhocMetric from './AdhocMetric';\nimport { savedMetricType } from './types';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nexport type AdhocMetricPopoverTriggerProps = {\n  adhocMetric: AdhocMetric;\n  onMetricEdit(newMetric: Metric, oldMetric: Metric): void;\n  columns: { column_name: string; type: string }[];\n  savedMetricsOptions: savedMetricType[];\n  savedMetric: savedMetricType;\n  datasource: Datasource & ISaveableDatasource;\n  children: ReactNode;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  isNew?: boolean;\n};\n\nexport type AdhocMetricPopoverTriggerState = {\n  adhocMetric: AdhocMetric;\n  popoverVisible: boolean;\n  title: { label: string; hasCustomLabel: boolean };\n  currentLabel: string;\n  labelModified: boolean;\n  isTitleEditDisabled: boolean;\n  showSaveDatasetModal: boolean;\n};\n\nclass AdhocMetricPopoverTrigger extends React.PureComponent<\n  AdhocMetricPopoverTriggerProps,\n  AdhocMetricPopoverTriggerState\n> {\n  constructor(props: AdhocMetricPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.getCurrentTab = this.getCurrentTab.bind(this);\n    this.getCurrentLabel = this.getCurrentLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.handleDatasetModal = this.handleDatasetModal.bind(this);\n\n    this.state = {\n      adhocMetric: props.adhocMetric,\n      popoverVisible: false,\n      title: {\n        label: props.adhocMetric.label,\n        hasCustomLabel: props.adhocMetric.hasCustomLabel,\n      },\n      currentLabel: '',\n      labelModified: false,\n      isTitleEditDisabled: false,\n      showSaveDatasetModal: false,\n    };\n  }\n\n  static getDerivedStateFromProps(\n    nextProps: AdhocMetricPopoverTriggerProps,\n    prevState: AdhocMetricPopoverTriggerState,\n  ) {\n    if (prevState.adhocMetric.optionName !== nextProps.adhocMetric.optionName) {\n      return {\n        adhocMetric: nextProps.adhocMetric,\n        title: {\n          label: nextProps.adhocMetric.label,\n          hasCustomLabel: nextProps.adhocMetric.hasCustomLabel,\n        },\n        currentLabel: '',\n        labelModified: false,\n      };\n    }\n    return {\n      adhocMetric: nextProps.adhocMetric,\n    };\n  }\n\n  onLabelChange(e: any) {\n    const { verbose_name, metric_name } = this.props.savedMetric;\n    const defaultMetricLabel = this.props.adhocMetric?.getDefaultLabel();\n    const label = e.target.value;\n    this.setState(state => ({\n      title: {\n        label:\n          label ||\n          state.currentLabel ||\n          verbose_name ||\n          metric_name ||\n          defaultMetricLabel,\n        hasCustomLabel: !!label,\n      },\n      labelModified: true,\n    }));\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  handleDatasetModal(showModal: boolean) {\n    this.setState({ showSaveDatasetModal: showModal });\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n    this.setState({\n      labelModified: false,\n    });\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  getCurrentTab(tab: string) {\n    this.setState({\n      isTitleEditDisabled: tab === SAVED_TAB_KEY,\n    });\n  }\n\n  getCurrentLabel({\n    savedMetricLabel,\n    adhocMetricLabel,\n  }: {\n    savedMetricLabel: string;\n    adhocMetricLabel: string;\n  }) {\n    const currentLabel = savedMetricLabel || adhocMetricLabel;\n    this.setState({\n      currentLabel,\n      labelModified: true,\n    });\n    if (savedMetricLabel || !this.state.title.hasCustomLabel) {\n      this.setState({\n        title: {\n          label: currentLabel,\n          hasCustomLabel: false,\n        },\n      });\n    }\n  }\n\n  onChange(newMetric: Metric, oldMetric: Metric) {\n    this.props.onMetricEdit({ ...newMetric, ...this.state.title }, oldMetric);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      savedMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      isControlledComponent,\n    } = this.props;\n    const { verbose_name, metric_name } = savedMetric;\n    const { hasCustomLabel, label } = adhocMetric;\n    const adhocMetricLabel = hasCustomLabel\n      ? label\n      : adhocMetric.getDefaultLabel();\n    const title = this.state.labelModified\n      ? this.state.title\n      : {\n          label: verbose_name || metric_name || adhocMetricLabel,\n          hasCustomLabel,\n        };\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocMetricEditPopover\n          adhocMetric={adhocMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricsOptions}\n          savedMetric={savedMetric}\n          datasource={datasource}\n          handleDatasetModal={this.handleDatasetModal}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          onChange={this.onChange}\n          getCurrentTab={this.getCurrentTab}\n          getCurrentLabel={this.getCurrentLabel}\n          isNewMetric={this.props.isNew}\n          isLabelModified={\n            this.state.labelModified &&\n            adhocMetricLabel !== this.state.title.label\n          }\n        />\n      </ExplorePopoverContent>\n    );\n\n    const popoverTitle = (\n      <AdhocMetricEditPopoverTitle\n        title={title}\n        onChange={this.onLabelChange}\n        isEditDisabled={this.state.isTitleEditDisabled}\n      />\n    );\n\n    return (\n      <>\n        {this.state.showSaveDatasetModal && (\n          <SaveDatasetModal\n            visible={this.state.showSaveDatasetModal}\n            onHide={() => this.handleDatasetModal(false)}\n            buttonTextOnSave={t('Save')}\n            buttonTextOnOverwrite={t('Overwrite')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n        )}\n        <ControlPopover\n          placement=\"right\"\n          trigger=\"click\"\n          content={overlayContent}\n          defaultVisible={visible}\n          visible={visible}\n          onVisibleChange={togglePopover}\n          title={popoverTitle}\n          destroyTooltipOnHide\n        >\n          {this.props.children}\n        </ControlPopover>\n      </>\n    );\n  }\n}\n\nexport default AdhocMetricPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport columnType from './columnType';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  adhocMetric: PropTypes.instanceOf(AdhocMetric),\n  onMetricEdit: PropTypes.func.isRequired,\n  onRemoveMetric: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  index: PropTypes.number,\n  type: PropTypes.string,\n  multi: PropTypes.bool,\n  datasourceWarningMessage: PropTypes.string,\n};\n\nclass AdhocMetricOption extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onRemoveMetric = this.onRemoveMetric.bind(this);\n  }\n\n  onRemoveMetric(e) {\n    e.stopPropagation();\n    this.props.onRemoveMetric(this.props.index);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      onMetricEdit,\n      columns,\n      savedMetricsOptions,\n      savedMetric,\n      datasource,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      type,\n      multi,\n      datasourceWarningMessage,\n    } = this.props;\n\n    return (\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onMetricEdit}\n        columns={columns}\n        savedMetricsOptions={savedMetricsOptions}\n        savedMetric={savedMetric}\n        datasource={datasource}\n      >\n        <OptionControlLabel\n          savedMetric={savedMetric}\n          adhocMetric={adhocMetric}\n          label={adhocMetric.label}\n          onRemove={this.onRemoveMetric}\n          onMoveLabel={onMoveLabel}\n          onDropLabel={onDropLabel}\n          index={index}\n          type={type ?? DndItemType.AdhocMetricOption}\n          withCaret\n          isFunction\n          multi={multi}\n          datasourceWarningMessage={datasourceWarningMessage}\n        />\n      </AdhocMetricPopoverTrigger>\n    );\n  }\n}\n\nexport default AdhocMetricOption;\n\nAdhocMetricOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport columnType from './columnType';\nimport AdhocMetricOption from './AdhocMetricOption';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([PropTypes.object, PropTypes.string]).isRequired,\n  index: PropTypes.number.isRequired,\n  onMetricEdit: PropTypes.func,\n  onRemoveMetric: PropTypes.func,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  multi: PropTypes.bool,\n  datasource: PropTypes.object,\n  datasourceWarningMessage: PropTypes.string,\n};\n\nexport default function MetricDefinitionValue({\n  option,\n  onMetricEdit,\n  onRemoveMetric,\n  columns,\n  savedMetrics,\n  savedMetricsOptions,\n  datasource,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  type,\n  multi,\n  datasourceWarningMessage,\n}) {\n  const getSavedMetricByName = metricName =>\n    savedMetrics.find(metric => metric.metric_name === metricName);\n\n  let savedMetric;\n  if (typeof option === 'string') {\n    savedMetric = getSavedMetricByName(option);\n  } else if (option.metric_name) {\n    savedMetric = option;\n  }\n\n  if (option instanceof AdhocMetric || savedMetric) {\n    const adhocMetric =\n      option instanceof AdhocMetric ? option : new AdhocMetric({});\n\n    const metricOptionProps = {\n      onMetricEdit,\n      onRemoveMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      adhocMetric,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      savedMetric: savedMetric ?? {},\n      type,\n      multi,\n      datasourceWarningMessage,\n    };\n\n    return <AdhocMetricOption {...metricOptionProps} />;\n  }\n  return null;\n}\nMetricDefinitionValue.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { ensureIsArray, t, useTheme } from '@superset-ui/core';\nimport { isEqual } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Icons from 'src/components/Icons';\nimport {\n  AddIconButton,\n  AddControlLabel,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport columnType from './columnType';\nimport MetricDefinitionValue from './MetricDefinitionValue';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport adhocMetricType from './adhocMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.string, adhocMetricType])),\n    PropTypes.oneOfType([PropTypes.string, adhocMetricType]),\n  ]),\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  clearable: PropTypes.bool,\n  datasource: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  clearable: true,\n  savedMetrics: [],\n  columns: [],\n};\n\nfunction getOptionsForSavedMetrics(\n  savedMetrics,\n  currentMetricValues,\n  currentMetric,\n) {\n  return (\n    savedMetrics?.filter(savedMetric =>\n      Array.isArray(currentMetricValues)\n        ? !currentMetricValues.includes(savedMetric.metric_name) ||\n          savedMetric.metric_name === currentMetric\n        : savedMetric,\n    ) ?? []\n  );\n}\n\nfunction isDictionaryForAdhocMetric(value) {\n  return value && !(value instanceof AdhocMetric) && value.expressionType;\n}\n\n// adhoc metrics are stored as dictionaries in URL params. We convert them back into the\n// AdhocMetric class for typechecking, consistency and instance method access.\nfunction coerceAdhocMetrics(value) {\n  if (!value) {\n    return [];\n  }\n  if (!Array.isArray(value)) {\n    if (isDictionaryForAdhocMetric(value)) {\n      return [new AdhocMetric(value)];\n    }\n    return [value];\n  }\n  return value.map(val => {\n    if (isDictionaryForAdhocMetric(val)) {\n      return new AdhocMetric(val);\n    }\n    return val;\n  });\n}\n\nconst emptySavedMetric = { metric_name: '', expression: '' };\n\n// TODO: use typeguards to distinguish saved metrics from adhoc metrics\nconst getMetricsMatchingCurrentDataset = (value, columns, savedMetrics) =>\n  ensureIsArray(value).filter(metric => {\n    if (typeof metric === 'string' || metric.metric_name) {\n      return savedMetrics?.some(\n        savedMetric =>\n          savedMetric.metric_name === metric ||\n          savedMetric.metric_name === metric.metric_name,\n      );\n    }\n    return columns?.some(\n      column =>\n        !metric.column || metric.column.column_name === column.column_name,\n    );\n  });\n\nconst MetricsControl = ({\n  onChange,\n  multi,\n  value: propsValue,\n  columns,\n  savedMetrics,\n  datasource,\n  ...props\n}) => {\n  const [value, setValue] = useState(coerceAdhocMetrics(propsValue));\n  const theme = useTheme();\n  const prevColumns = usePrevious(columns);\n  const prevSavedMetrics = usePrevious(savedMetrics);\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const onNewMetric = useCallback(\n    newMetric => {\n      const newValue = [...value, newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric, oldMetric) => {\n      const newValue = value.map(val => {\n        if (\n          // compare saved metrics\n          val === oldMetric.metric_name ||\n          // compare adhoc metrics\n          typeof val.optionName !== 'undefined'\n            ? val.optionName === oldMetric.optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return val;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    index => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex, hoverIndex) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const isAddNewMetricDisabled = useCallback(\n    () => !multi && value.length > 0,\n    [multi, value.length],\n  );\n\n  const savedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(savedMetrics, propsValue, null),\n    [propsValue, savedMetrics],\n  );\n\n  const newAdhocMetric = useMemo(() => new AdhocMetric({}), [value]);\n  const addNewMetricPopoverTrigger = useCallback(\n    trigger => {\n      if (isAddNewMetricDisabled()) {\n        return trigger;\n      }\n      return (\n        <AdhocMetricPopoverTrigger\n          adhocMetric={newAdhocMetric}\n          onMetricEdit={onNewMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricOptions}\n          savedMetric={emptySavedMetric}\n          datasource={datasource}\n          isNew\n        >\n          {trigger}\n        </AdhocMetricPopoverTrigger>\n      );\n    },\n    [\n      columns,\n      datasource,\n      isAddNewMetricDisabled,\n      newAdhocMetric,\n      onNewMetric,\n      savedMetricOptions,\n    ],\n  );\n\n  useEffect(() => {\n    // Remove selected custom metrics that do not exist in the dataset anymore\n    // Remove selected adhoc metrics that use columns which do not exist in the dataset anymore\n    if (\n      propsValue &&\n      (!isEqual(prevColumns, columns) ||\n        !isEqual(prevSavedMetrics, savedMetrics))\n    ) {\n      const matchingMetrics = getMetricsMatchingCurrentDataset(\n        propsValue,\n        columns,\n        savedMetrics,\n      );\n      if (!isEqual(matchingMetrics, propsValue)) {\n        handleChange(matchingMetrics);\n      }\n    }\n  }, [columns, handleChange, savedMetrics]);\n\n  useEffect(() => {\n    setValue(coerceAdhocMetrics(propsValue));\n  }, [propsValue]);\n\n  const onDropLabel = useCallback(\n    () => handleChange(value),\n    [handleChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option, index) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={columns}\n        datasource={datasource}\n        savedMetrics={savedMetrics}\n        savedMetricsOptions={getOptionsForSavedMetrics(\n          savedMetrics,\n          value,\n          value?.[index],\n        )}\n        onMoveLabel={moveLabel}\n        onDropLabel={onDropLabel}\n        multi={multi}\n      />\n    ),\n    [\n      columns,\n      datasource,\n      moveLabel,\n      multi,\n      onDropLabel,\n      onMetricEdit,\n      onRemoveMetric,\n      savedMetrics,\n      value,\n    ],\n  );\n\n  return (\n    <div className=\"metrics-select\">\n      <HeaderContainer>\n        <ControlHeader {...props} />\n        {addNewMetricPopoverTrigger(\n          <AddIconButton\n            disabled={isAddNewMetricDisabled()}\n            data-test=\"add-metric-button\"\n          >\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>,\n        )}\n      </HeaderContainer>\n      <LabelsContainer>\n        {value.length > 0\n          ? value.map((value, index) => valueRenderer(value, index))\n          : addNewMetricPopoverTrigger(\n              <AddControlLabel>\n                <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                {t('Add metric')}\n              </AddControlLabel>,\n            )}\n      </LabelsContainer>\n    </div>\n  );\n};\n\nMetricsControl.propTypes = propTypes;\nMetricsControl.defaultProps = defaultProps;\n\nexport default MetricsControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css } from '@emotion/react';\nimport { t } from '@superset-ui/core';\nimport Label from 'src/components/Label';\nimport Collapse from 'src/components/Collapse';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport MetricsControl from 'src/explore/components/controls/MetricControl/MetricsControl';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport PopoverSection from 'src/components/PopoverSection';\n\nconst controlTypes = {\n  fixed: 'fix',\n  metric: 'metric',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  isFloat: PropTypes.bool,\n  datasource: PropTypes.object.isRequired,\n  default: PropTypes.shape({\n    type: PropTypes.oneOf(['fix', 'metric']),\n    value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  }),\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: controlTypes.fixed, value: 5 },\n};\n\nexport default class FixedOrMetricControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n    this.setType = this.setType.bind(this);\n    this.setFixedValue = this.setFixedValue.bind(this);\n    this.setMetric = this.setMetric.bind(this);\n    const type =\n      (props.value ? props.value.type : props.default.type) ||\n      controlTypes.fixed;\n    const value =\n      (props.value ? props.value.value : props.default.value) || '100';\n    this.state = {\n      type,\n      fixedValue: type === controlTypes.fixed ? value : '',\n      metricValue: type === controlTypes.metric ? value : null,\n    };\n  }\n\n  onChange() {\n    this.props.onChange({\n      type: this.state.type,\n      value:\n        this.state.type === controlTypes.fixed\n          ? this.state.fixedValue\n          : this.state.metricValue,\n    });\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  setFixedValue(fixedValue) {\n    this.setState({ fixedValue }, this.onChange);\n  }\n\n  setMetric(metricValue) {\n    this.setState({ metricValue }, this.onChange);\n  }\n\n  render() {\n    const value = this.props.value || this.props.default;\n    const type = value.type || controlTypes.fixed;\n    const columns = this.props.datasource\n      ? this.props.datasource.columns\n      : null;\n    const metrics = this.props.datasource\n      ? this.props.datasource.metrics\n      : null;\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Collapse\n          ghost\n          css={theme => css`\n            &.ant-collapse\n              > .ant-collapse-item.ant-collapse-no-arrow\n              > .ant-collapse-header {\n              border: 0px;\n              padding: 0px 0px ${theme.gridUnit * 2}px 0px;\n              display: inline-block;\n            }\n            &.ant-collapse-ghost\n              > .ant-collapse-item\n              > .ant-collapse-content\n              > .ant-collapse-content-box {\n              padding: 0px;\n\n              & .well {\n                margin-bottom: 0px;\n                padding: ${theme.gridUnit * 2}px;\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            showArrow={false}\n            header={\n              <Label onClick={() => undefined}>\n                {this.state.type === controlTypes.fixed && (\n                  <span>{this.state.fixedValue}</span>\n                )}\n                {this.state.type === controlTypes.metric && (\n                  <span>\n                    <span>{t('metric')}: </span>\n                    <strong>\n                      {this.state.metricValue\n                        ? this.state.metricValue.label\n                        : null}\n                    </strong>\n                  </span>\n                )}\n              </Label>\n            }\n          >\n            <div className=\"well\">\n              <PopoverSection\n                title={t('Fixed')}\n                isSelected={type === controlTypes.fixed}\n                onSelect={() => {\n                  this.setType(controlTypes.fixed);\n                }}\n              >\n                <TextControl\n                  isFloat\n                  onChange={this.setFixedValue}\n                  onFocus={() => {\n                    this.setType(controlTypes.fixed);\n                  }}\n                  value={this.state.fixedValue}\n                />\n              </PopoverSection>\n              <PopoverSection\n                title={t('Based on a metric')}\n                isSelected={type === controlTypes.metric}\n                onSelect={() => {\n                  this.setType(controlTypes.metric);\n                }}\n              >\n                <MetricsControl\n                  name=\"metric\"\n                  columns={columns}\n                  savedMetrics={metrics}\n                  multi={false}\n                  onFocus={() => {\n                    this.setType(controlTypes.metric);\n                  }}\n                  onChange={this.setMetric}\n                  value={this.state.metricValue}\n                  datasource={this.props.datasource}\n                />\n              </PopoverSection>\n            </div>\n          </Collapse.Panel>\n        </Collapse>\n      </div>\n    );\n  }\n}\n\nFixedOrMetricControl.propTypes = propTypes;\nFixedOrMetricControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport { SelectOptionsType, SelectProps } from 'src/components/Select/types';\nimport { SelectValue, LabeledValue } from 'antd/lib/select';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\ntype SelectAsyncProps = Omit<SelectProps, 'options' | 'ariaLabel' | 'onChange'>;\n\ninterface SelectAsyncControlProps extends SelectAsyncProps {\n  addDangerToast: (error: string) => void;\n  ariaLabel?: string;\n  dataEndpoint: string;\n  default?: SelectValue;\n  mutator?: (response: Record<string, any>) => SelectOptionsType;\n  multi?: boolean;\n  onChange: (val: SelectValue) => void;\n  // ControlHeader related props\n  description?: string;\n  hovered?: boolean;\n  label?: string;\n}\n\nfunction isLabeledValue(arg: any): arg is LabeledValue {\n  return arg.value !== undefined;\n}\n\nconst SelectAsyncControl = ({\n  addDangerToast,\n  allowClear = true,\n  ariaLabel,\n  dataEndpoint,\n  multi = true,\n  mutator,\n  onChange,\n  placeholder,\n  value,\n  ...props\n}: SelectAsyncControlProps) => {\n  const [options, setOptions] = useState<SelectOptionsType>([]);\n\n  const handleOnChange = (val: SelectValue) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map(v => (isLabeledValue(v) ? v.value : v));\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n\n  const getValue = () => {\n    const currentValue =\n      value || (props.default !== undefined ? props.default : undefined);\n\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find(o => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n\n  useEffect(() => {\n    const onError = (response: Response) =>\n      getClientErrorObject(response).then(e => {\n        const { error } = e;\n        addDangerToast(t('Error while fetching data: %s', error));\n      });\n    const loadOptions = () =>\n      SupersetClient.get({\n        endpoint: dataEndpoint,\n      })\n        .then(response => {\n          const data = mutator ? mutator(response.json) : response.json.result;\n          setOptions(data);\n        })\n        .catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n\n  return (\n    <Select\n      allowClear={allowClear}\n      ariaLabel={ariaLabel || t('Select ...')}\n      value={getValue()}\n      header={<ControlHeader {...props} />}\n      mode={multi ? 'multiple' : 'single'}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default withToasts(SelectAsyncControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport AntdSlider, {\n  SliderSingleProps,\n  SliderRangeProps,\n} from 'antd/lib/slider';\n\nexport type { SliderSingleProps, SliderRangeProps };\n\nexport default function Slider(props: SliderSingleProps | SliderRangeProps) {\n  return <AntdSlider {...props} css={{ marginLeft: 0, marginRight: 0 }} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Input } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport { Select, Row, Col } from 'src/components';\nimport { t, styled } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport BoundsControl from '../BoundsControl';\nimport CheckboxControl from '../CheckboxControl';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst propTypes = {\n  label: PropTypes.string,\n  tooltip: PropTypes.string,\n  colType: PropTypes.string,\n  width: PropTypes.string,\n  height: PropTypes.string,\n  timeLag: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  timeRatio: PropTypes.string,\n  comparisonType: PropTypes.string,\n  showYAxis: PropTypes.bool,\n  yAxisBounds: PropTypes.array,\n  bounds: PropTypes.array,\n  d3format: PropTypes.string,\n  dateFormat: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  label: t('Time series columns'),\n  tooltip: '',\n  colType: '',\n  width: '',\n  height: '',\n  timeLag: '',\n  timeRatio: '',\n  comparisonType: '',\n  showYAxis: false,\n  yAxisBounds: [null, null],\n  bounds: [null, null],\n  d3format: '',\n  dateFormat: '',\n};\n\nconst comparisonTypeOptions = [\n  { value: 'value', label: t('Actual value'), key: 'value' },\n  { value: 'diff', label: t('Difference'), key: 'diff' },\n  { value: 'perc', label: t('Percentage'), key: 'perc' },\n  { value: 'perc_change', label: t('Percentage change'), key: 'perc_change' },\n];\n\nconst colTypeOptions = [\n  { value: 'time', label: t('Time comparison'), key: 'time' },\n  { value: 'contrib', label: t('Contribution'), key: 'contrib' },\n  { value: 'spark', label: t('Sparkline'), key: 'spark' },\n  { value: 'avg', label: t('Period average'), key: 'avg' },\n];\n\nconst StyledRow = styled(Row)`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledCol = styled(Col)`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledTooltip = styled(InfoTooltipWithTrigger)`\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nconst ButtonBar = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  display: flex;\n  justify-content: center;\n`;\n\nexport default class TimeSeriesColumnControl extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onSave = this.onSave.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.resetState = this.resetState.bind(this);\n    this.initialState = this.initialState.bind(this);\n    this.onPopoverVisibleChange = this.onPopoverVisibleChange.bind(this);\n\n    this.state = this.initialState();\n  }\n\n  initialState() {\n    return {\n      label: this.props.label,\n      tooltip: this.props.tooltip,\n      colType: this.props.colType,\n      width: this.props.width,\n      height: this.props.height,\n      timeLag: this.props.timeLag || 0,\n      timeRatio: this.props.timeRatio,\n      comparisonType: this.props.comparisonType,\n      showYAxis: this.props.showYAxis,\n      yAxisBounds: this.props.yAxisBounds,\n      bounds: this.props.bounds,\n      d3format: this.props.d3format,\n      dateFormat: this.props.dateFormat,\n      popoverVisible: false,\n    };\n  }\n\n  resetState() {\n    const initialState = this.initialState();\n    this.setState({ ...initialState });\n  }\n\n  onSave() {\n    this.props.onChange(this.state);\n    this.setState({ popoverVisible: false });\n  }\n\n  onClose() {\n    this.resetState();\n  }\n\n  onSelectChange(attr, opt) {\n    this.setState({ [attr]: opt });\n  }\n\n  onTextInputChange(attr, event) {\n    this.setState({ [attr]: event.target.value });\n  }\n\n  onCheckboxChange(attr, value) {\n    this.setState({ [attr]: value });\n  }\n\n  onBoundsChange(bounds) {\n    this.setState({ bounds });\n  }\n\n  onPopoverVisibleChange(popoverVisible) {\n    if (popoverVisible) {\n      this.setState({ popoverVisible });\n    } else {\n      this.resetState();\n    }\n  }\n\n  onYAxisBoundsChange(yAxisBounds) {\n    this.setState({ yAxisBounds });\n  }\n\n  textSummary() {\n    return `${this.props.label}`;\n  }\n\n  formRow(label, tooltip, ttLabel, control) {\n    return (\n      <StyledRow>\n        <StyledCol xs={24} md={11}>\n          {label}\n          <StyledTooltip placement=\"top\" tooltip={tooltip} label={ttLabel} />\n        </StyledCol>\n        <Col xs={24} md={13}>\n          {control}\n        </Col>\n      </StyledRow>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={{ width: 320 }}>\n        {this.formRow(\n          t('Label'),\n          t('The column header label'),\n          'time-lag',\n          <Input\n            value={this.state.label}\n            onChange={this.onTextInputChange.bind(this, 'label')}\n            placeholder={t('Label')}\n          />,\n        )}\n        {this.formRow(\n          t('Tooltip'),\n          t('Column header tooltip'),\n          'col-tooltip',\n          <Input\n            value={this.state.tooltip}\n            onChange={this.onTextInputChange.bind(this, 'tooltip')}\n            placeholder={t('Tooltip')}\n          />,\n        )}\n        {this.formRow(\n          t('Type'),\n          t('Type of comparison, value difference or percentage'),\n          'col-type',\n          <Select\n            ariaLabel={t('Type')}\n            value={this.state.colType || undefined}\n            onChange={this.onSelectChange.bind(this, 'colType')}\n            options={colTypeOptions}\n          />,\n        )}\n        <hr />\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Width'),\n            t('Width of the sparkline'),\n            'spark-width',\n            <Input\n              value={this.state.width}\n              onChange={this.onTextInputChange.bind(this, 'width')}\n              placeholder={t('Width')}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Height'),\n            t('Height of the sparkline'),\n            'spark-width',\n            <Input\n              value={this.state.height}\n              onChange={this.onTextInputChange.bind(this, 'height')}\n              placeholder={t('Height')}\n            />,\n          )}\n        {['time', 'avg'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            t('Time lag'),\n            t('Number of periods to compare against'),\n            'time-lag',\n            <Input\n              value={this.state.timeLag}\n              onChange={this.onTextInputChange.bind(this, 'timeLag')}\n              placeholder={t('Time Lag')}\n            />,\n          )}\n        {['spark'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            t('Time ratio'),\n            t('Number of periods to ratio against'),\n            'time-ratio',\n            <Input\n              value={this.state.timeRatio}\n              onChange={this.onTextInputChange.bind(this, 'timeRatio')}\n              placeholder={t('Time Ratio')}\n            />,\n          )}\n        {this.state.colType === 'time' &&\n          this.formRow(\n            t('Type'),\n            t('Type of comparison, value difference or percentage'),\n            'comp-type',\n            <Select\n              ariaLabel={t('Type')}\n              value={this.state.comparisonType || undefined}\n              onChange={this.onSelectChange.bind(this, 'comparisonType')}\n              options={comparisonTypeOptions}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Show Y-axis'),\n            t(\n              'Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.',\n            ),\n            'show-y-axis-bounds',\n            <CheckboxControl\n              value={this.state.showYAxis}\n              onChange={this.onCheckboxChange.bind(this, 'showYAxis')}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Y-axis bounds'),\n            t('Manually set min/max values for the y-axis.'),\n            'y-axis-bounds',\n            <BoundsControl\n              value={this.state.yAxisBounds}\n              onChange={this.onYAxisBoundsChange.bind(this)}\n            />,\n          )}\n        {this.state.colType !== 'spark' &&\n          this.formRow(\n            t('Color bounds'),\n            t(`Number bounds used for color encoding from red to blue.\n               Reverse the numbers for blue to red. To get pure red or blue,\n               you can enter either only min or max.`),\n            'bounds',\n            <BoundsControl\n              value={this.state.bounds}\n              onChange={this.onBoundsChange.bind(this)}\n            />,\n          )}\n        {this.formRow(\n          t('Number format'),\n          t('Optional d3 number format string'),\n          'd3-format',\n          <Input\n            value={this.state.d3format}\n            onChange={this.onTextInputChange.bind(this, 'd3format')}\n            placeholder={t('Number format string')}\n          />,\n        )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            t('Date format'),\n            t('Optional d3 date format string'),\n            'date-format',\n            <Input\n              value={this.state.dateFormat}\n              onChange={this.onTextInputChange.bind(this, 'dateFormat')}\n              placeholder={t('Date format string')}\n            />,\n          )}\n        <ButtonBar>\n          <Button buttonSize=\"small\" onClick={this.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n        </ButtonBar>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span>\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title={t('Column Configuration')}\n          visible={this.state.popoverVisible}\n          onVisibleChange={this.onPopoverVisibleChange}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nTimeSeriesColumnControl.propTypes = propTypes;\nTimeSeriesColumnControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport Popover from 'src/components/Popover';\nimport { decimal2sexagesimal } from 'geolib';\n\nimport Label from 'src/components/Label';\nimport { FormLabel } from 'src/components/Form';\nimport TextControl from './TextControl';\nimport ControlHeader from '../ControlHeader';\n\nexport const DEFAULT_VIEWPORT = {\n  longitude: 6.85236157047845,\n  latitude: 31.222656842808707,\n  zoom: 1,\n  bearing: 0,\n  pitch: 0,\n};\n\nconst PARAMS = ['longitude', 'latitude', 'zoom', 'bearing', 'pitch'];\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.shape({\n    longitude: PropTypes.number,\n    latitude: PropTypes.number,\n    zoom: PropTypes.number,\n    bearing: PropTypes.number,\n    pitch: PropTypes.number,\n  }),\n  default: PropTypes.object,\n  name: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: 'fix', value: 5 },\n  value: DEFAULT_VIEWPORT,\n};\n\nexport default class ViewportControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(ctrl, value) {\n    this.props.onChange({\n      ...this.props.value,\n      [ctrl]: value,\n    });\n  }\n\n  renderTextControl(ctrl) {\n    return (\n      <div key={ctrl}>\n        <FormLabel>{ctrl}</FormLabel>\n        <TextControl\n          value={this.props.value[ctrl]}\n          onChange={this.onChange.bind(this, ctrl)}\n          isFloat\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id={`filter-popover-${this.props.name}`}>\n        {PARAMS.map(ctrl => this.renderTextControl(ctrl))}\n      </div>\n    );\n  }\n\n  renderLabel() {\n    if (this.props.value.longitude && this.props.value.latitude) {\n      return `${decimal2sexagesimal(\n        this.props.value.longitude,\n      )} | ${decimal2sexagesimal(this.props.value.latitude)}`;\n    }\n    return 'N/A';\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          container={document.body}\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          title={t('Viewport')}\n        >\n          <Label className=\"pointer\">{this.renderLabel()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nViewportControl.propTypes = propTypes;\nViewportControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport { css, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { ExplorePageState } from 'src/explore/types';\n\nexport interface VizMeta {\n  icon: ReactElement;\n  name: string;\n}\n\nexport interface FastVizSwitcherProps {\n  onChange: (vizName: string) => void;\n  currentSelection: string | null;\n}\ninterface VizTileProps {\n  vizMeta: VizMeta;\n  isActive: boolean;\n  isRendered: boolean;\n  onTileClick: (vizType: string) => void;\n}\n\nconst FEATURED_CHARTS: VizMeta[] = [\n  {\n    name: 'echarts_timeseries_line',\n    icon: <Icons.LineChartTile />,\n  },\n  {\n    name: 'echarts_timeseries_bar',\n    icon: <Icons.BarChartTile />,\n  },\n  { name: 'echarts_area', icon: <Icons.AreaChartTile /> },\n  { name: 'table', icon: <Icons.TableChartTile /> },\n  {\n    name: 'big_number_total',\n    icon: <Icons.BigNumberChartTile />,\n  },\n  { name: 'pie', icon: <Icons.PieChartTile /> },\n];\n\nconst antdIconProps = {\n  iconSize: 'l' as const,\n  css: (theme: SupersetTheme) => css`\n    padding: ${theme.gridUnit}px;\n    & > * {\n      line-height: 0;\n    }\n  `,\n};\n\nconst VizTile = ({\n  isActive,\n  isRendered,\n  vizMeta,\n  onTileClick,\n}: VizTileProps) => {\n  const { mountedPluginMetadata } = usePluginContext();\n  const chartNameRef = useRef<HTMLSpanElement>(null);\n  const theme = useTheme();\n  const TILE_TRANSITION_TIME = theme.transitionTiming * 2;\n  const [tooltipVisible, setTooltipVisible] = useState(false);\n  const [isTransitioning, setIsTransitioning] = useState(false);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const chartName = vizMeta.name\n    ? mountedPluginMetadata[vizMeta.name]?.name || `${vizMeta.name}`\n    : t('Select Viz Type');\n\n  const handleTileClick = useCallback(() => {\n    onTileClick(vizMeta.name);\n    setIsTransitioning(true);\n    setTooltipVisible(false);\n    setTimeout(() => {\n      setIsTransitioning(false);\n    }, TILE_TRANSITION_TIME * 1000);\n  }, [onTileClick, TILE_TRANSITION_TIME, vizMeta.name]);\n\n  // Antd tooltip seems to be bugged - when elements move, the tooltip sometimes\n  // stays visible even when user doesn't hover over the element.\n  // Here we manually prevent it from displaying after user triggers transition\n  useEffect(() => {\n    setShowTooltip(\n      Boolean(\n        !isTransitioning &&\n          (!isActive ||\n            (chartNameRef.current &&\n              chartNameRef.current.scrollWidth >\n                chartNameRef.current.clientWidth)),\n      ),\n    );\n  }, [isActive, isTransitioning]);\n\n  const containerProps = useMemo(\n    () =>\n      !isActive\n        ? { role: 'button', tabIndex: 0, onClick: handleTileClick }\n        : {},\n    [handleTileClick, isActive],\n  );\n\n  let tooltipTitle: string | null = null;\n  if (showTooltip) {\n    tooltipTitle = isRendered\n      ? t('Currently rendered: %s', chartName)\n      : chartName;\n  }\n  return (\n    <Tooltip\n      title={tooltipTitle}\n      onVisibleChange={visible => setTooltipVisible(visible)}\n      visible={tooltipVisible && !isTransitioning}\n      placement=\"top\"\n      mouseEnterDelay={0.4}\n    >\n      <div\n        {...containerProps}\n        css={css`\n          display: flex;\n          align-items: center;\n          text-transform: uppercase;\n\n          color: ${theme.colors.grayscale.base};\n          font-weight: ${theme.typography.weights.bold};\n          border-radius: 6px;\n          white-space: nowrap;\n          overflow: hidden;\n          max-width: fit-content;\n\n          ${!isActive &&\n          css`\n            flex-shrink: 0;\n            width: ${theme.gridUnit * 6}px;\n            background-color: transparent;\n            transition: none;\n            &:hover svg path {\n              fill: ${theme.colors.primary.base};\n              transition: fill ${theme.transitionTiming}s ease-out;\n            }\n          `}\n\n          ${isActive &&\n          css`\n            width: 100%;\n            background-color: ${theme.colors.grayscale.light4};\n            transition: width ${TILE_TRANSITION_TIME}s ease-out,\n              background-color ${TILE_TRANSITION_TIME}s ease-out;\n            cursor: default;\n            svg path {\n              fill: ${theme.colors.primary.base};\n            }\n          `}\n        `}\n      >\n        {vizMeta.icon}{' '}\n        <span\n          css={css`\n            overflow: hidden;\n            text-overflow: ellipsis;\n            min-width: 0;\n            padding-right: ${theme.gridUnit}px;\n          `}\n          ref={chartNameRef}\n        >\n          {chartName}\n        </span>\n      </div>\n    </Tooltip>\n  );\n};\n\nexport const FastVizSwitcher = React.memo(\n  ({ currentSelection, onChange }: FastVizSwitcherProps) => {\n    const currentViz = useSelector<ExplorePageState, string | undefined>(\n      state =>\n        state.charts?.[getChartKey(state.explore)]?.latestQueryFormData\n          ?.viz_type,\n    );\n    const vizTiles = useMemo(() => {\n      const vizTiles = [...FEATURED_CHARTS];\n      if (\n        currentSelection &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentSelection,\n        ) &&\n        currentSelection !== currentViz\n      ) {\n        vizTiles.unshift({\n          name: currentSelection,\n          icon: (\n            <Icons.MonitorOutlined {...antdIconProps} aria-label=\"monitor\" />\n          ),\n        });\n      }\n      if (\n        currentViz &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentViz,\n        )\n      ) {\n        vizTiles.unshift({\n          name: currentViz,\n          icon: (\n            <Icons.CheckSquareOutlined\n              {...antdIconProps}\n              aria-label=\"check-square\"\n            />\n          ),\n        });\n      }\n      return vizTiles;\n    }, [currentSelection, currentViz]);\n\n    return (\n      <div\n        css={(theme: SupersetTheme) => css`\n          display: flex;\n          justify-content: space-between;\n          column-gap: ${theme.gridUnit}px;\n        `}\n        data-test=\"fast-viz-switcher\"\n      >\n        {vizTiles.map(vizMeta => (\n          <VizTile\n            vizMeta={vizMeta}\n            isActive={currentSelection === vizMeta.name}\n            isRendered={currentViz === vizMeta.name}\n            onTileClick={onChange}\n            key={vizMeta.name}\n          />\n        ))}\n      </div>\n    );\n  },\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport {\n  css,\n  t,\n  getChartMetadataRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { noOp } from 'src/utils/common';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from './VizTypeGallery';\nimport { FastVizSwitcher } from './FastVizSwitcher';\n\ninterface VizTypeControlProps {\n  description?: string;\n  label?: string;\n  name: string;\n  onChange: (vizType: string | null) => void;\n  value: string | null;\n  isModalOpenInit?: boolean;\n}\n\nconst bootstrapData = getBootstrapData();\nconst denyList: string[] = bootstrapData.common.conf.VIZ_TYPE_DENYLIST || [];\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }: { vizType: string }) {\n  const state = usePluginContext();\n  if (state.loading || metadataRegistry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div\n      className=\"text-danger\"\n      css={(theme: SupersetTheme) =>\n        css`\n          margin-top: ${theme.gridUnit}px;\n        `\n      }\n    >\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst UnpaddedModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\n/** Manages the viz type and the viz picker modal */\nconst VizTypeControl = ({\n  value: initialValue,\n  onChange = noOp,\n  isModalOpenInit,\n}: VizTypeControlProps) => {\n  const [showModal, setShowModal] = useState(!!isModalOpenInit);\n  // a trick to force re-initialization of the gallery each time the modal opens,\n  // ensuring that the modal always opens to the correct category.\n  const [modalKey, setModalKey] = useState(0);\n  const [selectedViz, setSelectedViz] = useState<string | null>(initialValue);\n\n  const openModal = useCallback(() => {\n    setShowModal(true);\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    onChange(selectedViz);\n    setShowModal(false);\n  }, [selectedViz, onChange]);\n\n  const onCancel = useCallback(() => {\n    setShowModal(false);\n    setModalKey(key => key + 1);\n    // make sure the modal re-opens to the last submitted viz\n    setSelectedViz(initialValue);\n  }, [initialValue]);\n\n  return (\n    <>\n      <div\n        css={(theme: SupersetTheme) => css`\n          min-width: ${theme.gridUnit * 72}px;\n          max-width: fit-content;\n        `}\n      >\n        <FastVizSwitcher onChange={onChange} currentSelection={initialValue} />\n        {initialValue && <VizSupportValidation vizType={initialValue} />}\n      </div>\n      <div\n        css={(theme: SupersetTheme) =>\n          css`\n            display: flex;\n            justify-content: flex-end;\n            margin-top: ${theme.gridUnit * 3}px;\n            color: ${theme.colors.grayscale.base};\n            text-decoration: underline;\n          `\n        }\n      >\n        <span role=\"button\" tabIndex={0} onClick={openModal}>\n          {t('View all charts')}\n        </span>\n      </div>\n      <UnpaddedModal\n        show={showModal}\n        onHide={onCancel}\n        title={t('Select a visualization type')}\n        primaryButtonName={t('Select')}\n        disablePrimaryButton={!selectedViz}\n        onHandledPrimaryAction={onSubmit}\n        maxWidth={`${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px`}\n        responsive\n      >\n        {/* When the key increments, it forces react to re-init the gallery component */}\n        <VizTypeGallery\n          key={modalKey}\n          selectedViz={selectedViz}\n          onChange={setSelectedViz}\n          onDoubleClick={onSubmit}\n          denyList={denyList}\n        />\n      </UnpaddedModal>\n    </>\n  );\n};\n\nexport default VizTypeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\n\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst STYLE_ROW = { marginTop: '5px', minHeight: '30px' };\nconst STYLE_RALIGN = { textAlign: 'right' };\n\nconst propTypes = {\n  label: PropTypes.string.isRequired,\n  tooltip: PropTypes.string,\n  control: PropTypes.node.isRequired,\n  isCheckbox: PropTypes.bool,\n};\n\nconst defaultProps = {\n  tooltip: null,\n  isCheckbox: false,\n};\n\nexport default function FormRow({ label, tooltip, control, isCheckbox }) {\n  const labelAndTooltip = (\n    <span>\n      {label}{' '}\n      {tooltip && (\n        <InfoTooltipWithTrigger\n          placement=\"top\"\n          label={label}\n          tooltip={tooltip}\n        />\n      )}\n    </span>\n  );\n  if (isCheckbox) {\n    return (\n      <Row style={STYLE_ROW} gutter={16}>\n        <Col xs={24} md={8} style={STYLE_RALIGN}>\n          {control}\n        </Col>\n        <Col xs={24} md={16}>\n          {labelAndTooltip}\n        </Col>\n      </Row>\n    );\n  }\n  return (\n    <Row style={STYLE_ROW} gutter={16}>\n      <Col xs={24} md={8} style={STYLE_RALIGN}>\n        {labelAndTooltip}\n      </Col>\n      <Col xs={24} md={16}>\n        {control}\n      </Col>\n    </Row>\n  );\n}\nFormRow.propTypes = propTypes;\nFormRow.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport FormRow from 'src/components/FormRow';\nimport { Select } from 'src/components';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst INTEGRAL_TYPES = new Set([\n  'TINYINT',\n  'SMALLINT',\n  'INT',\n  'INTEGER',\n  'BIGINT',\n  'LONG',\n]);\nconst DECIMAL_TYPES = new Set([\n  'FLOAT',\n  'DOUBLE',\n  'REAL',\n  'NUMERIC',\n  'DECIMAL',\n  'MONEY',\n]);\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false,\n};\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue,\n    } = props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n        col => col.column_name === selectedColumnName,\n      );\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      <div>\n        <FormRow\n          label={t('Column')}\n          control={\n            <Select\n              ariaLabel={t('Column')}\n              value={this.state.column}\n              name=\"column\"\n              options={this.props.datasource.columns\n                .filter(col => col.column_name !== this.state.column)\n                .map(col => ({\n                  value: col.column_name,\n                  label: col.column_name,\n                }))\n                .concat([\n                  { value: this.state.column, label: this.state.column },\n                ])}\n              onChange={v => this.onControlChange('column', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Label')}\n          control={\n            <TextControl\n              value={this.state.label}\n              name=\"label\"\n              onChange={v => this.onControlChange('label', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Default')}\n          tooltip={t(\n            '(optional) default value for the filter, when using ' +\n              'the multiple option, you can use a semicolon-delimited list ' +\n              'of options.',\n          )}\n          control={\n            <TextControl\n              value={this.state.defaultValue}\n              name=\"defaultValue\"\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort metric')}\n          tooltip={t('Metric to sort the results by')}\n          control={\n            <Select\n              ariaLabel={t('Sort metric')}\n              value={this.state.metric}\n              name=\"column\"\n              options={this.props.datasource.metrics\n                .filter(m => m.metric_name !== this.state.metric)\n                .map(m => ({\n                  value: m.metric_name,\n                  label: m.metric_name,\n                }))\n                .concat([\n                  { value: this.state.metric, label: this.state.metric },\n                ])}\n              onChange={v => this.onControlChange('metric', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort ascending')}\n          tooltip={t('Check for sorting ascending')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.asc}\n              onChange={v => this.onControlChange('asc', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Allow multiple selections')}\n          isCheckbox\n          tooltip={t(\n            'Multiple selections allowed, otherwise filter ' +\n              'is limited to a single value',\n          )}\n          control={\n            <CheckboxControl\n              value={this.state.multiple}\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Search all filter options')}\n          tooltip={t(\n            'By default, each filter loads at most 1000 choices at the initial page load. ' +\n              'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n              'searching that loads filter values as users type (may add stress to your database).',\n          )}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.searchAllOptions}\n              onChange={v =>\n                this.onControlChange(\n                  FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n                  v,\n                )\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Required')}\n          tooltip={t('User must select a value for this filter')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={!this.state.clearable}\n              onChange={v => this.onControlChange('clearable', !v)}\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={STYLE_WIDTH}>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span data-test=\"FilterBoxItemControl\">\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title={t('Filter configuration')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode } from 'react';\nimport { PopoverProps } from 'antd/lib/popover';\nimport { ControlComponentProps } from '@superset-ui/chart-controls';\n\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '≥',\n  LESS_OR_EQUAL = '≤',\n  EQUAL = '=',\n  NOT_EQUAL = '≠',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = '≤ x ≤',\n  BETWEEN_OR_LEFT_EQUAL = '≤ x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ≤',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ConditionalFormattingControlProps = ControlComponentProps<\n  ConditionalFormattingConfig[]\n> & {\n  columnOptions: { label: string; value: string }[];\n  verboseMap: Record<string, string>;\n  label: string;\n  description: string;\n};\n\nexport type FormattingPopoverProps = PopoverProps & {\n  columns: { label: string; value: string }[];\n  onChange: (value: ConditionalFormattingConfig) => void;\n  config?: ConditionalFormattingConfig;\n  title: string;\n  children: ReactNode;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { Form, FormItem, FormProps } from 'src/components/Form';\nimport Select from 'src/components/Select/Select';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  MULTIPLE_VALUE_COMPARATORS,\n} from './types';\n\nconst FullWidthInputNumber = styled(InputNumber)`\n  width: 100%;\n`;\n\nconst JustifyEnd = styled.div`\n  display: flex;\n  justify-content: flex-end;\n`;\n\nconst colorSchemeOptions = (theme: SupersetTheme) => [\n  { value: theme.colors.success.light1, label: t('green') },\n  { value: theme.colors.alert.light1, label: t('yellow') },\n  { value: theme.colors.error.light1, label: t('red') },\n];\n\nconst operatorOptions = [\n  { value: COMPARATOR.NONE, label: t('None') },\n  { value: COMPARATOR.GREATER_THAN, label: '>' },\n  { value: COMPARATOR.LESS_THAN, label: '<' },\n  { value: COMPARATOR.GREATER_OR_EQUAL, label: '≥' },\n  { value: COMPARATOR.LESS_OR_EQUAL, label: '≤' },\n  { value: COMPARATOR.EQUAL, label: '=' },\n  { value: COMPARATOR.NOT_EQUAL, label: '≠' },\n  { value: COMPARATOR.BETWEEN, label: '< x <' },\n  { value: COMPARATOR.BETWEEN_OR_EQUAL, label: '≤ x ≤' },\n  { value: COMPARATOR.BETWEEN_OR_LEFT_EQUAL, label: '≤ x <' },\n  { value: COMPARATOR.BETWEEN_OR_RIGHT_EQUAL, label: '< x ≤' },\n];\n\nconst targetValueValidator =\n  (\n    compare: (targetValue: number, compareValue: number) => boolean,\n    rejectMessage: string,\n  ) =>\n  (targetValue: number | string) =>\n  (_: any, compareValue: number | string) => {\n    if (\n      !targetValue ||\n      !compareValue ||\n      compare(Number(targetValue), Number(compareValue))\n    ) {\n      return Promise.resolve();\n    }\n    return Promise.reject(new Error(rejectMessage));\n  };\n\nconst targetValueLeftValidator = targetValueValidator(\n  (target: number, val: number) => target > val,\n  t('This value should be smaller than the right target value'),\n);\n\nconst targetValueRightValidator = targetValueValidator(\n  (target: number, val: number) => target < val,\n  t('This value should be greater than the left target value'),\n);\n\nconst isOperatorMultiValue = (operator?: COMPARATOR) =>\n  operator && MULTIPLE_VALUE_COMPARATORS.includes(operator);\n\nconst isOperatorNone = (operator?: COMPARATOR) =>\n  !operator || operator === COMPARATOR.NONE;\n\nconst rulesRequired = [{ required: true, message: t('Required') }];\n\ntype GetFieldValue = Pick<Required<FormProps>['form'], 'getFieldValue'>;\nconst rulesTargetValueLeft = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueLeftValidator(getFieldValue('targetValueRight')),\n  }),\n];\n\nconst rulesTargetValueRight = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueRightValidator(getFieldValue('targetValueLeft')),\n  }),\n];\n\nconst targetValueLeftDeps = ['targetValueRight'];\nconst targetValueRightDeps = ['targetValueLeft'];\n\nconst shouldFormItemUpdate = (\n  prevValues: ConditionalFormattingConfig,\n  currentValues: ConditionalFormattingConfig,\n) =>\n  isOperatorNone(prevValues.operator) !==\n    isOperatorNone(currentValues.operator) ||\n  isOperatorMultiValue(prevValues.operator) !==\n    isOperatorMultiValue(currentValues.operator);\n\nconst operatorField = (\n  <FormItem\n    name=\"operator\"\n    label={t('Operator')}\n    rules={rulesRequired}\n    initialValue={operatorOptions[0].value}\n  >\n    <Select ariaLabel={t('Operator')} options={operatorOptions} />\n  </FormItem>\n);\n\nconst renderOperatorFields = ({ getFieldValue }: GetFieldValue) =>\n  isOperatorNone(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n    </Row>\n  ) : isOperatorMultiValue(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueLeft\"\n          label={t('Left value')}\n          rules={rulesTargetValueLeft}\n          dependencies={targetValueLeftDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueRight\"\n          label={t('Right value')}\n          rules={rulesTargetValueRight}\n          dependencies={targetValueRightDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  ) : (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={18}>\n        <FormItem\n          name=\"targetValue\"\n          label={t('Target value')}\n          rules={rulesRequired}\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  );\n\nexport const FormattingPopoverContent = ({\n  config,\n  onChange,\n  columns = [],\n}: {\n  config?: ConditionalFormattingConfig;\n  onChange: (config: ConditionalFormattingConfig) => void;\n  columns: { label: string; value: string }[];\n}) => {\n  const theme = useTheme();\n  const colorScheme = colorSchemeOptions(theme);\n  return (\n    <Form\n      onFinish={onChange}\n      initialValues={config}\n      requiredMark=\"optional\"\n      layout=\"vertical\"\n    >\n      <Row gutter={12}>\n        <Col span={12}>\n          <FormItem\n            name=\"column\"\n            label={t('Column')}\n            rules={rulesRequired}\n            initialValue={columns[0]?.value}\n          >\n            <Select ariaLabel={t('Select column')} options={columns} />\n          </FormItem>\n        </Col>\n        <Col span={12}>\n          <FormItem\n            name=\"colorScheme\"\n            label={t('Color scheme')}\n            rules={rulesRequired}\n            initialValue={colorScheme[0].value}\n          >\n            <Select ariaLabel={t('Color scheme')} options={colorScheme} />\n          </FormItem>\n        </Col>\n      </Row>\n      <FormItem noStyle shouldUpdate={shouldFormItemUpdate}>\n        {renderOperatorFields}\n      </FormItem>\n      <FormItem>\n        <JustifyEnd>\n          <Button htmlType=\"submit\" buttonStyle=\"primary\">\n            {t('Apply')}\n          </Button>\n        </JustifyEnd>\n      </FormItem>\n    </Form>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport Popover from 'src/components/Popover';\nimport { FormattingPopoverContent } from './FormattingPopoverContent';\nimport { ConditionalFormattingConfig, FormattingPopoverProps } from './types';\n\nexport const FormattingPopover = ({\n  title,\n  columns,\n  onChange,\n  config,\n  children,\n  ...props\n}: FormattingPopoverProps) => {\n  const [visible, setVisible] = useState(false);\n\n  const handleSave = useCallback(\n    (newConfig: ConditionalFormattingConfig) => {\n      setVisible(false);\n      onChange(newConfig);\n    },\n    [onChange],\n  );\n\n  return (\n    <Popover\n      title={title}\n      content={\n        <FormattingPopoverContent\n          onChange={handleSave}\n          config={config}\n          columns={columns}\n        />\n      }\n      visible={visible}\n      onVisibleChange={setVisible}\n      trigger={['click']}\n      overlayStyle={{ width: '450px' }}\n      {...props}\n    >\n      {children}\n    </Popover>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { styled, css, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { useComponentDidUpdate } from 'src/hooks/useComponentDidUpdate';\nimport { FormattingPopover } from './FormattingPopover';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  ConditionalFormattingControlProps,\n} from './types';\nimport {\n  AddControlLabel,\n  CaretContainer,\n  Label,\n  OptionControlContainer,\n} from '../OptionControls';\n\nconst FormattersContainer = styled.div`\n  ${({ theme }) => css`\n    padding: ${theme.gridUnit}px;\n    border: solid 1px ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n  `}\n`;\n\nexport const FormatterContainer = styled(OptionControlContainer)`\n  &,\n  & > div {\n    margin-bottom: ${({ theme }) => theme.gridUnit}px;\n    :last-child {\n      margin-bottom: 0;\n    }\n  }\n`;\n\nexport const CloseButton = styled.button`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.light1};\n    height: 100%;\n    width: ${theme.gridUnit * 6}px;\n    border: none;\n    border-right: solid 1px ${theme.colors.grayscale.dark2}0C;\n    padding: 0;\n    outline: none;\n    border-bottom-left-radius: 3px;\n    border-top-left-radius: 3px;\n  `}\n`;\n\nconst ConditionalFormattingControl = ({\n  value,\n  onChange,\n  columnOptions,\n  verboseMap,\n  ...props\n}: ConditionalFormattingControlProps) => {\n  const theme = useTheme();\n  const [conditionalFormattingConfigs, setConditionalFormattingConfigs] =\n    useState<ConditionalFormattingConfig[]>(value ?? []);\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(conditionalFormattingConfigs);\n    }\n  }, [conditionalFormattingConfigs, onChange]);\n\n  // remove formatter when corresponding column is removed from controls\n  const removeFormattersWhenColumnsChange = useCallback(() => {\n    const newFormattingConfigs = conditionalFormattingConfigs.filter(config =>\n      columnOptions.some(option => option?.value === config?.column),\n    );\n    if (\n      newFormattingConfigs.length !== conditionalFormattingConfigs.length &&\n      onChange\n    ) {\n      setConditionalFormattingConfigs(newFormattingConfigs);\n      onChange(newFormattingConfigs);\n    }\n  }, [JSON.stringify(columnOptions)]);\n  useComponentDidUpdate(removeFormattersWhenColumnsChange);\n\n  const onDelete = (index: number) => {\n    setConditionalFormattingConfigs(prevConfigs =>\n      prevConfigs.filter((_, i) => i !== index),\n    );\n  };\n\n  const onSave = (config: ConditionalFormattingConfig) => {\n    setConditionalFormattingConfigs(prevConfigs => [...prevConfigs, config]);\n  };\n\n  const onEdit = (newConfig: ConditionalFormattingConfig, index: number) => {\n    const newConfigs = [...conditionalFormattingConfigs];\n    newConfigs.splice(index, 1, newConfig);\n    setConditionalFormattingConfigs(newConfigs);\n  };\n\n  const createLabel = ({\n    column,\n    operator,\n    targetValue,\n    targetValueLeft,\n    targetValueRight,\n  }: ConditionalFormattingConfig) => {\n    const columnName = (column && verboseMap?.[column]) ?? column;\n    switch (operator) {\n      case COMPARATOR.NONE:\n        return `${columnName}`;\n      case COMPARATOR.BETWEEN:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_LEFT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_RIGHT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      default:\n        return `${columnName} ${operator} ${targetValue}`;\n    }\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <FormattersContainer>\n        {conditionalFormattingConfigs.map((config, index) => (\n          <FormatterContainer key={index}>\n            <CloseButton onClick={() => onDelete(index)}>\n              <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n            </CloseButton>\n            <FormattingPopover\n              title={t('Edit formatter')}\n              config={config}\n              columns={columnOptions}\n              onChange={(newConfig: ConditionalFormattingConfig) =>\n                onEdit(newConfig, index)\n              }\n              destroyTooltipOnHide\n            >\n              <OptionControlContainer withCaret>\n                <Label>{createLabel(config)}</Label>\n                <CaretContainer>\n                  <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n                </CaretContainer>\n              </OptionControlContainer>\n            </FormattingPopover>\n          </FormatterContainer>\n        ))}\n        <FormattingPopover\n          title={t('Add new formatter')}\n          columns={columnOptions}\n          onChange={onSave}\n          destroyTooltipOnHide\n        >\n          <AddControlLabel>\n            <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n            {t('Add new color formatter')}\n          </AddControlLabel>\n        </FormattingPopover>\n      </FormattersContainer>\n    </div>\n  );\n};\n\nexport default ConditionalFormattingControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useMemo } from 'react';\nimport { useDrop } from 'react-dnd';\nimport { t, useTheme } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport {\n  AddControlLabel,\n  DndLabelsContainer,\n  HeaderContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n} from 'src/explore/components/DatasourcePanel/types';\nimport Icons from 'src/components/Icons';\nimport { DndItemType } from '../../DndItemType';\n\nexport type DndSelectLabelProps = {\n  name: string;\n  accept: DndItemType | DndItemType[];\n  ghostButtonText?: string;\n  onDrop: (item: DatasourcePanelDndItem) => void;\n  canDrop: (item: DatasourcePanelDndItem) => boolean;\n  canDropValue?: (value: DndItemValue) => boolean;\n  onDropValue?: (value: DndItemValue) => void;\n  valuesRenderer: () => ReactNode;\n  displayGhostButton?: boolean;\n  onClickGhostButton?: () => void;\n};\n\nexport default function DndSelectLabel({\n  displayGhostButton = true,\n  accept,\n  valuesRenderer,\n  ...props\n}: DndSelectLabelProps) {\n  const theme = useTheme();\n\n  const [{ isOver, canDrop }, datasourcePanelDrop] = useDrop({\n    accept,\n\n    drop: (item: DatasourcePanelDndItem) => {\n      props.onDrop(item);\n      props.onDropValue?.(item.value);\n    },\n\n    canDrop: (item: DatasourcePanelDndItem) =>\n      props.canDrop(item) && (props.canDropValue?.(item.value) ?? true),\n\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n      type: monitor.getItemType(),\n    }),\n  });\n\n  const values = useMemo(() => valuesRenderer(), [valuesRenderer]);\n\n  function renderGhostButton() {\n    return (\n      <AddControlLabel\n        cancelHover={!props.onClickGhostButton}\n        onClick={props.onClickGhostButton}\n      >\n        <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n        {t(props.ghostButtonText || 'Drop columns here')}\n      </AddControlLabel>\n    );\n  }\n\n  return (\n    <div ref={datasourcePanelDrop}>\n      <HeaderContainer>\n        <ControlHeader {...props} />\n      </HeaderContainer>\n      <DndLabelsContainer\n        data-test=\"dnd-labels-container\"\n        canDrop={canDrop}\n        isOver={isOver}\n      >\n        {values}\n        {displayGhostButton && renderGhostButton()}\n      </DndLabelsContainer>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport {\n  CaretContainer,\n  CloseContainer,\n  OptionControlContainer,\n  Label,\n} from 'src/explore/components/controls/OptionControls';\nimport { OptionProps } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport default function Option({\n  children,\n  index,\n  clickClose,\n  withCaret,\n  isExtra,\n  datasourceWarningMessage,\n  canDelete = true,\n}: OptionProps) {\n  const theme = useTheme();\n  const onClickClose = useCallback(\n    e => {\n      e.stopPropagation();\n      clickClose(index);\n    },\n    [clickClose, index],\n  );\n  return (\n    <OptionControlContainer data-test=\"option-label\" withCaret={withCaret}>\n      {canDelete && (\n        <CloseContainer\n          role=\"button\"\n          data-test=\"remove-control-button\"\n          onClick={onClickClose}\n        >\n          <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n        </CloseContainer>\n      )}\n      <Label data-test=\"control-label\">{children}</Label>\n      {(!!datasourceWarningMessage || isExtra) && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={\n            datasourceWarningMessage ||\n            t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)\n          }\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport {\n  useDrag,\n  useDrop,\n  DropTargetMonitor,\n  DragSourceMonitor,\n} from 'react-dnd';\nimport { DragContainer } from 'src/explore/components/controls/OptionControls';\nimport {\n  OptionProps,\n  OptionItemInterface,\n} from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport { styled, isAdhocColumn } from '@superset-ui/core';\nimport { ColumnMeta } from '@superset-ui/chart-controls';\nimport Option from './Option';\n\nexport const OptionLabel = styled.div`\n  width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nexport default function OptionWrapper(\n  props: OptionProps & {\n    type: string;\n    onShiftOptions: (dragIndex: number, hoverIndex: number) => void;\n  },\n) {\n  const {\n    index,\n    label,\n    tooltipTitle,\n    column,\n    type,\n    onShiftOptions,\n    clickClose,\n    withCaret,\n    isExtra,\n    datasourceWarningMessage,\n    canDelete = true,\n    ...rest\n  } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      dragIndex: index,\n    },\n    collect: (monitor: DragSourceMonitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const [, drop] = useDrop({\n    accept: type,\n\n    hover: (item: OptionItemInterface, monitor: DropTargetMonitor) => {\n      if (!ref.current) {\n        return;\n      }\n      const { dragIndex } = item;\n      const hoverIndex = index;\n\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset\n        ? clientOffset.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n\n      // Time to actually perform the action\n      onShiftOptions(dragIndex, hoverIndex);\n      // eslint-disable-next-line no-param-reassign\n      item.dragIndex = hoverIndex;\n    },\n  });\n\n  const shouldShowTooltip =\n    (!isDragging && tooltipTitle && label && tooltipTitle !== label) ||\n    (!isDragging &&\n      labelRef &&\n      labelRef.current &&\n      labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n  const LabelContent = () => {\n    if (!shouldShowTooltip) {\n      return <span>{label}</span>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <span>{label}</span>\n      </Tooltip>\n    );\n  };\n\n  const ColumnOption = () => {\n    const transformedCol =\n      column && isAdhocColumn(column)\n        ? { verbose_name: column.label, expression: column.sqlExpression }\n        : column;\n    return (\n      <StyledColumnOption\n        column={transformedCol as ColumnMeta}\n        labelRef={labelRef}\n        showType\n      />\n    );\n  };\n\n  const Label = () => {\n    if (label) {\n      return (\n        <OptionLabel ref={labelRef}>\n          <LabelContent />\n        </OptionLabel>\n      );\n    }\n    if (column) {\n      return (\n        <OptionLabel>\n          <ColumnOption />\n        </OptionLabel>\n      );\n    }\n    return null;\n  };\n\n  drag(drop(ref));\n\n  return (\n    <DragContainer ref={ref} {...rest}>\n      <Option\n        index={index}\n        clickClose={clickClose}\n        withCaret={withCaret}\n        isExtra={isExtra}\n        datasourceWarningMessage={datasourceWarningMessage}\n        canDelete={canDelete}\n      >\n        <Label />\n      </Option>\n    </DragContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport {\n  AdhocColumn,\n  ensureIsArray,\n  QueryFormColumn,\n  isPhysicalColumn,\n} from '@superset-ui/core';\n\nconst getColumnNameOrAdhocColumn = (\n  column: ColumnMeta | AdhocColumn,\n): QueryFormColumn => {\n  if (isColumnMeta(column)) {\n    return column.column_name;\n  }\n  return column as AdhocColumn;\n};\n\nexport class OptionSelector {\n  values: (ColumnMeta | AdhocColumn)[];\n\n  options: Record<string, ColumnMeta>;\n\n  multi: boolean;\n\n  constructor(\n    options: Record<string, ColumnMeta>,\n    multi: boolean,\n    initialValues?: QueryFormColumn[] | QueryFormColumn | null,\n  ) {\n    this.options = options;\n    this.multi = multi;\n    this.values = ensureIsArray(initialValues)\n      .map(value => {\n        if (value && isPhysicalColumn(value) && value in options) {\n          return options[value];\n        }\n        if (!isPhysicalColumn(value)) {\n          return value;\n        }\n        return null;\n      })\n      .filter(Boolean) as ColumnMeta[];\n  }\n\n  add(value: QueryFormColumn) {\n    if (isPhysicalColumn(value) && value in this.options) {\n      this.values.push(this.options[value]);\n    } else if (!isPhysicalColumn(value)) {\n      this.values.push(value as AdhocColumn);\n    }\n  }\n\n  del(idx: number) {\n    this.values.splice(idx, 1);\n  }\n\n  replace(idx: number, value: QueryFormColumn) {\n    if (this.values[idx]) {\n      this.values[idx] = isPhysicalColumn(value) ? this.options[value] : value;\n    }\n  }\n\n  swap(a: number, b: number) {\n    [this.values[a], this.values[b]] = [this.values[b], this.values[a]];\n  }\n\n  has(value: QueryFormColumn): boolean {\n    return this.values.some(col => {\n      if (isPhysicalColumn(value)) {\n        return (\n          (col as ColumnMeta).column_name === value ||\n          (col as AdhocColumn).label === value\n        );\n      }\n      return (\n        (col as ColumnMeta).column_name === value.label ||\n        (col as AdhocColumn).label === value.label\n      );\n    });\n  }\n\n  getValues(): QueryFormColumn[] | QueryFormColumn | undefined {\n    if (!this.multi) {\n      return this.values.length > 0\n        ? getColumnNameOrAdhocColumn(this.values[0])\n        : undefined;\n    }\n    return this.values.map(getColumnNameOrAdhocColumn);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React, {\n  Dispatch,\n  SetStateAction,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport {\n  AdhocColumn,\n  isAdhocColumn,\n  t,\n  styled,\n  css,\n  DatasourceType,\n} from '@superset-ui/core';\nimport { ColumnMeta, isSavedExpression } from '@superset-ui/chart-controls';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\n\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  UNRESIZABLE_POPOVER_WIDTH,\n} from 'src/explore/constants';\nimport { ExplorePageState } from 'src/explore/types';\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\ninterface ColumnSelectPopoverProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onChange: (column: ColumnMeta | AdhocColumn) => void;\n  onClose: () => void;\n  setLabel: (title: string) => void;\n  getCurrentTab: (tab: string) => void;\n  label: string;\n  isTemporal?: boolean;\n  setDatasetModal?: Dispatch<SetStateAction<boolean>>;\n}\n\nconst getInitialColumnValues = (\n  editedColumn?: ColumnMeta | AdhocColumn,\n): [AdhocColumn?, ColumnMeta?, ColumnMeta?] => {\n  if (!editedColumn) {\n    return [undefined, undefined, undefined];\n  }\n  if (isAdhocColumn(editedColumn)) {\n    return [editedColumn, undefined, undefined];\n  }\n  if (isSavedExpression(editedColumn)) {\n    return [undefined, editedColumn, undefined];\n  }\n  return [undefined, undefined, editedColumn];\n};\n\nconst ColumnSelectPopover = ({\n  columns,\n  editedColumn,\n  onChange,\n  onClose,\n  setDatasetModal,\n  setLabel,\n  getCurrentTab,\n  label,\n  isTemporal,\n}: ColumnSelectPopoverProps) => {\n  const datasourceType = useSelector<ExplorePageState, string | undefined>(\n    state => state.explore.datasource.type,\n  );\n  const [initialLabel] = useState(label);\n  const [initialAdhocColumn, initialCalculatedColumn, initialSimpleColumn] =\n    getInitialColumnValues(editedColumn);\n\n  const [adhocColumn, setAdhocColumn] = useState<AdhocColumn | undefined>(\n    initialAdhocColumn,\n  );\n  const [selectedCalculatedColumn, setSelectedCalculatedColumn] = useState<\n    ColumnMeta | undefined\n  >(initialCalculatedColumn);\n  const [selectedSimpleColumn, setSelectedSimpleColumn] = useState<\n    ColumnMeta | undefined\n  >(initialSimpleColumn);\n\n  const sqlEditorRef = useRef(null);\n\n  const [calculatedColumns, simpleColumns] = useMemo(\n    () =>\n      columns?.reduce(\n        (acc: [ColumnMeta[], ColumnMeta[]], column: ColumnMeta) => {\n          if (column.expression) {\n            acc[0].push(column);\n          } else {\n            acc[1].push(column);\n          }\n          return acc;\n        },\n        [[], []],\n      ),\n    [columns],\n  );\n\n  const onSqlExpressionChange = useCallback(\n    sqlExpression => {\n      setAdhocColumn({ label, sqlExpression, expressionType: 'SQL' });\n      setSelectedSimpleColumn(undefined);\n      setSelectedCalculatedColumn(undefined);\n    },\n    [label],\n  );\n\n  const onCalculatedColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = calculatedColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(selectedColumn);\n      setSelectedSimpleColumn(undefined);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [calculatedColumns, setLabel],\n  );\n\n  const onSimpleColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = simpleColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(undefined);\n      setSelectedSimpleColumn(selectedColumn);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [setLabel, simpleColumns],\n  );\n\n  const defaultActiveTabKey = initialAdhocColumn\n    ? 'sqlExpression'\n    : initialSimpleColumn || calculatedColumns.length === 0\n    ? 'simple'\n    : 'saved';\n\n  useEffect(() => {\n    getCurrentTab(defaultActiveTabKey);\n  }, [defaultActiveTabKey, getCurrentTab]);\n\n  const onSave = useCallback(() => {\n    if (adhocColumn && adhocColumn.label !== label) {\n      adhocColumn.label = label;\n    }\n    const selectedColumn =\n      adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n    if (!selectedColumn) {\n      return;\n    }\n    onChange(selectedColumn);\n    onClose();\n  }, [\n    adhocColumn,\n    label,\n    onChange,\n    onClose,\n    selectedCalculatedColumn,\n    selectedSimpleColumn,\n  ]);\n\n  const onResetStateAndClose = useCallback(() => {\n    setSelectedCalculatedColumn(initialCalculatedColumn);\n    setSelectedSimpleColumn(initialSimpleColumn);\n    setAdhocColumn(initialAdhocColumn);\n    onClose();\n  }, [\n    initialAdhocColumn,\n    initialCalculatedColumn,\n    initialSimpleColumn,\n    onClose,\n  ]);\n\n  const onTabChange = useCallback(\n    tab => {\n      getCurrentTab(tab);\n      // @ts-ignore\n      sqlEditorRef.current?.editor.focus();\n    },\n    [getCurrentTab],\n  );\n\n  const onSqlEditorFocus = useCallback(() => {\n    // @ts-ignore\n    sqlEditorRef.current?.editor.resize();\n  }, []);\n\n  const setDatasetAndClose = () => {\n    if (setDatasetModal) {\n      setDatasetModal(true);\n    }\n    onClose();\n  };\n\n  const stateIsValid =\n    adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n  const hasUnsavedChanges =\n    initialLabel !== label ||\n    selectedCalculatedColumn?.column_name !==\n      initialCalculatedColumn?.column_name ||\n    selectedSimpleColumn?.column_name !== initialSimpleColumn?.column_name ||\n    adhocColumn?.sqlExpression !== initialAdhocColumn?.sqlExpression;\n\n  const savedExpressionsLabel = t('Saved expressions');\n  const simpleColumnsLabel = t('Column');\n\n  return (\n    <Form layout=\"vertical\" id=\"metrics-edit-popover\">\n      <Tabs\n        id=\"adhoc-metric-edit-tabs\"\n        defaultActiveKey={defaultActiveTabKey}\n        onChange={onTabChange}\n        className=\"adhoc-metric-edit-tabs\"\n        allowOverflow\n        css={css`\n          height: ${POPOVER_INITIAL_HEIGHT}px;\n          width: ${UNRESIZABLE_POPOVER_WIDTH}px;\n        `}\n      >\n        <Tabs.TabPane key=\"saved\" tab={t('Saved')}>\n          {calculatedColumns.length > 0 ? (\n            <FormItem label={savedExpressionsLabel}>\n              <StyledSelect\n                ariaLabel={savedExpressionsLabel}\n                value={selectedCalculatedColumn?.column_name}\n                onChange={onCalculatedColumnChange}\n                allowClear\n                autoFocus={!selectedCalculatedColumn}\n                placeholder={t('%s column(s)', calculatedColumns.length)}\n                options={calculatedColumns.map(calculatedColumn => ({\n                  value: calculatedColumn.column_name,\n                  label:\n                    calculatedColumn.verbose_name ||\n                    calculatedColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={calculatedColumn} showType />\n                  ),\n                  key: calculatedColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          ) : datasourceType === DatasourceType.Table ? (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={\n                isTemporal\n                  ? t('No temporal columns found')\n                  : t('No saved expressions found')\n              }\n              description={\n                isTemporal\n                  ? t(\n                      'Add calculated temporal columns to dataset in \"Edit datasource\" modal',\n                    )\n                  : t(\n                      'Add calculated columns to dataset in \"Edit datasource\" modal',\n                    )\n              }\n            />\n          ) : (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={\n                isTemporal\n                  ? t('No temporal columns found')\n                  : t('No saved expressions found')\n              }\n              description={\n                isTemporal ? (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to mark a column as a time column')}\n                  </>\n                ) : (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to add calculated columns')}\n                  </>\n                )\n              }\n            />\n          )}\n        </Tabs.TabPane>\n        <Tabs.TabPane key=\"simple\" tab={t('Simple')}>\n          {isTemporal && simpleColumns.length === 0 ? (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={t('No temporal columns found')}\n              description={\n                datasourceType === DatasourceType.Table ? (\n                  t('Mark a column as temporal in \"Edit datasource\" modal')\n                ) : (\n                  <>\n                    <span\n                      role=\"button\"\n                      tabIndex={0}\n                      onClick={setDatasetAndClose}\n                    >\n                      {t('Create a dataset')}\n                    </span>{' '}\n                    {t(' to mark a column as a time column')}\n                  </>\n                )\n              }\n            />\n          ) : (\n            <FormItem label={simpleColumnsLabel}>\n              <Select\n                ariaLabel={simpleColumnsLabel}\n                value={selectedSimpleColumn?.column_name}\n                onChange={onSimpleColumnChange}\n                allowClear\n                autoFocus={!selectedSimpleColumn}\n                placeholder={t('%s column(s)', simpleColumns.length)}\n                options={simpleColumns.map(simpleColumn => ({\n                  value: simpleColumn.column_name,\n                  label: simpleColumn.verbose_name || simpleColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={simpleColumn} showType />\n                  ),\n                  key: simpleColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          )}\n        </Tabs.TabPane>\n\n        <Tabs.TabPane key=\"sqlExpression\" tab={t('Custom SQL')}>\n          <SQLEditor\n            value={\n              adhocColumn?.sqlExpression ||\n              selectedSimpleColumn?.column_name ||\n              selectedCalculatedColumn?.expression\n            }\n            onFocus={onSqlEditorFocus}\n            showLoadingForImport\n            onChange={onSqlExpressionChange}\n            width=\"100%\"\n            height={`${POPOVER_INITIAL_HEIGHT - 80}px`}\n            showGutter={false}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n            ref={sqlEditorRef}\n          />\n        </Tabs.TabPane>\n      </Tabs>\n      <div>\n        <Button buttonSize=\"small\" onClick={onResetStateAndClose} cta>\n          {t('Close')}\n        </Button>\n        <Button\n          disabled={!stateIsValid || !hasUnsavedChanges}\n          buttonStyle=\"primary\"\n          buttonSize=\"small\"\n          onClick={onSave}\n          data-test=\"ColumnEdit#save\"\n          cta\n        >\n          {t('Save')}\n        </Button>\n      </div>\n    </Form>\n  );\n};\n\nexport default ColumnSelectPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport const DndColumnSelectPopoverTitle = ({\n  title,\n  onChange,\n  isEditDisabled,\n  hasCustomLabel,\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [isEditMode, setIsEditMode] = useState(false);\n\n  const onMouseOver = useCallback(() => {\n    setIsHovered(true);\n  }, []);\n\n  const onMouseOut = useCallback(() => {\n    setIsHovered(false);\n  }, []);\n\n  const onClick = useCallback(() => {\n    setIsEditMode(true);\n  }, []);\n\n  const onBlur = useCallback(() => {\n    setIsEditMode(false);\n  }, []);\n\n  const onInputBlur = useCallback(\n    e => {\n      if (e.target.value === '') {\n        onChange(e);\n      }\n      onBlur();\n    },\n    [onBlur, onChange],\n  );\n\n  const defaultLabel = t('My column');\n\n  if (isEditDisabled) {\n    return <span>{title || defaultLabel}</span>;\n  }\n\n  return isEditMode ? (\n    <StyledInput\n      type=\"text\"\n      placeholder={title}\n      value={hasCustomLabel ? title : ''}\n      autoFocus\n      onChange={onChange}\n      onBlur={onInputBlur}\n    />\n  ) : (\n    <Tooltip placement=\"top\" title={t('Click to edit label')}>\n      <span\n        className=\"AdhocMetricEditPopoverTitle inline-editable\"\n        data-test=\"AdhocMetricEditTitle#trigger\"\n        onMouseOver={onMouseOver}\n        onMouseOut={onMouseOut}\n        onClick={onClick}\n        onBlur={onBlur}\n        role=\"button\"\n        tabIndex={0}\n      >\n        {title || defaultLabel}\n        &nbsp;\n        <i\n          className=\"fa fa-pencil\"\n          style={{ color: isHovered ? 'black' : 'grey' }}\n        />\n      </span>\n    </Tooltip>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { AdhocColumn, t, isAdhocColumn } from '@superset-ui/core';\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport ColumnSelectPopover from './ColumnSelectPopover';\nimport { DndColumnSelectPopoverTitle } from './DndColumnSelectPopoverTitle';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\ninterface ColumnSelectPopoverTriggerProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onColumnEdit: (editedColumn: ColumnMeta | AdhocColumn) => void;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  children: React.ReactNode;\n  isTemporal?: boolean;\n}\n\nconst defaultPopoverLabel = t('My column');\nconst editableTitleTab = 'sqlExpression';\n\nconst ColumnSelectPopoverTrigger = ({\n  columns,\n  editedColumn,\n  onColumnEdit,\n  isControlledComponent,\n  children,\n  isTemporal,\n  ...props\n}: ColumnSelectPopoverTriggerProps) => {\n  // @ts-ignore\n  const datasource = useSelector(state => state.explore.datasource);\n  const [popoverLabel, setPopoverLabel] = useState(defaultPopoverLabel);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  const [isTitleEditDisabled, setIsTitleEditDisabled] = useState(true);\n  const [hasCustomLabel, setHasCustomLabel] = useState(false);\n  const [showDatasetModal, setDatasetModal] = useState(false);\n\n  let initialPopoverLabel = defaultPopoverLabel;\n  if (editedColumn && isColumnMeta(editedColumn)) {\n    initialPopoverLabel = editedColumn.verbose_name || editedColumn.column_name;\n  } else if (editedColumn && isAdhocColumn(editedColumn)) {\n    initialPopoverLabel = editedColumn.label || defaultPopoverLabel;\n  }\n\n  useEffect(() => {\n    setPopoverLabel(initialPopoverLabel);\n  }, [initialPopoverLabel, popoverVisible]);\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    setPopoverVisible(false);\n  }, []);\n\n  const { visible, handleTogglePopover, handleClosePopover } =\n    isControlledComponent\n      ? {\n          visible: props.visible,\n          handleTogglePopover: props.togglePopover!,\n          handleClosePopover: props.closePopover!,\n        }\n      : {\n          visible: popoverVisible,\n          handleTogglePopover: togglePopover,\n          handleClosePopover: closePopover,\n        };\n\n  const getCurrentTab = useCallback((tab: string) => {\n    setIsTitleEditDisabled(tab !== editableTitleTab);\n  }, []);\n\n  const overlayContent = useMemo(\n    () => (\n      <ExplorePopoverContent>\n        <ColumnSelectPopover\n          editedColumn={editedColumn}\n          columns={columns}\n          setDatasetModal={setDatasetModal}\n          onClose={handleClosePopover}\n          onChange={onColumnEdit}\n          label={popoverLabel}\n          setLabel={setPopoverLabel}\n          getCurrentTab={getCurrentTab}\n          isTemporal={isTemporal}\n        />\n      </ExplorePopoverContent>\n    ),\n    [\n      columns,\n      editedColumn,\n      getCurrentTab,\n      handleClosePopover,\n      isTemporal,\n      onColumnEdit,\n      popoverLabel,\n    ],\n  );\n\n  const onLabelChange = useCallback((e: any) => {\n    setPopoverLabel(e.target.value);\n    setHasCustomLabel(true);\n  }, []);\n\n  const popoverTitle = useMemo(\n    () => (\n      <DndColumnSelectPopoverTitle\n        title={popoverLabel}\n        onChange={onLabelChange}\n        isEditDisabled={isTitleEditDisabled}\n        hasCustomLabel={hasCustomLabel}\n      />\n    ),\n    [hasCustomLabel, isTitleEditDisabled, onLabelChange, popoverLabel],\n  );\n\n  return (\n    <>\n      {showDatasetModal && (\n        <SaveDatasetModal\n          visible={showDatasetModal}\n          onHide={() => setDatasetModal(false)}\n          buttonTextOnSave={t('Save')}\n          buttonTextOnOverwrite={t('Overwrite')}\n          modalDescription={t(\n            'Save this query as a virtual dataset to continue exploring',\n          )}\n          datasource={datasource}\n        />\n      )}\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={handleTogglePopover}\n        title={popoverTitle}\n        destroyTooltipOnHide\n      >\n        {children}\n      </ControlPopover>\n    </>\n  );\n};\n\nexport default ColumnSelectPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useMemo, useState } from 'react';\nimport {\n  AdhocColumn,\n  FeatureFlag,\n  isFeatureEnabled,\n  tn,\n  QueryFormColumn,\n  t,\n  isAdhocColumn,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isColumnMeta,\n  withDndFallback,\n} from '@superset-ui/chart-controls';\nimport { isEmpty } from 'lodash';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport OptionWrapper from 'src/explore/components/controls/DndColumnSelectControl/OptionWrapper';\nimport { OptionSelector } from 'src/explore/components/controls/DndColumnSelectControl/utils';\nimport { DatasourcePanelDndItem } from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport ColumnSelectPopoverTrigger from './ColumnSelectPopoverTrigger';\nimport { DndControlProps } from './types';\nimport SelectControl from '../SelectControl';\n\nexport type DndColumnSelectProps = DndControlProps<QueryFormColumn> & {\n  options: ColumnMeta[];\n  isTemporal?: boolean;\n};\n\nfunction DndColumnSelect(props: DndColumnSelectProps) {\n  const {\n    value,\n    options,\n    multi = true,\n    onChange,\n    canDelete = true,\n    ghostButtonText,\n    clickEnabledGhostButtonText,\n    name,\n    label,\n    isTemporal,\n  } = props;\n  const [newColumnPopoverVisible, setNewColumnPopoverVisible] = useState(false);\n\n  const optionSelector = useMemo(() => {\n    const optionsMap = Object.fromEntries(\n      options.map(option => [option.column_name, option]),\n    );\n\n    return new OptionSelector(optionsMap, multi, value);\n  }, [multi, options, value]);\n\n  const onDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const column = item.value as ColumnMeta;\n      if (!optionSelector.multi && !isEmpty(optionSelector.values)) {\n        optionSelector.replace(0, column.column_name);\n      } else {\n        optionSelector.add(column.column_name);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const columnName = (item.value as ColumnMeta).column_name;\n      return (\n        columnName in optionSelector.options && !optionSelector.has(columnName)\n      );\n    },\n    [optionSelector],\n  );\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      optionSelector.del(index);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      optionSelector.swap(dragIndex, hoverIndex);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const clickEnabled = useMemo(\n    () => isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX),\n    [],\n  );\n\n  const valuesRenderer = useCallback(\n    () =>\n      optionSelector.values.map((column, idx) => {\n        const datasourceWarningMessage =\n          isAdhocColumn(column) && column.datasourceWarning\n            ? t('This column might be incompatible with current dataset')\n            : undefined;\n        return clickEnabled ? (\n          <ColumnSelectPopoverTrigger\n            key={idx}\n            columns={options}\n            onColumnEdit={newColumn => {\n              if (isColumnMeta(newColumn)) {\n                optionSelector.replace(idx, newColumn.column_name);\n              } else {\n                optionSelector.replace(idx, newColumn as AdhocColumn);\n              }\n              onChange(optionSelector.getValues());\n            }}\n            editedColumn={column}\n            isTemporal={isTemporal}\n          >\n            <OptionWrapper\n              key={idx}\n              index={idx}\n              clickClose={onClickClose}\n              onShiftOptions={onShiftOptions}\n              type={`${DndItemType.ColumnOption}_${name}_${label}`}\n              canDelete={canDelete}\n              column={column}\n              datasourceWarningMessage={datasourceWarningMessage}\n              withCaret\n            />\n          </ColumnSelectPopoverTrigger>\n        ) : (\n          <OptionWrapper\n            key={idx}\n            index={idx}\n            clickClose={onClickClose}\n            onShiftOptions={onShiftOptions}\n            type={`${DndItemType.ColumnOption}_${name}_${label}`}\n            canDelete={canDelete}\n            column={column}\n            datasourceWarningMessage={datasourceWarningMessage}\n          />\n        );\n      }),\n    [\n      canDelete,\n      clickEnabled,\n      isTemporal,\n      label,\n      name,\n      onChange,\n      onClickClose,\n      onShiftOptions,\n      optionSelector,\n      options,\n    ],\n  );\n\n  const addNewColumnWithPopover = useCallback(\n    (newColumn: ColumnMeta | AdhocColumn) => {\n      if (isColumnMeta(newColumn)) {\n        optionSelector.add(newColumn.column_name);\n      } else {\n        optionSelector.add(newColumn as AdhocColumn);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewColumnPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const openPopover = useCallback(() => {\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const labelGhostButtonText = useMemo(() => {\n    if (clickEnabled) {\n      return (\n        clickEnabledGhostButtonText ??\n        ghostButtonText ??\n        tn(\n          'Drop a column here or click',\n          'Drop columns here or click',\n          multi ? 2 : 1,\n        )\n      );\n    }\n\n    return (\n      ghostButtonText ??\n      tn('Drop column here', 'Drop columns here', multi ? 2 : 1)\n    );\n  }, [clickEnabled, clickEnabledGhostButtonText, ghostButtonText, multi]);\n\n  return (\n    <div>\n      <DndSelectLabel\n        onDrop={onDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DndItemType.Column}\n        displayGhostButton={multi || optionSelector.values.length === 0}\n        ghostButtonText={labelGhostButtonText}\n        onClickGhostButton={clickEnabled ? openPopover : undefined}\n        {...props}\n      />\n      <ColumnSelectPopoverTrigger\n        columns={options}\n        onColumnEdit={addNewColumnWithPopover}\n        isControlledComponent\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        visible={newColumnPopoverVisible}\n        isTemporal={isTemporal}\n      >\n        <div />\n      </ColumnSelectPopoverTrigger>\n    </div>\n  );\n}\n\nconst DndColumnSelectWithFallback = withDndFallback(\n  DndColumnSelect,\n  SelectControl,\n);\n\nexport { DndColumnSelectWithFallback as DndColumnSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { OptionSortType } from 'src/explore/types';\nimport { useGetTimeRangeLabel } from 'src/explore/components/controls/FilterControl/utils';\nimport OptionWrapper from './OptionWrapper';\n\nexport interface DndAdhocFilterOptionProps {\n  adhocFilter: AdhocFilter;\n  onFilterEdit: (changedFilter: AdhocFilter) => void;\n  onClickClose: (index: number) => void;\n  onShiftOptions: (dragIndex: number, hoverIndex: number) => void;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  partitionColumn?: string;\n  index: number;\n}\n\nexport default function DndAdhocFilterOption({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onShiftOptions,\n  onClickClose,\n  partitionColumn,\n  index,\n}: DndAdhocFilterOptionProps) {\n  const { actualTimeRange, title } = useGetTimeRangeLabel(adhocFilter);\n\n  return (\n    <AdhocFilterPopoverTrigger\n      key={index}\n      adhocFilter={adhocFilter}\n      options={options}\n      datasource={datasource}\n      onFilterEdit={onFilterEdit}\n      partitionColumn={partitionColumn}\n    >\n      <OptionWrapper\n        key={index}\n        index={index}\n        label={actualTimeRange ?? adhocFilter.getDefaultLabel()}\n        tooltipTitle={title ?? adhocFilter.getTooltipTitle()}\n        clickClose={onClickClose}\n        onShiftOptions={onShiftOptions}\n        type={DndItemType.FilterOption}\n        withCaret\n        isExtra={adhocFilter.isExtra}\n        datasourceWarningMessage={\n          adhocFilter.datasourceWarning\n            ? t('This filter might be incompatible with current dataset')\n            : undefined\n        }\n      />\n    </AdhocFilterPopoverTrigger>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  FeatureFlag,\n  hasGenericChartAxes,\n  isFeatureEnabled,\n  logging,\n  Metric,\n  QueryFormData,\n  QueryFormMetric,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isColumnMeta,\n  isTemporalColumn,\n  withDndFallback,\n} from '@superset-ui/chart-controls';\nimport Modal from 'src/components/Modal';\nimport {\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  Operators,\n} from 'src/explore/constants';\nimport { Datasource, OptionSortType } from 'src/explore/types';\nimport { OptionValueType } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport AdhocFilter, {\n  CLAUSES,\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n  isSavedMetric,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport { ControlComponentProps } from 'src/explore/components/Control';\nimport AdhocFilterControl from '../FilterControl/AdhocFilterControl';\nimport DndAdhocFilterOption from './DndAdhocFilterOption';\nimport { useDefaultTimeFilter } from '../DateFilterControl/utils';\n\nconst { warning } = Modal;\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [\n  DndItemType.Column,\n  DndItemType.Metric,\n  DndItemType.MetricOption,\n  DndItemType.AdhocMetricOption,\n];\n\nconst isDictionaryForAdhocFilter = (value: OptionValueType) =>\n  !(value instanceof AdhocFilter) && value?.expressionType;\n\nexport interface DndFilterSelectProps\n  extends ControlComponentProps<OptionValueType[]> {\n  columns: ColumnMeta[];\n  savedMetrics: Metric[];\n  selectedMetrics: QueryFormMetric[];\n  datasource: Datasource;\n  canDelete?: (\n    valueToBeDeleted: OptionValueType,\n    values: OptionValueType[],\n  ) => true | string;\n}\n\nconst DndFilterSelect = (props: DndFilterSelectProps) => {\n  const {\n    datasource,\n    onChange = () => {},\n    name: controlName,\n    canDelete,\n  } = props;\n\n  const propsValues = Array.from(props.value ?? []);\n  const [values, setValues] = useState(\n    propsValues.map((filter: OptionValueType) =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    ),\n  );\n  const [partitionColumn, setPartitionColumn] = useState(undefined);\n  const [newFilterPopoverVisible, setNewFilterPopoverVisible] = useState(false);\n  const [droppedItem, setDroppedItem] = useState<\n    DndItemValue | typeof EMPTY_OBJECT\n  >({});\n\n  const optionsForSelect = (\n    columns: ColumnMeta[],\n    formData: QueryFormData | null | undefined,\n  ) => {\n    const options: OptionSortType[] = [\n      ...columns,\n      ...[...(formData?.metrics || []), formData?.metric].map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce(\n        (\n          results: (OptionSortType & { filterOptionName: string })[],\n          option,\n        ) => {\n          if ('saved_metric_name' in option && option.saved_metric_name) {\n            results.push({\n              ...option,\n              filterOptionName: option.saved_metric_name,\n            });\n          } else if ('column_name' in option && option.column_name) {\n            results.push({\n              ...option,\n              filterOptionName: `_col_${option.column_name}`,\n            });\n          } else if (option instanceof AdhocMetric) {\n            results.push({\n              ...option,\n              filterOptionName: `_adhocmetric_${option.label}`,\n            });\n          }\n          return results;\n        },\n        [],\n      )\n      .sort(\n        (a: OptionSortType, b: OptionSortType) =>\n          (a.saved_metric_name || a.column_name || a.label)?.localeCompare(\n            b.saved_metric_name || b.column_name || b.label || '',\n          ) ?? 0,\n      );\n  };\n  const [options, setOptions] = useState(\n    optionsForSelect(props.columns, props.formData),\n  );\n\n  useEffect(() => {\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }: { json: Record<string, any> }) => {\n            if (json?.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions?.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                setPartitionColumn(partitions.cols[0]);\n              }\n            }\n          })\n          .catch((error: Record<string, any>) => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }, [datasource]);\n\n  useEffect(() => {\n    setOptions(optionsForSelect(props.columns, props.formData));\n  }, [props.columns, props.formData]);\n\n  useEffect(() => {\n    setValues(\n      (props.value || []).map((filter: OptionValueType) =>\n        isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n      ),\n    );\n  }, [props.value]);\n\n  const removeValue = useCallback(\n    (index: number) => {\n      const valuesCopy = [...values];\n      valuesCopy.splice(index, 1);\n      setValues(valuesCopy);\n      onChange(valuesCopy);\n    },\n    [onChange, values],\n  );\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      const result = canDelete?.(values[index], values);\n      if (typeof result === 'string') {\n        warning({ title: t('Warning'), content: result });\n        return;\n      }\n      removeValue(index);\n    },\n    [canDelete, removeValue, values],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...values];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValues(newValues);\n    },\n    [values],\n  );\n\n  const getMetricExpression = useCallback(\n    (savedMetricName: string) =>\n      props.savedMetrics.find(\n        (savedMetric: Metric) => savedMetric.metric_name === savedMetricName,\n      )?.expression,\n    [props.savedMetrics],\n  );\n\n  const mapOption = useCallback(\n    (option: OptionValueType) => {\n      // already a AdhocFilter, skip\n      if (option instanceof AdhocFilter) {\n        return option;\n      }\n      const filterOptions = option as Record<string, any>;\n      // via datasource saved metric\n      if (filterOptions.saved_metric_name) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SQL,\n          subject: getMetricExpression(filterOptions.saved_metric_name),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // has a custom label, meaning it's custom column\n      if (filterOptions.label) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SQL,\n          subject: new AdhocMetric(option).translateToSql(),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // add a new filter item\n      if (filterOptions.column_name) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n          subject: filterOptions.column_name,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n          operatorId: Operators.EQUALS,\n          comparator: '',\n          clause: CLAUSES.WHERE,\n          isNew: true,\n        });\n      }\n      return null;\n    },\n    [datasource.type, getMetricExpression],\n  );\n\n  const onFilterEdit = useCallback(\n    (changedFilter: AdhocFilter) => {\n      onChange(\n        values.map((value: AdhocFilter) => {\n          if (value.filterOptionName === changedFilter.filterOptionName) {\n            return changedFilter;\n          }\n          return value;\n        }),\n      );\n    },\n    [onChange, values],\n  );\n\n  const onNewFilter = useCallback(\n    (newFilter: AdhocFilter) => {\n      const mappedOption = mapOption(newFilter);\n      if (mappedOption) {\n        const newValues = [...values, mappedOption];\n        setValues(newValues);\n        onChange(newValues);\n      }\n    },\n    [mapOption, onChange, values],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewFilterPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const valuesRenderer = useCallback(\n    () =>\n      values.map((adhocFilter: AdhocFilter, index: number) => (\n        <DndAdhocFilterOption\n          index={index}\n          adhocFilter={adhocFilter}\n          options={options}\n          datasource={datasource}\n          onFilterEdit={onFilterEdit}\n          partitionColumn={partitionColumn}\n          onClickClose={onClickClose}\n          onShiftOptions={onShiftOptions}\n        />\n      )),\n    [\n      onClickClose,\n      onFilterEdit,\n      onShiftOptions,\n      options,\n      partitionColumn,\n      datasource,\n      values,\n    ],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const defaultTimeFilter = useDefaultTimeFilter();\n  const adhocFilter = useMemo(() => {\n    if (isSavedMetric(droppedItem)) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: droppedItem?.expression,\n      });\n    }\n    if (droppedItem instanceof AdhocMetric) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: (droppedItem as AdhocMetric)?.translateToSql(),\n      });\n    }\n    const config: Partial<AdhocFilter> = {\n      subject: (droppedItem as ColumnMeta)?.column_name,\n    };\n    if (config.subject && isFeatureEnabled(FeatureFlag.UX_BETA)) {\n      config.operator = OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.IN].operation;\n      config.operatorId = Operators.IN;\n    }\n    if (\n      hasGenericChartAxes &&\n      isColumnMeta(droppedItem) &&\n      isTemporalColumn(droppedItem?.column_name, props.datasource)\n    ) {\n      config.operator = Operators.TEMPORAL_RANGE;\n      config.operatorId = Operators.TEMPORAL_RANGE;\n      config.comparator = defaultTimeFilter;\n    }\n    return new AdhocFilter(config);\n  }, [droppedItem]);\n\n  const canDrop = useCallback(() => true, []);\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      setDroppedItem(item.value);\n      togglePopover(true);\n    },\n    [controlName, togglePopover],\n  );\n\n  const ghostButtonText = isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n    ? t('Drop columns/metrics here or click')\n    : t('Drop columns or metrics here');\n\n  return (\n    <>\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={ghostButtonText}\n        onClickGhostButton={\n          isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n            ? handleClickGhostButton\n            : undefined\n        }\n        {...props}\n      />\n      <AdhocFilterPopoverTrigger\n        adhocFilter={adhocFilter}\n        options={options}\n        datasource={datasource}\n        onFilterEdit={onNewFilter}\n        partitionColumn={partitionColumn}\n        isControlledComponent\n        visible={newFilterPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        requireSave={!!droppedItem}\n      />\n    </>\n  );\n};\n\nconst DndFilterSelectWithFallback = withDndFallback(\n  DndFilterSelect,\n  AdhocFilterControl,\n);\n\nexport { DndFilterSelectWithFallback as DndFilterSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\nimport { DndItemType } from '../DndItemType';\n\nexport type DndItemValue = ColumnMeta | Metric;\n\nexport interface DatasourcePanelDndItem {\n  value: DndItemValue;\n  type: DndItemType;\n}\n\nexport function isDatasourcePanelDndItem(\n  item: any,\n): item is DatasourcePanelDndItem {\n  return item?.value && item?.type;\n}\n\nexport function isSavedMetric(item: any): item is Metric {\n  return item?.metric_name;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  ensureIsArray,\n  FeatureFlag,\n  GenericDataType,\n  isAdhocMetricSimple,\n  isFeatureEnabled,\n  isSavedMetric,\n  Metric,\n  QueryFormMetric,\n  t,\n  tn,\n} from '@superset-ui/core';\nimport { ColumnMeta, withDndFallback } from '@superset-ui/chart-controls';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport AdhocMetricPopoverTrigger from 'src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger';\nimport MetricDefinitionValue from 'src/explore/components/controls/MetricControl/MetricDefinitionValue';\nimport {\n  DatasourcePanelDndItem,\n  isDatasourcePanelDndItem,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport { AGGREGATES } from 'src/explore/constants';\nimport MetricsControl from '../MetricControl/MetricsControl';\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [DndItemType.Column, DndItemType.Metric];\n\nconst isDictionaryForAdhocMetric = (value: QueryFormMetric) =>\n  value &&\n  !(value instanceof AdhocMetric) &&\n  typeof value !== 'string' &&\n  value.expressionType;\n\nconst coerceMetrics = (\n  addedMetrics: QueryFormMetric | QueryFormMetric[] | undefined | null,\n  savedMetrics: Metric[],\n  columns: ColumnMeta[],\n) => {\n  if (!addedMetrics) {\n    return [];\n  }\n  const metricsCompatibleWithDataset = ensureIsArray(addedMetrics).filter(\n    metric => {\n      if (isSavedMetric(metric)) {\n        return savedMetrics.some(\n          savedMetric => savedMetric.metric_name === metric,\n        );\n      }\n      if (isAdhocMetricSimple(metric)) {\n        return columns.some(\n          column => column.column_name === metric.column.column_name,\n        );\n      }\n      return true;\n    },\n  );\n\n  return metricsCompatibleWithDataset.map(metric => {\n    if (!isDictionaryForAdhocMetric(metric)) {\n      return metric;\n    }\n    if (isAdhocMetricSimple(metric)) {\n      const column = columns.find(\n        col => col.column_name === metric.column.column_name,\n      );\n      if (column) {\n        return new AdhocMetric({ ...metric, column });\n      }\n    }\n    return new AdhocMetric(metric);\n  });\n};\n\nconst getOptionsForSavedMetrics = (\n  savedMetrics: savedMetricType[],\n  currentMetricValues: (string | AdhocMetric)[],\n  currentMetric?: string,\n) =>\n  savedMetrics?.filter(savedMetric =>\n    Array.isArray(currentMetricValues)\n      ? !currentMetricValues.includes(savedMetric.metric_name ?? '') ||\n        savedMetric.metric_name === currentMetric\n      : savedMetric,\n  ) ?? [];\n\ntype ValueType = Metric | AdhocMetric | QueryFormMetric;\n\nconst DndMetricSelect = (props: any) => {\n  const { onChange, multi } = props;\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const [value, setValue] = useState<ValueType[]>(\n    coerceMetrics(props.value, props.savedMetrics, props.columns),\n  );\n  const [droppedItem, setDroppedItem] = useState<\n    DatasourcePanelDndItem | typeof EMPTY_OBJECT\n  >({});\n  const [newMetricPopoverVisible, setNewMetricPopoverVisible] = useState(false);\n\n  useEffect(() => {\n    setValue(coerceMetrics(props.value, props.savedMetrics, props.columns));\n  }, [\n    JSON.stringify(props.value),\n    JSON.stringify(props.savedMetrics),\n    JSON.stringify(props.columns),\n  ]);\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const isMetricAlreadyInValues =\n        item.type === 'metric' ? value.includes(item.value.metric_name) : false;\n      return !isMetricAlreadyInValues;\n    },\n    [value],\n  );\n\n  const onNewMetric = useCallback(\n    (newMetric: Metric) => {\n      const newValue = props.multi ? [...value, newMetric] : [newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, props.multi, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric: Metric | AdhocMetric, oldMetric: Metric | AdhocMetric) => {\n      if (oldMetric instanceof AdhocMetric && oldMetric.equals(changedMetric)) {\n        return;\n      }\n      const newValue = value.map(value => {\n        if (\n          // compare saved metrics\n          ('metric_name' in oldMetric && value === oldMetric.metric_name) ||\n          // compare adhoc metrics\n          typeof (value as AdhocMetric).optionName !== 'undefined'\n            ? (value as AdhocMetric).optionName ===\n              (oldMetric as AdhocMetric).optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return value;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    (index: number) => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const newSavedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(props.savedMetrics, props.value),\n    [props.savedMetrics, props.value],\n  );\n\n  const getSavedMetricOptionsForMetric = useCallback(\n    index =>\n      getOptionsForSavedMetrics(\n        props.savedMetrics,\n        props.value,\n        props.value?.[index],\n      ),\n    [props.savedMetrics, props.value],\n  );\n\n  const handleDropLabel = useCallback(\n    () => onChange(multi ? value : value[0]),\n    [multi, onChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option: ValueType, index: number) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={props.columns}\n        savedMetrics={props.savedMetrics}\n        savedMetricsOptions={getSavedMetricOptionsForMetric(index)}\n        datasource={props.datasource}\n        onMoveLabel={moveLabel}\n        onDropLabel={handleDropLabel}\n        type={`${DndItemType.AdhocMetricOption}_${props.name}_${props.label}`}\n        multi={multi}\n        datasourceWarningMessage={\n          option instanceof AdhocMetric && option.datasourceWarning\n            ? t('This metric might be incompatible with current dataset')\n            : undefined\n        }\n      />\n    ),\n    [\n      getSavedMetricOptionsForMetric,\n      handleDropLabel,\n      moveLabel,\n      multi,\n      onMetricEdit,\n      onRemoveMetric,\n      props.columns,\n      props.datasource,\n      props.label,\n      props.name,\n      props.savedMetrics,\n    ],\n  );\n\n  const valuesRenderer = useCallback(\n    () => value.map((value, index) => valueRenderer(value, index)),\n    [value, valueRenderer],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewMetricPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      if (item.type === DndItemType.Metric) {\n        onNewMetric(item.value as Metric);\n      }\n      if (item.type === DndItemType.Column) {\n        setDroppedItem(item);\n        togglePopover(true);\n      }\n    },\n    [onNewMetric, togglePopover],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const adhocMetric = useMemo(() => {\n    if (\n      isDatasourcePanelDndItem(droppedItem) &&\n      droppedItem.type === DndItemType.Column\n    ) {\n      const itemValue = droppedItem.value as ColumnMeta;\n      const config: Partial<AdhocMetric> = {\n        column: itemValue,\n      };\n      if (isFeatureEnabled(FeatureFlag.UX_BETA)) {\n        if (itemValue.type_generic === GenericDataType.NUMERIC) {\n          config.aggregate = AGGREGATES.SUM;\n        } else if (\n          itemValue.type_generic === GenericDataType.STRING ||\n          itemValue.type_generic === GenericDataType.BOOLEAN ||\n          itemValue.type_generic === GenericDataType.TEMPORAL\n        ) {\n          config.aggregate = AGGREGATES.COUNT_DISTINCT;\n        }\n      }\n      return new AdhocMetric(config);\n    }\n    return new AdhocMetric({});\n  }, [droppedItem]);\n\n  const ghostButtonText = isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n    ? tn(\n        'Drop a column/metric here or click',\n        'Drop columns/metrics here or click',\n        multi ? 2 : 1,\n      )\n    : tn(\n        'Drop column or metric here',\n        'Drop columns or metrics here',\n        multi ? 2 : 1,\n      );\n\n  return (\n    <div className=\"metrics-select\">\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={ghostButtonText}\n        displayGhostButton={multi || value.length === 0}\n        onClickGhostButton={\n          isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n            ? handleClickGhostButton\n            : undefined\n        }\n        {...props}\n      />\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onNewMetric}\n        columns={props.columns}\n        savedMetricsOptions={newSavedMetricOptions}\n        savedMetric={EMPTY_OBJECT as savedMetricType}\n        datasource={props.datasource}\n        isControlledComponent\n        visible={newMetricPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        isNew\n      >\n        <div />\n      </AdhocMetricPopoverTrigger>\n    </div>\n  );\n};\n\nconst DndMetricSelectWithFallback = withDndFallback(\n  DndMetricSelect,\n  MetricsControl,\n);\n\nexport { DndMetricSelectWithFallback as DndMetricSelect };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { sharedControlComponents } from '@superset-ui/chart-controls';\nimport AnnotationLayerControl from './AnnotationLayerControl';\nimport BoundsControl from './BoundsControl';\nimport CheckboxControl from './CheckboxControl';\nimport CollectionControl from './CollectionControl';\nimport ColorPickerControl from './ColorPickerControl';\nimport ColorSchemeControl from './ColorSchemeControl';\nimport DatasourceControl from './DatasourceControl';\nimport DateFilterControl from './DateFilterControl';\nimport FixedOrMetricControl from './FixedOrMetricControl';\nimport HiddenControl from './HiddenControl';\nimport SelectAsyncControl from './SelectAsyncControl';\nimport SelectControl from './SelectControl';\nimport SliderControl from './SliderControl';\nimport SpatialControl from './SpatialControl';\nimport TextAreaControl from './TextAreaControl';\nimport TextControl from './TextControl';\nimport TimeSeriesColumnControl from './TimeSeriesColumnControl';\nimport ViewportControl from './ViewportControl';\nimport VizTypeControl from './VizTypeControl';\nimport MetricsControl from './MetricControl/MetricsControl';\nimport AdhocFilterControl from './FilterControl/AdhocFilterControl';\nimport FilterBoxItemControl from './FilterBoxItemControl';\nimport ConditionalFormattingControl from './ConditionalFormattingControl';\nimport DndColumnSelectControl, {\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n} from './DndColumnSelectControl';\nimport XAxisSortControl from './XAxisSortControl';\n\nconst controlMap = {\n  AnnotationLayerControl,\n  BoundsControl,\n  CheckboxControl,\n  CollectionControl,\n  ColorPickerControl,\n  ColorSchemeControl,\n  DatasourceControl,\n  DateFilterControl,\n  DndColumnSelectControl,\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n  FixedOrMetricControl,\n  HiddenControl,\n  SelectAsyncControl,\n  SelectControl,\n  SliderControl,\n  SpatialControl,\n  TextAreaControl,\n  TextControl,\n  TimeSeriesColumnControl,\n  ViewportControl,\n  VizTypeControl,\n  MetricsControl,\n  AdhocFilterControl,\n  FilterBoxItemControl,\n  ConditionalFormattingControl,\n  XAxisSortControl,\n  ...sharedControlComponents,\n};\nexport default controlMap;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Input } from 'src/components/Input';\n\ninterface HiddenControlsProps {\n  onChange: () => void;\n  value: string | number | readonly string[] | undefined;\n}\n\nexport default function HiddenControl(props: HiddenControlsProps) {\n  // This wouldn't be necessary but might as well\n  return <Input type=\"hidden\" value={props.value} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport Slider from 'src/components/Slider';\nimport ControlHeader, {\n  ControlHeaderProps,\n} from 'src/explore/components/ControlHeader';\n\ntype SliderControlProps = ControlHeaderProps & {\n  onChange: (value: number) => void;\n  value: number;\n  default?: number;\n};\n\nexport default function SliderControl({\n  default: defaultValue,\n  name,\n  label,\n  description,\n  renderTrigger,\n  rightNode,\n  leftNode,\n  validationErrors,\n  hovered,\n  warning,\n  danger,\n  onClick,\n  tooltipOnClick,\n  onChange = () => {},\n  ...rest\n}: SliderControlProps) {\n  const headerProps = {\n    name,\n    label,\n    description,\n    renderTrigger,\n    rightNode,\n    leftNode,\n    validationErrors,\n    onClick,\n    hovered,\n    tooltipOnClick,\n    warning,\n    danger,\n  };\n  return (\n    <>\n      <ControlHeader {...headerProps} />\n      <Slider {...rest} onChange={onChange} defaultValue={defaultValue} />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport SelectControl from './SelectControl';\n\nexport default function XAxisSortControl(props: {\n  onChange: (val: string | undefined) => void;\n  value: string | null;\n  shouldReset: boolean;\n}) {\n  const [value, setValue] = useState(props.value);\n  useEffect(() => {\n    if (props.shouldReset) {\n      props.onChange(undefined);\n      setValue(null);\n    }\n  }, [props.shouldReset, props.value]);\n\n  return <SelectControl {...props} value={value} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useCallback, useState, useEffect } from 'react';\nimport { isEqual } from 'lodash';\nimport {\n  ControlType,\n  ControlComponentProps as BaseControlComponentProps,\n} from '@superset-ui/chart-controls';\nimport { styled, JsonValue, QueryFormData } from '@superset-ui/core';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport controlMap from './controls';\n\nexport type ControlProps = {\n  // the actual action dispatcher (via bindActionCreators) has identical\n  // signature to the original action factory.\n  actions: Partial<ExploreActions> & Pick<ExploreActions, 'setControlValue'>;\n  type: ControlType;\n  label?: ReactNode;\n  name: string;\n  description?: ReactNode;\n  tooltipOnClick?: () => ReactNode;\n  places?: number;\n  rightNode?: ReactNode;\n  formData?: QueryFormData | null;\n  value?: JsonValue;\n  validationErrors?: any[];\n  hidden?: boolean;\n  renderTrigger?: boolean;\n  default?: JsonValue;\n  isVisible?: boolean;\n  resetOnHide?: boolean;\n};\n\n/**\n *\n */\nexport type ControlComponentProps<ValueType extends JsonValue = JsonValue> =\n  Omit<ControlProps, 'value'> & BaseControlComponentProps<ValueType>;\n\nconst StyledControl = styled.div`\n  padding-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport default function Control(props: ControlProps) {\n  const {\n    actions: { setControlValue },\n    name,\n    type,\n    hidden,\n    isVisible,\n    resetOnHide = true,\n  } = props;\n\n  const [hovered, setHovered] = useState(false);\n  const wasVisible = usePrevious(isVisible);\n  const onChange = useCallback(\n    (value: any, errors: any[]) => setControlValue(name, value, errors),\n    [name, setControlValue],\n  );\n\n  useEffect(() => {\n    if (\n      wasVisible === true &&\n      isVisible === false &&\n      props.default !== undefined &&\n      !isEqual(props.value, props.default) &&\n      resetOnHide\n    ) {\n      // reset control value if setting to invisible\n      setControlValue?.(name, props.default);\n    }\n  }, [\n    name,\n    wasVisible,\n    isVisible,\n    setControlValue,\n    props.value,\n    props.default,\n  ]);\n\n  if (!type || isVisible === false) return null;\n\n  const ControlComponent = typeof type === 'string' ? controlMap[type] : type;\n  if (!ControlComponent) {\n    // eslint-disable-next-line no-console\n    console.warn(`Unknown controlType: ${type}`);\n    return null;\n  }\n\n  return (\n    <StyledControl\n      className=\"Control\"\n      data-test={name}\n      style={hidden ? { display: 'none' } : undefined}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      <ErrorBoundary>\n        <ControlComponent onChange={onChange} hovered={hovered} {...props} />\n      </ErrorBoundary>\n    </StyledControl>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, ReactNode, useMemo, useRef } from 'react';\nimport { t, css, useTheme, SupersetTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { FormLabel } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  onClick?: () => void;\n  hovered?: boolean;\n  tooltipOnClick?: () => void;\n  warning?: string;\n  danger?: string;\n};\n\nconst iconStyles = css`\n  &.anticon {\n    font-size: unset;\n    .anticon {\n      line-height: unset;\n      vertical-align: unset;\n    }\n  }\n`;\n\nconst ControlHeader: FC<ControlHeaderProps> = ({\n  name,\n  label,\n  description,\n  validationErrors = [],\n  renderTrigger = false,\n  rightNode,\n  leftNode,\n  onClick,\n  hovered = false,\n  tooltipOnClick = () => {},\n  warning,\n  danger,\n}) => {\n  const { gridUnit, colors } = useTheme();\n  const hasHadNoErrors = useRef(false);\n  const labelColor = useMemo(() => {\n    if (!validationErrors.length) {\n      hasHadNoErrors.current = true;\n    }\n\n    if (hasHadNoErrors.current) {\n      if (validationErrors.length) {\n        return colors.error.base;\n      }\n\n      return 'unset';\n    }\n\n    return colors.alert.base;\n  }, [colors.error.base, colors.alert.base, validationErrors.length]);\n\n  if (!label) {\n    return null;\n  }\n\n  const renderOptionalIcons = () => {\n    if (!hovered) {\n      return null;\n    }\n\n    return (\n      <span\n        css={() => css`\n          position: absolute;\n          top: 50%;\n          right: 0;\n          padding-left: ${gridUnit}px;\n          transform: translate(100%, -50%);\n          white-space: nowrap;\n        `}\n      >\n        {description && (\n          <span>\n            <Tooltip\n              id=\"description-tooltip\"\n              title={description}\n              placement=\"top\"\n            >\n              <Icons.InfoCircleOutlined\n                css={iconStyles}\n                onClick={tooltipOnClick}\n              />\n            </Tooltip>{' '}\n          </span>\n        )}\n        {renderTrigger && (\n          <span>\n            <InfoTooltipWithTrigger\n              label={t('bolt')}\n              tooltip={t('Changing this control takes effect instantly')}\n              placement=\"top\"\n              icon=\"bolt\"\n            />{' '}\n          </span>\n        )}\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <FormLabel\n          css={(theme: SupersetTheme) =>\n            css`\n              margin-bottom: ${theme.gridUnit * 0.5}px;\n              position: relative;\n            `\n          }\n        >\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <Icons.AlertSolid iconColor={colors.alert.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <Icons.ErrorSolid iconColor={colors.error.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors?.length > 0 && (\n            <span data-test=\"error-tooltip\">\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors?.join(' ')}\n              >\n                <Icons.ExclamationCircleOutlined\n                  css={css`\n                    ${iconStyles}\n                    color: ${labelColor};\n                  `}\n                />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n        </FormLabel>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n};\n\nexport default ControlHeader;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\n\nconst NUM_COLUMNS = 12;\n\ntype Control = React.ReactElement | null;\n\nexport default function ControlRow({ controls }: { controls: Control[] }) {\n  const isHiddenControl = useCallback(\n    (control: Control) =>\n      control?.props.type === 'HiddenControl' ||\n      control?.props.isVisible === false,\n    [],\n  );\n  // Invisible control should not be counted\n  // in the columns number\n  const countableControls = controls.filter(\n    control => !isHiddenControl(control),\n  );\n  const colSize = countableControls.length\n    ? NUM_COLUMNS / countableControls.length\n    : NUM_COLUMNS;\n  return (\n    <div className=\"row\">\n      {controls.map((control, i) => (\n        <div\n          className={`col-lg-${colSize} col-xs-12`}\n          style={{\n            display: isHiddenControl(control) ? 'none' : 'block',\n          }}\n          key={i}\n        >\n          {control}\n        </div>\n      ))}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState, useEffect } from 'react';\nimport {\n  css,\n  GenericDataType,\n  getTimeFormatter,\n  styled,\n  t,\n  TimeFormats,\n  useTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { Column } from 'react-table';\nimport debounce from 'lodash/debounce';\nimport { Space } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  NULL_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { Radio } from 'src/components/Radio';\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport Popover from 'src/components/Popover';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport RowCountLabel from 'src/explore/components/RowCountLabel';\nimport { getTimeColumns, setTimeColumns } from './utils';\n\nexport const CellNull = styled('span')`\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nexport const CopyButton = styled(Button)`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n\n  // needed to override button's first-of-type margin: 0\n  && {\n    margin: 0 ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  i {\n    padding: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport const CopyToClipboardButton = ({\n  data,\n  columns,\n}: {\n  data?: Record<string, any>;\n  columns?: string[];\n}) => {\n  const theme = useTheme();\n  return (\n    <CopyToClipboard\n      text={\n        data && columns ? prepareCopyToClipboardTabularData(data, columns) : ''\n      }\n      wrapped={false}\n      copyNode={\n        <Icons.CopyOutlined\n          iconColor={theme.colors.grayscale.base}\n          iconSize=\"l\"\n          aria-label={t('Copy')}\n          role=\"button\"\n          css={css`\n            &.anticon > * {\n              line-height: 0;\n            }\n          `}\n        />\n      }\n    />\n  );\n};\n\nexport const FilterInput = ({\n  onChangeHandler,\n}: {\n  onChangeHandler(filterText: string): void;\n}) => {\n  const theme = useTheme();\n  const debouncedChangeHandler = debounce(onChangeHandler, SLOW_DEBOUNCE);\n  return (\n    <Input\n      prefix={<Icons.Search iconColor={theme.colors.grayscale.base} />}\n      placeholder={t('Search')}\n      onChange={(event: any) => {\n        const filterText = event.target.value;\n        debouncedChangeHandler(filterText);\n      }}\n      css={css`\n        width: 200px;\n        margin-right: ${theme.gridUnit * 2}px;\n      `}\n    />\n  );\n};\n\nexport const RowCount = ({\n  data,\n  loading,\n}: {\n  data?: Record<string, any>[];\n  loading: boolean;\n}) => <RowCountLabel rowcount={data?.length ?? 0} loading={loading} />;\n\nenum FormatPickerValue {\n  Formatted = 'formatted',\n  Original = 'original',\n}\n\nconst FormatPicker = ({\n  onChange,\n  value,\n}: {\n  onChange: any;\n  value: FormatPickerValue;\n}) => (\n  <Radio.Group value={value} onChange={onChange}>\n    <Space direction=\"vertical\">\n      <Radio value={FormatPickerValue.Formatted}>{t('Formatted date')}</Radio>\n      <Radio value={FormatPickerValue.Original}>{t('Original value')}</Radio>\n    </Space>\n  </Radio.Group>\n);\n\nconst FormatPickerContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  padding: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst FormatPickerLabel = styled.span`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  text-transform: uppercase;\n`;\n\nconst DataTableTemporalHeaderCell = ({\n  columnName,\n  onTimeColumnChange,\n  datasourceId,\n  isOriginalTimeColumn,\n}: {\n  columnName: string;\n  onTimeColumnChange: (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => void;\n  datasourceId?: string;\n  isOriginalTimeColumn: boolean;\n}) => {\n  const theme = useTheme();\n\n  const onChange = (e: any) => {\n    onTimeColumnChange(columnName, e.target.value);\n  };\n\n  const overlayContent = useMemo(\n    () =>\n      datasourceId ? ( // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n        <FormatPickerContainer onClick={e => e.stopPropagation()}>\n          {/* hack to disable click propagation from popover content to table header, which triggers sorting column */}\n          <Global\n            styles={css`\n              .column-formatting-popover .ant-popover-inner-content {\n                padding: 0;\n              }\n            `}\n          />\n          <FormatPickerLabel>{t('Column Formatting')}</FormatPickerLabel>\n          <FormatPicker\n            onChange={onChange}\n            value={\n              isOriginalTimeColumn\n                ? FormatPickerValue.Original\n                : FormatPickerValue.Formatted\n            }\n          />\n        </FormatPickerContainer>\n      ) : null,\n    [datasourceId, isOriginalTimeColumn],\n  );\n\n  return datasourceId ? (\n    <span>\n      <Popover\n        overlayClassName=\"column-formatting-popover\"\n        trigger=\"click\"\n        content={overlayContent}\n        placement=\"bottomLeft\"\n        arrowPointAtCenter\n      >\n        <Icons.SettingOutlined\n          iconSize=\"m\"\n          iconColor={theme.colors.grayscale.light1}\n          css={{ marginRight: `${theme.gridUnit}px` }}\n          onClick={e => e.stopPropagation()}\n        />\n      </Popover>\n      {columnName}\n    </span>\n  ) : (\n    <span>{columnName}</span>\n  );\n};\n\nexport const useFilteredTableData = (\n  filterText: string,\n  data?: Record<string, any>[],\n) => {\n  const rowsAsStrings = useMemo(\n    () =>\n      data?.map((row: Record<string, any>) =>\n        Object.values(row).map(value =>\n          value ? value.toString().toLowerCase() : t('N/A'),\n        ),\n      ) ?? [],\n    [data],\n  );\n\n  return useMemo(() => {\n    if (!data?.length) {\n      return [];\n    }\n    return data.filter((_, index: number) =>\n      rowsAsStrings[index].some(value =>\n        value?.includes(filterText.toLowerCase()),\n      ),\n    );\n  }, [data, filterText, rowsAsStrings]);\n};\n\nconst timeFormatter = getTimeFormatter(TimeFormats.DATABASE_DATETIME);\n\nexport const useTableColumns = (\n  colnames?: string[],\n  coltypes?: GenericDataType[],\n  data?: Record<string, any>[],\n  datasourceId?: string,\n  isVisible?: boolean,\n  moreConfigs?: { [key: string]: Partial<Column> },\n) => {\n  const [originalFormattedTimeColumns, setOriginalFormattedTimeColumns] =\n    useState<string[]>(getTimeColumns(datasourceId));\n\n  const onTimeColumnChange = (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => {\n    if (!datasourceId) {\n      return;\n    }\n    if (\n      columnType === FormatPickerValue.Original &&\n      !originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.push(columnName);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    } else if (\n      columnType === FormatPickerValue.Formatted &&\n      originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.splice(cols.indexOf(columnName), 1);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    }\n  };\n\n  useEffect(() => {\n    if (isVisible) {\n      setOriginalFormattedTimeColumns(getTimeColumns(datasourceId));\n    }\n  }, [datasourceId, isVisible]);\n\n  return useMemo(\n    () =>\n      colnames && data?.length\n        ? colnames\n            .filter((column: string) => Object.keys(data[0]).includes(column))\n            .map((key, index) => {\n              const colType = coltypes?.[index];\n              const firstValue = data[0][key];\n              const originalFormattedTimeColumnIndex =\n                colType === GenericDataType.TEMPORAL\n                  ? originalFormattedTimeColumns.indexOf(key)\n                  : -1;\n              const isOriginalTimeColumn =\n                originalFormattedTimeColumns.includes(key);\n              return {\n                // react-table requires a non-empty id, therefore we introduce a fallback value in case the key is empty\n                id: key || index,\n                accessor: row => row[key],\n                Header:\n                  colType === GenericDataType.TEMPORAL &&\n                  typeof firstValue !== 'string' ? (\n                    <DataTableTemporalHeaderCell\n                      columnName={key}\n                      datasourceId={datasourceId}\n                      onTimeColumnChange={onTimeColumnChange}\n                      isOriginalTimeColumn={isOriginalTimeColumn}\n                    />\n                  ) : (\n                    key\n                  ),\n                Cell: ({ value }) => {\n                  if (value === true) {\n                    return BOOL_TRUE_DISPLAY;\n                  }\n                  if (value === false) {\n                    return BOOL_FALSE_DISPLAY;\n                  }\n                  if (value === null) {\n                    return <CellNull>{NULL_DISPLAY}</CellNull>;\n                  }\n                  if (\n                    colType === GenericDataType.TEMPORAL &&\n                    originalFormattedTimeColumnIndex === -1 &&\n                    typeof value === 'number'\n                  ) {\n                    return timeFormatter(value);\n                  }\n                  return String(value);\n                },\n                ...moreConfigs?.[key],\n              } as Column;\n            })\n        : [],\n    [\n      colnames,\n      data,\n      coltypes,\n      datasourceId,\n      moreConfigs,\n      originalFormattedTimeColumns,\n    ],\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray } from '@superset-ui/core';\nimport {\n  LocalStorageKeys,\n  setItem,\n  getItem,\n} from 'src/utils/localStorageHelpers';\n\nexport const getTimeColumns = (datasourceId?: string): string[] => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  if (datasourceId === undefined) {\n    return [];\n  }\n  return ensureIsArray(colsMap[datasourceId]);\n};\n\nexport const setTimeColumns = (datasourceId: string, columns: string[]) => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  setItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {\n      ...colsMap,\n      [datasourceId]: columns,\n    },\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * All possible draggable items for the chart controls.\n */\nexport enum DndItemType {\n  // an existing column in table\n  Column = 'column',\n  // a selected column option in ColumnSelectControl\n  ColumnOption = 'columnOption',\n  // an adhoc column option in ColumnSelectControl\n  AdhocColumnOption = 'adhocColumn',\n\n  // a saved metric\n  Metric = 'metric',\n  // a selected saved metric in MetricsControl\n  MetricOption = 'metricOption',\n  // an adhoc metric option in MetricsControl\n  AdhocMetricOption = 'adhocMetric',\n\n  // an adhoc filter option\n  FilterOption = 'filterOption',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\n\nexport const ExplorePopoverContent = styled.div`\n  .edit-popover-resize {\n    transform: scaleX(-1);\n    float: right;\n    margin-top: ${({ theme }) => theme.gridUnit * 4}px;\n    margin-right: ${({ theme }) => theme.gridUnit * -2}px;\n    cursor: nwse-resize;\n  }\n  .filter-sql-editor {\n    border: ${({ theme }) => theme.colors.grayscale.light2} solid thin;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { getNumberFormatter, t, tn } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype RowCountLabelProps = {\n  rowcount?: number;\n  limit?: number;\n  loading?: boolean;\n};\n\nexport default function RowCountLabel(props: RowCountLabelProps) {\n  const { rowcount = 0, limit, loading } = props;\n  const limitReached = rowcount === limit;\n  const type =\n    limitReached || (rowcount === 0 && !loading) ? 'danger' : 'default';\n  const formattedRowCount = getNumberFormatter()(rowcount);\n  const label = (\n    <Label type={type}>\n      {loading ? (\n        t('Loading...')\n      ) : (\n        <span data-test=\"row-count-label\">\n          {tn('%s row', '%s rows', rowcount, formattedRowCount)}\n        </span>\n      )}\n    </Label>\n  );\n  return limitReached ? (\n    <Tooltip id=\"tt-rowcount-tooltip\" title={<span>{t('Limit reached')}</span>}>\n      {label}\n    </Tooltip>\n  ) : (\n    label\n  );\n}\n\nexport type { RowCountLabelProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { css, SupersetTheme } from '@superset-ui/core';\nimport React, { useRef, useState } from 'react';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype ColorSchemeLabelProps = {\n  colors: string[];\n  id: string;\n  label: string;\n};\n\nexport default function ColorSchemeLabel(props: ColorSchemeLabelProps) {\n  const { id, label, colors } = props;\n  const [showTooltip, setShowTooltip] = useState<boolean>(false);\n  const labelNameRef = useRef<HTMLElement>(null);\n  const labelColorsRef = useRef<HTMLElement>(null);\n  const handleShowTooltip = () => {\n    const labelNameElement = labelNameRef.current;\n    const labelColorsElement = labelColorsRef.current;\n    if (\n      labelNameElement &&\n      labelColorsElement &&\n      (labelNameElement.scrollWidth > labelNameElement.offsetWidth ||\n        labelNameElement.scrollHeight > labelNameElement.offsetHeight ||\n        labelColorsElement.scrollWidth > labelColorsElement.offsetWidth ||\n        labelColorsElement.scrollHeight > labelColorsElement.offsetHeight)\n    ) {\n      setShowTooltip(true);\n    }\n  };\n  const handleHideTooltip = () => {\n    setShowTooltip(false);\n  };\n\n  const colorsList = () =>\n    colors.map((color: string, i: number) => (\n      <span\n        data-test=\"color\"\n        key={`${id}-${i}`}\n        css={(theme: { gridUnit: number }) => css`\n          padding-left: ${theme.gridUnit / 2}px;\n          :before {\n            content: '';\n            display: inline-block;\n            background-color: ${color};\n            border: 1px solid ${color === 'white' ? 'black' : color};\n            width: 9px;\n            height: 10px;\n          }\n        `}\n      />\n    ));\n\n  const tooltipContent = () => (\n    <>\n      <span>{label}</span>\n      <div>{colorsList()}</div>\n    </>\n  );\n\n  return (\n    <Tooltip\n      data-testid=\"tooltip\"\n      overlayClassName=\"color-scheme-tooltip\"\n      title={tooltipContent}\n      key={id}\n      visible={showTooltip}\n    >\n      <span\n        className=\"color-scheme-option\"\n        onMouseEnter={handleShowTooltip}\n        onMouseLeave={handleHideTooltip}\n        css={css`\n          display: flex;\n          align-items: center;\n          justify-content: flex-start;\n        `}\n        data-test={id}\n      >\n        <span\n          className=\"color-scheme-label\"\n          ref={labelNameRef}\n          css={(theme: SupersetTheme) => css`\n            min-width: 125px;\n            padding-right: ${theme.gridUnit * 2}px;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n          `}\n        >\n          {label}\n        </span>\n        <span\n          ref={labelColorsRef}\n          css={(theme: SupersetTheme) => css`\n            flex: 100%;\n            text-overflow: ellipsis;\n            overflow: hidden;\n            white-space: nowrap;\n            padding-right: ${theme.gridUnit}px;\n          `}\n        >\n          {colorsList()}\n        </span>\n      </span>\n    </Tooltip>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport { ColorScheme, SequentialScheme, styled, t } from '@superset-ui/core';\nimport { isFunction } from 'lodash';\nimport { Select } from 'src/components';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport ColorSchemeLabel from './ColorSchemeLabel';\n\nexport interface ColorSchemes {\n  [key: string]: ColorScheme;\n}\n\nexport interface ColorSchemeControlProps {\n  hasCustomLabelColors: boolean;\n  dashboardId?: number;\n  label: string;\n  name: string;\n  onChange?: (value: string) => void;\n  value: string;\n  clearable: boolean;\n  defaultScheme?: string;\n  choices: string[][] | (() => string[][]);\n  schemes: ColorSchemes | (() => ColorSchemes);\n  isLinear: boolean;\n}\n\nconst StyledAlert = styled(Icons.AlertSolid)`\n  color: ${({ theme }) => theme.colors.alert.base};\n`;\n\nconst CUSTOM_LABEL_ALERT = t(\n  `This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings`,\n);\n\nconst DASHBOARD_ALERT = t(\n  `The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties.`,\n);\n\nconst Label = ({\n  label,\n  hasCustomLabelColors,\n  dashboardId,\n}: Pick<\n  ColorSchemeControlProps,\n  'label' | 'hasCustomLabelColors' | 'dashboardId'\n>) => {\n  if (hasCustomLabelColors || dashboardId) {\n    const alertTitle = hasCustomLabelColors\n      ? CUSTOM_LABEL_ALERT\n      : DASHBOARD_ALERT;\n    return (\n      <>\n        {label}{' '}\n        <Tooltip title={alertTitle}>\n          <StyledAlert iconSize=\"s\" />\n        </Tooltip>\n      </>\n    );\n  }\n  return <>{label}</>;\n};\n\nconst ColorSchemeControl = ({\n  hasCustomLabelColors = false,\n  dashboardId,\n  label = t('Color scheme'),\n  name,\n  onChange = () => {},\n  value,\n  clearable = false,\n  defaultScheme,\n  choices = [],\n  schemes = {},\n  isLinear,\n  ...rest\n}: ColorSchemeControlProps) => {\n  const currentScheme = useMemo(() => {\n    if (dashboardId) {\n      return 'dashboard';\n    }\n    let result = value || defaultScheme;\n    if (result === 'SUPERSET_DEFAULT') {\n      const schemesObject = isFunction(schemes) ? schemes() : schemes;\n      result = schemesObject?.SUPERSET_DEFAULT?.id;\n    }\n    return result;\n  }, [dashboardId, defaultScheme, schemes, value]);\n\n  const options = useMemo(() => {\n    if (dashboardId) {\n      return [\n        {\n          value: 'dashboard',\n          label: t('dashboard'),\n          customLabel: (\n            <Tooltip title={DASHBOARD_ALERT}>{t('Dashboard scheme')}</Tooltip>\n          ),\n        },\n      ];\n    }\n    const schemesObject = isFunction(schemes) ? schemes() : schemes;\n    const controlChoices = isFunction(choices) ? choices() : choices;\n    const allColorOptions: string[] = [];\n    const filteredColorOptions = controlChoices.filter(o => {\n      const option = o[0];\n      const isValidColorOption =\n        option !== 'SUPERSET_DEFAULT' && !allColorOptions.includes(option);\n      allColorOptions.push(option);\n      return isValidColorOption;\n    });\n\n    return filteredColorOptions.map(([value]) => {\n      const currentScheme = schemesObject[value];\n\n      // For categorical scheme, display all the colors\n      // For sequential scheme, show 10 or interpolate to 10.\n      // Sequential schemes usually have at most 10 colors.\n      let colors: string[] = [];\n      if (currentScheme) {\n        colors = isLinear\n          ? (currentScheme as SequentialScheme).getColors(10)\n          : currentScheme.colors;\n      }\n      return {\n        customLabel: (\n          <ColorSchemeLabel\n            id={currentScheme.id}\n            label={currentScheme.label}\n            colors={colors}\n          />\n        ),\n        label: schemesObject?.[value]?.label || value,\n        value,\n      };\n    });\n  }, [choices, dashboardId, isLinear, schemes]);\n\n  // We can't pass on change directly because it receives a second\n  // parameter and it would be interpreted as the error parameter\n  const handleOnChange = (value: string) => onChange(value);\n\n  return (\n    <Select\n      header={\n        <ControlHeader\n          {...rest}\n          label={\n            <Label\n              label={label}\n              hasCustomLabelColors={hasCustomLabelColors}\n              dashboardId={dashboardId}\n            />\n          }\n        />\n      }\n      ariaLabel={t('Select color scheme')}\n      allowClear={clearable}\n      disabled={!!dashboardId}\n      name={`select-${name}`}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={t('Select scheme')}\n      value={currentScheme}\n    />\n  );\n};\n\nexport default ColorSchemeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport Popover, {\n  PopoverProps as BasePopoverProps,\n  TooltipPlacement,\n} from 'src/components/Popover';\n\nconst sectionContainerId = 'controlSections';\nexport const getSectionContainerElement = () =>\n  document.getElementById(sectionContainerId)?.lastElementChild as HTMLElement;\n\nconst getElementYVisibilityRatioOnContainer = (node: HTMLElement) => {\n  const containerHeight = window?.innerHeight;\n  const nodePositionInViewport = node?.getBoundingClientRect()?.top;\n  if (!containerHeight || !nodePositionInViewport) {\n    return 0;\n  }\n\n  return nodePositionInViewport / containerHeight;\n};\n\nexport type PopoverProps = BasePopoverProps & {\n  getVisibilityRatio?: typeof getElementYVisibilityRatioOnContainer;\n};\n\nconst ControlPopover: React.FC<PopoverProps> = ({\n  getPopupContainer,\n  getVisibilityRatio = getElementYVisibilityRatioOnContainer,\n  visible: visibleProp,\n  destroyTooltipOnHide = false,\n  ...props\n}) => {\n  const triggerElementRef = useRef<HTMLElement>();\n\n  const [visible, setVisible] = useState(\n    visibleProp === undefined ? props.defaultVisible : visibleProp,\n  );\n  const [placement, setPlacement] = React.useState<TooltipPlacement>('right');\n\n  const calculatePlacement = useCallback(() => {\n    const visibilityRatio = getVisibilityRatio(triggerElementRef.current!);\n    if (visibilityRatio < 0.35 && placement !== 'rightTop') {\n      setPlacement('rightTop');\n    } else if (visibilityRatio > 0.65 && placement !== 'rightBottom') {\n      setPlacement('rightBottom');\n    } else {\n      setPlacement('right');\n    }\n  }, [getVisibilityRatio]);\n\n  const changeContainerScrollStatus = useCallback(\n    visible => {\n      const element = getSectionContainerElement();\n      if (element) {\n        element.style.setProperty(\n          'overflow-y',\n          visible ? 'hidden' : 'auto',\n          'important',\n        );\n      }\n    },\n    [calculatePlacement],\n  );\n\n  const handleGetPopupContainer = useCallback(\n    (triggerNode: HTMLElement) => {\n      triggerElementRef.current = triggerNode;\n\n      return getPopupContainer?.(triggerNode) || document.body;\n    },\n    [calculatePlacement, getPopupContainer],\n  );\n\n  const handleOnVisibleChange = useCallback(\n    (visible: boolean | undefined) => {\n      if (visible === undefined) {\n        changeContainerScrollStatus(visible);\n      }\n\n      setVisible(!!visible);\n      props.onVisibleChange?.(!!visible);\n    },\n    [props, changeContainerScrollStatus],\n  );\n\n  const handleDocumentKeyDownListener = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setVisible(false);\n        props.onVisibleChange?.(false);\n      }\n    },\n    [props],\n  );\n\n  useEffect(() => {\n    if (visibleProp !== undefined) {\n      setVisible(!!visibleProp);\n    }\n  }, [visibleProp]);\n\n  useEffect(() => {\n    if (visible !== undefined) {\n      changeContainerScrollStatus(visible);\n    }\n  }, [visible, changeContainerScrollStatus]);\n\n  useEffect(() => {\n    if (visible) {\n      document.addEventListener('keydown', handleDocumentKeyDownListener);\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDownListener);\n    };\n  }, [handleDocumentKeyDownListener, visible]);\n\n  useEffect(() => {\n    if (visible) {\n      calculatePlacement();\n    }\n  }, [visible, calculatePlacement]);\n\n  return (\n    <Popover\n      {...props}\n      visible={visible}\n      arrowPointAtCenter\n      placement={placement}\n      onVisibleChange={handleOnVisibleChange}\n      getPopupContainer={handleGetPopupContainer}\n      destroyTooltipOnHide={destroyTooltipOnHide}\n    />\n  );\n};\n\nexport default ControlPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  COMMON_RANGE_OPTIONS,\n  COMMON_RANGE_SET,\n  DATE_FILTER_TEST_KEY,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CommonRangeType,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport function CommonFrame(props: FrameComponentProps) {\n  let commonRange = 'Last week';\n  if (COMMON_RANGE_SET.has(props.value as CommonRangeType)) {\n    commonRange = props.value;\n  } else {\n    props.onChange(commonRange);\n  }\n\n  return (\n    <>\n      <div\n        className=\"section-title\"\n        data-test={DATE_FILTER_TEST_KEY.commonFrame}\n      >\n        {t('Configure Time Range: Last...')}\n      </div>\n      <Radio.Group\n        value={commonRange}\n        onChange={(e: any) => props.onChange(e.target.value)}\n      >\n        {COMMON_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect } from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  CALENDAR_RANGE_OPTIONS,\n  CALENDAR_RANGE_SET,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CalendarRangeType,\n  PreviousCalendarWeek,\n  FrameComponentProps,\n} from '../types';\n\nexport function CalendarFrame({ onChange, value }: FrameComponentProps) {\n  useEffect(() => {\n    if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n      onChange(PreviousCalendarWeek);\n    }\n  }, [onChange, value]);\n\n  if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Time Range: Previous...')}\n      </div>\n      <Radio.Group\n        value={value}\n        onChange={(e: any) => onChange(e.target.value)}\n      >\n        {CALENDAR_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport { t } from '@superset-ui/core';\nimport { Moment } from 'moment';\nimport { isInteger } from 'lodash';\n// @ts-ignore\nimport { locales } from 'antd/dist/antd-with-locales';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport { DatePicker } from 'src/components/DatePicker';\nimport { Radio } from 'src/components/Radio';\nimport Select from 'src/components/Select/Select';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport {\n  SINCE_GRAIN_OPTIONS,\n  SINCE_MODE_OPTIONS,\n  UNTIL_GRAIN_OPTIONS,\n  UNTIL_MODE_OPTIONS,\n  MOMENT_FORMAT,\n  MIDNIGHT,\n  customTimeRangeDecode,\n  customTimeRangeEncode,\n  dttmToMoment,\n  LOCALE_MAPPING,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CustomRangeKey,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\nimport { ExplorePageState } from 'src/explore/types';\n\nexport function CustomFrame(props: FrameComponentProps) {\n  const { customRange, matchedFlag } = customTimeRangeDecode(props.value);\n  if (!matchedFlag) {\n    props.onChange(customTimeRangeEncode(customRange));\n  }\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n    anchorMode,\n  } = { ...customRange };\n\n  function onChange(control: CustomRangeKey, value: string) {\n    props.onChange(\n      customTimeRangeEncode({\n        ...customRange,\n        [control]: value,\n      }),\n    );\n  }\n\n  function onGrainValue(\n    control: 'sinceGrainValue' | 'untilGrainValue',\n    value: string | number,\n  ) {\n    // only positive values in grainValue controls\n    if (isInteger(value) && value > 0) {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          [control]: value,\n        }),\n      );\n    }\n  }\n\n  function onAnchorMode(option: any) {\n    const radioValue = option.target.value;\n    if (radioValue === 'now') {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: 'now',\n          anchorMode: radioValue,\n        }),\n      );\n    } else {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: MIDNIGHT,\n          anchorMode: radioValue,\n        }),\n      );\n    }\n  }\n\n  // check if there is a locale defined for explore\n  const localFromFlaskBabel = useSelector(\n    (state: ExplorePageState) => state?.common?.locale,\n  );\n  // An undefined datePickerLocale is acceptable if no match is found in the LOCALE_MAPPING[localFromFlaskBabel] lookup\n  // and will fall back to antd's default locale when the antd DataPicker's prop locale === undefined\n  // This also protects us from the case where state is populated with a locale that antd locales does not recognize\n  const datePickerLocale =\n    locales[LOCALE_MAPPING[localFromFlaskBabel]]?.DatePicker;\n\n  return (\n    <div data-test=\"custom-frame\">\n      <div className=\"section-title\">{t('Configure custom time range')}</div>\n      <Row gutter={24}>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('START (INCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('Start date included in time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('START (INCLUSIVE)')}\n            options={SINCE_MODE_OPTIONS}\n            value={sinceMode}\n            onChange={(value: string) => onChange('sinceMode', value)}\n          />\n          {sinceMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(sinceDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('sinceDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n                locale={datePickerLocale}\n              />\n            </Row>\n          )}\n          {sinceMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                {/* Make sure sinceGrainValue looks like a positive integer */}\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={Math.abs(sinceGrainValue)}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('sinceGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('sinceGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={SINCE_GRAIN_OPTIONS}\n                  value={sinceGrain}\n                  onChange={(value: string) => onChange('sinceGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('END (EXCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('End date excluded from time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('END (EXCLUSIVE)')}\n            options={UNTIL_MODE_OPTIONS}\n            value={untilMode}\n            onChange={(value: string) => onChange('untilMode', value)}\n          />\n          {untilMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(untilDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('untilDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n                locale={datePickerLocale}\n              />\n            </Row>\n          )}\n          {untilMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={untilGrainValue}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('untilGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('untilGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={UNTIL_GRAIN_OPTIONS}\n                  value={untilGrain}\n                  onChange={(value: string) => onChange('untilGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n      </Row>\n      {sinceMode === 'relative' && untilMode === 'relative' && (\n        <div className=\"control-anchor-to\">\n          <div className=\"control-label\">{t('Anchor to')}</div>\n          <Row align=\"middle\">\n            <Col>\n              <Radio.Group\n                onChange={onAnchorMode}\n                defaultValue=\"now\"\n                value={anchorMode}\n              >\n                <Radio key=\"now\" value=\"now\">\n                  {t('NOW')}\n                </Radio>\n                <Radio key=\"specific\" value=\"specific\">\n                  {t('Date/Time')}\n                </Radio>\n              </Radio.Group>\n            </Col>\n            {anchorMode !== 'now' && (\n              <Col>\n                <DatePicker\n                  showTime\n                  defaultValue={dttmToMoment(anchorValue)}\n                  onChange={(datetime: Moment) =>\n                    onChange('anchorValue', datetime.format(MOMENT_FORMAT))\n                  }\n                  allowClear={false}\n                  className=\"control-anchor-to-datetime\"\n                  locale={datePickerLocale}\n                />\n              </Col>\n            )}\n          </Row>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme, t } from '@superset-ui/core';\n\nimport { Tooltip } from 'src/components/Tooltip';\nimport { ClassNames } from '@emotion/react';\n\nconst TIME_PICKER_HELPER = (\n  <>\n    <div>\n      <h3>DATETIME</h3>\n      <p>{t('Return to specific datetime.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>datetime([string])</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetime(\"2020-03-01 12:00:00\")\ndatetime(\"now\")\ndatetime(\"last year\")`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATEADD</h3>\n      <p>{t('Moves the given set of dates by a specified interval.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`dateadd(datetime(\"today\"), -13, day)\ndateadd(datetime(\"2020-03-01\"), 2, day)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATETRUNC</h3>\n      <p>\n        {t(\n          'Truncates the specified date to the accuracy specified by the date unit.',\n        )}\n      </p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetrunc(datetime(\"2020-03-01\"), week)\ndatetrunc(datetime(\"2020-03-01\"), month)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>LASTDAY</h3>\n      <p>{t('Get the last date by the date unit.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`lastday([datetime], [dateunit])\ndateunit = (year | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>lastday(datetime(\"today\"), month)</code>\n      </pre>\n    </div>\n    <div>\n      <h3>HOLIDAY</h3>\n      <p>{t('Get the specify date for the holiday')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`holiday(\"new year\")\nholiday(\"christmas\", datetime(\"2019\"))\nholiday(\"christmas\", dateadd(datetime(\"2019\"), 1, year))\nholiday(\"christmas\", datetime(\"2 years ago\"))\nholiday(\"Easter Monday\", datetime(\"2019\"), \"UK\")`}</code>\n      </pre>\n    </div>\n  </>\n);\n\nconst StyledTooltip = (props: any) => {\n  const theme = useTheme();\n  return (\n    <ClassNames>\n      {({ css }) => (\n        <Tooltip\n          overlayClassName={css`\n            .ant-tooltip-content {\n              min-width: ${theme.gridUnit * 125}px;\n              max-height: 410px;\n              overflow-y: scroll;\n\n              .ant-tooltip-inner {\n                max-width: ${theme.gridUnit * 125}px;\n                h3 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                h4 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                pre {\n                  border: none;\n                  text-align: left;\n                  word-break: break-word;\n                  font-size: ${theme.typography.sizes.s}px;\n                }\n              }\n            }\n          `}\n          {...props}\n        />\n      )}\n    </ClassNames>\n  );\n};\n\nexport default function DateFunctionTooltip(props: any) {\n  return <StyledTooltip title={TIME_PICKER_HELPER} {...props} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { SEPARATOR } from 'src/explore/components/controls/DateFilterControl/utils';\nimport { Input } from 'src/components/Input';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { FrameComponentProps } from 'src/explore/components/controls/DateFilterControl/types';\nimport DateFunctionTooltip from './DateFunctionTooltip';\n\nfunction getAdvancedRange(value: string): string {\n  if (value.includes(SEPARATOR)) {\n    return value;\n  }\n  if (value.startsWith('Last')) {\n    return [value, ''].join(SEPARATOR);\n  }\n  if (value.startsWith('Next')) {\n    return ['', value].join(SEPARATOR);\n  }\n  return SEPARATOR;\n}\n\nexport function AdvancedFrame(props: FrameComponentProps) {\n  const advancedRange = getAdvancedRange(props.value || '');\n  const [since, until] = advancedRange.split(SEPARATOR);\n  if (advancedRange !== props.value) {\n    props.onChange(getAdvancedRange(props.value || ''));\n  }\n\n  function onChange(control: 'since' | 'until', value: string) {\n    if (control === 'since') {\n      props.onChange(`${value}${SEPARATOR}${until}`);\n    } else {\n      props.onChange(`${since}${SEPARATOR}${value}`);\n    }\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Advanced Time Range ')}\n        <DateFunctionTooltip placement=\"rightBottom\">\n          <i className=\"fa fa-info-circle text-muted\" />\n        </DateFunctionTooltip>\n      </div>\n      <div className=\"control-label\">\n        {t('START (INCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('Start date included in time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"since\"\n        value={since}\n        onChange={e => onChange('since', e.target.value)}\n      />\n      <div className=\"control-label\">\n        {t('END (EXCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('End date excluded from time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"until\"\n        value={until}\n        onChange={e => onChange('until', e.target.value)}\n      />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { forwardRef, ReactNode, RefObject } from 'react';\nimport { css, styled, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\n\nexport type DateLabelProps = {\n  label: ReactNode;\n  isActive?: boolean;\n  isPlaceholder?: boolean;\n  onClick?: (event: React.MouseEvent) => void;\n};\n\n// This is the color that antd components (such as Select or Input) use on hover\n// TODO: use theme.colors.primary.base here and in antd components\nconst ACTIVE_BORDER_COLOR = '#45BED6';\n\nconst LabelContainer = styled.div<{\n  isActive?: boolean;\n  isPlaceholder?: boolean;\n}>`\n  ${({ theme, isActive, isPlaceholder }) => css`\n    width: 100%;\n    height: ${theme.gridUnit * 8}px;\n\n    display: flex;\n    align-items: center;\n    flex-wrap: nowrap;\n\n    padding: 0 ${theme.gridUnit * 3}px;\n\n    background-color: ${theme.colors.grayscale.light5};\n\n    border: 1px solid\n      ${isActive ? ACTIVE_BORDER_COLOR : theme.colors.grayscale.light2};\n    border-radius: ${theme.borderRadius}px;\n\n    cursor: pointer;\n\n    transition: border-color 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);\n    :hover,\n    :focus {\n      border-color: ${ACTIVE_BORDER_COLOR};\n    }\n\n    .date-label-content {\n      color: ${isPlaceholder\n        ? theme.colors.grayscale.light1\n        : theme.colors.grayscale.dark1};\n      overflow: hidden;\n      text-overflow: ellipsis;\n      min-width: 0;\n      flex-shrink: 1;\n      white-space: nowrap;\n    }\n\n    span[role='img'] {\n      margin-left: auto;\n      padding-left: ${theme.gridUnit}px;\n\n      & > span[role='img'] {\n        line-height: 0;\n      }\n    }\n  `}\n`;\n\nexport const DateLabel = forwardRef(\n  (props: DateLabelProps, ref: RefObject<HTMLSpanElement>) => {\n    const theme = useTheme();\n    return (\n      <LabelContainer {...props} tabIndex={0}>\n        <span className=\"date-label-content\" ref={ref}>\n          {props.label}\n        </span>\n        <Icons.CalendarOutlined\n          iconSize=\"s\"\n          iconColor={theme.colors.grayscale.base}\n        />\n      </LabelContainer>\n    );\n  },\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useState, useEffect, useMemo } from 'react';\nimport {\n  css,\n  styled,\n  t,\n  useTheme,\n  NO_TIME_RANGE,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport Button from 'src/components/Button';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Modal from 'src/components/Modal';\nimport { Divider } from 'src/components';\nimport Icons from 'src/components/Icons';\nimport Select from 'src/components/Select/Select';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { noOp } from 'src/utils/common';\nimport { useCSSTextTruncation } from 'src/hooks/useTruncation';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nimport { DateFilterControlProps, FrameType } from './types';\nimport {\n  DATE_FILTER_TEST_KEY,\n  fetchTimeRange,\n  FRAME_OPTIONS,\n  guessFrame,\n  useDefaultTimeFilter,\n} from './utils';\nimport {\n  CommonFrame,\n  CalendarFrame,\n  CustomFrame,\n  AdvancedFrame,\n  DateLabel,\n} from './components';\n\nconst StyledRangeType = styled(Select)`\n  width: 272px;\n`;\n\nconst ContentStyleWrapper = styled.div`\n  ${({ theme }) => css`\n    .ant-row {\n      margin-top: 8px;\n    }\n\n    .ant-input-number {\n      width: 100%;\n    }\n\n    .ant-picker {\n      padding: 4px 17px 4px;\n      border-radius: 4px;\n      width: 100%;\n    }\n\n    .ant-divider-horizontal {\n      margin: 16px 0;\n    }\n\n    .control-label {\n      font-size: 11px;\n      font-weight: ${theme.typography.weights.medium};\n      color: ${theme.colors.grayscale.light2};\n      line-height: 16px;\n      text-transform: uppercase;\n      margin: 8px 0;\n    }\n\n    .vertical-radio {\n      display: block;\n      height: 40px;\n      line-height: 40px;\n    }\n\n    .section-title {\n      font-style: normal;\n      font-weight: ${theme.typography.weights.bold};\n      font-size: 15px;\n      line-height: 24px;\n      margin-bottom: 8px;\n    }\n\n    .control-anchor-to {\n      margin-top: 16px;\n    }\n\n    .control-anchor-to-datetime {\n      width: 217px;\n    }\n\n    .footer {\n      text-align: right;\n    }\n  `}\n`;\n\nconst IconWrapper = styled.span`\n  span {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n  .error {\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n`;\n\nconst getTooltipTitle = (\n  isLabelTruncated: boolean,\n  label: string | undefined,\n  range: string | undefined,\n) =>\n  isLabelTruncated ? (\n    <div>\n      {label && <strong>{label}</strong>}\n      {range && (\n        <div\n          css={(theme: SupersetTheme) => css`\n            margin-top: ${theme.gridUnit}px;\n          `}\n        >\n          {range}\n        </div>\n      )}\n    </div>\n  ) : (\n    range || null\n  );\n\nexport default function DateFilterLabel(props: DateFilterControlProps) {\n  const {\n    onChange,\n    onOpenPopover = noOp,\n    onClosePopover = noOp,\n    overlayStyle = 'Popover',\n    isOverflowingFilterBar = false,\n  } = props;\n  const defaultTimeFilter = useDefaultTimeFilter();\n\n  const value = props.value ?? defaultTimeFilter;\n  const [actualTimeRange, setActualTimeRange] = useState<string>(value);\n\n  const [show, setShow] = useState<boolean>(false);\n  const guessedFrame = useMemo(() => guessFrame(value), [value]);\n  const [frame, setFrame] = useState<FrameType>(guessedFrame);\n  const [lastFetchedTimeRange, setLastFetchedTimeRange] = useState(value);\n  const [timeRangeValue, setTimeRangeValue] = useState(value);\n  const [validTimeRange, setValidTimeRange] = useState<boolean>(false);\n  const [evalResponse, setEvalResponse] = useState<string>(value);\n  const [tooltipTitle, setTooltipTitle] = useState<ReactNode | null>(value);\n  const theme = useTheme();\n  const [labelRef, labelIsTruncated] = useCSSTextTruncation<HTMLSpanElement>();\n\n  useEffect(() => {\n    if (value === NO_TIME_RANGE) {\n      setActualTimeRange(NO_TIME_RANGE);\n      setTooltipTitle(null);\n      setValidTimeRange(true);\n      return;\n    }\n    fetchTimeRange(value).then(({ value: actualRange, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n        setTooltipTitle(value || null);\n      } else {\n        /*\n          HRT == human readable text\n          ADR == actual datetime range\n          +--------------+------+----------+--------+----------+-----------+\n          |              | Last | Previous | Custom | Advanced | No Filter |\n          +--------------+------+----------+--------+----------+-----------+\n          | control pill | HRT  | HRT      | ADR    | ADR      |   HRT     |\n          +--------------+------+----------+--------+----------+-----------+\n          | tooltip      | ADR  | ADR      | HRT    | HRT      |   ADR     |\n          +--------------+------+----------+--------+----------+-----------+\n        */\n        if (\n          guessedFrame === 'Common' ||\n          guessedFrame === 'Calendar' ||\n          guessedFrame === 'No filter'\n        ) {\n          setActualTimeRange(value);\n          setTooltipTitle(\n            getTooltipTitle(labelIsTruncated, value, actualRange),\n          );\n        } else {\n          setActualTimeRange(actualRange || '');\n          setTooltipTitle(\n            getTooltipTitle(labelIsTruncated, actualRange, value),\n          );\n        }\n        setValidTimeRange(true);\n      }\n      setLastFetchedTimeRange(value);\n      setEvalResponse(actualRange || value);\n    });\n  }, [guessedFrame, labelIsTruncated, labelRef, value]);\n\n  useDebouncedEffect(\n    () => {\n      if (timeRangeValue === NO_TIME_RANGE) {\n        setEvalResponse(NO_TIME_RANGE);\n        setLastFetchedTimeRange(NO_TIME_RANGE);\n        setValidTimeRange(true);\n        return;\n      }\n      if (lastFetchedTimeRange !== timeRangeValue) {\n        fetchTimeRange(timeRangeValue).then(({ value: actualRange, error }) => {\n          if (error) {\n            setEvalResponse(error || '');\n            setValidTimeRange(false);\n          } else {\n            setEvalResponse(actualRange || '');\n            setValidTimeRange(true);\n          }\n          setLastFetchedTimeRange(timeRangeValue);\n        });\n      }\n    },\n    SLOW_DEBOUNCE,\n    [timeRangeValue],\n  );\n\n  function onSave() {\n    onChange(timeRangeValue);\n    setShow(false);\n    onClosePopover();\n  }\n\n  function onOpen() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(true);\n    onOpenPopover();\n  }\n\n  function onHide() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(false);\n    onClosePopover();\n  }\n\n  const toggleOverlay = () => {\n    if (show) {\n      onHide();\n    } else {\n      onOpen();\n    }\n  };\n\n  function onChangeFrame(value: FrameType) {\n    if (value === NO_TIME_RANGE) {\n      setTimeRangeValue(NO_TIME_RANGE);\n    }\n    setFrame(value);\n  }\n\n  const overlayContent = (\n    <ContentStyleWrapper>\n      <div className=\"control-label\">{t('RANGE TYPE')}</div>\n      <StyledRangeType\n        ariaLabel={t('RANGE TYPE')}\n        options={FRAME_OPTIONS}\n        value={frame}\n        onChange={onChangeFrame}\n      />\n      {frame !== 'No filter' && <Divider />}\n      {frame === 'Common' && (\n        <CommonFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Calendar' && (\n        <CalendarFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Advanced' && (\n        <AdvancedFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Custom' && (\n        <CustomFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'No filter' && (\n        <div data-test={DATE_FILTER_TEST_KEY.noFilter} />\n      )}\n      <Divider />\n      <div>\n        <div className=\"section-title\">{t('Actual time range')}</div>\n        {validTimeRange && <div>{evalResponse}</div>}\n        {!validTimeRange && (\n          <IconWrapper className=\"warning\">\n            <Icons.ErrorSolidSmall iconColor={theme.colors.error.base} />\n            <span className=\"text error\">{evalResponse}</span>\n          </IconWrapper>\n        )}\n      </div>\n      <Divider />\n      <div className=\"footer\">\n        <Button\n          buttonStyle=\"secondary\"\n          cta\n          key=\"cancel\"\n          onClick={onHide}\n          data-test={DATE_FILTER_TEST_KEY.cancelButton}\n        >\n          {t('CANCEL')}\n        </Button>\n        <Button\n          buttonStyle=\"primary\"\n          cta\n          disabled={!validTimeRange}\n          key=\"apply\"\n          onClick={onSave}\n          data-test={DATE_FILTER_TEST_KEY.applyButton}\n        >\n          {t('APPLY')}\n        </Button>\n      </div>\n    </ContentStyleWrapper>\n  );\n\n  const title = (\n    <IconWrapper>\n      <Icons.EditAlt iconColor={theme.colors.grayscale.base} />\n      <span className=\"text\">{t('Edit time range')}</span>\n    </IconWrapper>\n  );\n\n  const popoverContent = (\n    <ControlPopover\n      placement=\"right\"\n      trigger=\"click\"\n      content={overlayContent}\n      title={title}\n      defaultVisible={show}\n      visible={show}\n      onVisibleChange={toggleOverlay}\n      overlayStyle={{ width: '600px' }}\n      getPopupContainer={triggerNode =>\n        isOverflowingFilterBar\n          ? (triggerNode.parentNode as HTMLElement)\n          : document.body\n      }\n      destroyTooltipOnHide\n    >\n      <Tooltip placement=\"top\" title={tooltipTitle}>\n        <DateLabel\n          label={actualTimeRange}\n          isActive={show}\n          isPlaceholder={actualTimeRange === NO_TIME_RANGE}\n          data-test={DATE_FILTER_TEST_KEY.popoverOverlay}\n          ref={labelRef}\n        />\n      </Tooltip>\n    </ControlPopover>\n  );\n\n  const modalContent = (\n    <>\n      <Tooltip placement=\"top\" title={tooltipTitle}>\n        <DateLabel\n          onClick={toggleOverlay}\n          label={actualTimeRange}\n          isActive={show}\n          isPlaceholder={actualTimeRange === NO_TIME_RANGE}\n          data-test={DATE_FILTER_TEST_KEY.modalOverlay}\n          ref={labelRef}\n        />\n      </Tooltip>\n      {/* the zIndex value is from trying so that the Modal doesn't overlay the AdhocFilter when GENERIC_CHART_AXES is enabled */}\n      <Modal\n        title={title}\n        show={show}\n        onHide={toggleOverlay}\n        width=\"600px\"\n        hideFooter\n        zIndex={1030}\n      >\n        {overlayContent}\n      </Modal>\n    </>\n  );\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      {overlayStyle === 'Modal' ? modalContent : popoverContent}\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type SelectOptionType = {\n  value: string;\n  label: string;\n};\n\nexport type FrameType =\n  | 'Common'\n  | 'Calendar'\n  | 'Custom'\n  | 'Advanced'\n  | 'No filter';\n\nexport type DateTimeGrainType =\n  | 'second'\n  | 'minute'\n  | 'hour'\n  | 'day'\n  | 'week'\n  | 'month'\n  | 'quarter'\n  | 'year';\n\nexport type CustomRangeKey =\n  | 'sinceMode'\n  | 'sinceDatetime'\n  | 'sinceGrain'\n  | 'sinceGrainValue'\n  | 'untilMode'\n  | 'untilDatetime'\n  | 'untilGrain'\n  | 'untilGrainValue'\n  | 'anchorMode'\n  | 'anchorValue';\n\nexport type DateTimeModeType = 'specific' | 'relative' | 'now' | 'today';\n\nexport type CustomRangeType = {\n  sinceMode: DateTimeModeType;\n  sinceDatetime: string;\n  sinceGrain: DateTimeGrainType;\n  sinceGrainValue: number;\n  untilMode: DateTimeModeType;\n  untilDatetime: string;\n  untilGrain: DateTimeGrainType;\n  untilGrainValue: number;\n  anchorMode: 'now' | 'specific';\n  anchorValue: string;\n};\n\nexport type CustomRangeDecodeType = {\n  customRange: CustomRangeType;\n  matchedFlag: boolean;\n};\n\nexport type CommonRangeType =\n  | 'Last day'\n  | 'Last week'\n  | 'Last month'\n  | 'Last quarter'\n  | 'Last year';\n\nexport const PreviousCalendarWeek = 'previous calendar week';\nexport const PreviousCalendarMonth = 'previous calendar month';\nexport const PreviousCalendarYear = 'previous calendar year';\nexport type CalendarRangeType =\n  | typeof PreviousCalendarWeek\n  | typeof PreviousCalendarMonth\n  | typeof PreviousCalendarYear;\n\nexport type FrameComponentProps = {\n  onChange: (timeRange: string) => void;\n  value: string;\n};\n\nexport interface DateFilterControlProps {\n  name: string;\n  onChange: (timeRange: string) => void;\n  value?: string;\n  onOpenPopover?: () => void;\n  onClosePopover?: () => void;\n  overlayStyle?: 'Modal' | 'Popover';\n  isOverflowingFilterBar?: boolean;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { SupersetClient, NO_TIME_RANGE, JsonObject } from '@superset-ui/core';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { useSelector } from 'react-redux';\nimport {\n  COMMON_RANGE_VALUES_SET,\n  CALENDAR_RANGE_VALUES_SET,\n  customTimeRangeDecode,\n} from '.';\nimport { FrameType } from '../types';\n\nexport const SEPARATOR = ' : ';\n\nexport const buildTimeRangeString = (since: string, until: string): string =>\n  `${since}${SEPARATOR}${until}`;\n\nconst formatDateEndpoint = (dttm: string, isStart?: boolean): string =>\n  dttm.replace('T00:00:00', '') || (isStart ? '-∞' : '∞');\n\nexport const formatTimeRange = (\n  timeRange: string,\n  columnPlaceholder = 'col',\n) => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n  if (splitDateRange.length === 1) return timeRange;\n  return `${formatDateEndpoint(\n    splitDateRange[0],\n    true,\n  )} ≤ ${columnPlaceholder} < ${formatDateEndpoint(splitDateRange[1])}`;\n};\n\nexport const guessFrame = (timeRange: string): FrameType => {\n  if (COMMON_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Common';\n  }\n  if (CALENDAR_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Calendar';\n  }\n  if (timeRange === NO_TIME_RANGE) {\n    return 'No filter';\n  }\n  if (customTimeRangeDecode(timeRange).matchedFlag) {\n    return 'Custom';\n  }\n  return 'Advanced';\n};\n\nexport const fetchTimeRange = async (\n  timeRange: string,\n  columnPlaceholder = 'col',\n) => {\n  const query = rison.encode_uri(timeRange);\n  const endpoint = `/api/v1/time_range/?q=${query}`;\n  try {\n    const response = await SupersetClient.get({ endpoint });\n    const timeRangeString = buildTimeRangeString(\n      response?.json?.result?.since || '',\n      response?.json?.result?.until || '',\n    );\n    return {\n      value: formatTimeRange(timeRangeString, columnPlaceholder),\n    };\n  } catch (response) {\n    const clientError = await getClientErrorObject(response);\n    return {\n      error: clientError.message || clientError.error || response.statusText,\n    };\n  }\n};\n\nexport function useDefaultTimeFilter() {\n  return (\n    useSelector(\n      (state: JsonObject) => state?.common?.conf?.DEFAULT_TIME_FILTER,\n    ) ?? NO_TIME_RANGE\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport { t } from '@superset-ui/core';\nimport {\n  SelectOptionType,\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n  CommonRangeType,\n  CalendarRangeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport const FRAME_OPTIONS: SelectOptionType[] = [\n  { value: 'Common', label: t('Last') },\n  { value: 'Calendar', label: t('Previous') },\n  { value: 'Custom', label: t('Custom') },\n  { value: 'Advanced', label: t('Advanced') },\n  { value: 'No filter', label: t('No filter') },\n];\n\nexport const COMMON_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: 'Last day', label: t('last day') },\n  { value: 'Last week', label: t('last week') },\n  { value: 'Last month', label: t('last month') },\n  { value: 'Last quarter', label: t('last quarter') },\n  { value: 'Last year', label: t('last year') },\n];\nexport const COMMON_RANGE_VALUES_SET = new Set(\n  COMMON_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nexport const CALENDAR_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: PreviousCalendarWeek, label: t('previous calendar week') },\n  {\n    value: PreviousCalendarMonth,\n    label: t('previous calendar month'),\n  },\n  { value: PreviousCalendarYear, label: t('previous calendar year') },\n];\nexport const CALENDAR_RANGE_VALUES_SET = new Set(\n  CALENDAR_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nconst GRAIN_OPTIONS = [\n  { value: 'second', label: (rel: string) => t('Seconds %s', rel) },\n  { value: 'minute', label: (rel: string) => t('Minutes %s', rel) },\n  { value: 'hour', label: (rel: string) => t('Hours %s', rel) },\n  { value: 'day', label: (rel: string) => t('Days %s', rel) },\n  { value: 'week', label: (rel: string) => t('Weeks %s', rel) },\n  { value: 'month', label: (rel: string) => t('Months %s', rel) },\n  { value: 'quarter', label: (rel: string) => t('Quarters %s', rel) },\n  { value: 'year', label: (rel: string) => t('Years %s', rel) },\n];\n\nexport const SINCE_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('Before')),\n  }),\n);\n\nexport const UNTIL_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('After')),\n  }),\n);\n\nexport const SINCE_MODE_OPTIONS: SelectOptionType[] = [\n  { value: 'specific', label: t('Specific Date/Time') },\n  { value: 'relative', label: t('Relative Date/Time') },\n  { value: 'now', label: t('Now') },\n  { value: 'today', label: t('Midnight') },\n];\n\nexport const UNTIL_MODE_OPTIONS: SelectOptionType[] =\n  SINCE_MODE_OPTIONS.slice();\n\nexport const COMMON_RANGE_SET: Set<CommonRangeType> = new Set([\n  'Last day',\n  'Last week',\n  'Last month',\n  'Last quarter',\n  'Last year',\n]);\n\nexport const CALENDAR_RANGE_SET: Set<CalendarRangeType> = new Set([\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n]);\n\nexport const MOMENT_FORMAT = 'YYYY-MM-DD[T]HH:mm:ss';\nexport const SEVEN_DAYS_AGO = moment()\n  .utc()\n  .startOf('day')\n  .subtract(7, 'days')\n  .format(MOMENT_FORMAT);\nexport const MIDNIGHT = moment().utc().startOf('day').format(MOMENT_FORMAT);\n\nexport const LOCALE_MAPPING = {\n  en: 'en_US',\n  fr: 'fr_FR',\n  es: 'es_ES',\n  it: 'it_IT',\n  zh: 'zh_CN',\n  ja: 'ja_JP',\n  de: 'de_DE',\n  pt: 'pt_PT',\n  pt_BR: 'pt_BR',\n  ru: 'ru_RU',\n  ko: 'ko_KR',\n  sk: 'sk_SK',\n  sl: 'sl_SI',\n  nl: 'nl_NL',\n};\n\nexport enum DATE_FILTER_TEST_KEY {\n  commonFrame = 'common-frame',\n  modalOverlay = 'modal-overlay',\n  popoverOverlay = 'time-range-trigger',\n  noFilter = 'no-filter',\n  cancelButton = 'cancel-button',\n  applyButton = 'date-filter-control__apply-button',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment, { Moment } from 'moment';\nimport {\n  CustomRangeDecodeType,\n  CustomRangeType,\n  DateTimeGrainType,\n  DateTimeModeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\nimport { SEPARATOR } from './dateFilterUtils';\nimport { SEVEN_DAYS_AGO, MIDNIGHT, MOMENT_FORMAT } from './constants';\n\n/**\n * RegExp to test a string for a full ISO 8601 Date\n * Does not do any sort of date validation, only checks if the string is according to the ISO 8601 spec.\n *  YYYY-MM-DDThh:mm:ss\n *  YYYY-MM-DDThh:mm:ssTZD\n *  YYYY-MM-DDThh:mm:ss.sTZD\n * @see: https://www.w3.org/TR/NOTE-datetime\n */\nconst iso8601 = String.raw`\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.\\d+)?(?:(?:[+-]\\d\\d:\\d\\d)|Z)?`;\nconst datetimeConstant = String.raw`(?:TODAY|NOW)`;\nconst grainValue = String.raw`[+-]?[1-9][0-9]*`;\nconst grain = String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`;\nconst CUSTOM_RANGE_EXPRESSION = RegExp(\n  String.raw`^DATEADD\\(DATETIME\\(\"(${iso8601}|${datetimeConstant})\"\\),\\s(${grainValue}),\\s(${grain})\\)$`,\n  'i',\n);\nexport const ISO8601_AND_CONSTANT = RegExp(\n  String.raw`^${iso8601}$|^${datetimeConstant}$`,\n  'i',\n);\nconst DATETIME_CONSTANT = ['now', 'today'];\nconst defaultCustomRange: CustomRangeType = {\n  sinceDatetime: SEVEN_DAYS_AGO,\n  sinceMode: 'relative',\n  sinceGrain: 'day',\n  sinceGrainValue: -7,\n  untilDatetime: MIDNIGHT,\n  untilMode: 'specific',\n  untilGrain: 'day',\n  untilGrainValue: 7,\n  anchorMode: 'now',\n  anchorValue: 'now',\n};\nconst SPECIFIC_MODE = ['specific', 'today', 'now'];\n\nexport const dttmToMoment = (dttm: string): Moment => {\n  if (dttm === 'now') {\n    return moment().utc().startOf('second');\n  }\n  if (dttm === 'today') {\n    return moment().utc().startOf('day');\n  }\n  return moment(dttm);\n};\n\nexport const dttmToString = (dttm: string): string =>\n  dttmToMoment(dttm).format(MOMENT_FORMAT);\n\nexport const customTimeRangeDecode = (\n  timeRange: string,\n): CustomRangeDecodeType => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n\n  if (splitDateRange.length === 2) {\n    const [since, until] = splitDateRange;\n\n    // specific : specific\n    if (ISO8601_AND_CONSTANT.test(since) && ISO8601_AND_CONSTANT.test(until)) {\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceDatetime: since,\n          untilDatetime: until,\n          sinceMode,\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : specific\n    const sinceCapturedGroup = since.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      sinceCapturedGroup &&\n      ISO8601_AND_CONSTANT.test(until) &&\n      since.includes(until)\n    ) {\n      const [dttm, grainValue, grain] = sinceCapturedGroup.slice(1);\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceGrain: grain as DateTimeGrainType,\n          sinceGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          sinceMode: 'relative',\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // specific : relative\n    const untilCapturedGroup = until.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      ISO8601_AND_CONSTANT.test(since) &&\n      untilCapturedGroup &&\n      until.includes(since)\n    ) {\n      const [dttm, grainValue, grain] = [...untilCapturedGroup.slice(1)];\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          untilGrain: grain as DateTimeGrainType,\n          untilGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          untilMode: 'relative',\n          sinceMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : relative\n    if (sinceCapturedGroup && untilCapturedGroup) {\n      const [sinceDttm, sinceGrainValue, sinceGrain] = [\n        ...sinceCapturedGroup.slice(1),\n      ];\n      const [untileDttm, untilGrainValue, untilGrain] = [\n        ...untilCapturedGroup.slice(1),\n      ];\n      if (sinceDttm === untileDttm) {\n        return {\n          customRange: {\n            ...defaultCustomRange,\n            sinceGrain: sinceGrain as DateTimeGrainType,\n            sinceGrainValue: parseInt(sinceGrainValue, 10),\n            sinceDatetime: sinceDttm,\n            untilGrain: untilGrain as DateTimeGrainType,\n            untilGrainValue: parseInt(untilGrainValue, 10),\n            untilDatetime: untileDttm,\n            anchorValue: sinceDttm,\n            sinceMode: 'relative',\n            untilMode: 'relative',\n            anchorMode: sinceDttm === 'now' ? 'now' : 'specific',\n          },\n          matchedFlag: true,\n        };\n      }\n    }\n  }\n\n  return {\n    customRange: defaultCustomRange,\n    matchedFlag: false,\n  };\n};\n\nexport const customTimeRangeEncode = (customRange: CustomRangeType): string => {\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n  } = { ...customRange };\n  // specific : specific\n  if (SPECIFIC_MODE.includes(sinceMode) && SPECIFIC_MODE.includes(untilMode)) {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    return `${since} : ${until}`;\n  }\n\n  // specific : relative\n  if (SPECIFIC_MODE.includes(sinceMode) && untilMode === 'relative') {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until = `DATEADD(DATETIME(\"${since}\"), ${untilGrainValue}, ${untilGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : specific\n  if (sinceMode === 'relative' && SPECIFIC_MODE.includes(untilMode)) {\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    const since = `DATEADD(DATETIME(\"${until}\"), ${-Math.abs(\n      sinceGrainValue,\n    )}, ${sinceGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : relative\n  const since = `DATEADD(DATETIME(\"${anchorValue}\"), ${-Math.abs(\n    sinceGrainValue,\n  )}, ${sinceGrain})`;\n  const until = `DATEADD(DATETIME(\"${anchorValue}\"), ${untilGrainValue}, ${untilGrain})`;\n  return `${since} : ${until}`;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport { ensureIsArray, SupersetClient, t } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport rison from 'rison';\nimport { AdvancedDataTypesState, Props } from './index';\n\nconst INITIAL_ADVANCED_DATA_TYPES_STATE: AdvancedDataTypesState = {\n  parsedAdvancedDataType: '',\n  advancedDataTypeOperatorList: [],\n  errorMessage: '',\n};\n\nconst useAdvancedDataTypes = (validHandler: (isValid: boolean) => void) => {\n  const [advancedDataTypesState, setAdvancedDataTypesState] =\n    useState<AdvancedDataTypesState>(INITIAL_ADVANCED_DATA_TYPES_STATE);\n  const [subjectAdvancedDataType, setSubjectAdvancedDataType] = useState<\n    string | undefined\n  >();\n\n  const fetchAdvancedDataTypeValueCallback = useCallback(\n    (\n      comp: string | string[],\n      advancedDataTypesState: AdvancedDataTypesState,\n      subjectAdvancedDataType?: string,\n    ) => {\n      const values = ensureIsArray(comp);\n      if (!subjectAdvancedDataType) {\n        setAdvancedDataTypesState(INITIAL_ADVANCED_DATA_TYPES_STATE);\n        return;\n      }\n      debounce(() => {\n        const queryParams = rison.encode({\n          type: subjectAdvancedDataType,\n          values,\n        });\n        const endpoint = `/api/v1/advanced_data_type/convert?q=${queryParams}`;\n        SupersetClient.get({ endpoint })\n          .then(({ json }) => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: json.result.display_value,\n              advancedDataTypeOperatorList: json.result.valid_filter_operators,\n              errorMessage: json.result.error_message,\n            });\n            // Changed due to removal of status field\n            validHandler(!json.result.error_message);\n          })\n          .catch(() => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: '',\n              advancedDataTypeOperatorList:\n                advancedDataTypesState.advancedDataTypeOperatorList,\n              errorMessage: t('Failed to retrieve advanced type'),\n            });\n            validHandler(false);\n          });\n      }, 600)();\n    },\n    [validHandler],\n  );\n\n  const fetchSubjectAdvancedDataType = (props: Props) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option &&\n          option.column_name === props.adhocFilter.subject) ||\n        ('optionName' in option &&\n          option.optionName === props.adhocFilter.subject),\n    );\n    if (option && 'advanced_data_type' in option) {\n      setSubjectAdvancedDataType(option.advanced_data_type);\n    } else {\n      props.validHandler(true);\n    }\n  };\n\n  return {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    setAdvancedDataTypesState,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  };\n};\n\nexport default useAdvancedDataTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport FormItem from 'src/components/Form/FormItem';\nimport { Select } from 'src/components';\nimport {\n  t,\n  SupersetClient,\n  SupersetTheme,\n  styled,\n  hasGenericChartAxes,\n  isDefined,\n} from '@superset-ui/core';\nimport {\n  Operators,\n  OPERATORS_OPTIONS,\n  HAVING_OPERATORS,\n  MULTI_OPERATORS,\n  CUSTOM_OPERATORS,\n  DISABLE_INPUT_OPERATORS,\n  AGGREGATES,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport { optionLabel } from 'src/utils/common';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport {\n  ColumnMeta,\n  Dataset,\n  isTemporalColumn,\n} from '@superset-ui/chart-controls';\nimport useAdvancedDataTypes from './useAdvancedDataTypes';\nimport { useDatePickerInAdhocFilter } from '../utils';\nimport { useDefaultTimeFilter } from '../../DateFilterControl/utils';\n\nconst StyledInput = styled(Input)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledFormItem = styled(FormItem)`\n  &.ant-row.ant-form-item {\n    margin: 0;\n  }\n`;\n\nconst SelectWithLabel = styled(Select)<{ labelText: string }>`\n  .ant-select-selector::after {\n    content: ${({ labelText }) => labelText || '\\\\A0'};\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\n\nexport interface SimpleExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  column: ColumnMeta;\n  aggregate: keyof typeof AGGREGATES;\n  label: string;\n}\nexport interface SQLExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  sqlExpression: string;\n  label: string;\n}\n\nexport interface MetricColumnType {\n  saved_metric_name: string;\n}\n\nexport type ColumnType =\n  | ColumnMeta\n  | SimpleExpressionType\n  | SQLExpressionType\n  | MetricColumnType;\n\nexport interface Props {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: ColumnType[];\n  datasource: Dataset;\n  partitionColumn: string;\n  operators?: Operators[];\n  validHandler: (isValid: boolean) => void;\n}\n\nexport interface AdvancedDataTypesState {\n  parsedAdvancedDataType: string;\n  advancedDataTypeOperatorList: string[];\n  errorMessage: string;\n}\n\nexport const useSimpleTabFilterProps = (props: Props) => {\n  const defaultTimeFilter = useDefaultTimeFilter();\n\n  const isOperatorRelevant = (operator: Operators, subject: string) => {\n    const column = props.datasource.columns?.find(\n      col => col.column_name === subject,\n    );\n    const isColumnBoolean =\n      !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber =\n      !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n\n    if (operator && operator === Operators.LATEST_PARTITION) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator && operator === Operators.TEMPORAL_RANGE) {\n      // hide the TEMPORAL_RANGE operator\n      return false;\n    }\n    if (operator === Operators.IS_TRUE || operator === Operators.IS_FALSE) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return (\n        operator === Operators.IS_NULL || operator === Operators.IS_NOT_NULL\n      );\n    }\n    return (\n      props.adhocFilter.clause !== CLAUSES.HAVING ||\n      HAVING_OPERATORS.indexOf(operator) !== -1\n    );\n  };\n  const onSubjectChange = (id: string) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option && option.column_name === id) ||\n        ('optionName' in option && option.optionName === id),\n    );\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = CLAUSES.WHERE;\n    } else if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = CLAUSES.HAVING;\n    } else if (option?.label) {\n      subject = option.label;\n      clause = CLAUSES.HAVING;\n    }\n    let { operator, operatorId, comparator } = props.adhocFilter;\n    operator =\n      operator && operatorId && isOperatorRelevant(operatorId, subject)\n        ? OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation\n        : null;\n    if (!isDefined(operator)) {\n      // if operator is `null`, use the `IN` and reset the comparator.\n      operator = Operators.IN;\n      operatorId = Operators.IN;\n      comparator = undefined;\n    }\n\n    if (hasGenericChartAxes && isTemporalColumn(id, props.datasource)) {\n      subject = id;\n      operator = Operators.TEMPORAL_RANGE;\n      operatorId = Operators.TEMPORAL_RANGE;\n      comparator = defaultTimeFilter;\n    }\n\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject,\n        clause,\n        operator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        operatorId,\n        comparator,\n      }),\n    );\n  };\n  const onOperatorChange = (operatorId: Operators) => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator\n        : [currentComparator].filter(element => element);\n    } else {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator[0]\n        : currentComparator;\n    }\n    if (operatorId === Operators.IS_TRUE || operatorId === Operators.IS_FALSE) {\n      newComparator = Operators.IS_TRUE === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          subject: props.adhocFilter.subject,\n          clause: CLAUSES.WHERE,\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          expressionType: EXPRESSION_TYPES.SQL,\n          datasource: props.datasource,\n        }),\n      );\n    } else {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          comparator: newComparator,\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n        }),\n      );\n    }\n  };\n  const onComparatorChange = (comparator: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        comparator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  const clearOperator = (): void => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        operatorId: undefined,\n        operator: undefined,\n      }),\n    );\n  };\n  const onDatePickerChange = (columnName: string, timeRange: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject: columnName,\n        operator: Operators.TEMPORAL_RANGE,\n        comparator: timeRange,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant,\n    clearOperator,\n    onDatePickerChange,\n  };\n};\n\nconst AdhocFilterEditPopoverSimpleTabContent: React.FC<Props> = props => {\n  const {\n    onSubjectChange,\n    onOperatorChange,\n    isOperatorRelevant,\n    onComparatorChange,\n    onDatePickerChange,\n  } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState<\n    Record<'label' | 'value', any>[]\n  >([]);\n  const [comparator, setComparator] = useState(props.adhocFilter.comparator);\n  const [loadingComparatorSuggestions, setLoadingComparatorSuggestions] =\n    useState(false);\n\n  const {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  } = useAdvancedDataTypes(props.validHandler);\n  // TODO: This does not need to exist, just use the advancedTypeOperatorList list\n  const isOperatorRelevantWrapper = (operator: Operators, subject: string) =>\n    subjectAdvancedDataType\n      ? isOperatorRelevant(operator, subject) &&\n        advancedDataTypesState.advancedDataTypeOperatorList.includes(operator)\n      : isOperatorRelevant(operator, subject);\n  const onInputComparatorChange = (\n    event: React.ChangeEvent<HTMLInputElement>,\n  ) => {\n    const { value } = event.target;\n    setComparator(value);\n    onComparatorChange(value);\n  };\n\n  const renderSubjectOptionLabel = (option: ColumnType) => (\n    <FilterDefinitionOption option={option} />\n  );\n\n  const getOptionsRemaining = () => {\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = Array.isArray(comparator)\n      ? comparator.filter(v => suggestions.includes(v)).length\n      : 0;\n    return suggestions?.length - valuesFromSuggestionsLength ?? 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n\n  const handleSubjectChange = (subject: string) => {\n    setComparator(undefined);\n    onSubjectChange(subject);\n  };\n\n  let columns = props.options;\n  const { subject, operator, operatorId } = props.adhocFilter;\n\n  const subjectSelectProps = {\n    ariaLabel: t('Select subject'),\n    value: subject ?? undefined,\n    onChange: handleSubjectChange,\n    notFoundContent: t(\n      'No such column found. To filter on a metric, try the Custom SQL tab.',\n    ),\n    autoFocus: !subject,\n    placeholder: '',\n  };\n\n  subjectSelectProps.placeholder =\n    props.adhocFilter.clause === CLAUSES.WHERE\n      ? t('%s column(s)', columns.length)\n      : t('To filter on a metric, use Custom SQL tab.');\n  columns = props.options.filter(\n    option => 'column_name' in option && option.column_name,\n  );\n\n  const operatorSelectProps = {\n    placeholder: t(\n      '%s operator(s)',\n      (props.operators ?? OPERATORS_OPTIONS).filter(op =>\n        isOperatorRelevantWrapper(op, subject),\n      ).length,\n    ),\n    value: operatorId,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    ariaLabel: t('Select operator'),\n  };\n\n  const shouldFocusComparator =\n    !!subjectSelectProps.value && !!operatorSelectProps.value;\n\n  const comparatorSelectProps = {\n    allowClear: true,\n    allowNewOptions: true,\n    ariaLabel: t('Comparator option'),\n    mode: MULTI_OPERATORS.has(operatorId)\n      ? ('multiple' as const)\n      : ('single' as const),\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: DISABLE_INPUT_OPERATORS.includes(operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator,\n  };\n\n  const labelText =\n    comparator && comparator.length > 0 && createSuggestionsPlaceholder();\n\n  const datePicker = useDatePickerInAdhocFilter({\n    columnName: props.adhocFilter.subject,\n    timeRange:\n      props.adhocFilter.operator === Operators.TEMPORAL_RANGE\n        ? props.adhocFilter.comparator\n        : undefined,\n    datasource: props.datasource,\n    onChange: onDatePickerChange,\n  });\n\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === CLAUSES.HAVING;\n\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/api/v1/datasource/${datasource.type}/${datasource.id}/column/${col}/values/`,\n        })\n          .then(({ json }) => {\n            setSuggestions(\n              json.result.map(\n                (suggestion: null | number | boolean | string) => ({\n                  value: suggestion,\n                  label: optionLabel(suggestion),\n                }),\n              ),\n            );\n            setLoadingComparatorSuggestions(false);\n          })\n          .catch(() => {\n            setSuggestions([]);\n            setLoadingComparatorSuggestions(false);\n          });\n      }\n    };\n    if (!datePicker) {\n      refreshComparatorSuggestions();\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchSubjectAdvancedDataType(props);\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchAdvancedDataTypeValueCallback(\n        comparator === undefined ? '' : comparator,\n        advancedDataTypesState,\n        subjectAdvancedDataType,\n      );\n    }\n  }, [comparator, subjectAdvancedDataType, fetchAdvancedDataTypeValueCallback]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      setComparator(props.adhocFilter.comparator);\n    }\n  }, [props.adhocFilter.comparator]);\n\n  // another name for columns, just for following previous naming.\n  const subjectComponent = (\n    <Select\n      css={(theme: SupersetTheme) => ({\n        marginTop: theme.gridUnit * 4,\n        marginBottom: theme.gridUnit * 4,\n      })}\n      data-test=\"select-element\"\n      options={columns.map(column => ({\n        value:\n          ('column_name' in column && column.column_name) ||\n          ('optionName' in column && column.optionName) ||\n          '',\n        label:\n          ('saved_metric_name' in column && column.saved_metric_name) ||\n          ('column_name' in column && column.column_name) ||\n          ('label' in column && column.label),\n        key:\n          ('id' in column && column.id) ||\n          ('optionName' in column && column.optionName) ||\n          undefined,\n        customLabel: renderSubjectOptionLabel(column),\n      }))}\n      {...subjectSelectProps}\n    />\n  );\n\n  const operatorsAndOperandComponent = (\n    <>\n      <Select\n        css={(theme: SupersetTheme) => ({ marginBottom: theme.gridUnit * 4 })}\n        options={(props.operators ?? OPERATORS_OPTIONS)\n          .filter(op => isOperatorRelevantWrapper(op, subject))\n          .map((option, index) => ({\n            value: option,\n            label: OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display,\n            key: option,\n            order: index,\n          }))}\n        {...operatorSelectProps}\n      />\n      {MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <SelectWithLabel\n            labelText={labelText}\n            options={suggestions}\n            {...comparatorSelectProps}\n          />\n        </Tooltip>\n      ) : (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <StyledInput\n            data-test=\"adhoc-filter-simple-value\"\n            name=\"filter-value\"\n            ref={ref => {\n              if (ref && shouldFocusComparator) {\n                ref.focus();\n              }\n            }}\n            onChange={onInputComparatorChange}\n            value={comparator}\n            placeholder={t('Filter value (case sensitive)')}\n            disabled={DISABLE_INPUT_OPERATORS.includes(operatorId)}\n          />\n        </Tooltip>\n      )}\n    </>\n  );\n  return (\n    <>\n      {subjectComponent}\n      {datePicker ?? operatorsAndOperandComponent}\n    </>\n  );\n};\n\nexport default AdhocFilterEditPopoverSimpleTabContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column'),\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange,\n    };\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.keys(CLAUSES).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <StyledSelect\n            options={selectOptions}\n            {...this.selectProps}\n            {...clauseSelectProps}\n          />\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  requireSave: PropTypes.bool,\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nconst FilterActionsContainer = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.setSimpleTabIsValid = this.setSimpleTabIsValid.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n      isSimpleTabValid: true,\n    };\n\n    this.popoverContentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  setSimpleTabIsValid(isValid) {\n    this.setState({ isSimpleTabValid: isValid });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      operators,\n      requireSave,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges =\n      requireSave || !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          data-test=\"adhoc-filter-edit-tabs\"\n          style={{ minHeight: this.state.height, width: this.state.width }}\n          allowOverflow\n          onChange={this.onTabChange}\n        >\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={t('Simple')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSimpleTabContent\n                operators={operators}\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={options}\n                datasource={datasource}\n                onHeightChange={this.adjustHeight}\n                partitionColumn={partitionColumn}\n                popoverRef={this.popoverContentRef.current}\n                validHandler={this.setSimpleTabIsValid}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SQL}\n            tab={t('Custom SQL')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSqlTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={this.props.options}\n                height={this.state.height}\n                activeKey={this.state.activeKey}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n        </Tabs>\n        <FilterActionsContainer>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={\n              !stateIsValid ||\n              !this.state.isSimpleTabValid ||\n              !hasUnsavedChanges\n            }\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </FilterActionsContainer>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { OptionSortType } from 'src/explore/types';\nimport AdhocFilterEditPopover from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopover';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { Operators } from 'src/explore/constants';\nimport ControlPopover from '../../ControlPopover/ControlPopover';\n\ninterface AdhocFilterPopoverTriggerProps {\n  sections?: string[];\n  operators?: Operators[];\n  adhocFilter: AdhocFilter;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  onFilterEdit: (editedFilter: AdhocFilter) => void;\n  partitionColumn?: string;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  requireSave?: boolean;\n}\n\ninterface AdhocFilterPopoverTriggerState {\n  popoverVisible: boolean;\n}\n\nclass AdhocFilterPopoverTrigger extends React.PureComponent<\n  AdhocFilterPopoverTriggerProps,\n  AdhocFilterPopoverTriggerState\n> {\n  constructor(props: AdhocFilterPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.state = {\n      popoverVisible: false,\n    };\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  render() {\n    const { adhocFilter, isControlledComponent } = this.props;\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocFilterEditPopover\n          adhocFilter={adhocFilter}\n          options={this.props.options}\n          datasource={this.props.datasource}\n          partitionColumn={this.props.partitionColumn}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          sections={this.props.sections}\n          operators={this.props.operators}\n          onChange={this.props.onFilterEdit}\n          requireSave={this.props.requireSave}\n        />\n      </ExplorePopoverContent>\n    );\n\n    return (\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={togglePopover}\n        destroyTooltipOnHide\n      >\n        {this.props.children}\n      </ControlPopover>\n    );\n  }\n}\n\nexport default AdhocFilterPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useState } from 'react';\nimport { NO_TIME_RANGE } from '@superset-ui/core';\nimport { fetchTimeRange } from 'src/explore/components/controls/DateFilterControl';\nimport { Operators } from 'src/explore/constants';\nimport AdhocFilter, { EXPRESSION_TYPES } from '../AdhocFilter';\n\ninterface Results {\n  actualTimeRange?: string;\n  title?: string;\n}\n\nexport const useGetTimeRangeLabel = (adhocFilter: AdhocFilter): Results => {\n  const [actualTimeRange, setActualTimeRange] = useState<Results>({});\n\n  useEffect(() => {\n    if (\n      adhocFilter.operator !== Operators.TEMPORAL_RANGE ||\n      adhocFilter.expressionType !== EXPRESSION_TYPES.SIMPLE\n    ) {\n      setActualTimeRange({});\n    }\n    if (\n      adhocFilter.operator === Operators.TEMPORAL_RANGE &&\n      adhocFilter.comparator === NO_TIME_RANGE\n    ) {\n      setActualTimeRange({\n        actualTimeRange: `${adhocFilter.subject} (${NO_TIME_RANGE})`,\n        title: NO_TIME_RANGE,\n      });\n    }\n\n    if (\n      adhocFilter.operator === Operators.TEMPORAL_RANGE &&\n      adhocFilter.expressionType === EXPRESSION_TYPES.SIMPLE &&\n      adhocFilter.comparator !== NO_TIME_RANGE &&\n      actualTimeRange.title !== adhocFilter.comparator\n    ) {\n      fetchTimeRange(adhocFilter.comparator, adhocFilter.subject).then(\n        ({ value, error }) => {\n          if (error) {\n            setActualTimeRange({\n              actualTimeRange: `${adhocFilter.subject} (${adhocFilter.comparator})`,\n              title: error,\n            });\n          } else {\n            setActualTimeRange({\n              actualTimeRange: value ?? '',\n              title: adhocFilter.comparator,\n            });\n          }\n        },\n      );\n    }\n  }, [adhocFilter]);\n\n  return actualTimeRange;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\nimport { hasGenericChartAxes, t } from '@superset-ui/core';\nimport { Dataset, isTemporalColumn } from '@superset-ui/chart-controls';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl/DateFilterLabel';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ninterface DatePickerInFilterProps {\n  columnName: string;\n  timeRange?: string;\n  datasource: Dataset;\n  onChange: (columnName: string, timeRange: string) => void;\n}\n\nexport const useDatePickerInAdhocFilter = ({\n  columnName,\n  timeRange,\n  datasource,\n  onChange,\n}: DatePickerInFilterProps): React.ReactElement | undefined => {\n  const onTimeRangeChange = (val: string) => onChange(columnName, val);\n\n  return hasGenericChartAxes && isTemporalColumn(columnName, datasource) ? (\n    <>\n      <ControlHeader label={t('Time Range')} />\n      <DateFilterControl\n        value={timeRange}\n        name=\"time_range\"\n        onChange={onTimeRangeChange}\n        overlayStyle=\"Modal\"\n      />\n    </>\n  ) : undefined;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport { useDrag, useDrop, DropTargetMonitor } from 'react-dnd';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport { StyledMetricOption } from '../../optionRenderers';\n\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const OptionControlContainer = styled.div<{\n  withCaret?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => (withCaret ? 'pointer' : 'default')};\n`;\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\n\nconst LabelText = styled.span`\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\n\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DndLabelsContainer = styled.div<{\n  canDrop?: boolean;\n  isOver?: boolean;\n}>`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: ${({ canDrop, isOver, theme }) => {\n    if (canDrop) {\n      return `dashed 1px ${theme.colors.info.dark1}`;\n    }\n    if (isOver && !canDrop) {\n      return `dashed 1px ${theme.colors.error.dark1}`;\n    }\n    return `solid 1px ${theme.colors.grayscale.light2}`;\n  }};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const AddControlLabel = styled.div<{\n  cancelHover?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => (cancelHover ? 'inherit' : 'pointer')};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\n\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\ninterface DragItem {\n  index: number;\n  type: string;\n}\n\nexport const OptionControlLabel = ({\n  label,\n  savedMetric,\n  adhocMetric,\n  onRemove,\n  onMoveLabel,\n  onDropLabel,\n  withCaret,\n  isFunction,\n  type,\n  index,\n  isExtra,\n  datasourceWarningMessage,\n  tooltipTitle,\n  multi = true,\n  ...props\n}: {\n  label: string | React.ReactNode;\n  savedMetric?: savedMetricType;\n  adhocMetric?: AdhocMetric;\n  onRemove: () => void;\n  onMoveLabel: (dragIndex: number, hoverIndex: number) => void;\n  onDropLabel: () => void;\n  withCaret?: boolean;\n  isFunction?: boolean;\n  isDraggable?: boolean;\n  type: string;\n  index: number;\n  isExtra?: boolean;\n  datasourceWarningMessage?: string;\n  tooltipTitle?: string;\n  multi?: boolean;\n}) => {\n  const theme = useTheme();\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n  const hasMetricName = savedMetric?.metric_name;\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      if (!multi) {\n        return;\n      }\n      onDropLabel?.();\n    },\n    hover(item: DragItem, monitor: DropTargetMonitor) {\n      if (!multi) {\n        return;\n      }\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset?.y\n        ? clientOffset?.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel?.(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.index = hoverIndex;\n    },\n  });\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      index,\n      value: savedMetric?.metric_name ? savedMetric : adhocMetric,\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getLabelContent = () => {\n    const shouldShowTooltip =\n      (!isDragging &&\n        typeof label === 'string' &&\n        tooltipTitle &&\n        label &&\n        tooltipTitle !== label) ||\n      (!isDragging &&\n        labelRef &&\n        labelRef.current &&\n        labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n    if (savedMetric && hasMetricName) {\n      return (\n        <StyledMetricOption\n          metric={savedMetric}\n          labelRef={labelRef}\n          shouldShowTooltip={!isDragging}\n        />\n      );\n    }\n    if (!shouldShowTooltip) {\n      return <LabelText ref={labelRef}>{label}</LabelText>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <LabelText ref={labelRef}>{label}</LabelText>\n      </Tooltip>\n    );\n  };\n\n  const getOptionControlContent = () => (\n    <OptionControlContainer\n      withCaret={withCaret}\n      data-test=\"option-label\"\n      {...props}\n    >\n      <CloseContainer\n        role=\"button\"\n        data-test=\"remove-control-button\"\n        onClick={onRemove}\n      >\n        <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n      </CloseContainer>\n      <Label data-test=\"control-label\">\n        {isFunction && <Icons.FieldDerived />}\n        {getLabelContent()}\n      </Label>\n      {(!!datasourceWarningMessage || isExtra) && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={\n            datasourceWarningMessage ||\n            t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)\n          }\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n\n  drag(drop(ref));\n  return <DragContainer ref={ref}>{getOptionControlContent()}</DragContainer>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { legacyValidateNumber, legacyValidateInteger } from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Input } from 'src/components/Input';\n\ntype InputValueType = string | number;\n\nexport interface TextControlProps<T extends InputValueType = InputValueType> {\n  label?: string;\n  disabled?: boolean;\n  isFloat?: boolean;\n  isInt?: boolean;\n  onChange?: (value: T, errors: any) => {};\n  onFocus?: () => {};\n  placeholder?: string;\n  value?: T | null;\n  controlId?: string;\n  renderTrigger?: boolean;\n}\n\nexport interface TextControlState {\n  value: string;\n}\n\nconst safeStringify = (value?: InputValueType | null) =>\n  value == null ? '' : String(value);\n\nexport default class TextControl<\n  T extends InputValueType = InputValueType,\n> extends React.Component<TextControlProps<T>, TextControlState> {\n  initialValue?: TextControlProps['value'];\n\n  constructor(props: TextControlProps<T>) {\n    super(props);\n    this.initialValue = props.value;\n    this.state = {\n      value: safeStringify(this.initialValue),\n    };\n  }\n\n  onChange = (inputValue: string) => {\n    let parsedValue: InputValueType = inputValue;\n    // Validation & casting\n    const errors = [];\n    if (inputValue !== '' && this.props.isFloat) {\n      const error = legacyValidateNumber(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = inputValue.match(/.*([.0])$/g)\n          ? inputValue\n          : parseFloat(inputValue);\n      }\n    }\n    if (inputValue !== '' && this.props.isInt) {\n      const error = legacyValidateInteger(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = parseInt(inputValue, 10);\n      }\n    }\n    this.props.onChange?.(parsedValue as T, errors);\n  };\n\n  debouncedOnChange = debounce((inputValue: string) => {\n    this.onChange(inputValue);\n  }, FAST_DEBOUNCE);\n\n  onChangeWrapper = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.target;\n    this.setState({ value }, () => {\n      this.debouncedOnChange(value);\n    });\n  };\n\n  render() {\n    let { value } = this.state;\n    if (this.initialValue !== this.props.value) {\n      this.initialValue = this.props.value;\n      value = safeStringify(this.props.value);\n    }\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Input\n          type=\"text\"\n          data-test=\"inline-name\"\n          placeholder={this.props.placeholder}\n          onChange={this.onChangeWrapper}\n          onFocus={this.props.onFocus}\n          value={value}\n          disabled={this.props.disabled}\n          aria-label={this.props.label}\n        />\n      </div>\n    );\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { CopyButton } from 'src/explore/components/DataTableControl';\nimport markdownSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/markdown';\nimport htmlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/htmlbars';\nimport sqlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/json';\n\nconst CopyButtonViewQuery = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nSyntaxHighlighter.registerLanguage('markdown', markdownSyntax);\nSyntaxHighlighter.registerLanguage('html', htmlSyntax);\nSyntaxHighlighter.registerLanguage('sql', sqlSyntax);\nSyntaxHighlighter.registerLanguage('json', jsonSyntax);\n\ninterface ViewQueryProps {\n  sql: string;\n  language?: string;\n}\n\nconst StyledSyntaxContainer = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst StyledSyntaxHighlighter = styled(SyntaxHighlighter)`\n  flex: 1;\n`;\n\nconst ViewQuery: React.FC<ViewQueryProps> = props => {\n  const { sql, language = 'sql' } = props;\n  return (\n    <StyledSyntaxContainer key={sql}>\n      <CopyToClipboard\n        text={sql}\n        shouldShowText={false}\n        copyNode={\n          <CopyButtonViewQuery buttonSize=\"xsmall\">\n            <i className=\"fa fa-clipboard\" />\n          </CopyButtonViewQuery>\n        }\n      />\n      <StyledSyntaxHighlighter language={language} style={github}>\n        {sql}\n      </StyledSyntaxHighlighter>\n    </StyledSyntaxContainer>\n  );\n};\n\nexport default ViewQuery;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Fuse from 'fuse.js';\nimport cx from 'classnames';\nimport {\n  t,\n  styled,\n  css,\n  ChartMetadata,\n  SupersetTheme,\n  useTheme,\n  chartLabelWeight,\n  chartLabelExplanations,\n} from '@superset-ui/core';\nimport { AntdCollapse } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport Label from 'src/components/Label';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Icons from 'src/components/Icons';\nimport { nativeFilterGate } from 'src/dashboard/components/nativeFilters/utils';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\ninterface VizTypeGalleryProps {\n  onChange: (vizType: string | null) => void;\n  onDoubleClick: () => void;\n  selectedViz: string | null;\n  className?: string;\n  denyList: string[];\n}\n\ntype VizEntry = {\n  key: string;\n  value: ChartMetadata;\n};\n\nenum SECTIONS {\n  ALL_CHARTS = 'ALL_CHARTS',\n  CATEGORY = 'CATEGORY',\n  TAGS = 'TAGS',\n  RECOMMENDED_TAGS = 'RECOMMENDED_TAGS',\n}\n\nconst DEFAULT_ORDER = [\n  'line',\n  'big_number',\n  'big_number_total',\n  'table',\n  'pivot_table_v2',\n  'echarts_timeseries_line',\n  'echarts_area',\n  'echarts_timeseries_bar',\n  'echarts_timeseries_scatter',\n  'pie',\n  'mixed_timeseries',\n  'filter_box',\n  'dist_bar',\n  'area',\n  'bar',\n  'deck_polygon',\n  'time_table',\n  'histogram',\n  'deck_scatter',\n  'deck_hex',\n  'time_pivot',\n  'deck_arc',\n  'heatmap',\n  'deck_grid',\n  'dual_line',\n  'deck_screengrid',\n  'line_multi',\n  'treemap',\n  'box_plot',\n  'sunburst',\n  'sankey',\n  'word_cloud',\n  'mapbox',\n  'kepler',\n  'cal_heatmap',\n  'rose',\n  'bubble',\n  'deck_geojson',\n  'horizon',\n  'deck_multi',\n  'compare',\n  'partition',\n  'event_flow',\n  'deck_path',\n  'graph_chart',\n  'world_map',\n  'paired_ttest',\n  'para',\n  'country_map',\n];\n\nconst typesWithDefaultOrder = new Set(DEFAULT_ORDER);\n\nconst THUMBNAIL_GRID_UNITS = 24;\n\nexport const MAX_ADVISABLE_VIZ_GALLERY_WIDTH = 1090;\n\nconst OTHER_CATEGORY = t('Other');\n\nconst ALL_CHARTS = t('All charts');\n\nconst RECOMMENDED_TAGS = [t('Popular'), t('ECharts'), t('Advanced-Analytics')];\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nconst VizPickerLayout = styled.div<{ isSelectedVizMetadata: boolean }>`\n  ${({ isSelectedVizMetadata }) => `\n    display: grid;\n    grid-template-rows: ${\n      isSelectedVizMetadata\n        ? `auto minmax(100px, 1fr) minmax(200px, 35%)`\n        : 'auto minmax(100px, 1fr)'\n    };\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}\n`;\n\nconst SectionTitle = styled.h3`\n  margin-top: 0;\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  font-size: ${({ theme }) => theme.typography.sizes.l}px;\n  font-weight: ${({ theme }) => theme.typography.weights.bold};\n  line-height: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\nconst LeftPane = styled.div`\n  grid-area: sidebar;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  overflow: auto;\n\n  .ant-collapse .ant-collapse-item {\n    .ant-collapse-header {\n      font-size: ${({ theme }) => theme.typography.sizes.s}px;\n      color: ${({ theme }) => theme.colors.grayscale.base};\n      padding-left: ${({ theme }) => theme.gridUnit * 2}px;\n      padding-bottom: ${({ theme }) => theme.gridUnit}px;\n    }\n    .ant-collapse-content .ant-collapse-content-box {\n      display: flex;\n      flex-direction: column;\n      padding: 0 ${({ theme }) => theme.gridUnit * 2}px;\n    }\n  }\n`;\n\nconst RightPane = styled.div`\n  grid-area: main;\n  overflow-y: auto;\n`;\n\nconst SearchWrapper = styled.div`\n  ${({ theme }) => `\n    grid-area: search;\n    margin-top: ${theme.gridUnit * 3}px;\n    margin-bottom: ${theme.gridUnit}px;\n    margin-left: ${theme.gridUnit * 3}px;\n    margin-right: ${theme.gridUnit * 3}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\n/** Styles to line up prefix/suffix icons in the search input */\nconst InputIconAlignment = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n`;\n\nconst SelectorLabel = styled.button`\n  ${({ theme }) => `\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${theme.gridUnit}px 0;\n    padding: 0 ${theme.gridUnit}px;\n    border-radius: ${theme.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${theme.colors.primary.base};\n      color: ${theme.colors.primary.light5};\n\n      svg {\n        color: ${theme.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${theme.gridUnit * 1.5}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}\n`;\n\nconst IconsPane = styled.div`\n  overflow: auto;\n  display: grid;\n  grid-template-columns: repeat(\n    auto-fill,\n    ${({ theme }) => theme.gridUnit * THUMBNAIL_GRID_UNITS}px\n  );\n  grid-auto-rows: max-content;\n  justify-content: space-evenly;\n  grid-gap: ${({ theme }) => theme.gridUnit * 2}px;\n  justify-items: center;\n  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst DetailsPane = (theme: SupersetTheme) => css`\n  grid-area: details;\n  border-top: 1px solid ${theme.colors.grayscale.light2};\n`;\n\nconst DetailsPopulated = (theme: SupersetTheme) => css`\n  padding: ${theme.gridUnit * 4}px;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: auto auto 1fr;\n  grid-template-areas:\n    'viz-name examples-header'\n    'viz-tags examples'\n    'description examples';\n`;\n\n// overflow hidden on the details pane and overflow auto on the description\n// (plus grid layout) enables the description to scroll while the header stays in place.\nconst TagsWrapper = styled.div`\n  grid-area: viz-tags;\n  width: ${({ theme }) => theme.gridUnit * 120}px;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  padding-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst Description = styled.p`\n  grid-area: description;\n  overflow: auto;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  margin: 0;\n`;\n\nconst Examples = styled.div`\n  grid-area: examples;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow: auto;\n  gap: ${({ theme }) => theme.gridUnit * 4}px;\n\n  img {\n    height: 100%;\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n`;\n\nconst thumbnailContainerCss = (theme: SupersetTheme) => css`\n  cursor: pointer;\n  width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n  position: relative;\n\n  img {\n    min-width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    min-height: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    border: 1px solid ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n    transition: border-color ${theme.transitionTiming};\n  }\n\n  &.selected img {\n    border: 2px solid ${theme.colors.primary.light2};\n  }\n\n  &:hover:not(.selected) img {\n    border: 1px solid ${theme.colors.grayscale.light1};\n  }\n\n  .viztype-label {\n    margin-top: ${theme.gridUnit * 2}px;\n    text-align: center;\n  }\n`;\n\nconst HighlightLabel = styled.div`\n  ${({ theme }) => `\n    border: 1px solid ${theme.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${theme.gridUnit}px;\n    background: ${theme.colors.grayscale.light5};\n    line-height: ${theme.gridUnit * 2.5}px;\n    color: ${theme.colors.primary.dark1};\n    font-size: ${theme.typography.sizes.s}px;\n    font-weight: ${theme.typography.weights.bold};\n    text-align: center;\n    padding: ${theme.gridUnit * 0.5}px ${theme.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}\n`;\n\nconst ThumbnailLabelWrapper = styled.div`\n  position: absolute;\n  right: ${({ theme }) => theme.gridUnit}px;\n  top: ${({ theme }) => theme.gridUnit * 19}px;\n`;\n\nconst TitleLabelWrapper = styled.div`\n  display: inline-block !important;\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction vizSortFactor(entry: VizEntry) {\n  if (typesWithDefaultOrder.has(entry.key)) {\n    return DEFAULT_ORDER.indexOf(entry.key);\n  }\n  return DEFAULT_ORDER.length;\n}\n\ninterface ThumbnailProps {\n  entry: VizEntry;\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n  onDoubleClick: () => void;\n}\n\nconst Thumbnail: React.FC<ThumbnailProps> = ({\n  entry,\n  selectedViz,\n  setSelectedViz,\n  onDoubleClick,\n}) => {\n  const theme = useTheme();\n  const { key, value: type } = entry;\n  const isSelected = selectedViz === entry.key;\n\n  return (\n    <div\n      role=\"button\"\n      // using css instead of a styled component to preserve\n      // the data-test attribute\n      css={thumbnailContainerCss(theme)}\n      tabIndex={0}\n      className={isSelected ? 'selected' : ''}\n      onClick={() => setSelectedViz(key)}\n      onDoubleClick={onDoubleClick}\n      data-test=\"viztype-selector-container\"\n    >\n      <img\n        alt={type.name}\n        width=\"100%\"\n        className={`viztype-selector ${isSelected ? 'selected' : ''}`}\n        src={type.thumbnail}\n      />\n      <div\n        className=\"viztype-label\"\n        data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viztype-label`}\n      >\n        {type.name}\n      </div>\n      {type.label && (\n        <ThumbnailLabelWrapper>\n          <HighlightLabel>\n            <div>{t(type.label)}</div>\n          </HighlightLabel>\n        </ThumbnailLabelWrapper>\n      )}\n    </div>\n  );\n};\n\ninterface ThumbnailGalleryProps {\n  vizEntries: VizEntry[];\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n  onDoubleClick: () => void;\n}\n\n/** A list of viz thumbnails, used within the viz picker modal */\nconst ThumbnailGallery: React.FC<ThumbnailGalleryProps> = ({\n  vizEntries,\n  ...props\n}) => (\n  <IconsPane data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viz-row`}>\n    {vizEntries.map(entry => (\n      <Thumbnail key={entry.key} {...props} entry={entry} />\n    ))}\n  </IconsPane>\n);\n\nconst Selector: React.FC<{\n  selector: string;\n  sectionId: string;\n  icon: JSX.Element;\n  isSelected: boolean;\n  onClick: (selector: string, sectionId: string) => void;\n  className?: string;\n}> = ({ selector, sectionId, icon, isSelected, onClick, className }) => {\n  const btnRef = useRef<HTMLButtonElement>(null);\n\n  // see Element.scrollIntoViewIfNeeded()\n  // see: https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded\n  useEffect(() => {\n    if (isSelected) {\n      // We need to wait for the modal to open and then scroll, so we put it in the microtask queue\n      queueMicrotask(() =>\n        scrollIntoView(btnRef.current as HTMLButtonElement, {\n          behavior: 'smooth',\n          scrollMode: 'if-needed',\n        }),\n      );\n    }\n  }, []);\n\n  return (\n    <SelectorLabel\n      ref={btnRef}\n      key={selector}\n      name={selector}\n      className={cx(className, isSelected && 'selected')}\n      onClick={() => onClick(selector, sectionId)}\n    >\n      {icon}\n      {selector}\n    </SelectorLabel>\n  );\n};\n\nconst doesVizMatchSelector = (viz: ChartMetadata, selector: string) =>\n  selector === viz.category ||\n  (selector === OTHER_CATEGORY && viz.category == null) ||\n  (viz.tags || []).indexOf(selector) > -1;\n\nexport default function VizTypeGallery(props: VizTypeGalleryProps) {\n  const { selectedViz, onChange, onDoubleClick, className } = props;\n  const { mountedPluginMetadata } = usePluginContext();\n  const searchInputRef = useRef<HTMLInputElement>();\n  const [searchInputValue, setSearchInputValue] = useState('');\n  const [isSearchFocused, setIsSearchFocused] = useState(true);\n  const isActivelySearching = isSearchFocused && !!searchInputValue;\n\n  const selectedVizMetadata: ChartMetadata | null = selectedViz\n    ? mountedPluginMetadata[selectedViz]\n    : null;\n\n  const chartMetadata: VizEntry[] = useMemo(() => {\n    const result = Object.entries(mountedPluginMetadata)\n      .map(([key, value]) => ({ key, value }))\n      .filter(({ key }) => !props.denyList.includes(key))\n      .filter(\n        ({ value }) =>\n          nativeFilterGate(value.behaviors || []) && !value.deprecated,\n      );\n    result.sort((a, b) => vizSortFactor(a) - vizSortFactor(b));\n    return result;\n  }, [mountedPluginMetadata]);\n\n  const chartsByCategory = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const category = entry.value.category || OTHER_CATEGORY;\n      if (!result[category]) {\n        result[category] = [];\n      }\n      result[category].push(entry);\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const categories = useMemo(\n    () =>\n      Object.keys(chartsByCategory).sort((a, b) => {\n        // make sure Other goes at the end\n        if (a === OTHER_CATEGORY) return 1;\n        if (b === OTHER_CATEGORY) return -1;\n        // sort alphabetically\n        return a.localeCompare(b);\n      }),\n    [chartsByCategory],\n  );\n\n  const chartsByTags = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const tags = entry.value.tags || [];\n      tags.forEach(tag => {\n        if (!result[tag]) {\n          result[tag] = [];\n        }\n        result[tag].push(entry);\n      });\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const tags = useMemo(\n    () =>\n      Object.keys(chartsByTags)\n        .sort((a, b) =>\n          // sort alphabetically\n          a.localeCompare(b),\n        )\n        .filter(tag => RECOMMENDED_TAGS.indexOf(tag) === -1),\n    [chartsByTags],\n  );\n\n  const sortedMetadata = useMemo(\n    () => chartMetadata.sort((a, b) => a.key.localeCompare(b.key)),\n    [chartMetadata],\n  );\n\n  const [activeSelector, setActiveSelector] = useState<string>(\n    () => selectedVizMetadata?.category || RECOMMENDED_TAGS[0],\n  );\n\n  const [activeSection, setActiveSection] = useState<string>(() =>\n    selectedVizMetadata?.category\n      ? SECTIONS.CATEGORY\n      : SECTIONS.RECOMMENDED_TAGS,\n  );\n\n  // get a fuse instance for fuzzy search\n  const fuse = useMemo(\n    () =>\n      new Fuse(chartMetadata, {\n        ignoreLocation: true,\n        threshold: 0.3,\n        keys: [\n          {\n            name: 'value.name',\n            weight: 4,\n          },\n          {\n            name: 'value.tags',\n            weight: 2,\n          },\n          'value.description',\n        ],\n      }),\n    [chartMetadata],\n  );\n\n  const searchResults = useMemo(() => {\n    if (searchInputValue.trim() === '') {\n      return [];\n    }\n    return fuse\n      .search(searchInputValue)\n      .map(result => result.item)\n      .sort((a, b) => {\n        const aLabel = a.value?.label;\n        const bLabel = b.value?.label;\n        const aOrder =\n          aLabel && chartLabelWeight[aLabel]\n            ? chartLabelWeight[aLabel].weight\n            : 0;\n        const bOrder =\n          bLabel && chartLabelWeight[bLabel]\n            ? chartLabelWeight[bLabel].weight\n            : 0;\n        return bOrder - aOrder;\n      });\n  }, [searchInputValue, fuse]);\n\n  const focusSearch = useCallback(() => {\n    // \"start searching\" is actually a two-stage process.\n    // When you first click on the search bar, the input is focused and nothing else happens.\n    // Once you begin typing, the selected category is cleared and the displayed viz entries change.\n    setIsSearchFocused(true);\n  }, []);\n\n  const changeSearch: ChangeEventHandler<HTMLInputElement> = useCallback(\n    event => setSearchInputValue(event.target.value),\n    [],\n  );\n\n  const stopSearching = useCallback(() => {\n    // stopping a search takes you back to the category you were looking at before.\n    // Unlike focusSearch, this is a simple one-step process.\n    setIsSearchFocused(false);\n    setSearchInputValue('');\n    searchInputRef.current!.blur();\n  }, []);\n\n  const clickSelector = useCallback(\n    (selector: string, sectionId: string) => {\n      if (isSearchFocused) {\n        stopSearching();\n      }\n      setActiveSelector(selector);\n      setActiveSection(sectionId);\n      // clear the selected viz if it is not present in the new category or tags\n      const isSelectedVizCompatible =\n        selectedVizMetadata &&\n        doesVizMatchSelector(selectedVizMetadata, selector);\n      if (selector !== activeSelector && !isSelectedVizCompatible) {\n        onChange(null);\n      }\n    },\n    [\n      stopSearching,\n      isSearchFocused,\n      activeSelector,\n      selectedVizMetadata,\n      onChange,\n    ],\n  );\n\n  const sectionMap = useMemo(\n    () => ({\n      [SECTIONS.RECOMMENDED_TAGS]: {\n        title: t('Recommended tags'),\n        icon: <Icons.Tags />,\n        selectors: RECOMMENDED_TAGS,\n      },\n      [SECTIONS.CATEGORY]: {\n        title: t('Category'),\n        icon: <Icons.Category />,\n        selectors: categories,\n      },\n      [SECTIONS.TAGS]: {\n        title: t('Tags'),\n        icon: <Icons.Tags />,\n        selectors: tags,\n      },\n    }),\n    [categories, tags],\n  );\n\n  const getVizEntriesToDisplay = () => {\n    if (isActivelySearching) {\n      return searchResults;\n    }\n    if (\n      activeSelector === ALL_CHARTS &&\n      activeSection === SECTIONS.ALL_CHARTS\n    ) {\n      return sortedMetadata;\n    }\n    if (\n      activeSection === SECTIONS.CATEGORY &&\n      chartsByCategory[activeSelector]\n    ) {\n      return chartsByCategory[activeSelector];\n    }\n    if (\n      (activeSection === SECTIONS.TAGS ||\n        activeSection === SECTIONS.RECOMMENDED_TAGS) &&\n      chartsByTags[activeSelector]\n    ) {\n      return chartsByTags[activeSelector];\n    }\n    return [];\n  };\n\n  return (\n    <VizPickerLayout\n      className={className}\n      isSelectedVizMetadata={Boolean(selectedVizMetadata)}\n    >\n      <LeftPane>\n        <Selector\n          css={({ gridUnit }) =>\n            // adjust style for not being inside a collapse\n            css`\n              margin: ${gridUnit * 2}px;\n              margin-bottom: 0;\n            `\n          }\n          sectionId={SECTIONS.ALL_CHARTS}\n          selector={ALL_CHARTS}\n          icon={<Icons.Ballot />}\n          isSelected={\n            !isActivelySearching &&\n            ALL_CHARTS === activeSelector &&\n            SECTIONS.ALL_CHARTS === activeSection\n          }\n          onClick={clickSelector}\n        />\n        <AntdCollapse\n          expandIconPosition=\"right\"\n          ghost\n          defaultActiveKey={Object.keys(sectionMap)}\n        >\n          {Object.keys(sectionMap).map(sectionId => {\n            const section = sectionMap[sectionId];\n\n            return (\n              <AntdCollapse.Panel\n                header={<span className=\"header\">{section.title}</span>}\n                key={sectionId}\n              >\n                {section.selectors.map((selector: string) => (\n                  <Selector\n                    key={selector}\n                    selector={selector}\n                    sectionId={sectionId}\n                    icon={section.icon}\n                    isSelected={\n                      !isActivelySearching &&\n                      selector === activeSelector &&\n                      sectionId === activeSection\n                    }\n                    onClick={clickSelector}\n                  />\n                ))}\n              </AntdCollapse.Panel>\n            );\n          })}\n        </AntdCollapse>\n      </LeftPane>\n\n      <SearchWrapper>\n        <Input\n          type=\"text\"\n          ref={searchInputRef as any /* cast required because emotion */}\n          value={searchInputValue}\n          placeholder={t('Search all charts')}\n          onChange={changeSearch}\n          onFocus={focusSearch}\n          data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__search-input`}\n          prefix={\n            <InputIconAlignment>\n              <Icons.Search iconSize=\"m\" />\n            </InputIconAlignment>\n          }\n          suffix={\n            <InputIconAlignment>\n              {searchInputValue && (\n                <Icons.XLarge iconSize=\"m\" onClick={stopSearching} />\n              )}\n            </InputIconAlignment>\n          }\n        />\n      </SearchWrapper>\n\n      <RightPane>\n        <ThumbnailGallery\n          vizEntries={getVizEntriesToDisplay()}\n          selectedViz={selectedViz}\n          setSelectedViz={onChange}\n          onDoubleClick={onDoubleClick}\n        />\n      </RightPane>\n\n      {selectedVizMetadata ? (\n        <div\n          css={(theme: SupersetTheme) => [\n            DetailsPane(theme),\n            DetailsPopulated(theme),\n          ]}\n        >\n          <>\n            <SectionTitle\n              css={css`\n                grid-area: viz-name;\n                position: relative;\n              `}\n            >\n              {selectedVizMetadata?.name}\n              {selectedVizMetadata?.label && (\n                <Tooltip\n                  id=\"viz-badge-tooltip\"\n                  placement=\"top\"\n                  title={\n                    selectedVizMetadata.labelExplanation ??\n                    chartLabelExplanations[selectedVizMetadata.label]\n                  }\n                >\n                  <TitleLabelWrapper>\n                    <HighlightLabel>\n                      <div>{t(selectedVizMetadata.label)}</div>\n                    </HighlightLabel>\n                  </TitleLabelWrapper>\n                </Tooltip>\n              )}\n            </SectionTitle>\n            <TagsWrapper>\n              {selectedVizMetadata?.tags.map(tag => (\n                <Label key={tag}>{tag}</Label>\n              ))}\n            </TagsWrapper>\n            <Description>\n              {selectedVizMetadata?.description ||\n                t('No description available.')}\n            </Description>\n            <SectionTitle\n              css={css`\n                grid-area: examples-header;\n              `}\n            >\n              {!!selectedVizMetadata?.exampleGallery?.length && t('Examples')}\n            </SectionTitle>\n            <Examples>\n              {(selectedVizMetadata?.exampleGallery || []).map(example => (\n                <img\n                  src={example.url}\n                  alt={example.caption}\n                  title={example.caption}\n                />\n              ))}\n            </Examples>\n          </>\n        </div>\n      ) : null}\n    </VizPickerLayout>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport {\n  MetricOption,\n  ColumnOption,\n  MetricOptionProps,\n  ColumnOptionProps,\n} from '@superset-ui/chart-controls';\n\nconst OptionContainer = styled.div`\n  width: 100%;\n  > span {\n    display: flex;\n    align-items: center;\n  }\n\n  .option-label {\n    display: inline-block;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    & ~ i {\n      margin-left: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n  .type-label {\n    margin-right: ${({ theme }) => theme.gridUnit * 3}px;\n    width: ${({ theme }) => theme.gridUnit * 7}px;\n    display: inline-block;\n    text-align: center;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n`;\n\nexport const StyledMetricOption = (props: MetricOptionProps) => (\n  <OptionContainer>\n    <MetricOption {...props} />\n  </OptionContainer>\n);\n\nexport const StyledColumnOption = (props: ColumnOptionProps) => (\n  <OptionContainer>\n    <ColumnOption {...props} />\n  </OptionContainer>\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { ControlPanelSectionConfig } from '@superset-ui/chart-controls';\n\nexport const datasourceAndVizType: ControlPanelSectionConfig = {\n  controlSetRows: [\n    ['datasource'],\n    ['viz_type'],\n    [\n      {\n        name: 'slice_id',\n        config: {\n          type: 'HiddenControl',\n          label: t('Chart ID'),\n          hidden: true,\n          description: t('The id of the active chart'),\n        },\n      },\n      {\n        name: 'cache_timeout',\n        config: {\n          type: 'HiddenControl',\n          label: t('Cache Timeout (seconds)'),\n          hidden: true,\n          description: t('The number of seconds before expiring the cache'),\n        },\n      },\n      {\n        name: 'url_params',\n        config: {\n          type: 'HiddenControl',\n          label: t('URL parameters'),\n          hidden: true,\n          description: t('Extra parameters for use in jinja templated queries'),\n        },\n      },\n    ],\n  ],\n};\n\nexport const colorScheme: ControlPanelSectionConfig = {\n  label: t('Color scheme'),\n  controlSetRows: [['color_scheme']],\n};\n\nexport const sqlaTimeSeries: ControlPanelSectionConfig = {\n  label: t('Time'),\n  description: t('Time related form attributes'),\n  expanded: true,\n  controlSetRows: [['granularity_sqla'], ['time_range']],\n};\n\nexport const annotations: ControlPanelSectionConfig = {\n  label: t('Annotations and layers'),\n  tabOverride: 'data',\n  expanded: true,\n  controlSetRows: [\n    [\n      {\n        name: 'annotation_layers',\n        config: {\n          type: 'AnnotationLayerControl',\n          label: '',\n          default: [],\n          description: t('Annotation layers'),\n          renderTrigger: true,\n          tabOverride: 'data',\n        },\n      },\n    ],\n  ],\n};\n\nexport const NVD3TimeSeries: ControlPanelSectionConfig[] = [\n  {\n    label: t('Query'),\n    expanded: true,\n    controlSetRows: [\n      ['metrics'],\n      ['adhoc_filters'],\n      ['groupby'],\n      ['limit', 'timeseries_limit_metric'],\n      ['order_desc'],\n      [\n        {\n          name: 'contribution',\n          config: {\n            type: 'CheckboxControl',\n            label: t('Contribution'),\n            default: false,\n            description: t('Compute the contribution to the total'),\n          },\n        },\n      ],\n      ['row_limit', null],\n    ],\n  },\n  {\n    label: t('Advanced analytics'),\n    tabOverride: 'data',\n    description: t(\n      'This section contains options ' +\n        'that allow for advanced analytical post processing ' +\n        'of query results',\n    ),\n    controlSetRows: [\n      [<div className=\"section-header\">{t('Rolling window')}</div>],\n      [\n        {\n          name: 'rolling_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Rolling function'),\n            default: 'None',\n            choices: [\n              ['None', t('None')],\n              ['mean', t('mean')],\n              ['sum', t('sum')],\n              ['std', t('std')],\n              ['cumsum', t('cumsum')],\n            ],\n            description: t(\n              'Defines a rolling window function to apply, works along ' +\n                'with the [Periods] text box',\n            ),\n          },\n        },\n        {\n          name: 'rolling_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Periods'),\n            isInt: true,\n            description: t(\n              'Defines the size of the rolling window function, ' +\n                'relative to the time granularity selected',\n            ),\n          },\n        },\n        {\n          name: 'min_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Min periods'),\n            isInt: true,\n            description: t(\n              'The minimum number of rolling periods required to show ' +\n                'a value. For instance if you do a cumulative sum on 7 days ' +\n                'you may want your \"Min Period\" to be 7, so that all data points ' +\n                'shown are the total of 7 periods. This will hide the \"ramp up\" ' +\n                'taking place over the first 7 periods',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Time comparison')}</div>],\n      [\n        {\n          name: 'time_compare',\n          config: {\n            type: 'SelectControl',\n            multi: true,\n            freeForm: true,\n            label: t('Time shift'),\n            choices: [\n              ['1 day', t('1 day')],\n              ['1 week', t('1 week')],\n              ['28 days', t('28 days')],\n              ['30 days', t('30 days')],\n              ['52 weeks', t('52 weeks')],\n              ['1 year', t('1 year')],\n              ['104 weeks', t('104 weeks')],\n              ['2 years', t('2 years')],\n              ['156 weeks', t('156 weeks')],\n              ['3 years', t('3 years')],\n            ],\n            description: t(\n              'Overlay one or more timeseries from a ' +\n                'relative time period. Expects relative time deltas ' +\n                'in natural language (example: 24 hours, 7 days, ' +\n                '52 weeks, 365 days). Free text is supported.',\n            ),\n          },\n        },\n        {\n          name: 'comparison_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Calculation type'),\n            default: 'values',\n            choices: [\n              ['values', t('Actual values')],\n              ['absolute', t('Difference')],\n              ['percentage', t('Percentage change')],\n              ['ratio', t('Ratio')],\n            ],\n            description: t(\n              'How to display time shifts: as individual lines; as the ' +\n                'difference between the main time series and each time shift; ' +\n                'as the percentage change; or as the ratio between series and time shifts.',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Resample')}</div>],\n      [\n        {\n          name: 'resample_rule',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Rule'),\n            default: null,\n            choices: [\n              ['1T', t('1T')],\n              ['1H', t('1H')],\n              ['1D', t('1D')],\n              ['7D', t('7D')],\n              ['1M', t('1M')],\n              ['1AS', t('1AS')],\n            ],\n            description: t('Pandas resample rule'),\n          },\n        },\n        {\n          name: 'resample_method',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Method'),\n            default: null,\n            choices: [\n              ['asfreq', t('asfreq')],\n              ['bfill', t('bfill')],\n              ['ffill', t('ffill')],\n              ['median', t('median')],\n              ['mean', t('mean')],\n              ['sum', t('sum')],\n            ],\n            description: t('Pandas resample method'),\n          },\n        },\n      ],\n    ],\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport {\n  DatasourceType,\n  getChartControlPanelRegistry,\n} from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\nimport * as SECTIONS from 'src/explore/controlPanels/sections';\n\nconst getMemoizedSectionsToRender = memoizeOne(\n  (datasourceType: DatasourceType, controlPanelConfig: ControlPanelConfig) => {\n    const {\n      sectionOverrides = {},\n      controlOverrides,\n      controlPanelSections = [],\n    } = controlPanelConfig;\n\n    // default control panel sections\n    const sections = { ...SECTIONS };\n\n    // apply section overrides\n    Object.entries(sectionOverrides).forEach(([section, overrides]) => {\n      if (typeof overrides === 'object' && overrides.constructor === Object) {\n        sections[section] = {\n          ...sections[section],\n          ...overrides,\n        };\n      } else {\n        sections[section] = overrides;\n      }\n    });\n\n    const { datasourceAndVizType } = sections;\n\n    // list of datasource-specific controls that should be removed if the datasource is a specific type\n    const filterControlsForTypes = [DatasourceType.Query, DatasourceType.Table];\n    const invalidControls = filterControlsForTypes.includes(datasourceType)\n      ? ['granularity']\n      : ['granularity_sqla', 'time_grain_sqla'];\n\n    return [datasourceAndVizType]\n      .concat(controlPanelSections.filter(isControlPanelSectionConfig))\n      .map(section => {\n        const { controlSetRows } = section;\n        return {\n          ...section,\n          controlSetRows:\n            controlSetRows?.map(row =>\n              row\n                .filter(\n                  control =>\n                    typeof control !== 'string' ||\n                    !invalidControls.includes(control),\n                )\n                .map(item => expandControlConfig(item, controlOverrides)),\n            ) || [],\n        };\n      });\n  },\n);\n\n/**\n * Get the clean and processed control panel sections\n */\nexport function getSectionsToRender(\n  vizType: string,\n  datasourceType: DatasourceType,\n) {\n  const controlPanelConfig =\n    // TODO: update `chartControlPanelRegistry` type to use ControlPanelConfig\n    (getChartControlPanelRegistry().get(vizType) as ControlPanelConfig) || {};\n  return getMemoizedSectionsToRender(datasourceType, controlPanelConfig);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  ControlPanelSectionConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\n/**\n * Find control item from control panel config.\n */\nexport function findControlItem(\n  controlPanelSections: (ControlPanelSectionConfig | null)[],\n  controlKey: string,\n) {\n  return (\n    controlPanelSections\n      .filter(isControlPanelSectionConfig)\n      .map(section => section.controlSetRows)\n      .flat(2)\n      .find(\n        control =>\n          controlKey === control ||\n          (control !== null &&\n            typeof control === 'object' &&\n            'name' in control &&\n            control.name === controlKey),\n      ) ?? null\n  );\n}\n\nconst getMemoizedControlConfig = memoizeOne(\n  (controlKey, controlPanelConfig: ControlPanelConfig) => {\n    const { controlOverrides = {}, controlPanelSections = [] } =\n      controlPanelConfig;\n    const control = expandControlConfig(\n      findControlItem(controlPanelSections, controlKey),\n      controlOverrides,\n    );\n    return control && 'config' in control ? control.config : control;\n  },\n);\n\nexport const getControlConfig = function getControlConfig(\n  controlKey: string,\n  vizType: string,\n) {\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  return getMemoizedControlConfig(\n    controlKey,\n    // TODO: the ChartControlPanelRegistry is incorrectly typed and needs to\n    // be fixed\n    controlPanelConfig as ControlPanelConfig,\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport {\n  DatasourceType,\n  ensureIsArray,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\nimport {\n  ControlConfig,\n  ControlPanelState,\n  ControlState,\n  ControlType,\n  ControlValueValidator,\n  CustomControlItem,\n} from '@superset-ui/chart-controls';\nimport { getSectionsToRender } from './getSectionsToRender';\nimport { getControlConfig } from './getControlConfig';\n\ntype ValidationError = JsonValue;\n\nfunction execControlValidator<T = ControlType>(\n  control: ControlState<T>,\n  processedState: ControlState<T>,\n) {\n  const validators = control.validators as ControlValueValidator[] | undefined;\n  const { externalValidationErrors = [] } = control;\n  const errors: ValidationError[] = [];\n  if (validators && validators.length > 0) {\n    validators.forEach(validator => {\n      const error = validator.call(control, control.value, processedState);\n      if (error) {\n        errors.push(error);\n      }\n    });\n  }\n  const validationErrors = [...errors, ...externalValidationErrors];\n  // always reset validation errors even when there is no validator\n  return { ...control, validationErrors };\n}\n\n/**\n * Clear control values that are no longer in the `choices` list.\n */\nfunction handleMissingChoice<T = ControlType>(control: ControlState<T>) {\n  // If the value is not valid anymore based on choices, clear it\n  if (\n    control.type === 'SelectControl' &&\n    !control.freeForm &&\n    control.choices &&\n    control.value\n  ) {\n    const alteredControl = { ...control };\n    const choices = control.choices as [JsonValue, ReactNode][];\n    const value = ensureIsArray(control.value);\n    const choiceValues = choices.map(c => c[0]);\n    if (control.multi && value.length > 0) {\n      alteredControl.value = value.filter(el => choiceValues.includes(el));\n      return alteredControl;\n    }\n    if (!control.multi && !choiceValues.includes(value[0])) {\n      alteredControl.value = null;\n      return alteredControl;\n    }\n  }\n  return control;\n}\n\nexport function applyMapStateToPropsToControl<T = ControlType>(\n  controlState: ControlState<T>,\n  controlPanelState: Partial<ControlPanelState> | null,\n) {\n  const { mapStateToProps } = controlState;\n  let state = { ...controlState };\n  let { value } = state; // value is current user-input value\n  if (mapStateToProps && controlPanelState) {\n    state = {\n      ...controlState,\n      ...mapStateToProps.call(controlState, controlPanelState, controlState),\n    };\n    // `mapStateToProps` may also provide a value\n    value = value || state.value;\n  }\n\n  // InitialValue is used for setting value for the control,\n  // this value is not recalculated. The default value will override it.\n  if (typeof state.initialValue === 'function') {\n    state.initialValue = state.initialValue(state, controlPanelState);\n    // if default is still a function, discard\n    if (typeof state.initialValue === 'function') {\n      delete state.initialValue;\n    }\n  }\n  if (state.initialValue) {\n    value = state.initialValue;\n    delete state.initialValue;\n  }\n\n  // If default is a function, evaluate it\n  if (typeof state.default === 'function') {\n    state.default = state.default(state, controlPanelState);\n    // if default is still a function, discard\n    if (typeof state.default === 'function') {\n      delete state.default;\n    }\n  }\n  // If no current value, set it as default\n  if (state.default && value === undefined) {\n    value = state.default;\n  }\n  // If a choice control went from multi=false to true, wrap value in array\n  if (value && state.multi && !Array.isArray(value)) {\n    value = [value];\n  }\n  state.value = value;\n  return execControlValidator(handleMissingChoice(state), state);\n}\n\nexport function getControlStateFromControlConfig<T = ControlType>(\n  controlConfig: ControlConfig<T> | null,\n  controlPanelState: Partial<ControlPanelState> | null,\n  value?: JsonValue,\n) {\n  // skip invalid config values\n  if (!controlConfig) {\n    return null;\n  }\n  const controlState = { ...controlConfig, value } as ControlState<T>;\n  // only apply mapStateToProps when control states have been initialized\n  // or when explicitly didn't provide control panel state (mostly for testing)\n  if (controlPanelState?.controls || controlPanelState === null) {\n    return applyMapStateToPropsToControl(controlState, controlPanelState);\n  }\n  return controlState;\n}\n\nexport function getControlState(\n  controlKey: string,\n  vizType: string,\n  state: Partial<ControlPanelState>,\n  value?: JsonValue,\n) {\n  return getControlStateFromControlConfig(\n    getControlConfig(controlKey, vizType),\n    state,\n    value,\n  );\n}\n\nexport function getAllControlsState(\n  vizType: string,\n  datasourceType: DatasourceType,\n  state: ControlPanelState | null,\n  formData: QueryFormData,\n) {\n  const controlsState = {};\n  getSectionsToRender(vizType, datasourceType).forEach(section =>\n    section.controlSetRows.forEach(fieldsetRow =>\n      fieldsetRow.forEach((field: CustomControlItem) => {\n        if (field?.config && field.name) {\n          const { config, name } = field;\n          controlsState[name] = getControlStateFromControlConfig(\n            config,\n            state,\n            formData[name],\n          );\n        }\n      }),\n    ),\n  );\n  return controlsState;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { QueryFormData } from '@superset-ui/core';\nimport { ControlStateMapping } from '@superset-ui/chart-controls';\n\nexport function getFormDataFromControls(\n  controlsState: ControlStateMapping,\n): QueryFormData {\n  const formData = {};\n  Object.keys(controlsState).forEach(controlName => {\n    const control = controlsState[controlName];\n    formData[controlName] = control.value;\n  });\n  return formData as QueryFormData;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ControlState, Dataset, Metric } from '@superset-ui/chart-controls';\nimport {\n  Column,\n  isAdhocMetricSimple,\n  isAdhocMetricSQL,\n  isSavedMetric,\n  isSimpleAdhocFilter,\n  JsonValue,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\n\nconst isControlValueCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: any,\n) => {\n  if (controlState.options && typeof value === 'string') {\n    if (\n      controlState.options.some(\n        (option: [string | number, string] | { column_name: string }) =>\n          Array.isArray(option)\n            ? option[0] === value\n            : option.column_name === value,\n      )\n    ) {\n      return datasource.columns.some(column => column.column_name === value);\n    }\n  }\n  if (\n    controlState.savedMetrics &&\n    isSavedMetric(value) &&\n    controlState.savedMetrics.some(\n      (savedMetric: Metric) => savedMetric.metric_name === value,\n    )\n  ) {\n    return datasource.metrics.some(\n      (metric: Metric) => metric.metric_name === value,\n    );\n  }\n  if (\n    controlState.columns &&\n    (isAdhocMetricSimple(value) || isSimpleAdhocFilter(value)) &&\n    controlState.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    )\n  ) {\n    return datasource.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    );\n  }\n  if (isAdhocMetricSQL(value)) {\n    Object.assign(value, { datasourceWarning: true });\n    return true;\n  }\n  return false;\n};\n\nexport const getControlValuesCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: JsonValue,\n) => {\n  if (value === undefined || value === null) {\n    return undefined;\n  }\n  if (Array.isArray(value)) {\n    const compatibleValues = value.filter(val =>\n      isControlValueCompatibleWithDatasource(datasource, controlState, val),\n    );\n    return compatibleValues.length > 0\n      ? compatibleValues\n      : controlState.default;\n  }\n  return isControlValueCompatibleWithDatasource(datasource, controlState, value)\n    ? value\n    : controlState.default;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport {\n  ensureIsArray,\n  getChartControlPanelRegistry,\n  QueryFormColumn,\n  QueryFormData,\n  QueryFormMetric,\n} from '@superset-ui/core';\nimport {\n  ControlStateMapping,\n  getStandardizedControls,\n  isStandardizedFormData,\n  StandardizedControls,\n  StandardizedFormDataInterface,\n} from '@superset-ui/chart-controls';\nimport { getControlsState } from 'src/explore/store';\nimport { getFormDataFromControls } from './getFormDataFromControls';\n\nexport const sharedMetricsKey = [\n  'metric', // via sharedControls, scalar\n  'metrics', // via sharedControls, array\n  'metric_2', // via sharedControls, scalar\n  'size', // via sharedControls, scalar\n  'x', // via sharedControls, scalar\n  'y', // via sharedControls, scalar\n  'secondary_metric', // via sharedControls, scalar\n];\nexport const sharedColumnsKey = [\n  'groupby', // via sharedControls, array\n  'columns', // via sharedControls, array\n  'groupbyColumns', // via pivot table v2, array\n  'groupbyRows', // via pivot table v2, array\n  'entity', // via sharedControls, scalar\n  'series', // via sharedControls, scalar\n  'series_columns', // via sharedControls, array\n];\n\nexport const publicControls = [\n  // time section\n  'granularity_sqla', // via sharedControls\n  'time_grain_sqla', // via sharedControls\n  'time_range', // via sharedControls\n  // filters\n  'adhoc_filters', // via sharedControls\n  // subquery limit(series limit)\n  'limit', // via sharedControls\n  // order by clause\n  'timeseries_limit_metric', // via sharedControls\n  'series_limit_metric', // via sharedControls\n  // desc or asc in order by clause\n  'order_desc', // via sharedControls\n  // outer query limit\n  'row_limit', // via sharedControls\n  // x asxs column\n  'x_axis', // via sharedControls\n  // advanced analytics - rolling window\n  'rolling_type', // via sections.advancedAnalytics\n  'rolling_periods', // via sections.advancedAnalytics\n  'min_periods', // via sections.advancedAnalytics\n  // advanced analytics - time comparison\n  'time_compare', // via sections.advancedAnalytics\n  'comparison_type', // via sections.advancedAnalytics\n  // advanced analytics - resample\n  'resample_rule', // via sections.advancedAnalytics\n  'resample_method', // via sections.advancedAnalytics\n];\n\nexport class StandardizedFormData {\n  private sfd: StandardizedFormDataInterface;\n\n  constructor(sourceFormData: QueryFormData) {\n    /*\n     * Support form_data for smooth switching between different viz\n     * */\n    const formData = Object.freeze(sourceFormData);\n\n    // generates an ordered map, the key is viz_type and the value is form_data. the last item is current viz.\n    const mfd = formData?.standardizedFormData?.memorizedFormData;\n    const vizType = formData.viz_type;\n    let memorizedFormData = new Map<string, QueryFormData>();\n    let controls: StandardizedControls;\n    if (\n      Array.isArray(mfd) &&\n      mfd.length > 0 &&\n      formData.datasource === mfd.slice(-1)[0][1]?.datasource\n    ) {\n      memorizedFormData = new Map(\n        formData.standardizedFormData.memorizedFormData,\n      );\n      if (memorizedFormData.has(vizType)) {\n        memorizedFormData.delete(vizType);\n      }\n      memorizedFormData.set(vizType, formData);\n      controls = StandardizedFormData.getStandardizedControls(formData);\n    } else {\n      // reset the `memorizedFormData` if a request between different datasource.\n      const restFormData = omit(\n        formData,\n        'standardizedFormData',\n      ) as QueryFormData;\n      memorizedFormData.set(vizType, restFormData);\n      controls = StandardizedFormData.getStandardizedControls(restFormData);\n    }\n\n    this.sfd = {\n      controls,\n      memorizedFormData,\n    };\n  }\n\n  static getStandardizedControls(\n    formData: QueryFormData,\n  ): StandardizedControls {\n    // 1. initial StandardizedControls\n    const controls: StandardizedControls = {\n      metrics: [],\n      columns: [],\n    };\n\n    // 2. collect current sharedControls\n    Object.entries(formData).forEach(([key, value]) => {\n      if (sharedMetricsKey.includes(key)) {\n        controls.metrics.push(...ensureIsArray<QueryFormMetric>(value));\n      }\n      if (sharedColumnsKey.includes(key)) {\n        controls.columns.push(...ensureIsArray<QueryFormColumn>(value));\n      }\n    });\n\n    // 3. append inherit sharedControls\n    if (isStandardizedFormData(formData)) {\n      const { metrics, columns } = formData.standardizedFormData.controls;\n      controls.metrics.push(...metrics);\n      controls.columns.push(...columns);\n    }\n\n    return controls;\n  }\n\n  private getLatestFormData(vizType: string): QueryFormData {\n    if (this.has(vizType)) {\n      return this.get(vizType);\n    }\n    return this.memorizedFormData.slice(-1)[0][1];\n  }\n\n  private get standardizedControls() {\n    return this.sfd.controls;\n  }\n\n  private get memorizedFormData() {\n    return Array.from(this.sfd.memorizedFormData.entries());\n  }\n\n  serialize() {\n    return {\n      controls: this.standardizedControls,\n      memorizedFormData: this.memorizedFormData,\n    };\n  }\n\n  has(vizType: string): boolean {\n    return this.sfd.memorizedFormData.has(vizType);\n  }\n\n  get(vizType: string): QueryFormData {\n    return this.sfd.memorizedFormData.get(vizType) as QueryFormData;\n  }\n\n  transform(\n    targetVizType: string,\n    exploreState: Record<string, any>,\n  ): {\n    formData: QueryFormData;\n    controlsState: ControlStateMapping;\n  } {\n    /*\n     * Transfrom form_data between different viz. Return new form_data and controlsState.\n     * 1. get memorized form_data by viz type or get previous form_data\n     * 2. collect public control values\n     * 3. generate initial targetControlsState\n     * 4. attach `standardizedFormData` to the initial form_data\n     * 5. call formDataOverrides to transform initial form_data if the plugin was defined\n     * 6. use final form_data to generate controlsState\n     * 7. to refresh validator message\n     * */\n    const latestFormData = this.getLatestFormData(targetVizType);\n    const publicFormData = {};\n    publicControls.forEach(key => {\n      if (key in exploreState.form_data) {\n        publicFormData[key] = exploreState.form_data[key];\n      }\n    });\n    const targetControlsState = getControlsState(exploreState, {\n      ...latestFormData,\n      ...publicFormData,\n      viz_type: targetVizType,\n    });\n    const targetFormData = {\n      ...getFormDataFromControls(targetControlsState),\n      standardizedFormData: this.serialize(),\n    };\n\n    let rv = {\n      formData: targetFormData,\n      controlsState: targetControlsState,\n    };\n\n    const controlPanel = getChartControlPanelRegistry().get(targetVizType);\n    if (controlPanel?.formDataOverrides) {\n      getStandardizedControls().setStandardizedControls(targetFormData);\n      const transformed = {\n        ...controlPanel.formDataOverrides(targetFormData),\n        standardizedFormData: {\n          controls: { ...getStandardizedControls().controls },\n          memorizedFormData: this.memorizedFormData,\n        },\n      };\n      getStandardizedControls().clear();\n      rv = {\n        formData: transformed,\n        controlsState: getControlsState(exploreState, transformed),\n      };\n    }\n\n    // refresh validator message\n    rv.controlsState = getControlsState(\n      { ...exploreState, controls: rv.controlsState },\n      rv.formData,\n    );\n    return rv;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { EffectCallback, useEffect, useRef } from 'react';\n\nexport const useComponentDidUpdate = (effect: EffectCallback) => {\n  const isMountedRef = useRef(false);\n  useEffect(() => {\n    if (isMountedRef.current) {\n      effect();\n    } else {\n      isMountedRef.current = true;\n    }\n  }, [effect]);\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  makeApi,\n  SupersetClient,\n  logging,\n} from '@superset-ui/core';\nimport { SupersetError } from 'src/components/ErrorMessage/types';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { FeatureFlag, isFeatureEnabled } from '../featureFlags';\nimport {\n  getClientErrorObject,\n  parseErrorJson,\n} from '../utils/getClientErrorObject';\n\ntype AsyncEvent = {\n  id?: string | null;\n  channel_id: string;\n  job_id: string;\n  user_id?: string;\n  status: string;\n  errors?: SupersetError[];\n  result_url: string | null;\n};\n\ntype CachedDataResponse = {\n  status: string;\n  data: any;\n};\ntype AppConfig = Record<string, any>;\ntype ListenerFn = (asyncEvent: AsyncEvent) => Promise<any>;\n\nconst TRANSPORT_POLLING = 'polling';\nconst TRANSPORT_WS = 'ws';\nconst JOB_STATUS = {\n  PENDING: 'pending',\n  RUNNING: 'running',\n  ERROR: 'error',\n  DONE: 'done',\n};\nconst LOCALSTORAGE_KEY = 'last_async_event_id';\nconst POLLING_URL = '/api/v1/async_event/';\nconst MAX_RETRIES = 6;\nconst RETRY_DELAY = 100;\n\nlet config: AppConfig;\nlet transport: string;\nlet pollingDelayMs: number;\nlet pollingTimeoutId: number;\nlet listenersByJobId: Record<string, ListenerFn>;\nlet retriesByJobId: Record<string, number>;\nlet lastReceivedEventId: string | null | undefined;\n\nconst addListener = (id: string, fn: any) => {\n  listenersByJobId[id] = fn;\n};\n\nconst removeListener = (id: string) => {\n  if (!listenersByJobId[id]) return;\n  delete listenersByJobId[id];\n};\n\nconst fetchCachedData = async (\n  asyncEvent: AsyncEvent,\n): Promise<CachedDataResponse> => {\n  let status = 'success';\n  let data;\n  try {\n    const { json } = await SupersetClient.get({\n      endpoint: String(asyncEvent.result_url),\n    });\n    data = 'result' in json ? json.result : json;\n  } catch (response) {\n    status = 'error';\n    data = await getClientErrorObject(response);\n  }\n\n  return { status, data };\n};\n\nexport const waitForAsyncData = async (asyncResponse: AsyncEvent) =>\n  new Promise((resolve, reject) => {\n    const jobId = asyncResponse.job_id;\n    const listener = async (asyncEvent: AsyncEvent) => {\n      switch (asyncEvent.status) {\n        case JOB_STATUS.DONE: {\n          let { data, status } = await fetchCachedData(asyncEvent); // eslint-disable-line prefer-const\n          data = ensureIsArray(data);\n          if (status === 'success') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n          break;\n        }\n        case JOB_STATUS.ERROR: {\n          const err = parseErrorJson(asyncEvent);\n          reject(err);\n          break;\n        }\n        default: {\n          logging.warn('received event with status', asyncEvent.status);\n        }\n      }\n      removeListener(jobId);\n    };\n    addListener(jobId, listener);\n  });\n\nconst fetchEvents = makeApi<\n  { last_id?: string | null },\n  { result: AsyncEvent[] }\n>({\n  method: 'GET',\n  endpoint: POLLING_URL,\n});\n\nconst setLastId = (asyncEvent: AsyncEvent) => {\n  lastReceivedEventId = asyncEvent.id;\n  try {\n    localStorage.setItem(LOCALSTORAGE_KEY, lastReceivedEventId as string);\n  } catch (err) {\n    logging.warn('Error saving event Id to localStorage', err);\n  }\n};\n\nexport const processEvents = async (events: AsyncEvent[]) => {\n  events.forEach((asyncEvent: AsyncEvent) => {\n    const jobId = asyncEvent.job_id;\n    const listener = listenersByJobId[jobId];\n    if (listener) {\n      listener(asyncEvent);\n      delete retriesByJobId[jobId];\n    } else {\n      // handle race condition where event is received\n      // before listener is registered\n      if (!retriesByJobId[jobId]) retriesByJobId[jobId] = 0;\n      retriesByJobId[jobId] += 1;\n\n      if (retriesByJobId[jobId] <= MAX_RETRIES) {\n        setTimeout(() => {\n          processEvents([asyncEvent]);\n        }, RETRY_DELAY * retriesByJobId[jobId]);\n      } else {\n        delete retriesByJobId[jobId];\n        logging.warn('listener not found for job_id', asyncEvent.job_id);\n      }\n    }\n    setLastId(asyncEvent);\n  });\n};\n\nconst loadEventsFromApi = async () => {\n  const eventArgs = lastReceivedEventId ? { last_id: lastReceivedEventId } : {};\n  if (Object.keys(listenersByJobId).length) {\n    try {\n      const { result: events } = await fetchEvents(eventArgs);\n      if (events?.length) await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    pollingTimeoutId = window.setTimeout(loadEventsFromApi, pollingDelayMs);\n  }\n};\n\nconst wsConnectMaxRetries = 6;\nconst wsConnectErrorDelay = 2500;\nlet wsConnectRetries = 0;\nlet wsConnectTimeout: any;\nlet ws: WebSocket;\n\nconst wsConnect = (): void => {\n  let url = config.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;\n  if (lastReceivedEventId) url += `?last_id=${lastReceivedEventId}`;\n  ws = new WebSocket(url);\n\n  ws.addEventListener('open', () => {\n    logging.log('WebSocket connected');\n    clearTimeout(wsConnectTimeout);\n    wsConnectRetries = 0;\n  });\n\n  ws.addEventListener('close', () => {\n    wsConnectTimeout = setTimeout(() => {\n      wsConnectRetries += 1;\n      if (wsConnectRetries <= wsConnectMaxRetries) {\n        wsConnect();\n      } else {\n        logging.warn('WebSocket not available, falling back to async polling');\n        loadEventsFromApi();\n      }\n    }, wsConnectErrorDelay);\n  });\n\n  ws.addEventListener('error', () => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/readyState\n    if (ws.readyState < 2) ws.close();\n  });\n\n  ws.addEventListener('message', async event => {\n    let events: AsyncEvent[] = [];\n    try {\n      events = [JSON.parse(event.data)];\n      await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  });\n};\n\nexport const init = (appConfig?: AppConfig) => {\n  if (!isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) return;\n  if (pollingTimeoutId) clearTimeout(pollingTimeoutId);\n\n  listenersByJobId = {};\n  retriesByJobId = {};\n  lastReceivedEventId = null;\n\n  config = appConfig || getBootstrapData().common.conf;\n  transport = config.GLOBAL_ASYNC_QUERIES_TRANSPORT || TRANSPORT_POLLING;\n  pollingDelayMs = config.GLOBAL_ASYNC_QUERIES_POLLING_DELAY || 500;\n\n  try {\n    lastReceivedEventId = localStorage.getItem(LOCALSTORAGE_KEY);\n  } catch (err) {\n    logging.warn('Failed to fetch last event Id from localStorage');\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    loadEventsFromApi();\n  }\n  if (transport === TRANSPORT_WS) {\n    wsConnect();\n  }\n};\n\ninit();\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport { UserRoles } from 'src/types/bootstrapTypes';\n\nexport const findPermission = memoizeOne(\n  (perm: string, view: string, roles?: UserRoles | null) =>\n    !!roles &&\n    Object.values(roles).some(permissions =>\n      permissions.some(([perm_, view_]) => perm_ === perm && view_ === view),\n    ),\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dataset } from '@superset-ui/chart-controls';\n\nexport const getDatasourceUid = (datasource: Dataset) =>\n  datasource.uid ?? `${datasource.id ?? 'None'}__${datasource.type}`;\n","/* Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable global-require */\nconst loadModule = () => {\n  let module;\n  try {\n    // @ts-ignore\n    module = require('../../../superset_text'); // eslint-disable-line import/no-unresolved\n  } catch (e) {\n    module = {};\n  }\n  return module;\n};\n\nconst supersetText = loadModule();\n\nexport default supersetText;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  isDefined,\n  JsonObject,\n  QueryFormData,\n  SupersetClient,\n} from '@superset-ui/core';\nimport rison from 'rison';\nimport { isEmpty } from 'lodash';\nimport {\n  RESERVED_CHART_URL_PARAMS,\n  RESERVED_DASHBOARD_URL_PARAMS,\n  URL_PARAMS,\n} from '../constants';\nimport { getActiveFilters } from '../dashboard/util/activeDashboardFilters';\nimport serializeActiveFilterValues from '../dashboard/util/serializeActiveFilterValues';\n\nexport type UrlParamType = 'string' | 'number' | 'boolean' | 'object' | 'rison';\nexport type UrlParam = typeof URL_PARAMS[keyof typeof URL_PARAMS];\nexport function getUrlParam(\n  param: UrlParam & { type: 'string' },\n): string | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'number' },\n): number | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'boolean' },\n): boolean | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'object' },\n): object | null;\nexport function getUrlParam(param: UrlParam & { type: 'rison' }): object | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'rison | string' },\n): string | object | null;\nexport function getUrlParam({ name, type }: UrlParam): unknown {\n  const urlParam = new URLSearchParams(window.location.search).get(name);\n  switch (type) {\n    case 'number':\n      if (!urlParam) {\n        return null;\n      }\n      if (urlParam.toLowerCase() === 'true') {\n        return 1;\n      }\n      if (urlParam.toLowerCase() === 'false') {\n        return 0;\n      }\n      if (!Number.isNaN(Number(urlParam))) {\n        return Number(urlParam);\n      }\n      return null;\n    case 'object':\n      if (!urlParam) {\n        return null;\n      }\n      return JSON.parse(urlParam);\n    case 'boolean':\n      if (!urlParam) {\n        return null;\n      }\n      return urlParam.toLowerCase() !== 'false' && urlParam !== '0';\n    case 'rison':\n      if (!urlParam) {\n        return null;\n      }\n      try {\n        return rison.decode(urlParam);\n      } catch {\n        return urlParam;\n      }\n    default:\n      return urlParam;\n  }\n}\n\nfunction getUrlParams(excludedParams: string[]): URLSearchParams {\n  const urlParams = new URLSearchParams();\n  const currentParams = new URLSearchParams(window.location.search);\n  currentParams.forEach((value, key) => {\n    if (!excludedParams.includes(key)) urlParams.append(key, value);\n  });\n  return urlParams;\n}\n\nexport type UrlParamEntries = [string, string][];\n\nfunction getUrlParamEntries(urlParams: URLSearchParams): UrlParamEntries {\n  const urlEntries: [string, string][] = [];\n  urlParams.forEach((value, key) => urlEntries.push([key, value]));\n  return urlEntries;\n}\n\nfunction getChartUrlParams(excludedUrlParams?: string[]): UrlParamEntries {\n  const excludedParams = excludedUrlParams || RESERVED_CHART_URL_PARAMS;\n  const urlParams = getUrlParams(excludedParams);\n  const filterBoxFilters = getActiveFilters();\n  if (\n    !isEmpty(filterBoxFilters) &&\n    !excludedParams.includes(URL_PARAMS.preselectFilters.name)\n  )\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getDashboardUrlParams(): UrlParamEntries {\n  const urlParams = getUrlParams(RESERVED_DASHBOARD_URL_PARAMS);\n  const filterBoxFilters = getActiveFilters();\n  if (!isEmpty(filterBoxFilters))\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getPermalink(endpoint: string, jsonPayload: JsonObject) {\n  return SupersetClient.post({\n    endpoint,\n    jsonPayload,\n  }).then(result => result.json.url as string);\n}\n\nexport function getChartPermalink(\n  formData: Pick<QueryFormData, 'datasource'>,\n  excludedUrlParams?: string[],\n) {\n  return getPermalink('/api/v1/explore/permalink', {\n    formData,\n    urlParams: getChartUrlParams(excludedUrlParams),\n  });\n}\n\nexport function getDashboardPermalink({\n  dashboardId,\n  dataMask,\n  activeTabs,\n  anchor, // the anchor part of the link which corresponds to the tab/chart id\n}: {\n  dashboardId: string | number;\n  /**\n   * Current applied data masks (for native filters).\n   */\n  dataMask: JsonObject;\n  /**\n   * Current active tabs in the dashboard.\n   */\n  activeTabs: string[];\n  /**\n   * The \"anchor\" component for the permalink. It will be scrolled into view\n   * and highlighted upon page load.\n   */\n  anchor?: string;\n}) {\n  // only encode filter box state if non-empty\n  return getPermalink(`/api/v1/dashboard/${dashboardId}/permalink`, {\n    urlParams: getDashboardUrlParams(),\n    dataMask,\n    activeTabs,\n    anchor,\n  });\n}\n\nconst externalUrlRegex =\n  /^([^:/?#]+:)?(?:(\\/\\/)?([^/?#]*))?([^?#]+)?(\\?[^#]*)?(#.*)?/;\n\n// group 1 matches protocol\n// group 2 matches '//'\n// group 3 matches hostname\nexport function isUrlExternal(url: string) {\n  const match = url.match(externalUrlRegex) || [];\n  return (\n    (typeof match[1] === 'string' && match[1].length > 0) ||\n    match[2] === '//' ||\n    (typeof match[3] === 'string' && match[3].length > 0)\n  );\n}\n\nexport function parseUrl(url: string) {\n  const match = url.match(externalUrlRegex) || [];\n  // if url is external but start with protocol or '//',\n  // it can't be used correctly with <a> element\n  // in such case, add '//' prefix\n  if (isUrlExternal(url) && !isDefined(match[1]) && !url.startsWith('//')) {\n    return `//${url}`;\n  }\n  return url;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nexport const PAGE_SIZE = 25;\nexport const SORT_BY = [{ id: 'changed_on_delta_humanized', desc: true }];\nexport const PASSWORDS_NEEDED_MESSAGE = t(\n  'The passwords for the databases below are needed in order to ' +\n    'import them together with the datasets. Please note that the ' +\n    '\"Secure Extra\" and \"Certificate\" sections of ' +\n    'the database configuration are not present in export files, and ' +\n    'should be added manually after the import if they are needed.',\n);\nexport const CONFIRM_OVERWRITE_MESSAGE = t(\n  'You are importing one or more datasets that already exist. ' +\n    'Overwriting might cause you to lose some of your work. Are you ' +\n    'sure you want to overwrite?',\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { useState, useEffect, useCallback } from 'react';\nimport { makeApi, SupersetClient, t, JsonObject } from '@superset-ui/core';\n\nimport {\n  createErrorHandler,\n  getAlreadyExists,\n  getPasswordsNeeded,\n  hasTerminalValidation,\n} from 'src/views/CRUD/utils';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport { FilterValue } from 'src/components/ListView/types';\nimport Chart, { Slice } from 'src/types/Chart';\nimport copyTextToClipboard from 'src/utils/copy';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nimport { FavoriteStatus, ImportResourceName, DatabaseObject } from './types';\n\ninterface ListViewResourceState<D extends object = any> {\n  loading: boolean;\n  collection: D[];\n  count: number;\n  permissions: string[];\n  lastFetchDataConfig: FetchDataConfig | null;\n  bulkSelectEnabled: boolean;\n  lastFetched?: string;\n}\n\nconst parsedErrorMessage = (\n  errorMessage: Record<string, string[] | string> | string,\n) => {\n  if (typeof errorMessage === 'string') {\n    return errorMessage;\n  }\n  return Object.entries(errorMessage)\n    .map(([key, value]) => {\n      if (Array.isArray(value)) {\n        return `(${key}) ${value.join(', ')}`;\n      }\n      return `(${key}) ${value}`;\n    })\n    .join('\\n');\n};\n\nexport function useListViewResource<D extends object = any>(\n  resource: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n  infoEnable = true,\n  defaultCollectionValue: D[] = [],\n  baseFilters?: FilterValue[], // must be memoized\n  initialLoadingState = true,\n) {\n  const [state, setState] = useState<ListViewResourceState<D>>({\n    count: 0,\n    collection: defaultCollectionValue,\n    loading: initialLoadingState,\n    lastFetchDataConfig: null,\n    permissions: [],\n    bulkSelectEnabled: false,\n  });\n\n  function updateState(update: Partial<ListViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  function toggleBulkSelect() {\n    updateState({ bulkSelectEnabled: !state.bulkSelectEnabled });\n  }\n\n  useEffect(() => {\n    if (!infoEnable) return;\n    SupersetClient.get({\n      endpoint: `/api/v1/${resource}/_info?q=${rison.encode({\n        keys: ['permissions'],\n      })}`,\n    }).then(\n      ({ json: infoJson = {} }) => {\n        updateState({\n          permissions: infoJson.permissions,\n        });\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t(\n            'An error occurred while fetching %s info: %s',\n            resourceLabel,\n            errMsg,\n          ),\n        ),\n      ),\n    );\n  }, []);\n\n  function hasPerm(perm: string) {\n    if (!state.permissions.length) {\n      return false;\n    }\n\n    return Boolean(state.permissions.find(p => p === perm));\n  }\n\n  const fetchData = useCallback(\n    ({\n      pageIndex,\n      pageSize,\n      sortBy,\n      filters: filterValues,\n    }: FetchDataConfig) => {\n      // set loading state, cache the last config for refreshing data.\n      updateState({\n        lastFetchDataConfig: {\n          filters: filterValues,\n          pageIndex,\n          pageSize,\n          sortBy,\n        },\n        loading: true,\n      });\n\n      const filterExps = (baseFilters || [])\n        .concat(filterValues)\n        .map(({ id, operator: opr, value }) => ({\n          col: id,\n          opr,\n          value:\n            value && typeof value === 'object' && 'value' in value\n              ? value.value\n              : value,\n        }));\n\n      const queryParams = rison.encode_uri({\n        order_column: sortBy[0].id,\n        order_direction: sortBy[0].desc ? 'desc' : 'asc',\n        page: pageIndex,\n        page_size: pageSize,\n        ...(filterExps.length ? { filters: filterExps } : {}),\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resource}/?q=${queryParams}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              collection: json.result,\n              count: json.count,\n              lastFetched: new Date().toISOString(),\n            });\n          },\n          createErrorHandler(errMsg =>\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                errMsg,\n              ),\n            ),\n          ),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [baseFilters],\n  );\n\n  return {\n    state: {\n      loading: state.loading,\n      resourceCount: state.count,\n      resourceCollection: state.collection,\n      bulkSelectEnabled: state.bulkSelectEnabled,\n      lastFetched: state.lastFetched,\n    },\n    setResourceCollection: (update: D[]) =>\n      updateState({\n        collection: update,\n      }),\n    hasPerm,\n    fetchData,\n    toggleBulkSelect,\n    refreshData: (provideConfig?: FetchDataConfig) => {\n      if (state.lastFetchDataConfig) {\n        return fetchData(state.lastFetchDataConfig);\n      }\n      if (provideConfig) {\n        return fetchData(provideConfig);\n      }\n      return null;\n    },\n  };\n}\n\n// In the same vein as above, a hook for viewing a single instance of a resource (given id)\ninterface SingleViewResourceState<D extends object = any> {\n  loading: boolean;\n  resource: D | null;\n  error: any | null;\n}\n\nexport function useSingleViewResource<D extends object = any>(\n  resourceName: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<SingleViewResourceState<D>>({\n    loading: false,\n    resource: null,\n    error: null,\n  });\n\n  function updateState(update: Partial<SingleViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const fetchResource = useCallback(\n    (resourceID: number) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: json.result,\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                parsedErrorMessage(errMsg),\n              ),\n            );\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const createResource = useCallback(\n    (resource: D, hideToast = false) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { id: json.id, ...json.result },\n              error: null,\n            });\n            return json.id;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            // we did not want toasts for db-connection-ui but did not want to disable it everywhere\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while creating %ss: %s',\n                  resourceLabel,\n                  parsedErrorMessage(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const updateResource = useCallback(\n    (resourceID: number, resource: D, hideToast = false, setLoading = true) => {\n      // Set loading state\n      if (setLoading) {\n        updateState({\n          loading: true,\n        });\n      }\n\n      return SupersetClient.put({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { ...json.result, id: json.id },\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler(errMsg => {\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while fetching %ss: %s',\n                  resourceLabel,\n                  JSON.stringify(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n\n            return errMsg;\n          }),\n        )\n        .finally(() => {\n          if (setLoading) {\n            updateState({ loading: false });\n          }\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const clearError = () =>\n    updateState({\n      error: null,\n    });\n\n  return {\n    state,\n    setResource: (update: D) =>\n      updateState({\n        resource: update,\n      }),\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError,\n  };\n}\n\ninterface ImportResourceState {\n  loading: boolean;\n  passwordsNeeded: string[];\n  alreadyExists: string[];\n  failed: boolean;\n}\n\nexport function useImportResource(\n  resourceName: ImportResourceName,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<ImportResourceState>({\n    loading: false,\n    passwordsNeeded: [],\n    alreadyExists: [],\n    failed: false,\n  });\n\n  function updateState(update: Partial<ImportResourceState>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const importResource = useCallback(\n    (\n      bundle: File,\n      databasePasswords: Record<string, string> = {},\n      overwrite = false,\n    ) => {\n      // Set loading state\n      updateState({\n        loading: true,\n        failed: false,\n      });\n\n      const formData = new FormData();\n      formData.append('formData', bundle);\n\n      const RE_EXPORT_TEXT = t(\n        'Please re-export your file and try importing again',\n      );\n\n      /* The import bundle never contains database passwords; if required\n       * they should be provided by the user during import.\n       */\n      if (databasePasswords) {\n        formData.append('passwords', JSON.stringify(databasePasswords));\n      }\n      /* If the imported model already exists the user needs to confirm\n       * that they want to overwrite it.\n       */\n      if (overwrite) {\n        formData.append('overwrite', 'true');\n      }\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/import/`,\n        body: formData,\n        headers: { Accept: 'application/json' },\n      })\n        .then(() => {\n          updateState({\n            passwordsNeeded: [],\n            alreadyExists: [],\n            failed: false,\n          });\n          return true;\n        })\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            updateState({\n              failed: true,\n            });\n            if (!error.errors) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  error.message || error.error,\n                ),\n              );\n              return false;\n            }\n            if (hasTerminalValidation(error.errors)) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  [\n                    ...error.errors.map(payload => payload.message),\n                    RE_EXPORT_TEXT,\n                  ].join('.\\n'),\n                ),\n              );\n            } else {\n              updateState({\n                passwordsNeeded: getPasswordsNeeded(error.errors),\n                alreadyExists: getAlreadyExists(error.errors),\n              });\n            }\n            return false;\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [],\n  );\n\n  return { state, importResource };\n}\n\nenum FavStarClassName {\n  CHART = 'slice',\n  DASHBOARD = 'Dashboard',\n}\n\ntype FavoriteStatusResponse = {\n  result: Array<{\n    id: string;\n    value: boolean;\n  }>;\n};\n\nconst favoriteApis = {\n  chart: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/chart/favorite_status/',\n  }),\n  dashboard: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/dashboard/favorite_status/',\n  }),\n};\n\nexport function useFavoriteStatus(\n  type: 'chart' | 'dashboard',\n  ids: Array<string | number>,\n  handleErrorMsg: (message: string) => void,\n) {\n  const [favoriteStatus, setFavoriteStatus] = useState<FavoriteStatus>({});\n\n  const updateFavoriteStatus = (update: FavoriteStatus) =>\n    setFavoriteStatus(currentState => ({ ...currentState, ...update }));\n\n  useEffect(() => {\n    if (!ids.length) {\n      return;\n    }\n    favoriteApis[type](ids).then(\n      ({ result }) => {\n        const update = result.reduce((acc, element) => {\n          acc[element.id] = element.value;\n          return acc;\n        }, {});\n        updateFavoriteStatus(update);\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t('There was an error fetching the favorite status: %s', errMsg),\n        ),\n      ),\n    );\n  }, [ids, type, handleErrorMsg]);\n\n  const saveFaveStar = useCallback(\n    (id: number, isStarred: boolean) => {\n      const urlSuffix = isStarred ? 'unselect' : 'select';\n      SupersetClient.get({\n        endpoint: `/superset/favstar/${\n          type === 'chart' ? FavStarClassName.CHART : FavStarClassName.DASHBOARD\n        }/${id}/${urlSuffix}/`,\n      }).then(\n        ({ json }) => {\n          updateFavoriteStatus({\n            [id]: (json as { count: number })?.count > 0,\n          });\n        },\n        createErrorHandler(errMsg =>\n          handleErrorMsg(\n            t('There was an error saving the favorite status: %s', errMsg),\n          ),\n        ),\n      );\n    },\n    [type],\n  );\n\n  return [saveFaveStar, favoriteStatus] as const;\n}\n\nexport const useChartEditModal = (\n  setCharts: (charts: Array<Chart>) => void,\n  charts: Array<Chart>,\n) => {\n  const [sliceCurrentlyEditing, setSliceCurrentlyEditing] =\n    useState<Slice | null>(null);\n\n  function openChartEditModal(chart: Chart) {\n    setSliceCurrentlyEditing({\n      slice_id: chart.id,\n      slice_name: chart.slice_name,\n      description: chart.description,\n      cache_timeout: chart.cache_timeout,\n      certified_by: chart.certified_by,\n      certification_details: chart.certification_details,\n      is_managed_externally: chart.is_managed_externally,\n    });\n  }\n\n  function closeChartEditModal() {\n    setSliceCurrentlyEditing(null);\n  }\n\n  function handleChartUpdated(edits: Chart) {\n    // update the chart in our state with the edited info\n    const newCharts = charts.map((chart: Chart) =>\n      chart.id === edits.id ? { ...chart, ...edits } : chart,\n    );\n    setCharts(newCharts);\n  }\n\n  return {\n    sliceCurrentlyEditing,\n    handleChartUpdated,\n    openChartEditModal,\n    closeChartEditModal,\n  };\n};\n\nexport const copyQueryLink = (\n  id: number,\n  addDangerToast: (arg0: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  copyTextToClipboard(() =>\n    Promise.resolve(\n      `${window.location.origin}/superset/sqllab?savedQueryId=${id}`,\n    ),\n  )\n    .then(() => {\n      addSuccessToast(t('Link Copied!'));\n    })\n    .catch(() => {\n      addDangerToast(t('Sorry, your browser does not support copying.'));\n    });\n};\n\nexport const getDatabaseImages = () => SupersetText.DB_IMAGES;\n\nexport const getConnectionAlert = () => SupersetText.DB_CONNECTION_ALERTS;\nexport const getDatabaseDocumentationLinks = () =>\n  SupersetText.DB_CONNECTION_DOC_LINKS;\n\nexport const testDatabaseConnection = (\n  connection: DatabaseObject,\n  handleErrorMsg: (errorMsg: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  SupersetClient.post({\n    endpoint: 'api/v1/database/test_connection/',\n    body: JSON.stringify(connection),\n    headers: { 'Content-Type': 'application/json' },\n  }).then(\n    () => {\n      addSuccessToast(t('Connection looks good!'));\n    },\n    createErrorHandler((errMsg: Record<string, string[] | string> | string) => {\n      handleErrorMsg(t('ERROR: %s', parsedErrorMessage(errMsg)));\n    }),\n  );\n};\n\nexport function useAvailableDatabases() {\n  const [availableDbs, setAvailableDbs] = useState<JsonObject | null>(null);\n\n  const getAvailable = useCallback(() => {\n    SupersetClient.get({\n      endpoint: `/api/v1/database/available/`,\n    }).then(({ json }) => {\n      setAvailableDbs(json);\n    });\n  }, [setAvailableDbs]);\n\n  return [availableDbs, getAvailable] as const;\n}\n\nconst transformDB = (db: Partial<DatabaseObject> | null) => {\n  if (db && Array.isArray(db?.catalog)) {\n    return {\n      ...db,\n      catalog: Object.assign(\n        {},\n        ...db.catalog.map((x: { name: string; value: string }) => ({\n          [x.name]: x.value,\n        })),\n      ),\n    };\n  }\n  return db;\n};\n\nexport function useDatabaseValidation() {\n  const [validationErrors, setValidationErrors] = useState<JsonObject | null>(\n    null,\n  );\n  const getValidation = useCallback(\n    (database: Partial<DatabaseObject> | null, onCreate = false) => {\n      if (database?.parameters?.ssh) {\n        // when ssh tunnel is enabled we don't want to render any validation errors\n        setValidationErrors(null);\n        return [];\n      }\n\n      return (\n        SupersetClient.post({\n          endpoint: '/api/v1/database/validate_parameters/',\n          body: JSON.stringify(transformDB(database)),\n          headers: { 'Content-Type': 'application/json' },\n        })\n          .then(() => {\n            setValidationErrors(null);\n          })\n          // eslint-disable-next-line consistent-return\n          .catch(e => {\n            if (typeof e.json === 'function') {\n              return e.json().then(({ errors = [] }: JsonObject) => {\n                const parsedErrors = errors\n                  .filter((error: { error_type: string }) => {\n                    const skipValidationError = ![\n                      'CONNECTION_MISSING_PARAMETERS_ERROR',\n                      'CONNECTION_ACCESS_DENIED_ERROR',\n                    ].includes(error.error_type);\n                    return skipValidationError || onCreate;\n                  })\n                  .reduce(\n                    (\n                      obj: {},\n                      {\n                        error_type,\n                        extra,\n                        message,\n                      }: {\n                        error_type: string;\n                        extra: {\n                          invalid?: string[];\n                          missing?: string[];\n                          name: string;\n                          catalog: {\n                            name: string;\n                            url: string;\n                            idx: number;\n                          };\n                          issue_codes?: {\n                            code?: number;\n                            message?: string;\n                          }[];\n                        };\n                        message: string;\n                      },\n                    ) => {\n                      if (extra.catalog) {\n                        if (extra.catalog.name) {\n                          return {\n                            ...obj,\n                            error_type,\n                            [extra.catalog.idx]: {\n                              name: message,\n                            },\n                          };\n                        }\n                        if (extra.catalog.url) {\n                          return {\n                            ...obj,\n                            error_type,\n                            [extra.catalog.idx]: {\n                              url: message,\n                            },\n                          };\n                        }\n\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            name: message,\n                            url: message,\n                          },\n                        };\n                      }\n                      // if extra.invalid doesn't exist then the\n                      // error can't be mapped to a parameter\n                      // so leave it alone\n                      if (extra.invalid) {\n                        return {\n                          ...obj,\n                          [extra.invalid[0]]: message,\n                          error_type,\n                        };\n                      }\n                      if (extra.missing) {\n                        return {\n                          ...obj,\n                          error_type,\n                          ...Object.assign(\n                            {},\n                            ...extra.missing.map(field => ({\n                              [field]: 'This is a required field',\n                            })),\n                          ),\n                        };\n                      }\n                      if (extra.issue_codes?.length) {\n                        return {\n                          ...obj,\n                          error_type,\n                          description: message || extra.issue_codes[0]?.message,\n                        };\n                      }\n\n                      return obj;\n                    },\n                    {},\n                  );\n                setValidationErrors(parsedErrors);\n                return parsedErrors;\n              });\n            }\n            // eslint-disable-next-line no-console\n            console.error(e);\n          })\n      );\n    },\n    [setValidationErrors],\n  );\n\n  return [validationErrors, getValidation, setValidationErrors] as const;\n}\n\nexport const reportSelector = (\n  state: Record<string, any>,\n  resourceType: string,\n  resourceId?: number,\n) => {\n  if (resourceId) {\n    return state.reports[resourceType]?.[resourceId];\n  }\n  return {};\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { QueryState } from '@superset-ui/core';\nimport { User } from 'src/types/bootstrapTypes';\nimport Database from 'src/types/Database';\nimport Owner from 'src/types/Owner';\n\nexport type FavoriteStatus = {\n  [id: number]: boolean;\n};\n\nexport enum TableTab {\n  Favorite = 'Favorite',\n  Mine = 'Mine',\n  Other = 'Other',\n  Viewed = 'Viewed',\n  Created = 'Created',\n  Edited = 'Edited',\n}\n\nexport type Filter = {\n  col: string;\n  opr: string;\n  value: string | number;\n};\n\nexport interface DashboardTableProps {\n  addDangerToast: (message: string) => void;\n  addSuccessToast: (message: string) => void;\n  user?: User;\n  mine: Array<Dashboard>;\n  showThumbnails?: boolean;\n  otherTabData: Array<Dashboard>;\n  otherTabFilters: Filter[];\n  otherTabTitle: string;\n}\n\nexport interface Dashboard {\n  certified_by?: string;\n  certification_details?: string;\n  changed_by_name: string;\n  changed_by_url: string;\n  changed_on_delta_humanized?: string;\n  changed_on_utc?: string;\n  changed_by: string;\n  dashboard_title: string;\n  slice_name?: string;\n  id: number;\n  published: boolean;\n  url: string;\n  thumbnail_url: string;\n  owners: Owner[];\n  loading?: boolean;\n}\n\nexport type SavedQueryObject = {\n  id: number;\n  changed_on: string;\n  changed_on_delta_humanized: string;\n  database: {\n    database_name: string;\n    id: number;\n  };\n  db_id: number;\n  description?: string;\n  label: string;\n  schema: string;\n  sql: string | null;\n  sql_tables?: { catalog?: string; schema: string; table: string }[];\n};\n\nexport interface QueryObject {\n  id: number;\n  changed_on: string;\n  database: {\n    database_name: string;\n  };\n  schema: string;\n  sql: string;\n  executed_sql: string | null;\n  sql_tables?: { catalog?: string; schema: string; table: string }[];\n  status: QueryState;\n  tab_name: string;\n  user: {\n    first_name: string;\n    id: number;\n    last_name: string;\n    username: string;\n  };\n  start_time: number;\n  end_time: number;\n  rows: number;\n  tmp_table_name: string;\n  tracking_url: string;\n}\n\nexport enum QueryObjectColumns {\n  id = 'id',\n  changed_on = 'changed_on',\n  database = 'database',\n  database_name = 'database.database_name',\n  schema = 'schema',\n  sql = 'sql',\n  executed_sql = 'executed_sql',\n  sql_tables = 'sql_tables',\n  status = 'status',\n  tab_name = 'tab_name',\n  user = 'user',\n  user_first_name = 'user.first_name',\n  start_time = 'start_time',\n  end_time = 'end_time',\n  rows = 'rows',\n  tmp_table_name = 'tmp_table_name',\n  tracking_url = 'tracking_url',\n}\n\nexport type ImportResourceName =\n  | 'chart'\n  | 'dashboard'\n  | 'database'\n  | 'dataset'\n  | 'saved_query';\n\nexport type DatabaseObject = Partial<Database> &\n  Pick<Database, 'sqlalchemy_uri'>;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  css,\n  logging,\n  styled,\n  SupersetClient,\n  SupersetClientResponse,\n  SupersetTheme,\n  t,\n} from '@superset-ui/core';\nimport Chart from 'src/types/Chart';\nimport { intersection } from 'lodash';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FetchDataConfig, FilterValue } from 'src/components/ListView';\nimport SupersetText from 'src/utils/textUtils';\nimport { findPermission } from 'src/utils/findPermission';\nimport { User } from 'src/types/bootstrapTypes';\nimport { Dashboard, Filter, TableTab } from './types';\nimport { WelcomeTable } from './welcome/types';\n\n// Modifies the rison encoding slightly to match the backend's rison encoding/decoding. Applies globally.\n// Code pulled from rison.js (https://github.com/Nanonid/rison), rison is licensed under the MIT license.\n(() => {\n  const risonRef: {\n    not_idchar: string;\n    not_idstart: string;\n    id_ok: RegExp;\n    next_id: RegExp;\n  } = rison as any;\n\n  const l = [];\n  for (let hi = 0; hi < 16; hi += 1) {\n    for (let lo = 0; lo < 16; lo += 1) {\n      if (hi + lo === 0) continue;\n      const c = String.fromCharCode(hi * 16 + lo);\n      if (!/\\w|[-_./~]/.test(c))\n        l.push(`\\\\u00${hi.toString(16)}${lo.toString(16)}`);\n    }\n  }\n\n  risonRef.not_idchar = l.join('');\n  risonRef.not_idstart = '-0123456789';\n\n  const idrx = `[^${risonRef.not_idstart}${risonRef.not_idchar}][^${risonRef.not_idchar}]*`;\n\n  risonRef.id_ok = new RegExp(`^${idrx}$`);\n  risonRef.next_id = new RegExp(idrx, 'g');\n})();\n\nconst createFetchResourceMethod =\n  (method: string) =>\n  (\n    resource: string,\n    relation: string,\n    handleError: (error: Response) => void,\n    user?: { userId: string | number; firstName: string; lastName: string },\n  ) =>\n  async (filterValue = '', page: number, pageSize: number) => {\n    const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n    const queryParams = rison.encode_uri({\n      filter: filterValue,\n      page,\n      page_size: pageSize,\n    });\n    const { json = {} } = await SupersetClient.get({\n      endpoint: `${resourceEndpoint}?q=${queryParams}`,\n    });\n\n    let fetchedLoggedUser = false;\n    const loggedUser = user\n      ? {\n          label: `${user.firstName} ${user.lastName}`,\n          value: user.userId,\n        }\n      : undefined;\n\n    const data: { label: string; value: string | number }[] = [];\n    json?.result\n      ?.filter(({ text }: { text: string }) => text.trim().length > 0)\n      .forEach(({ text, value }: { text: string; value: string | number }) => {\n        if (\n          loggedUser &&\n          value === loggedUser.value &&\n          text === loggedUser.label\n        ) {\n          fetchedLoggedUser = true;\n        } else {\n          data.push({\n            label: text,\n            value,\n          });\n        }\n      });\n\n    if (loggedUser && (!filterValue || fetchedLoggedUser)) {\n      data.unshift(loggedUser);\n    }\n\n    return {\n      data,\n      totalCount: json?.count,\n    };\n  };\n\nexport const PAGE_SIZE = 5;\nconst getParams = (filters?: Filter[]) => {\n  const params = {\n    order_column: 'changed_on_delta_humanized',\n    order_direction: 'desc',\n    page: 0,\n    page_size: PAGE_SIZE,\n    filters,\n  };\n  if (!filters) delete params.filters;\n  return rison.encode(params);\n};\n\nexport const getEditedObjects = (userId: string | number) => {\n  const filters = {\n    edited: [\n      {\n        col: 'changed_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  const batch = [\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}`,\n    }),\n  ];\n  return Promise.all(batch)\n    .then(([editedCharts, editedDashboards]) => {\n      const res = {\n        editedDash: editedDashboards.json?.result.slice(0, 3),\n        editedChart: editedCharts.json?.result.slice(0, 3),\n      };\n      return res;\n    })\n    .catch(err => err);\n};\n\nexport const getUserOwnedObjects = (\n  userId: string | number,\n  resource: string,\n  filters: Filter[] = [\n    {\n      col: 'owners',\n      opr: 'rel_m_m',\n      value: `${userId}`,\n    },\n  ],\n) =>\n  SupersetClient.get({\n    endpoint: `/api/v1/${resource}/?q=${getParams(filters)}`,\n  }).then(res => res.json?.result);\n\nexport const getRecentActivityObjs = (\n  userId: string | number,\n  recent: string,\n  addDangerToast: (arg1: string, arg2: any) => any,\n  filters: Filter[],\n) =>\n  SupersetClient.get({ endpoint: recent }).then(recentsRes => {\n    const res: any = {};\n    const newBatch = [\n      SupersetClient.get({\n        endpoint: `/api/v1/chart/?q=${getParams(filters)}`,\n      }),\n      SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${getParams(filters)}`,\n      }),\n    ];\n    return Promise.all(newBatch)\n      .then(([chartRes, dashboardRes]) => {\n        res.other = [...chartRes.json.result, ...dashboardRes.json.result];\n        res.viewed = recentsRes.json.result;\n        return res;\n      })\n      .catch(errMsg =>\n        addDangerToast(\n          t('There was an error fetching your recent activity:'),\n          errMsg,\n        ),\n      );\n  });\n\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\n\nexport function createErrorHandler(\n  handleErrorFunc: (\n    errMsg?: string | Record<string, string[] | string>,\n  ) => void,\n) {\n  return async (e: SupersetClientResponse | string) => {\n    const parsedError = await getClientErrorObject(e);\n    // Taking the first error returned from the API\n    // @ts-ignore\n    const errorsArray = parsedError?.errors;\n    const config = await SupersetText;\n    if (\n      errorsArray?.length &&\n      config?.ERRORS &&\n      errorsArray[0].error_type in config.ERRORS\n    ) {\n      parsedError.message = config.ERRORS[errorsArray[0].error_type];\n    }\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\n\nexport function handleChartDelete(\n  { id, slice_name: sliceName }: Chart,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  refreshData: (arg0?: FetchDataConfig | null) => void,\n  chartFilter?: string,\n  userId?: string | number,\n) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true,\n      },\n    ],\n    filters: [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}`,\n  }).then(\n    () => {\n      if (chartFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', sliceName));\n    },\n    () => {\n      addDangerToast(t('There was an issue deleting: %s', sliceName));\n    },\n  );\n}\n\nexport function handleDashboardDelete(\n  { id, dashboard_title: dashboardTitle }: Dashboard,\n  refreshData: (config?: FetchDataConfig | null) => void,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  dashboardFilter?: string,\n  userId?: string | number,\n) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}`,\n  }).then(\n    () => {\n      const filters = {\n        pageIndex: 0,\n        pageSize: PAGE_SIZE,\n        sortBy: [\n          {\n            id: 'changed_on_delta_humanized',\n            desc: true,\n          },\n        ],\n        filters: [\n          {\n            id: 'owners',\n            operator: 'rel_m_m',\n            value: `${userId}`,\n          },\n        ],\n      };\n      if (dashboardFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', dashboardTitle));\n    },\n    createErrorHandler(errMsg =>\n      addDangerToast(\n        t('There was an issue deleting %s: %s', dashboardTitle, errMsg),\n      ),\n    ),\n  );\n}\n\nexport function shortenSQL(sql: string, maxLines: number) {\n  let lines: string[] = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n\n// loading card count for homepage\nexport const loadingCardCount = 5;\n\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map(bp => `@media (max-width: ${bp}px)`);\n\nexport const CardContainer = styled.div<{\n  showThumbnails?: boolean | undefined;\n}>`\n  ${({ showThumbnails, theme }) => `\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${theme.gridUnit * 12}px ${theme.gridUnit * 4}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${showThumbnails ? '314' : '148'}px;\n    margin-top: ${theme.gridUnit * -6}px;\n    padding: ${\n      showThumbnails\n        ? `${theme.gridUnit * 8 + 3}px ${theme.gridUnit * 9}px`\n        : `${theme.gridUnit * 8 + 1}px ${theme.gridUnit * 9}px`\n    };\n  `}\n`;\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover > div {\n    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */\n    height: 168px;\n  }\n`;\n\nexport const StyledIcon = (theme: SupersetTheme) => css`\n  margin: auto ${theme.gridUnit * 2}px auto 0;\n  color: ${theme.colors.grayscale.base};\n`;\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  payload._schema.length === 1 &&\n  payload._schema[0] === 'Must provide a password for the database';\n\nexport const isAlreadyExists = (payload: any) =>\n  typeof payload === 'string' &&\n  payload.includes('already exists and `overwrite=true` was not passed');\n\nexport const getPasswordsNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getAlreadyExists = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isAlreadyExists(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const hasTerminalValidation = (errors: Record<string, any>[]) =>\n  errors.some(error => {\n    const noIssuesCodes = Object.entries(error.extra).filter(\n      ([key]) => key !== 'issue_codes',\n    );\n\n    if (noIssuesCodes.length === 0) return true;\n\n    return !noIssuesCodes.every(\n      ([, payload]) => isNeedsPassword(payload) || isAlreadyExists(payload),\n    );\n  });\n\nexport const checkUploadExtensions = (\n  perm: Array<string>,\n  cons: Array<string>,\n) => {\n  if (perm !== undefined) {\n    return intersection(perm, cons).length > 0;\n  }\n  return false;\n};\n\nexport const uploadUserPerms = (\n  roles: Record<string, [string, string][]>,\n  csvExt: Array<string>,\n  colExt: Array<string>,\n  excelExt: Array<string>,\n  allowedExt: Array<string>,\n) => {\n  const canUploadCSV =\n    findPermission('can_this_form_get', 'CsvToDatabaseView', roles) &&\n    checkUploadExtensions(csvExt, allowedExt);\n  const canUploadColumnar =\n    checkUploadExtensions(colExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ColumnarToDatabaseView', roles);\n  const canUploadExcel =\n    checkUploadExtensions(excelExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ExcelToDatabaseView', roles);\n  return {\n    canUploadCSV,\n    canUploadColumnar,\n    canUploadExcel,\n    canUploadData: canUploadCSV || canUploadColumnar || canUploadExcel,\n  };\n};\n\nexport function getFilterValues(\n  tab: TableTab,\n  welcomeTable: WelcomeTable,\n  user?: User,\n  otherTabFilters?: Filter[],\n): FilterValue[] {\n  if (\n    tab === TableTab.Created ||\n    (welcomeTable === WelcomeTable.SavedQueries && tab === TableTab.Mine)\n  ) {\n    return [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${user?.userId}`,\n      },\n    ];\n  }\n  if (welcomeTable === WelcomeTable.SavedQueries && tab === TableTab.Favorite) {\n    return [\n      {\n        id: 'id',\n        operator: 'saved_query_is_fav',\n        value: true,\n      },\n    ];\n  }\n  if (tab === TableTab.Mine && user) {\n    return [\n      {\n        id: 'owners',\n        operator: 'rel_m_m',\n        value: `${user.userId}`,\n      },\n    ];\n  }\n  if (\n    tab === TableTab.Favorite &&\n    [WelcomeTable.Dashboards, WelcomeTable.Charts].includes(welcomeTable)\n  ) {\n    return [\n      {\n        id: 'id',\n        operator:\n          welcomeTable === WelcomeTable.Dashboards\n            ? 'dashboard_is_favorite'\n            : 'chart_is_favorite',\n        value: true,\n      },\n    ];\n  }\n  if (tab === TableTab.Other) {\n    return (otherTabFilters || []).map(flt => ({\n      id: flt.col,\n      operator: flt.opr,\n      value: flt.value,\n    }));\n  }\n  return [];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Filter } from '../types';\n\nexport enum WelcomeTable {\n  Charts = 'CHARTS',\n  Dashboards = 'DASHBOARDS',\n  Recents = 'RECENTS',\n  SavedQueries = 'SAVED_QUERIES',\n}\n\nexport type WelcomePageLastTab = 'examples' | 'all' | [string, Filter[]];\n"],"names":["CHART_UPDATE_STARTED","chartUpdateStarted","queryController","latestQueryFormData","key","type","CHART_UPDATE_SUCCEEDED","chartUpdateSucceeded","queriesResponse","CHART_UPDATE_STOPPED","chartUpdateStopped","CHART_UPDATE_FAILED","chartUpdateFailed","CHART_RENDERING_FAILED","chartRenderingFailed","error","stackTrace","CHART_RENDERING_SUCCEEDED","chartRenderingSucceeded","REMOVE_CHART","removeChart","ANNOTATION_QUERY_SUCCESS","annotationQuerySuccess","annotation","queryResponse","ANNOTATION_QUERY_STARTED","annotationQueryStarted","ANNOTATION_QUERY_FAILED","annotationQueryFailed","DYNAMIC_PLUGIN_CONTROLS_READY","dynamicPluginControlsReady","dispatch","getState","state","controlsState","getControlsState","explore","form_data","slice_id","value","async","getChartDataRequest","formData","setDataMask","resultFormat","resultType","force","method","requestParams","ownState","querySettings","domainShardingEnabled","mode","credentials","shouldUseLegacyApi","endpointType","getLegacyEndpointType","allowDomainSharding","dashboard_id","url","getExploreUrl","postPayload","parseMethod","isFeatureEnabled","FeatureFlag","SupersetClient","then","json","response","result","legacyChartDataRequest","payload","buildV1ChartDataPayload","sliceId","dashboardId","qs","undefined","getChartDataUri","path","toString","headers","body","JSON","stringify","v1ChartDataRequest","runAnnotationQuery","timeout","isDashboardRequest","sliceKey","Object","keys","charts","fd","requiresQuery","sourceType","Promise","resolve","granularity","time_grain_sqla","overridesKeys","overrides","time_range","sliceFormData","reduce","d","k","hasExtraFilters","extra_filters","length","getAnnotationJsonUrl","controller","AbortController","signal","annotationIndex","annotation_layers","findIndex","it","name","jsonPayload","data","annotation_data","catch","getClientErrorObject","err","statusText","toLowerCase","TRIGGER_QUERY","triggerQuery","RENDER_TRIGGERED","renderTriggered","UPDATE_QUERY_FORM_DATA","updateQueryFormData","UPDATE_CHART_ID","updateChartId","newId","ADD_CHART","addChart","chart","exploreJSON","logStart","Logger","chartDataRequest","dataMask","updateDataMask","chartDataRequestCaught","status","waitForAsyncData","Error","forEach","resultItem","logEvent","LOG_ACTIONS_LOAD_CHART","applied_filters","is_cached","force_refresh","row_count","rowcount","datasource","start_offset","ts","Date","getTime","duration","has_extra_filters","viz_type","data_age","moment","diff","cached_dttm","appendErrorLog","errorDetails","isCached","has_err","error_details","parsedResponse","annotationLayers","all","map","GET_SAVED_CHART","getSavedChart","POST_CHART_FORM_DATA","postChartFormData","redirectSQLLab","datasourceKey","sql","query","safeStringify","addDangerToast","t","refreshChart","chartKey","dashboardInfo","common","conf","SUPERSET_WEBSERVER_TIMEOUT","id","getDatasourceSamples","datasourceType","datasourceId","perPage","page","searchParams","datasource_type","datasource_id","isDefined","per_page","endpoint","clientError","message","cause","propTypes","children","PropTypes","onError","showMessage","ErrorBoundary","React","constructor","props","super","this","info","componentDidCatch","setState","render","firstLine","subtitle","copyText","componentStack","defaultProps","isValidFilter","chartId","dashboardState","sliceIds","ADD_FILTER","addFilter","component","dashboardFilters","REMOVE_FILTER","removeFilter","CHANGE_FILTER","changeFilter","newSelectedValues","merge","components","dashboardLayout","present","UPDATE_DIRECT_PATH_TO_FILTER","updateDirectPathToFilter","UPDATE_LAYOUT_COMPONENTS","updateLayoutComponents","UPDATE_DASHBOARD_FILTERS_SCOPE","updateDashboardFiltersScope","scopes","UPDATE_COMPONENTS","setUnsavedChangesAfterAction","action","args","nextComponents","hasUnsavedChanges","setUnsavedChanges","updateComponents","updateDashboardTitle","text","DASHBOARD_HEADER_ID","meta","DASHBOARD_TITLE_CHANGED","dashboardTitleChanged","DELETE_COMPONENT","deleteComponent","parentId","CREATE_COMPONENT","createComponent","dropResult","CREATE_TOP_LEVEL_TABS","createTopLevelTabs","DELETE_TOP_LEVEL_TABS","deleteTopLevelTabs","RESIZE_COMPONENT","resizeComponent","width","height","undoableLayout","dashboard","widthChanged","heightChanged","updatedComponents","MOVE_COMPONENT","moveComponent","HANDLE_COMPONENT_DROP","handleComponentDrop","overflowsParent","layout","childWidth","getComponentWidthFromDrop","dropOverflowsParent","addWarningToast","source","destination","droppedOnRoot","DASHBOARD_ROOT_ID","isNewComponent","NEW_COMPONENTS_SOURCE_ID","dashboardRoot","rootChildId","TABS_TYPE","index","sourceComponent","destinationComponent","ROW_TYPE","findParentId","childId","sourceSet","Set","destinationSet","concat","values","scope","some","tab","has","isInDifferentFilterScopes","parents","undoLayoutAction","UndoActionCreators","past","maxUndoHistoryExceeded","updatedColorScheme","redoLayoutAction","UPDATE_COMPONENTS_PARENTS_LIST","JSON_KEYS","extractValue","object","keyPath","split","obj","parse","SET_UNSAVED_CHANGES","ADD_SLICE","REMOVE_SLICE","FAVESTAR_BASE_URL","TOGGLE_FAVE_STAR","toggleFaveStar","isStarred","fetchFaveStar","count","saveFaveStar","urlSuffix","TOGGLE_PUBLISHED","savePublished","isPublished","published","addSuccessToast","togglePublished","TOGGLE_EXPAND_SLICE","toggleExpandSlice","UPDATE_CSS","updateCss","css","SET_EDIT_MODE","setEditMode","editMode","ON_CHANGE","onChange","ON_SAVE","onSave","lastModifiedTime","SET_REFRESH_FREQUENCY","setRefreshFrequency","refreshFrequency","isPersistent","saveDashboardRequestSuccess","SET_OVERRIDE_CONFIRM","setOverrideConfirm","overwriteConfirmMetadata","SAVE_DASHBOARD_STARTED","SAVE_DASHBOARD_FINISHED","saveDashboardFinished","saveDashboardRequest","saveType","filter","componentId","directPathToFilter","slice","pop","push","serializedFilters","serializeActiveFilterValues","getActiveFilters","serializedFilterScopes","scopesByColumn","column","serializeFilterScopes","certified_by","certification_details","dashboard_title","owners","roles","slug","hasId","item","metadataCrossFiltersEnabled","metadata","cross_filters_enabled","cleanedData","ensureIsArray","o","r","color_namespace","color_scheme","color_scheme_domain","expanded_slices","label_colors","shared_label_colors","refresh_frequency","timed_refresh_immune_slices","isCrossFiltersEnabled","handleChartConfiguration","chart_configuration","prev","next","find","layoutItem","errorText","SAVE_TYPE_OVERWRITE","SAVE_TYPE_OVERWRITE_CONFIRMED","chartConfiguration","updatedDashboard","json_metadata","default_filters","filter_scopes","updateDashboard","last_modified_time","dashboardInfoChanged","SET_CHART_CONFIG_COMPLETE","native_filter_configuration","SET_FILTER_CONFIG_COMPLETE","filterConfig","window","history","pushState","event","onUpdateSuccess","reject","overwriteConfirmItems","OVERWRITE_INSPECT_FIELDS","oldValue","newValue","updatedAt","changed_on","updatedBy","changed_by_name","LOG_ACTIONS_CONFIRM_OVERWRITE_DASHBOARD_METADATA","items","copyData","finalCopyData","setChartConfiguration","onCopySuccess","fetchCharts","chartList","interval","refreshTime","Math","max","stagger_time","stagger_refresh","delay","i","setTimeout","ON_FILTERS_REFRESH","ON_FILTERS_REFRESH_SUCCESS","onFiltersRefreshSuccess","ON_REFRESH_SUCCESS","ON_REFRESH","onRefresh","refreshCharts","SHOW_BUILDER_PANE","showBuilderPane","addSliceToDashboard","sliceEntities","selectedSlice","slices","newChart","initChart","applyDefaultFormData","fetchDatasourceMetadata","removeSliceFromDashboard","sliceEntity","getSharedLabelColor","removeSlice","SET_COLOR_SCHEME","setColorScheme","colorScheme","SET_DIRECT_PATH","setDirectPathToChild","SET_ACTIVE_TABS","setActiveTabs","tabId","prevTabId","SET_FOCUSED_FILTER_FIELD","setFocusedFilterField","UNSET_FOCUSED_FILTER_FIELD","unsetFocusedFilterField","SET_FULL_SIZE_CHART_ID","setFullSizeChartId","SET_MAX_UNDO_HISTORY_EXCEEDED","setMaxUndoHistoryExceeded","maxUndoHistoryToast","historyLength","SET_DATASETS_STATUS","setDatasetsStatus","FILTER_COMPONENT_FILTER_TYPES","setValuesInArray","value1","value2","HYDRATE_DASHBOARD","hydrateDashboard","filterboxMigrationState","FILTER_BOX_MIGRATION_STATES","activeTabs","user","position_data","positionData","regularUrlParams","extractUrlParams","edit","preselectFilters","getUrlParam","URL_PARAMS","e","updateColorSchema","DASHBOARD_VERSION_KEY","DASHBOARD_ROOT_TYPE","DASHBOARD_GRID_ID","DASHBOARD_GRID_TYPE","chartIdToLayoutId","layoutComponent","CHART_TYPE","parent","findFirstParentContainerId","newSlicesContainer","newSlicesContainerWidth","filterScopes","chartQueries","slicesFromExploreCount","Map","url_params","slice_url","slice_name","description","description_markeddown","modified","add","GRID_DEFAULT_CHART_WIDTH","GRID_COLUMN_COUNT","newComponentFactory","chartHolder","get","set","configs","getFilterConfigsFromFormdata","columns","labels","col","scopesByChartId","scopeSettings","immune","DASHBOARD_FILTER_SCOPE_GLOBAL","dashboardFilter","filterName","isDateFilter","TIME_RANGE","layoutId","sliceName","element","updateComponentParentsList","currentComponent","buildActiveFilters","DASHBOARD_HEADER_TYPE","future","focusedChartId","focusedChartLayoutId","found","params","URLSearchParams","location","search","delete","replace","directLinkComponentId","getLocationHash","directPathToChild","chartData","filterBoxToFilterComponentMap","String","adhoc_filters","date_filter","filter_configs","granularity_sqla","show_sqla_time_column","show_sqla_time_granularity","getDashboardDefaultValues","preselectedFilters","filterKey","TIME_FILTER_MAP","timeRangeFilter","shortid","controlValues","TIME_FILTER_LABELS","filterType","FILTER_TIME","targets","cascadeParentIds","defaultDataMask","NativeFilterType","rootPath","excluded","dashboardDefaultValues","extraFormData","filterState","timeGrainFilter","FILTER_TIMEGRAIN","datasetId","parseInt","timeColumnFilter","FILTER_TIMECOLUMN","config","entry","enableEmptyFilter","FILTER_CONFIG_ATTRIBUTES","defaultToFirstItem","inverseSelection","multiSelect","sortAscending","label","FILTER_SELECT","sortMetric","defaultValues","defaultValue","getFilterBoxDefaultValues","filters","op","val","dependencies","filterFieldsDependencies","filterChartIds","entries","filterFields","filterField","filterScope","getChartIdsInFilterBoxScope","getFilterboxDependencies","field","childrenChartIds","parentComponentId","childrenChartId","childComponentId","childComponent","FILTER_RANGE","getNativeFilterConfig","show_native_filters","nativeFilters","getInitialNativeFilterState","behaviors","getChartMetadataRegistry","Behavior","crossFilters","chartsInScope","getChartIdsInFilterScope","canEdit","canUserEditDashboard","crossFiltersEnabled","initSliceEntities","isLoading","userId","dash_edit_perm","dash_save_perm","findPermission","dash_share_perm","superset_can_explore","superset_can_share","superset_can_csv","slice_can_edit","flash_messages","filterBarOrientation","filter_bar_orientation","FilterBarOrientation","preselectNativeFilters","Array","from","directPathLastUpdated","now","focusedFilterField","expandedSlices","shouldPersistRefreshFrequency","colorNamespace","dashboardIsSaving","isRefreshing","isFiltersRefreshing","datasetsStatus","ResourceStatus","SET_ALL_SLICES","setAllSlices","FETCH_ALL_SLICES_STARTED","fetchAllSlicesStarted","FETCH_ALL_SLICES_FAILED","fetchSlices","excludeFilterBox","filter_value","sortColumn","additional_filters","opr","cloneSlices","rison","page_size","order_column","order_direction","datasource_name","datasource_name_text","datasource_url","changed_on_utc","description_markdown","changed_on_delta_humanized","changed_on_humanized","thumbnail_url","errorResponse","fetchAllSlicesFailed","fetchAllSlices","lastUpdated","fetchSortedSlices","fetchFilteredSlices","isInstantFilter","CHANGE_FILTER_VALUE_ACTIONS","dashboardFiltersReducer","actionHandlers","instant_filtering","updatedColumns","allDashboardFiltersScope","updatedFilters","getChartIdAndColumnFromFilterKey","deletedFilter","errorMessage","sliceEntitiesReducer","allFilterBoxChartIds","activeFilters","appliedFilterValuesByChart","allComponents","isFilterBox","getAppliedFilterValues","applicableFilters","chartIds","traverse","immuneChartIds","child","scopeComponentIds","nonEmptyFilters","isArray","getDashboardFilterKey","dragging","draggingWidth","minimumWidth","minDraggingWidth","getDetailedComponentWidth","destinationWidth","occupiedWidth","draggingOccupiedWidth","destinationCapacity","Number","isNaN","grandparentWidth","grandparentOccupiedWidth","getTotalChildWidth","passedComponent","GRID_MIN_COLUMN_COUNT","COLUMN_TYPE","DYNAMIC_TYPE","MARKDOWN_TYPE","show_druid_time_granularity","vals","updatedLabels","typeToDefaultMetaData","background","BACKGROUND_TRANSPARENT","DIVIDER_TYPE","HEADER_TYPE","headerSize","MEDIUM_HEADER","TAB_TYPE","defaultText","placeholder","uuid","entityFactory","entryByChartId","parentsList","logging","CheckBoxControlWrapper","styled","theme","colors","grayscale","dark1","gridUnit","CheckboxControl","renderCheckbox","bind","checked","leftNode","onClick","EXPRESSION_TYPES","SIMPLE","SQL","CLAUSES","HAVING","WHERE","OPERATORS_TO_SQL","IN","LIKE","ILIKE","REGEX","schema","CUSTOM_OPERATIONS","CUSTOM_OPERATORS","OPERATOR_ENUM_TO_OPERATOR_TYPE","operation","translateToSql","adhocMetric","useSimple","expressionType","subject","comparator","operator","Operators","getSimpleSQLExpression","sqlExpression","AdhocFilter","adhocFilter","toUpperCase","operatorId","indexOf","clause","isExtra","isNew","datasourceWarning","filterOptionName","random","substring","duplicateWith","nextFields","equals","isValid","nullCheckOperators","truthCheckOperators","getDefaultLabel","getTooltipTitle","AdhocFilterOption","options","onFilterEdit","onRemoveFilter","partitionColumn","onMoveLabel","onDropLabel","sections","operators","actualTimeRange","title","useGetTimeRangeLabel","AdhocFilterPopoverTrigger","tooltipTitle","onRemove","DndItemType","withCaret","isRequired","warning","Modal","selectedMetricType","adhocMetricType","adhocFilterType","columnType","savedMetrics","savedMetricType","selectedMetrics","canDelete","isDictionaryForAdhocFilter","AdhocFilterControl","optionsForSelect","onNewFilter","moveLabel","mapOption","getMetricExpression","optionRenderer","option","FilterDefinitionOption","valueRenderer","stopPropagation","componentDidMount","dbId","database","is_sqllab_view","isSqllabView","partitions","cols","UNSAFE_componentWillReceiveProps","nextProps","valuesCopy","splice","prevState","content","newFilter","mappedOption","changedFilter","opts","savedMetricName","savedMetric","metric_name","expression","dragIndex","hoverIndex","newValues","saved_metric_name","AdhocMetric","column_name","metric","results","sort","a","b","localeCompare","addNewFilterPopoverTrigger","trigger","className","ControlHeader","Icons","iconSize","iconColor","light5","light1","withTheme","inferSqlExpressionColumn","sqlaAutoGeneratedMetricRegex","indexFirstCloseParen","indexPairedOpenParen","lastIndexOf","inferSqlExpressionAggregate","indexFirstOpenParen","inferredColumn","aggregate","hasCustomLabel","optionName","useVerboseName","transformCountDistinct","verbose_name","AGGREGATES","test","showType","ariaLabel","autoFocus","choices","clearable","disabled","freeForm","multi","isMulti","onFocus","default","showHeader","valueKey","filterOption","tokenSeparators","notFoundContent","renderTrigger","validationErrors","rightNode","hovered","tooltipOnClick","danger","SelectControl","getOptions","handleFilterOptions","isEqualArray","onChangeVal","v","customLabel","c","is","headerProps","selectProps","allowNewOptions","allowClear","header","loading","sortComparator","currentValue","getValue","spatialTypes","animation","SpatialControl","defaultCol","delimiter","latCol","lonCol","lonlatCol","reverseCheckbox","geohashCol","errors","toggleCheckbox","renderReverseCheckbox","errMsg","setType","renderLabelContent","renderSelect","renderPopoverContent","style","isSelected","onSelect","gutter","xs","md","placement","initialValue","minLines","maxLines","offerEditInModal","language","aboveEditorSection","readOnly","resize","textAreaStyles","TextAreaControl","onControlChange","target","onAreaEditorChange","renderEditor","inModal","border","minHeight","backgroundColor","editorProps","$blockScrolling","renderModalBody","controlHeader","modalTitle","triggerNode","buttonSize","modalBody","responsive","categoricalSchemeRegistry","getCategoricalSchemeRegistry","sequentialSchemeRegistry","getSequentialSchemeRegistry","D3_FORMAT_OPTIONS","timeColumnOption","groupByControl","includeTime","opt","mapStateToProps","control","newState","groupby","metrics","validators","validateNonEmpty","controls","isEditable","color_picker","g","metric_2","linear_color_scheme","getDefaultKey","schemes","getMap","isLinear","secondary_metric","main_dttm_col","row_limit","legacyValidateInteger","formatSelectOptions","limit","timeseries_limit_metric","series","entity","x","y","size","y_axis_format","showWarning","comparison_type","filterable","s","inputFormData","vizType","DEFAULT_VIZ_TYPE","y_axis_zero","y_axis_bounds","handleDeprecatedControls","getAllControlsState","controlPanelConfig","getChartControlPanelRegistry","onInit","controlFormData","getFormDataFromControls","controlName","defaultControls","f","extractTypes","ANNOTATION_TYPES_METADATA","FORMULA","EVENT","supportNativeSource","INTERVAL","TIME_SERIES","ANNOTATION_TYPES","DEFAULT_ANNOTATION_TYPE","ANNOTATION_SOURCE_TYPES_METADATA","NATIVE","ANNOTATION_SOURCE_TYPES","annotationSourceType","SET_REPORT","fetchUISpecificReport","creationMethod","resourceId","queryParams","report","setReport","structureFetchAction","chartArr","ADD_REPORT","addReport","EDIT_REPORT","editReport","toggleActive","isActive","encodeURI","active","finally","deleteActiveReport","WindowedMenuList","maxHeight","getStyles","cx","innerRef","windowListRef","windowListRef_","windowListInnerRef","defaultWindowListRef","useRef","optionHeight","spacing","baseUnit","lineHeight","detectHeight","totalHeight","useEffect","lastSelected","isFocused","getLastSelected","current","scrollToItem","ref","outerRef","min","itemData","itemCount","itemSize","MenuList","DefaultMenuList","defaultComponents","DEFAULT_WINDOW_THRESHOLD","windowThreshold","windowed","SelectComponent","forwardRef","components_","restProps","WindowedSelect","Select","WindowedCreatableSelect","Creatable","WindowedAsyncCreatableSelect","AsyncCreatable","DEFAULT_CLASS_NAME","DEFAULT_CLASS_NAME_PREFIX","primary","success","base","indicator","almostBlack","grayDark","grayLight","light2","gray","grayBg","light4","grayBgDarker","light3","grayBgDarkest","grayHeading","menuHover","lightest","darkest","dark2","grayBorder","grayBorderLight","grayBorderDark","textDefault","textDarkest","dangerLight","DEFAULT_STYLES","container","provider","minWidth","indicatorSeparator","indicatorsContainer","clearIndicator","menuIsOpen","borderRadius","isPseudoFocused","borderColor","menu","zIndex","menuList","isDisabled","fontSize","weights","color","bold","normal","valueContainer","hasValue","multiValueLabel","paddingLeft","paddingRight","input","menuPortal","INPUT_TAG_BASE_STYLES","outline","padding","ClearIndicator","DropdownIndicator","Option","Input","SelectContainer","DEFAULT_COMPONENTS","assistiveText","marginLeft","typography","sizes","innerProps","autoComplete","inputStyle","VALUE_LABELED_STYLES","overflow","singleValue","SortableSelectComponent","SortableContainer","withRef","supersetDefaultComponents","StyledSelect","stateManager","selectRef","labelKey","themeConfig","stylesConfig","valueRenderedAsLabel","valueRenderedAsLabel_","onPaste","sortable","forceOverflow","classNamePrefix","value_","isMulti_","isClearable","isClearable_","minMenuHeight","maxMenuHeight","ignoreAccents","getOptionValue","getOptionLabel","formatOptionLabel","context","flatOptions","flatMap","realVal","hasOwnProperty","findValue","shouldAllowSort","MaybeSortableSelect","MultiValue","SortableElement","onMouseDown","preventDefault","sortableContainerProps","getHelperDimensions","node","getBoundingClientRect","axis","onSortEnd","oldIndex","newIndex","arrayMove","distance","assign","getNewOptionData","inputValue","closeMenuOnScroll","classList","contains","menuPosition","useTheme","instance","refs","wrappedInstance","createFilter","styles","reactSelectTheme","menuGutter","controlHeight","defaultTheme","CreatableSelect","AsyncCreatableSelect","OnPasteSelect","evt","clipboard","clipboardData","getData","regex","separator","RegExp","trim","validator","isValidNewOption","selected","existingOptions","existing","notExists","unshift","selectWrap","noResultsText","StyledNativeSelect","getPopupContainer","parentNode","StyledNativeGraySelect","origSelectedValues","instantFiltering","filtersFields","filtersChoices","onFilterMenuOpen","onFilterMenuClose","showDateFilter","showSqlaTimeGrain","showSqlaTimeColumn","StyledFilterContainer","FilterBox","onCloseDateFilterControl","selectedValues","hasChanged","debouncerCache","maxValueCache","onOpenDateFilterControl","getControlData","actions","setControlValue","mapFunc","getKnownMax","d3Max","clickApply","fltr","debounceLoadOptions","callback","loadOptions","SLOW_DEBOUNCE","transformOptions","maxValue","perc","round","backgroundImage","BOOL_TRUE_DISPLAY","BOOL_FALSE_DISPLAY","sortAsc","asc","rawFormData","labelA","textOrder","startsWith","renderDateFilter","DateFilterControl","endpoints","renderDatasourceFilters","datasourceFilters","sqlaFilters","druidFilters","ControlRow","Control","choiceIds","isMultiple","searchAllOptions","cacheOptions","defaultOptions","onMenuOpen","onBlur","onMenuClose","FILTER_OPTIONS_LIMIT","renderFilters","Form","htmlFor","Button","buttonStyle","StyledDiv","certifiedBy","details","metricName","xmlns","enableBackground","viewBox","fill","StyleOverrides","ColumnOption","labelRef","type_generic","hasExpression","tooltipText","setTooltipText","useState","useLayoutEffect","getColumnTooltipNode","getColumnLabelText","is_certified","_path","_extends","arguments","prototype","call","apply","fillRule","clipRule","TypeIconWrapper","ColumnTypeLabel","typeIcon","QuestionOutlined","GenericDataType","ClockCircleOutlined","FlexRowContainer","MetricOption","openInNewWindow","showFormula","shouldShowTooltip","verbose","link","href","rel","warningMarkdown","warning_markdown","warning_text","getMetricTooltipNode","icon","tooltip","iconsStyle","StyledCalculatorIcon","CalculatorOutlined","SQLPopover","setOptions","highlightActiveLine","highlightGutterLine","wrapEnabled","secondary","maxWidth","arrowPointAtCenter","TooltipSectionWrapper","TooltipSectionLabel","TooltipSection","isLabelTruncated","scrollWidth","clientWidth","COLUMN_NAME_ALIASES","DTTM_ALIAS","DATASET_TIME_COLUMN_OPTION","QUERY_TIME_COLUMN_OPTION","DatasourceType","is_dttm","QueryModeLabel","QueryMode","required","labelClass","role","tabIndex","cursor","Tooltip","join","InfoTooltipWithTrigger","RadioButtonControl","position","top","marginBottom","marginTop","fontWeight","boxShadow","ControlFormRow","display","flexWrap","margin","ControlForm","debouncedOnChange","useMemo","FAST_DEBOUNCE","updatedChildren","row","defaultWidth","debounceDelay","onItemValueChange","fieldValue","textTransform","AntdSelect","creatable","onSearch","dropdownMatchSelectWidth","showSearch","showSearch_","searchValue","setSearchValue","handleSearch","optionsHasSearchValue","optionsHasValue","handleChange","ControlFormItemComponents","Slider","InputNumber","Checkbox","ControlFormItem","controlType","setHovered","setValue","setValidationErrors","isEmptyValue","onMouseEnter","onMouseLeave","d3NumberFormat","D3_FORMAT_DOCS","d3TimeFormat","D3_TIME_FORMAT_DOCS","D3_TIME_FORMAT_OPTIONS","fractionDigits","step","columnWidth","validateNumber","horizontalAlign","FaAlignLeft","FaAlignCenter","FaAlignRight","showCellBars","alignPositiveNegative","colorPositiveNegative","truncateLongCells","SHARED_COLUMN_CONFIG_PROPS","d3SmallNumberFormat","DEFAULT_CONFIG_FORM_LAYOUT","override","ColumnConfigPopover","configFormLayout","caretWidth","alignItems","borderBottom","right","ColumnConfigControl","appliedColumnNames","colnames","_colnames","coltypes","_coltypes","appliedCol","idx","columnConfigs","showAllColumns","setShowAllColumns","getColumnInfo","needShowMoreButton","MAX_NUM_COLS","ColumnConfigItem","validConfigs","fromEntries","setColumnConfig","textAlign","dndGroupByControl","allowAll","promptTextCreator","controlState","commaChoosesOption","dndColumnsControl","dndSeriesControl","dndEntityControl","dndAdhocFilterControl","isDataset","defineSavedMetrics","provideFormDataToProps","datePickerInAdhocFilterMixin","dndAdhocMetricsControl","dndAdhocMetricControl","dndAdhocMetricControl2","dndSortByControl","dndSizeControl","dndXControl","dndYControl","dndSecondaryMetricControl","dndGranularitySqlaControl","temporalColumnMixin","ghostButtonText","clickEnabledGhostButtonText","dndXAxisControl","xAxisMixin","withDndFallback","DndComponent","FallbackComponent","getAxisLabel","orientation","hasGenericChartAxes","x_axis","getTemporalColumns","temporalColumns","defaultTemporalColumn","isTemporal","flt","temporalColumn","DEFAULT_TIME_FILTER","NO_TIME_RANGE","SERIES_LIMITS","appContainer","document","getElementById","getAttribute","datasourceControl","visibility","xAxis","xAxisValue","isAdhocColumn","isPhysicalColumn","order_desc","Boolean","series_limit","DEFAULT_NUMBER_FORMAT","ComparisonType","x_axis_time_format","DEFAULT_TIME_FORMAT","truncate_metric","show_empty_columns","temporal_columns_lookup","orderby","series_columns","series_limit_metric","legacy_order_by","isStandardizedFormData","standardizedFormData","memorizedFormData","COMPARATOR","MULTIPLE_VALUE_COMPARATORS","BETWEEN","BETWEEN_OR_EQUAL","BETWEEN_OR_LEFT_EQUAL","BETWEEN_OR_RIGHT_EQUAL","isColumnMeta","isSavedExpression","isControlPanelSectionConfig","section","isQueryResponse","D3_NUMBER_FORMAT_DESCRIPTION_VALUES_TEXT","D3_NUMBER_FORMAT_DESCRIPTION_PERCENTAGE_TEXT","NumberFormats","smartDateFormatter","DEFAULT_METRICS","expandControlType","sharedControlComponents","expandControlConfig","controlOverrides","sharedControls","getStandardizedControls","makeSingleton","setStandardizedControls","shiftMetric","shift","shiftColumn","popAllMetrics","popAllColumns","clear","rv","isTemporalColumn","columnName","formatSelectOptionsForRange","start","end","ChartControlPanelRegistry","Registry","AppSection","ChartLabel","chartLabelExplanations","DEPRECATED","FEATURED","chartLabelWeight","weight","AxisType","CategoricalColorNamespace","forcedItems","scales","getScale","schemeId","scheme","CategoricalColorScale","setColor","forcedColor","stringifyAndTrim","resetColors","namespaces","DEFAULT_NAMESPACE","getNamespace","newInstance","getColor","namespace","ExtensibleFunction","parentForcedColors","originColors","scale","forcedColors","multiple","scaleOrdinal","range","cleanedValue","sharedLabelColor","getColorMap","floor","domain","newRange","getAnalogousColors","newColor","addSlice","colorMap","copy","unknown","newDomain","SharedLabelColorSource","SharedLabelColor","sliceLabelMap","updateColorMap","categoricalNamespace","newColorMap","colorScale","reset","_","rgbRegex","getContrastingColor","thresholds","matchColor","exec","hex","generatedColors","analogousColors","tinycolor","analogous","toHexString","addAlpha","opacity","modulePromises","withNamespace","defineSharedModule","fetchModule","moduleKey","modulePromise","defineSharedModules","moduleMap","initialRecords","records","RollingType","DataMaskType","isNativeFilter","filterElement","NATIVE_FILTER","isNativeFilterWithDataMask","isFilterDivider","DIVIDER","ExtensionsRegistry","TypedRegistry","getExtensionsRegistry","getUiOverrideRegistry","arrA","arrB","every","numeric","validateInteger","isFinite","chartAlert","chartStatus","chartStackTrace","chartUpdateEndTime","chartUpdateStartTime","lastRendered","chartReducer","stacktrace","annotationQuery","abort","annotationData","annotationError","HYDRATE_EXPLORE","DatasourcesAction","CheckboxChecked","CheckboxHalfChecked","CheckboxUnchecked","Styles","CONFIRM_WARNING_MESSAGE","CHANGE_WARNING_MSG","StyledModal","ConfirmModalStyled","StyledSpan","withToasts","onDatasourceSave","onHide","show","setFilter","pageIndex","setPageIndex","sortBy","setSortBy","DATASET_SORT_BY","confirmChange","setConfirmChange","confirmedDataset","setConfirmedDataset","searchRef","resourceCollection","resourceCount","fetchData","useListViewResource","selectDatasource","useCallback","fetchDatasetPayload","pageSize","DATASET_PAGE_SIZE","useDebouncedEffect","focus","onEnterModal","Cell","original","table_name","Header","accessor","disableSortBy","FacePile","users","hideFooter","footer","Alert","roomBelow","Loading","TableView","initialPageIndex","initialSortBy","totalCount","onServerPagination","emptyWrapperType","EmptyWrapperType","serverPagination","isPaginationSticky","scrollTable","DatasourceEditor","AsyncEsmComponent","StyledDatasourceModal","buildExtraJsonObject","certification","currentDatasource","setCurrentDatasource","setErrors","isSaving","setIsSaving","isEditing","setIsEditing","dialog","modal","contextHolder","onConfirmSave","tableSelector","databaseSelector","extra","okButtonProps","showLegacyDatasourceEditor","maskClosable","edit_url","confirm","showIcon","onOk","okText","cancelText","is_managed_externally","showLoadingForImport","AntdRangePicker","AntdDatePicker","RangePicker","DatePicker","metadataRegistry","dummyPluginContext","dynamicPlugins","mountedPluginMetadata","fetchAll","PluginContext","usePluginContext","useContext","getRegistryData","pluginContextReducer","plugins","mounting","plugin","pluginApi","makeApi","sharedModules","react","lodash","DynamicPluginProvider","pluginState","useReducer","import","bundle_url","stack","registryListener","addListener","removeListener","Provider","colorList","customAvatarStyler","m","StyledAvatar","Avatar","StyledGroup","maxCount","first_name","last_name","sampleValue","charCodes","letter","charCodeAt","len","stringAsciiPRNG","getRandomColor","toLocaleUpperCase","PopoverSection","paddingBottom","mediumHeavy","UiConfigContext","createContext","hideTitle","hideTab","hideNav","hideChartControls","useUiConfig","EmbeddedUiConfigProvider","embeddedConfig","DASHBOARD_INFO_UPDATED","labelColors","newInfo","SET_FILTER_BAR_ORIENTATION","SET_CROSS_FILTERS_ENABLED","saveFilterBarOrientation","errorObject","getErrorText","saveCrossFiltersSetting","setCrossFiltersEnabled","setDatasources","datasources","SET_DATASOURCES","setDatasource","SET_DATASOURCE","SET_IN_SCOPE_STATUS_OF_FILTERS","SET_FILTER_SETS_COMPLETE","setFilterConfiguration","oldFilters","mergedFilterConfig","oldFilter","setDataMaskForFilterConfigComplete","SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL","setInScopeStatusOfFilters","filtersWithScopes","filterId","tabsInScope","filterWithScope","getFilterSets","fetchFilterSets","filterSets","ids","createFilterSet","filterSet","postFilterSets","serverFilterSet","owner_type","owner_id","updateFilterSet","deleteFilterSet","filterSetId","deleteFilterSets","SET_FOCUSED_NATIVE_FILTER","UNSET_FOCUSED_NATIVE_FILTER","setFocusedNativeFilter","unsetFocusedNativeFilter","SET_HOVERED_NATIVE_FILTER","UNSET_HOVERED_NATIVE_FILTER","setHoveredNativeFilter","unsetHoveredNativeFilter","hasCircularDependency","dependencyMap","trace","dependency","validateForm","form","currentFilterId","setCurrentFilterId","formValues","validateFields","errorFields","outOfDate","filterError","createHandleSave","filterConfigMap","filterIds","removedFilters","saveForm","newFilterConfig","formInputs","dataset","requiredFirst","rf","getInitialDataMask","createHandleRemoveItem","setRemovedFilters","setOrderedFilters","setSaveAlertVisible","timerId","isPending","orderedFilters","completeFilterRemoval","REMOVAL_DELAY_SECS","NATIVE_FILTER_PREFIX","NATIVE_FILTER_DIVIDER_PREFIX","generateFilterId","getFilterIds","getFormData","otherProps","extra_form_data","inView","mergeExtraFormData","originalExtra","newExtra","mergedExtra","EXTRA_FORM_DATA_APPEND_KEYS","mergedValues","EXTRA_FORM_DATA_OVERRIDE_KEYS","originalValue","getExtraFormData","filterIdsAppliedOnChart","nativeFilterGate","isComponentATab","findTabsWithChartsInScopeHelper","tabIds","tabsToHighlight","findTabsWithChartsInScope","hasTopLevelTabs","PLACEHOLDER_DATASOURCE","uid","column_types","column_format","verbose_map","MAIN_HEADER_HEIGHT","CLOSED_FILTER_BAR_WIDTH","OPEN_FILTER_BAR_WIDTH","OPEN_FILTER_BAR_MAX_WIDTH","FILTER_BAR_HEADER_HEIGHT","FILTER_BAR_TABS_HEIGHT","BUILDER_SIDEPANEL_WIDTH","getInitialState","filterSetsConfig","filtersSet","focusedFilterId","nativeFilterReducer","hoveredFilterId","NEW_COMPONENT_SOURCE_TYPE","reservedQueryParams","urlParamType","querystring","acc","cache","findParentIdWithCache","structure","lastParent","layoutItems","elementId","filterKeySplitter","match","hash","isUserWithPermissionsAndRoles","isUser","isUserAdmin","owner","isUserDashboardOwner","canUserAccessSqlLab","CLEAR_DATA_MASK_STATE","UPDATE_DATA_MASK","SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE","isFeatureFlagActive","clearDataMask","clearDataMaskState","moreProps","fillNativeFilters","mergedDataMask","draftDataMask","initialDataMask","currentFilters","areObjectsEqual","ignoreUndefined","produce","draft","cleanState","ColorSchemeType","hydrateExplore","saveAction","fallbackSlice","initialSlice","initialFormData","defaultVizType","initialDatasource","initialExploreState","initialControls","colorSchemeKey","linearColorSchemeKey","verifyColorScheme","registryDefaultScheme","defaultKey","defaultScheme","currentScheme","colorSchemeExists","CATEGORICAL","SEQUENTIAL","exploreState","can_add","can_download","can_overwrite","isDatasourceMetaLoading","triggerRender","controlsTransferred","standalone","applyMapStateToPropsToControl","getChartKey","getDatasourceUid","saveModal","dashboards","saveModalAlert","isVisible","CustomListItem","selectable","rest","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","AnnotationLayer","refreshAnnotationData","AnnotationLayerControl","popoverVisible","addedAnnotationIndex","addAnnotationLayer","removeAnnotationLayer","handleVisibleChange","preload","originalAnnotation","newAnnotation","annotations","anno","visible","popoverKey","getSectionContainerElement","setProperty","renderPopover","close","renderInfo","bsStyle","addedAnnotation","ControlPopover","onVisibleChange","float","bordered","destroyTooltipOnHide","themedAnnotationLayerControl","connect","annotationObj","MinInput","MaxInput","parseNumber","BoundsControl","minMax","setMinMax","update","mm","addTooltip","itemGenerator","keyAccessor","isFloat","isInt","SortableListItem","SortableList","List","SortableDragger","SortableHandle","CollectionControl","onAdd","removeItem","ix","renderList","controlMap","useDragHandle","lockAxis","commonProps","flex","marginRight","swatchCommon","left","bottom","StyledSwatch","checkerboard","ColorPickerControl","rgb","presetColors","colStyle","Popover","CLOSE","SAVE_AS_DATASET","OPEN_IN_SQL_LAB","closeModal","changeDatasource","viewInSQLLab","openSQL","CHANGE_DATASET","VIEW_IN_SQL_LAB","EDIT_DATASET","datasourceIconLookup","DatasourceControl","timeCol","isGranularitySqalTemporal","isDefaultTemporal","toggleShowDatasource","showDatasource","toggleChangeDatasourceModal","showChangeDatasourceModal","toggleEditDatasourceModal","showEditDatasourceModal","toggleSaveDatasetModal","showSaveDatasetModal","handleMenuItemClick","isMissingDatasource","isMissingParams","allowEdit","canAccessSqlLab","editText","defaultDatasourceMenu","Menu","queryDatasourceMenu","ModalTrigger","ViewQuery","select_star","modalFooter","draggable","resizable","health_check_message","healthCheckMessage","titleText","getDatasourceTitle","displayString","renderDatasourceTitle","WarningIconWithTooltip","overlay","ErrorAlert","level","SaveDatasetModal","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","getDatasourceAsSaveableDataset","openWindow","TitleLabel","StyledInput","isEditDisabled","isHovered","setIsHovered","isEditMode","setIsEditMode","defaultLabel","handleMouseOver","handleMouseOut","handleClick","handleBlur","handleKeyPress","ev","handleInputBlur","onKeyPress","onMouseOver","onMouseOut","onClose","onResize","getCurrentTab","getCurrentLabel","savedMetricsOptions","isNewMetric","isLabelModified","noOp","SAVED_TAB_KEY","AdhocMetricEditPopover","defaultActiveTabKey","getDefaultTab","onResetStateAndClose","onColumnChange","onAggregateChange","onSavedMetricChange","onSqlExpressionChange","onDragDown","onMouseMove","onMouseUp","onTabChange","handleAceEditorRef","refreshAceEditor","POPOVER_INITIAL_WIDTH","POPOVER_INITIAL_HEIGHT","addEventListener","componentDidUpdate","prevProps","savedMetricLabel","adhocMetricLabel","componentWillUnmount","removeEventListener","oldMetric","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","aceEditorRef","editor","renderColumnOption","renderMetricOption","propsAdhocMetric","propsSavedMetric","popoverProps","keywords","sqlKeywords","score","columnValue","columnSelectProps","aggregateSelectProps","AGGREGATES_OPTIONS","savedSelectProps","stateIsValid","Tabs","defaultActiveKey","allowOverflow","EmptyState","image","handleDatasetModal","disallow_adhoc_metrics","showGutter","enableLiveAutocompletion","cta","AdhocMetricPopoverTrigger","onPopoverResize","onLabelChange","closePopover","togglePopover","currentLabel","labelModified","isTitleEditDisabled","defaultMetricLabel","forceUpdate","showModal","newMetric","onMetricEdit","isControlledComponent","overlayContent","popoverTitle","defaultVisible","onRemoveMetric","datasourceWarningMessage","AdhocMetricOption","isFunction","MetricDefinitionValue","metricOptionProps","getOptionsForSavedMetrics","currentMetricValues","currentMetric","isDictionaryForAdhocMetric","coerceAdhocMetrics","emptySavedMetric","MetricsControl","propsValue","prevColumns","usePrevious","prevSavedMetrics","optionValues","onNewMetric","changedMetric","isAddNewMetricDisabled","savedMetricOptions","newAdhocMetric","addNewMetricPopoverTrigger","matchingMetrics","getMetricsMatchingCurrentDataset","controlTypes","FixedOrMetricControl","setFixedValue","setMetric","fixedValue","metricValue","Collapse","ghost","showArrow","Label","TextControl","isLabeledValue","arg","dataEndpoint","mutator","colType","timeLag","timeRatio","comparisonType","showYAxis","yAxisBounds","bounds","d3format","dateFormat","comparisonTypeOptions","colTypeOptions","StyledRow","Row","StyledCol","Col","StyledTooltip","ButtonBar","TimeSeriesColumnControl","resetState","initialState","onPopoverVisibleChange","onSelectChange","attr","onTextInputChange","onCheckboxChange","onBoundsChange","onYAxisBoundsChange","textSummary","formRow","ttLabel","PARAMS","longitude","latitude","zoom","bearing","pitch","ViewportControl","ctrl","renderTextControl","renderLabel","decimal2sexagesimal","FEATURED_CHARTS","antdIconProps","VizTile","isRendered","vizMeta","onTileClick","chartNameRef","TILE_TRANSITION_TIME","transitionTiming","tooltipVisible","setTooltipVisible","isTransitioning","setIsTransitioning","showTooltip","setShowTooltip","chartName","handleTileClick","containerProps","mouseEnterDelay","FastVizSwitcher","currentSelection","currentViz","useSelector","vizTiles","featuredVizMeta","denyList","getBootstrapData","VIZ_TYPE_DENYLIST","VizSupportValidation","UnpaddedModal","STYLE_ROW","STYLE_RALIGN","isCheckbox","FormRow","labelAndTooltip","INTEGRAL_TYPES","DECIMAL_TYPES","STYLE_WIDTH","FilterBoxItemControl","typedValue","selectedColumnName","selectedColumn","parseFloat","renderForm","FullWidthInputNumber","JustifyEnd","operatorOptions","NONE","GREATER_THAN","LESS_THAN","GREATER_OR_EQUAL","LESS_OR_EQUAL","EQUAL","NOT_EQUAL","targetValueValidator","compare","rejectMessage","targetValue","compareValue","targetValueLeftValidator","targetValueRightValidator","isOperatorMultiValue","isOperatorNone","rulesRequired","rulesTargetValueLeft","getFieldValue","rulesTargetValueRight","targetValueLeftDeps","targetValueRightDeps","shouldFormItemUpdate","prevValues","currentValues","operatorField","rules","renderOperatorFields","span","validateTrigger","FormattingPopoverContent","alert","onFinish","initialValues","requiredMark","noStyle","shouldUpdate","htmlType","FormattingPopover","setVisible","handleSave","newConfig","overlayStyle","FormattersContainer","FormatterContainer","OptionControlContainer","CloseButton","DndSelectLabel","displayGhostButton","accept","valuesRenderer","isOver","canDrop","datasourcePanelDrop","useDrop","drop","onDrop","onDropValue","canDropValue","collect","monitor","getItemType","cancelHover","onClickGhostButton","StyledInfoTooltipWithTrigger","clickClose","onClickClose","OptionLabel","OptionWrapper","onShiftOptions","isDragging","drag","useDrag","hover","hoverBoundingRect","hoverMiddleY","clientOffset","getClientOffset","hoverClientY","LabelContent","transformedCol","getColumnNameOrAdhocColumn","OptionSelector","del","swap","getValues","editedColumn","setDatasetModal","setLabel","initialLabel","initialAdhocColumn","initialCalculatedColumn","initialSimpleColumn","getInitialColumnValues","adhocColumn","setAdhocColumn","selectedCalculatedColumn","setSelectedCalculatedColumn","selectedSimpleColumn","setSelectedSimpleColumn","sqlEditorRef","calculatedColumns","simpleColumns","onCalculatedColumnChange","onSimpleColumnChange","onSqlEditorFocus","setDatasetAndClose","savedExpressionsLabel","simpleColumnsLabel","UNRESIZABLE_POPOVER_WIDTH","calculatedColumn","simpleColumn","DndColumnSelectPopoverTitle","onInputBlur","defaultPopoverLabel","onColumnEdit","popoverLabel","setPopoverLabel","setPopoverVisible","setIsTitleEditDisabled","setHasCustomLabel","showDatasetModal","initialPopoverLabel","handleTogglePopover","handleClosePopover","DndColumnSelectWithFallback","newColumnPopoverVisible","setNewColumnPopoverVisible","optionSelector","optionsMap","clickEnabled","newColumn","addNewColumnWithPopover","openPopover","labelGhostButtonText","tn","DndAdhocFilterOption","DND_ACCEPTED_TYPES","DndFilterSelectWithFallback","propsValues","setValues","setPartitionColumn","newFilterPopoverVisible","setNewFilterPopoverVisible","droppedItem","setDroppedItem","removeValue","filterOptions","handleClickGhostButton","defaultTimeFilter","useDefaultTimeFilter","handleDrop","requireSave","EMPTY_OBJECT","coerceMetrics","addedMetrics","isSavedMetric","isAdhocMetricSimple","DndMetricSelectWithFallback","newMetricPopoverVisible","setNewMetricPopoverVisible","newSavedMetricOptions","getSavedMetricOptionsForMetric","handleDropLabel","itemValue","ColorSchemeControl","DndColumnSelectControl","DndColumnSelect","DndFilterSelect","DndMetricSelect","HiddenControl","SelectAsyncControl","SliderControl","VizTypeControl","isModalOpenInit","setShowModal","modalKey","setModalKey","selectedViz","setSelectedViz","openModal","onSubmit","onCancel","primaryButtonName","disablePrimaryButton","onHandledPrimaryAction","MAX_ADVISABLE_VIZ_GALLERY_WIDTH","VizTypeGallery","onDoubleClick","ConditionalFormattingControl","columnOptions","verboseMap","conditionalFormattingConfigs","setConditionalFormattingConfigs","removeFormattersWhenColumnsChange","newFormattingConfigs","useComponentDidUpdate","prevConfigs","onDelete","newConfigs","onEdit","targetValueLeft","targetValueRight","createLabel","XAxisSortControl","shouldReset","StyledControl","hidden","resetOnHide","wasVisible","ControlComponent","console","warn","iconStyles","hasHadNoErrors","labelColor","isHiddenControl","countableControls","colSize","CellNull","CopyButton","CopyToClipboardButton","prepareCopyToClipboardTabularData","wrapped","copyNode","FilterInput","onChangeHandler","debouncedChangeHandler","debounce","prefix","filterText","RowCount","FormatPickerValue","FormatPicker","direction","Formatted","Original","FormatPickerContainer","FormatPickerLabel","DataTableTemporalHeaderCell","onTimeColumnChange","isOriginalTimeColumn","overlayClassName","useFilteredTableData","rowsAsStrings","timeFormatter","getTimeFormatter","TimeFormats","useTableColumns","moreConfigs","originalFormattedTimeColumns","setOriginalFormattedTimeColumns","getTimeColumns","setTimeColumns","firstValue","originalFormattedTimeColumnIndex","NULL_DISPLAY","colsMap","getItem","LocalStorageKeys","setItem","ExplorePopoverContent","RowCountLabel","limitReached","formattedRowCount","getNumberFormatter","ColorSchemeLabel","labelNameRef","labelColorsRef","colorsList","labelNameElement","labelColorsElement","offsetWidth","scrollHeight","offsetHeight","StyledAlert","CUSTOM_LABEL_ALERT","DASHBOARD_ALERT","hasCustomLabelColors","alertTitle","schemesObject","SUPERSET_DEFAULT","controlChoices","allColorOptions","isValidColorOption","getColors","lastElementChild","getElementYVisibilityRatioOnContainer","containerHeight","innerHeight","nodePositionInViewport","getVisibilityRatio","visibleProp","triggerElementRef","setPlacement","calculatePlacement","visibilityRatio","changeContainerScrollStatus","handleGetPopupContainer","handleOnVisibleChange","handleDocumentKeyDownListener","CommonFrame","commonRange","COMMON_RANGE_SET","Radio","COMMON_RANGE_OPTIONS","CalendarFrame","CALENDAR_RANGE_SET","PreviousCalendarWeek","CALENDAR_RANGE_OPTIONS","CustomFrame","customRange","matchedFlag","customTimeRangeDecode","customTimeRangeEncode","sinceDatetime","sinceMode","sinceGrain","sinceGrainValue","untilDatetime","untilMode","untilGrain","untilGrainValue","anchorValue","anchorMode","onGrainValue","localFromFlaskBabel","locale","datePickerLocale","locales","LOCALE_MAPPING","SINCE_MODE_OPTIONS","showTime","dttmToMoment","datetime","format","MOMENT_FORMAT","abs","onStep","SINCE_GRAIN_OPTIONS","UNTIL_MODE_OPTIONS","UNTIL_GRAIN_OPTIONS","align","radioValue","MIDNIGHT","TIME_PICKER_HELPER","DateFunctionTooltip","getAdvancedRange","SEPARATOR","AdvancedFrame","advancedRange","since","until","ACTIVE_BORDER_COLOR","LabelContainer","isPlaceholder","DateLabel","StyledRangeType","ContentStyleWrapper","medium","IconWrapper","DateFilterLabel","onOpenPopover","onClosePopover","isOverflowingFilterBar","setActualTimeRange","setShow","guessedFrame","guessFrame","frame","setFrame","lastFetchedTimeRange","setLastFetchedTimeRange","timeRangeValue","setTimeRangeValue","validTimeRange","setValidTimeRange","evalResponse","setEvalResponse","setTooltipTitle","labelIsTruncated","useCSSTextTruncation","fetchTimeRange","actualRange","toggleOverlay","FRAME_OPTIONS","popoverContent","modalContent","PreviousCalendarMonth","PreviousCalendarYear","formatDateEndpoint","dttm","isStart","formatTimeRange","timeRange","columnPlaceholder","splitDateRange","COMMON_RANGE_VALUES_SET","CALENDAR_RANGE_VALUES_SET","timeRangeString","GRAIN_OPTIONS","SEVEN_DAYS_AGO","utc","startOf","subtract","en","fr","es","zh","ja","de","pt","pt_BR","ru","ko","sk","sl","nl","DATE_FILTER_TEST_KEY","iso8601","raw","datetimeConstant","grainValue","grain","CUSTOM_RANGE_EXPRESSION","ISO8601_AND_CONSTANT","DATETIME_CONSTANT","defaultCustomRange","SPECIFIC_MODE","dttmToString","sinceCapturedGroup","untilCapturedGroup","sinceDttm","untileDttm","INITIAL_ADVANCED_DATA_TYPES_STATE","parsedAdvancedDataType","advancedDataTypeOperatorList","SelectWithLabel","labelText","onSubjectChange","onOperatorChange","isOperatorRelevant","onComparatorChange","onDatePickerChange","isColumnBoolean","isColumnNumber","isColumnFunction","HAVING_OPERATORS","currentComparator","newComparator","MULTI_OPERATORS","clearOperator","useSimpleTabFilterProps","suggestions","setSuggestions","setComparator","loadingComparatorSuggestions","setLoadingComparatorSuggestions","advancedDataTypesState","subjectAdvancedDataType","fetchAdvancedDataTypeValueCallback","fetchSubjectAdvancedDataType","validHandler","setAdvancedDataTypesState","setSubjectAdvancedDataType","comp","display_value","valid_filter_operators","error_message","advanced_data_type","useAdvancedDataTypes","isOperatorRelevantWrapper","createSuggestionsPlaceholder","optionsRemaining","valuesFromSuggestionsLength","getOptionsRemaining","subjectSelectProps","operatorSelectProps","OPERATORS_OPTIONS","shouldFocusComparator","comparatorSelectProps","datePicker","useDatePickerInAdhocFilter","having","filter_select","suggestion","optionLabel","refreshComparatorSuggestions","subjectComponent","operatorsAndOperandComponent","order","activeKey","AdhocFilterEditPopoverSqlTabContent","onSqlExpressionClauseChange","clauseSelectProps","selectOptions","ResizeIcon","FilterPopoverContentContainer","FilterActionsContainer","AdhocFilterEditPopover","onAdhocFilterChange","setSimpleTabIsValid","adjustHeight","isSimpleTabValid","popoverContentRef","heightDifference","propsAdhocFilter","onHeightChange","popoverRef","DragContainer","LabelText","CaretContainer","CloseContainer","HeaderContainer","LabelsContainer","DndLabelsContainer","AddControlLabel","AddIconButton","OptionControlLabel","hasMetricName","getLabelContent","parsedValue","legacyValidateNumber","onChangeWrapper","CopyButtonViewQuery","SyntaxHighlighter","markdownSyntax","htmlSyntax","sqlSyntax","jsonSyntax","StyledSyntaxContainer","StyledSyntaxHighlighter","shouldShowText","github","SECTIONS","DEFAULT_ORDER","typesWithDefaultOrder","OTHER_CATEGORY","ALL_CHARTS","RECOMMENDED_TAGS","VizPickerLayout","isSelectedVizMetadata","SectionTitle","l","LeftPane","RightPane","SearchWrapper","InputIconAlignment","SelectorLabel","IconsPane","DetailsPane","DetailsPopulated","TagsWrapper","Description","Examples","thumbnailContainerCss","HighlightLabel","ThumbnailLabelWrapper","TitleLabelWrapper","vizSortFactor","Thumbnail","alt","src","thumbnail","ThumbnailGallery","vizEntries","Selector","selector","sectionId","btnRef","queueMicrotask","scrollIntoView","behavior","scrollMode","searchInputRef","searchInputValue","setSearchInputValue","isSearchFocused","setIsSearchFocused","isActivelySearching","selectedVizMetadata","chartMetadata","deprecated","chartsByCategory","category","categories","chartsByTags","tags","tag","sortedMetadata","activeSelector","setActiveSelector","activeSection","setActiveSection","CATEGORY","fuse","Fuse","ignoreLocation","threshold","searchResults","aLabel","bLabel","aOrder","focusSearch","changeSearch","stopSearching","blur","clickSelector","isSelectedVizCompatible","viz","doesVizMatchSelector","sectionMap","selectors","TAGS","expandIconPosition","suffix","labelExplanation","exampleGallery","example","caption","OptionContainer","StyledMetricOption","StyledColumnOption","datasourceAndVizType","controlSetRows","sqlaTimeSeries","expanded","tabOverride","NVD3TimeSeries","getMemoizedSectionsToRender","memoizeOne","sectionOverrides","controlPanelSections","filterControlsForTypes","invalidControls","getSectionsToRender","getMemoizedControlConfig","controlKey","flat","findControlItem","getControlConfig","controlPanelState","processedState","externalValidationErrors","execControlValidator","alteredControl","choiceValues","el","handleMissingChoice","getControlStateFromControlConfig","controlConfig","fieldsetRow","isControlValueCompatibleWithDatasource","isSimpleAdhocFilter","isAdhocMetricSQL","getControlValuesCompatibleWithDatasource","compatibleValues","sharedMetricsKey","sharedColumnsKey","publicControls","StandardizedFormData","sourceFormData","sfd","freeze","mfd","restFormData","getLatestFormData","standardizedControls","serialize","transform","targetVizType","latestFormData","publicFormData","targetControlsState","targetFormData","controlPanel","formDataOverrides","transformed","effect","isMountedRef","TRANSPORT_POLLING","LOCALSTORAGE_KEY","transport","pollingDelayMs","pollingTimeoutId","listenersByJobId","retriesByJobId","lastReceivedEventId","asyncResponse","jobId","job_id","fn","asyncEvent","result_url","fetchCachedData","parseErrorJson","fetchEvents","processEvents","events","listener","localStorage","setLastId","loadEventsFromApi","eventArgs","last_id","wsConnectTimeout","ws","wsConnectRetries","wsConnect","GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL","WebSocket","clearTimeout","readyState","appConfig","GLOBAL_ASYNC_QUERIES_TRANSPORT","GLOBAL_ASYNC_QUERIES_POLLING_DELAY","init","perm","view","permissions","perm_","view_","module","require","loadModule","urlParam","getUrlParams","excludedParams","urlParams","append","getUrlParamEntries","urlEntries","getChartUrlParams","excludedUrlParams","RESERVED_CHART_URL_PARAMS","filterBoxFilters","getDashboardUrlParams","RESERVED_DASHBOARD_URL_PARAMS","getPermalink","getChartPermalink","getDashboardPermalink","anchor","externalUrlRegex","isUrlExternal","parseUrl","PAGE_SIZE","SORT_BY","desc","PASSWORDS_NEEDED_MESSAGE","CONFIRM_OVERWRITE_MESSAGE","parsedErrorMessage","resource","resourceLabel","handleErrorMsg","infoEnable","defaultCollectionValue","baseFilters","initialLoadingState","collection","lastFetchDataConfig","bulkSelectEnabled","updateState","currentState","infoJson","createErrorHandler","filterValues","filterExps","lastFetched","toISOString","setResourceCollection","hasPerm","p","toggleBulkSelect","refreshData","provideConfig","useSingleViewResource","resourceName","setResource","fetchResource","resourceID","createResource","hideToast","updateResource","setLoading","clearError","useImportResource","passwordsNeeded","alreadyExists","failed","importResource","bundle","databasePasswords","overwrite","FormData","RE_EXPORT_TEXT","Accept","hasTerminalValidation","getPasswordsNeeded","getAlreadyExists","FavStarClassName","favoriteApis","requestType","useFavoriteStatus","favoriteStatus","setFavoriteStatus","updateFavoriteStatus","CHART","DASHBOARD","useChartEditModal","setCharts","sliceCurrentlyEditing","setSliceCurrentlyEditing","handleChartUpdated","edits","newCharts","openChartEditModal","cache_timeout","closeChartEditModal","copyQueryLink","copyTextToClipboard","origin","getDatabaseImages","SupersetText","getConnectionAlert","getDatabaseDocumentationLinks","testDatabaseConnection","connection","useAvailableDatabases","availableDbs","setAvailableDbs","useDatabaseValidation","onCreate","db","parameters","ssh","catalog","parsedErrors","error_type","invalid","missing","issue_codes","reportSelector","resourceType","reports","TableTab","QueryObjectColumns","risonRef","hi","lo","fromCharCode","not_idchar","not_idstart","idrx","id_ok","next_id","createFetchResourceMethod","relation","handleError","filterValue","resourceEndpoint","fetchedLoggedUser","loggedUser","firstName","lastName","getParams","getEditedObjects","edited","batch","editedCharts","editedDashboards","editedDash","editedChart","getUserOwnedObjects","res","getRecentActivityObjs","recent","recentsRes","newBatch","chartRes","dashboardRes","other","viewed","createFetchRelated","createFetchDistinct","handleErrorFunc","parsedError","errorsArray","ERRORS","handleChartDelete","chartFilter","handleDashboardDelete","dashboardTitle","shortenSQL","lines","loadingCardCount","mq","bp","CardContainer","showThumbnails","CardStyles","StyledIcon","isNeedsPassword","_schema","isAlreadyExists","fileName","noIssuesCodes","checkUploadExtensions","cons","uploadUserPerms","csvExt","colExt","excelExt","allowedExt","canUploadCSV","canUploadColumnar","canUploadExcel","canUploadData","getFilterValues","welcomeTable","otherTabFilters","WelcomeTable"],"sourceRoot":""}
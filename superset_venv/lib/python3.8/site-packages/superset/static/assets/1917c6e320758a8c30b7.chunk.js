/*! For license information please see 1917c6e320758a8c30b7.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{82689:(e,t,n)=>{var i=n(29932),r=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?i(t,(function(e){return u(e)?function(t){return r(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=i(t,l(o));var p=a(e,(function(e,n,r){return{criteria:i(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var i=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,o=e==e,a=i(e),s=void 0!==t,l=null===t,d=t==t,c=i(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||r&&s&&d||!n&&d||!o)return 1;if(!r&&!a&&!c&&e<t||c&&n&&o&&!r&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var i=n(26393);e.exports=function(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++r<s;){var d=i(o[r],a[r]);if(d)return r>=l?d:d*("desc"==n[r]?-1:1)}return e.index-t.index}},10752:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1/0)}},89734:(e,t,n)=>{var i=n(21078),r=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),r(e,i(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var i=n(45652);e.exports=function(e){return e&&e.length?i(e):[]}},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>U,DropTarget:()=>K});var i=n(28195);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===r(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),g=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}}]),e}(),x=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function R(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function T(e){var t=e.DecoratedComponent,n=e.createHandler,r=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,f=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",T=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(D,e);var t,s,p,m,T=(p=D,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(p);if(m){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function D(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,D),(t=T.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new x,t.receiveProps(e),t.dispose(),t}return t=D,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!f(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new x,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){f(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],i=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var r=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(r),new b(i)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(g.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,i.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=r(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&Z(t.prototype,s),D}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(T,t)}var D=n(33273),_=n(60938),I=n(8556);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function M(e,t){return"string"==typeof e||"symbol"===$(e)||!!t&&Array.isArray(e)&&e.every((function(e){return M(e,!1)}))}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=["canDrag","beginDrag","isDragging","endDrag"],O=["beginDrag"],z=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(r.props)return r.spec.beginDrag(r.props,r.monitor,r.ref.current)},this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&E(t.prototype,n),e}();function P(e){return Object.keys(e).forEach((function(t){(0,i.k)(F.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',F.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),O.forEach((function(t){(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new z(e,t,n)}}function U(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(M(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=P(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return T({containerDisplayName:"DragSource",createHandler:a,registerHandler:D.w,createConnector:function(e){return new I.x(e)},createMonitor:function(e){return new _.p(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}var N=n(89026),A=n(56941);function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=["canDrop","hover","drop"],j=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&q(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,i.k)(L.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',L.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new j(e,t,n)}}function K(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(M(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return T({containerDisplayName:"DropTarget",createHandler:a,registerHandler:D.n,createMonitor:function(e){return new A.H(e)},createConnector:function(e){return new N.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return t&&W(e.prototype,t),n&&W(e,n),e}function J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ee(e);if(t){var r=ee(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,i.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var r=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=r.displayName||r.name||"Component",l=function(){var t=function(t){J(o,t);var n=Q(o);function o(){var e;return H(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return Y(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(g.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(r,Object.assign({},e.props,e.state,{ref:d(r)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,i.k)("object"===B(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>r.DragLayer,DragSource:()=>r.DragSource,DropTarget:()=>r.DropTarget});var i=n(31388);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(9238)},54238:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var i=n(75253);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(48058);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(54238);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},24903:(e,t,n)=>{"use strict";t.cj=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),i=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return i.type=i.type||"search",i.value=this.state.searchTerm,i.onChange=this.updateSearch,i.className=n,i.placeholder=i.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",i))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,i=t.caseSensitive,r=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:i,fuzzy:r,sortResults:o})}}]),t}(r.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(i){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var r=e.split(" ");return t?("string"==typeof t&&(t=[t]),r.every((function(e){var r=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],r=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else r=t;return r.some((function(t){return s(a(t,i),e,n)}))}))):r.every((function(e){return s([i],e,n)}))}};var i,r=(i=n(69021))&&i.__esModule?i:{default:i};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),i=[t];return n.forEach((function(e){var t=[];i.forEach((function(n){if(n)if(n instanceof Array){var i=parseInt(e,10);if(!isNaN(i))return t.push(n[i]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),i=t})),(i=o(i=i.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new r.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:i,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return i||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,g=n.tokenSeparator,m=void 0===g?/ +/g:g,f=n.findAllMatches,v=void 0!==f&&f,b=n.minMatchCharLength,y=void 0===b?1:b,x=n.id,S=void 0===x?null:x,C=n.keys,Z=void 0===C?[]:C,w=n.shouldSort,R=void 0===w||w,k=n.getFn,T=void 0===k?s:k,D=n.sortFn,_=void 0===D?function(e,t){return e.score-t.score}:D,I=n.tokenize,$=void 0!==I&&I,M=n.matchAllTokens,E=void 0!==M&&M,F=n.includeMatches,O=void 0!==F&&F,z=n.includeScore,P=void 0!==z&&z,U=n.verbose,N=void 0!==U&&U;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:Z,includeMatches:O,includeScore:P,shouldSort:R,getFn:T,sortFn:_,verbose:N,tokenize:$,matchAllTokens:E},this.setCollection(t),this._processKeys(Z)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var i=e[t];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var r=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),r=null==r?u:Math.min(r,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),i=n.tokenSearchers,r=n.fullSearcher,o=this._search(i,r);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),i=0,r=n.length;i<r;i+=1)t.push(new o(n[i],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,i={},r=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t});return r}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t})}return r}},{key:"_analyze",value:function(e,t){var n=this,i=e.key,r=e.arrayIndex,o=void 0===r?-1:r,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,g=void 0===p?{}:p,m=t.results,f=void 0===m?[]:m;!function e(t,r,o,a){if(null!=r)if("string"==typeof r){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===i?"--":i));var p=h.search(r);if(n._log('Full text: "'.concat(r,'", score: ').concat(p.score)),n.options.tokenize){for(var m=r.split(n.options.tokenSeparator),v=m.length,b=[],y=0,x=u.length;y<x;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var C=!1,Z=0;Z<v;Z+=1){var w=m[Z],R=S.search(w),k={};R.isMatch?(k[w]=R.score,s=!0,C=!0,b.push(R.score)):(k[w]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(w,'", score: ').concat(k[w]))}C&&(c+=1)}d=b[0];for(var T=b.length,D=1;D<T;D+=1)d+=b[D];d/=T,n._log("Token score average:",d)}var _=p.score;d>-1&&(_=(_+d)/2),n._log("Score average:",_);var I=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(I)),(s||p.isMatch)&&I){var $={key:i,arrayIndex:t,value:r,score:_};n.options.includeMatches&&($.matchedIndices=p.matchedIndices);var M=g[a];M?M.output.push($):(g[a]={item:o,output:[$]},f.push(g[a]))}}else if(l(r))for(var E=0,F=r.length;E<F;E+=1)e(E,r[E],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,i=0,r=e.length;i<r;i+=1){for(var o=e[i],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===i(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var n=e.output;t.matches=[];for(var i=0,r=n.length;i<r;i+=1){var o=n[i];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),r.length){for(var l={item:s.item},d=0,c=r.length;d<c;d+=1)r[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(t.prototype,n),e}();e.exports=d},function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,g=n.tokenSeparator,m=void 0===g?/ +/g:g,f=n.findAllMatches,v=void 0!==f&&f,b=n.minMatchCharLength,y=void 0===b?1:b,x=n.includeMatches,S=void 0!==x&&x;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,i=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return i&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return r(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,g=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:g,minMatchCharLength:m,includeMatches:i})}}])&&i(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(i,"|")),o=e.match(r),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var i=n(4),r=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,g=o.minMatchCharLength,m=void 0===g?1:g,f=o.includeMatches,v=void 0!==f&&f,b=s,y=e.length,x=u,S=e.indexOf(t,b),C=t.length,Z=[],w=0;w<y;w+=1)Z[w]=0;if(-1!==S){var R=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(x=Math.min(R,x),-1!==(S=e.lastIndexOf(t,b+C))){var k=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});x=Math.min(k,x)}}S=-1;for(var T=[],D=1,_=C+y,I=1<<(C<=31?C-1:30),$=0;$<C;$+=1){for(var M=0,E=_;M<E;)i(t,{errors:$,currentLocation:b+E,expectedLocation:b,distance:d})<=x?M=E:_=E,E=Math.floor((_-M)/2+M);_=E;var F=Math.max(1,b-E+1),O=p?y:Math.min(b+E,y)+C,z=Array(O+2);z[O+1]=(1<<$)-1;for(var P=O;P>=F;P-=1){var U=P-1,N=n[e.charAt(U)];if(N&&(Z[U]=1),z[P]=(z[P+1]<<1|1)&N,0!==$&&(z[P]|=(T[P+1]|T[P])<<1|1|T[P+1]),z[P]&I&&(D=i(t,{errors:$,currentLocation:U,expectedLocation:b,distance:d}))<=x){if(x=D,(S=U)<=b)break;F=Math.max(1,2*b-S)}}if(i(t,{errors:$+1,currentLocation:b,expectedLocation:b,distance:d})>x)break;T=z}var A={isMatch:S>=0,score:0===D?.001:D};return v&&(A.matchedIndices=r(Z,m)),A}},function(e,t){e.exports=function(e,t){var n=t.errors,i=void 0===n?0:n,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=i/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],i=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===i?i=o:s||-1===i||((r=o-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[o-1]&&o-i>=t&&n.push([i,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,i=0;i<n;i+=1)t[e.charAt(i)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},r=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!r(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(i(u))}else a.push(t)}(e,t),a},isArray:n,isString:r,isNum:o,toString:i}}])},82607:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(5872),r=n.n(i),o=(n(67294),n(51995)),a=n(62529),s=n(11965);const l=(0,o.iK)((e=>{let{textColor:t,color:n,text:i,...o}=e;return(0,s.tZ)(a.Z,r()({text:i,color:i?n:void 0},o))}))`
  & > sup {
    padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    background: ${e=>{let{theme:t,color:n}=e;return n||t.colors.primary.base}};
    color: ${e=>{let{theme:t,textColor:n}=e;return n||t.colors.grayscale.light5}};
  }
`},38270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(5872),r=n.n(i),o=n(67294),a=n(73727),s=n(94184),l=n.n(s),d=n(51995),c=n(55867),u=n(11965),h=n(58593),p=n(79789);const g=(0,d.iK)(p.Z)`
  vertical-align: middle;
`;function m(e){let{canEdit:t=!1,editing:n=!1,extraClasses:i,multiLine:s=!1,noPermitTooltip:d,onSaveTitle:p,showTooltip:m=!0,style:f,title:v="",defaultTitle:b="",placeholder:y="",certifiedBy:x,certificationDetails:S,url:C,...Z}=e;const[w,R]=(0,o.useState)(n),[k,T]=(0,o.useState)(v),[D,_]=(0,o.useState)(v),[I,$]=(0,o.useState)(null),M=(0,o.useRef)();function E(){if(!t||w)return;const e=M.current?M.current.getBoundingClientRect():null;R(!0),$(e)}function F(){const e=k.trim();t&&(R(!1),e.length?(D!==e&&_(e),v!==e&&p(e)):T(D))}function O(e){" "===e.key&&e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),F())}function z(e){t&&T(e.target.value)}function P(e){"Enter"===e.key&&(e.preventDefault(),F())}let U;(0,o.useEffect)((()=>{v!==k&&(_(k),T(v))}),[v]),(0,o.useEffect)((()=>{if(w&&(M.current.focus(),M.current.setSelectionRange)){const{length:e}=M.current.value;M.current.setSelectionRange(e,e),M.current.scrollLeft=M.current.scrollWidth,M.current.scrollTop=M.current.scrollHeight}}),[w]),U=k,w||k||(U=b||v);const N=w&&I?{height:`${I.height}px`}:void 0;let A=s&&w?(0,u.tZ)("textarea",{ref:M,value:U,className:v?void 0:"text-muted",onKeyDown:O,onChange:z,onBlur:F,onClick:E,onKeyPress:P,placeholder:y,style:N}):(0,u.tZ)("input",{ref:M,type:w?"text":"button",value:U,className:v?void 0:"text-muted",onKeyDown:O,onChange:z,onBlur:F,onClick:E,onKeyPress:P,placeholder:y});return m&&!w&&(A=(0,u.tZ)(h.u,{id:"title-tooltip",title:t?(0,c.t)("Click to edit"):d||(0,c.t)("You don't have the rights to alter this title.")},A)),t||(A=C?(0,u.tZ)(a.rU,{to:C,css:e=>u.iv`
          color: ${e.colors.grayscale.dark1};
          text-decoration: none;
          :hover {
            text-decoration: underline;
          }
        `},U):(0,u.tZ)("span",null,U)),(0,u.tZ)("span",r()({className:l()("editable-title",i,t&&"editable-title--editable",w&&"editable-title--editing"),style:f},Z),x&&(0,u.tZ)(o.Fragment,null,(0,u.tZ)(g,{certifiedBy:x,details:S,size:"xl"})," "),A)}},85931:(e,t,n)=>{"use strict";n.d(t,{m:()=>l});var i=n(5872),r=n.n(i),o=(n(67294),n(73727)),a=n(23525),s=n(11965);const l=e=>{let{to:t,component:n,replace:i,innerRef:l,children:d,...c}=e;return"string"==typeof t&&(0,a.TO)(t)?(0,s.tZ)("a",r()({href:(0,a.en)(t)},c),d):(0,s.tZ)(o.rU,r()({to:t,component:n,replace:i,innerRef:l},c),d)}},19299:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Eh});var i=n(14890),r=n(28216),o=n(78580),a=n.n(o),s=n(67294),l=n(45697),d=n.n(l),c=n(55867),u=n(93185),h=n(14278),p=n(38703),g=n(20292),m=n(81255);function f(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===m.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var v=n(94184),b=n.n(v),y=n(51995),x=n(11965),S=n(25130),C=n(57902),Z=n(49484),w=n(71262),R=n(68969),k=n(23279),T=n.n(k),D=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},M=void 0;M="undefined"!=typeof window?window:"undefined"!=typeof self?self:n.g;var E=null,F=null,O=M.clearTimeout,z=M.setTimeout,P=M.cancelAnimationFrame||M.mozCancelAnimationFrame||M.webkitCancelAnimationFrame,U=M.requestAnimationFrame||M.mozRequestAnimationFrame||M.webkitRequestAnimationFrame;null==P||null==U?(E=O,F=function(e){return z(e,20)}):(E=function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e,2),n=t[0],i=t[1];P(n),O(i)},F=function(e){var t=U((function(){O(n),e()})),n=z((function(){P(t),e()}),20);return[t,n]});var N=function(e){function t(){var e,n,i;D(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=$(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={height:i.props.defaultHeight||0,width:i.props.defaultWidth||0},i._onResize=function(){var e=i.props,t=e.disableHeight,n=e.disableWidth,r=e.onResize;if(i._parentNode){var o=i._parentNode.offsetHeight||0,a=i._parentNode.offsetWidth||0,s=window.getComputedStyle(i._parentNode)||{},l=parseInt(s.paddingLeft,10)||0,d=parseInt(s.paddingRight,10)||0,c=parseInt(s.paddingTop,10)||0,u=parseInt(s.paddingBottom,10)||0,h=o-c-u,p=a-l-d;(!t&&i.state.height!==h||!n&&i.state.width!==p)&&(i.setState({height:o-c-u,width:a-l-d}),r({height:o,width:a}))}},i._setRef=function(e){i._autoSizer=e},$(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),_(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=function(e){var t=void 0,n=void 0,i=void 0,r=void 0,o=void 0,a=void 0,s=void 0,l="undefined"!=typeof document&&document.attachEvent;if(!l){a=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},o=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},s=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;a(this),this.__resizeRAF__&&E(this.__resizeRAF__),this.__resizeRAF__=F((function(){o(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))}};var d=!1,c="";i="animationstart";var u="Webkit Moz O ms".split(" "),h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p=document.createElement("fakeelement");if(void 0!==p.style.animationName&&(d=!0),!1===d)for(var g=0;g<u.length;g++)if(void 0!==p.style[u[g]+"AnimationName"]){c="-"+u[g].toLowerCase()+"-",i=h[g],d=!0;break}t="@"+c+"keyframes "+(n="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",r=c+"animation: 1ms "+n+"; "}return{addResizeListener:function(o,d){if(l)o.attachEvent("onresize",d);else{if(!o.__resizeTriggers__){var c=o.ownerDocument,u=M.getComputedStyle(o);u&&"static"===u.position&&(o.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){var i=(t||"")+".resize-triggers { "+(r||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',o=n.head||n.getElementsByTagName("head")[0],a=n.createElement("style");a.id="detectElementResize",a.type="text/css",null!=e&&a.setAttribute("nonce",e),a.styleSheet?a.styleSheet.cssText=i:a.appendChild(n.createTextNode(i)),o.appendChild(a)}}(c),o.__resizeLast__={},o.__resizeListeners__=[],(o.__resizeTriggers__=c.createElement("div")).className="resize-triggers";var h=c.createElement("div");h.className="expand-trigger",h.appendChild(c.createElement("div"));var p=c.createElement("div");p.className="contract-trigger",o.__resizeTriggers__.appendChild(h),o.__resizeTriggers__.appendChild(p),o.appendChild(o.__resizeTriggers__),a(o),o.addEventListener("scroll",s,!0),i&&(o.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&a(o)},o.__resizeTriggers__.addEventListener(i,o.__resizeTriggers__.__animationListener__))}o.__resizeListeners__.push(d)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",s,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(i,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,i=e.disableHeight,r=e.disableWidth,o=e.style,a=this.state,l=a.height,d=a.width,c={overflow:"visible"},u={},h=!1;return i||(0===l&&(h=!0),c.height=0,u.height=l),r||(0===d&&(h=!0),c.width=0,u.width=d),(0,s.createElement)("div",{className:n,ref:this._setRef,style:I({},c,o)},!h&&t(u))}}]),t}(s.PureComponent);N.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}};const A=N;var q=n(74061),L=n(24903),j=n(9875),V=n(4715),K=n(35932),B=n(70163),H=n(80621),W=n(2275),Y=n(69856),J=n(5872),G=n.n(J),Q=n(4144),X=n(58593),ee=n(85931);const te=e=>{let{children:t,...n}=e;const[i,r]=(0,s.useState)(!1),o=(0,s.useRef)(null);(0,s.useEffect)((()=>{r(!!o.current&&o.current.scrollWidth>o.current.clientWidth)}),[t]);const a=(0,x.tZ)("div",G()({},n,{ref:o,css:x.iv`
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        display: block;
      `}),t);return i?(0,x.tZ)(X.u,{title:t},a):a},ne=e=>{let{label:t,value:n}=e;return(0,x.tZ)("div",{css:e=>x.iv`
      font-size: ${e.typography.sizes.s}px;
      display: flex;
      justify-content: space-between;

      &:not(:last-child) {
        margin-bottom: ${e.gridUnit}px;
      }
    `},(0,x.tZ)("span",{css:e=>x.iv`
        margin-right: ${4*e.gridUnit}px;
        color: ${e.colors.grayscale.base};
      `},t),(0,x.tZ)("span",{css:x.iv`
        min-width: 0;
      `},(0,x.tZ)(te,null,n)))},ie=e=>{let{showThumbnails:t,placeholderRef:n}=e;return(0,x.tZ)("div",{ref:n,css:e=>x.iv`
      /* Display styles */
      border: 1px solid ${e.colors.primary.dark1};
      border-radius: ${e.gridUnit}px;
      color: ${e.colors.primary.dark1};
      font-size: ${e.typography.sizes.xs}px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      padding: ${e.gridUnit/2}px ${2*e.gridUnit}px;
      margin-left: ${4*e.gridUnit}px;
      pointer-events: none;

      /* Position styles */
      visibility: hidden;
      position: ${t?"absolute":"unset"};
      top: ${t?"72px":"unset"};
      left: ${t?"84px":"unset"};
    `},(0,c.t)("Added"))},re=e=>{let{placeholder:t}=e;return(0,x.tZ)("div",{css:e=>x.iv`
      /* Display styles */
      border: 1px solid ${e.colors.primary.dark1};
      border-radius: ${e.gridUnit}px;
      color: ${e.colors.primary.dark1};
      font-size: ${e.typography.sizes.xs}px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      padding: ${e.gridUnit/2}px ${2*e.gridUnit}px;
      margin-left: ${4*e.gridUnit}px;
      pointer-events: none;

      /* Position styles */
      display: ${t?"unset":"none"};
      position: absolute;
      top: ${t?`${t.offsetTop}px`:"unset"};
      left: ${t?t.offsetLeft-2+"px":"unset"};
    `},(0,c.t)("Added"))},oe=e=>{let{datasourceUrl:t,datasourceName:n="-",innerRef:i,isSelected:r=!1,lastModified:o,sliceName:a,style:l={},thumbnailUrl:d,visType:p}=e;const g=(0,u.c)(u.T.THUMBNAILS),[m,f]=(0,s.useState)(),{mountedPluginMetadata:v}=(0,h.gp)(),b=(0,s.useMemo)((()=>v[p].name),[v,p]);return(0,x.tZ)("div",{ref:i,style:l},(0,x.tZ)("div",{css:e=>x.iv`
          border: 1px solid ${e.colors.grayscale.light2};
          border-radius: ${e.gridUnit}px;
          background: ${e.colors.grayscale.light5};
          padding: ${4*e.gridUnit}px;
          margin: 0 ${3*e.gridUnit}px
            ${3*e.gridUnit}px
            ${3*e.gridUnit}px;
          position: relative;
          cursor: ${r?"not-allowed":"move"};
          white-space: nowrap;
          overflow: hidden;
          line-height: 1.3;
          color: ${e.colors.grayscale.dark1}

          &:hover {
            background: ${e.colors.grayscale.light4};
          }

          opacity: ${r?.4:"unset"};
        `},(0,x.tZ)("div",{css:x.iv`
            display: flex;
          `},g?(0,x.tZ)("div",{css:x.iv`
                width: 146px;
                height: 82px;
                flex-shrink: 0;
                margin-right: 16px;
              `},(0,x.tZ)(Q.Z,{src:d||"",fallback:"/static/assets/images/chart-card-fallback.svg",position:"top"}),r&&g?(0,x.tZ)(ie,{placeholderRef:f,showThumbnails:g}):null):null,(0,x.tZ)("div",{css:x.iv`
              flex-grow: 1;
              min-width: 0;
            `},(0,x.tZ)("div",{css:e=>x.iv`
                margin-bottom: ${2*e.gridUnit}px;
                font-weight: ${e.typography.weights.bold};
                display: flex;
                justify-content: space-between;
                align-items: center;
              `},(0,x.tZ)(te,null,a),r&&!g?(0,x.tZ)(ie,{placeholderRef:f}):null),(0,x.tZ)("div",{css:x.iv`
                display: flex;
                flex-direction: column;
              `},(0,x.tZ)(ne,{label:(0,c.t)("Viz type"),value:b}),(0,x.tZ)(ne,{label:(0,c.t)("Dataset"),value:t?(0,x.tZ)(ee.m,{to:t},n):n}),(0,x.tZ)(ne,{label:(0,c.t)("Modified"),value:o}))))),(0,x.tZ)(re,{placeholder:m}))};var ae=n(84785);const se={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},le={dragItem:d().shape({index:d().number.isRequired}),slices:d().arrayOf(W.Rw),isDragging:d().bool.isRequired,currentOffset:d().shape({x:d().number.isRequired,y:d().number.isRequired})};function de(e){let{dragItem:t,slices:n,isDragging:i,currentOffset:r}=e;if(!(i&&r&&t&&n))return null;const o=n[t.index];return o&&t.parentType===m.F0&&t.type===m.dW?(0,x.tZ)(oe,{style:{...se,transform:`translate(${r.x}px, ${r.y}px)`},sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name}):null}de.propTypes=le,de.defaultProps={currentOffset:null,dragItem:null,slices:null};const ce=(0,ae.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(de);var ue,he=n(23493),pe=n.n(he);const ge=H.Mu+1,me=H.Mu+3,fe=H.Mu+4,ve=H.Mu+5,be={[m.U0]:{[m.yR]:H.Mu,[m.BG]:H.Mu},[m.BG]:{[m.dW]:ge,[m.t]:ge,[m.xh]:ge,[m.BA]:ge,[m.hE]:ge,[m.Nc]:ge,[m.Os]:ge,[m.yR]:ge},[m.Os]:{[m.dW]:fe,[m.t]:fe,[m.xh]:fe,[m.BA]:fe},[m.yR]:{[m.gn]:me},[m.gn]:{[m.dW]:ve,[m.t]:ve,[m.xh]:ve,[m.BA]:me,[m.hE]:ve,[m.Nc]:ve,[m.Os]:me,[m.yR]:me},[m.BA]:{[m.dW]:ve,[m.Nc]:ve,[m.xh]:ve,[m.Os]:me,[m.hE]:me,[m.yR]:me},[m.dW]:{},[m.t]:{},[m.hE]:{},[m.Nc]:{},[m.xh]:{}};function ye(e){const{parentType:t,childType:n,parentDepth:i}=e;if(!t||!n||"number"!=typeof i)return!1;const r=(be[t]||{})[n];return"number"==typeof r&&i<=r}const xe="DROP_TOP",Se="DROP_RIGHT",Ce="DROP_BOTTOM",Ze="DROP_LEFT";let we,Re={};function ke(e,t){const{depth:n,parentComponent:i,component:r,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===r.id)return null;const l=ye({parentType:r.type,parentDepth:n,childType:s.type}),d=i&&i.type,c=ye({parentType:d,parentDepth:n+(d===m.gn||d===m.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(r.children||[]).length>0,h="row"===o?"vertical":"horizontal",p="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===h?u?Se:Ze:u?Ce:xe;const g=t.ref.getBoundingClientRect(),f=e.getClientOffset()||Re[r.id];if(!f||!g)return null;Re[r.id]=f;const v=Math.abs(f.y-g.top),b=Math.abs(f.y-g.bottom),y=Math.abs(f.x-g.left),x=Math.abs(f.x-g.right);if(!a&&[v,b,y,x].every((e=>e>20)))return null;if(c&&!l){if("vertical"===p){const e=g.left+(g.right-g.left)/2;return f.x<e?Ze:Se}const e=g.top+(g.bottom-g.top)/2;return f.y<e?xe:Ce}if(c&&l){if("vertical"===p){if(y<20)return Ze;if(x<20)return Se}else{if(v<20)return xe;if(b<20)return Ce}return"vertical"===h?u?Se:Ze:u?Ce:xe}return null}const Te=pe()((function(e,t,n){var i,r,o;if(!n.mounted)return;const a=ke(t,n);!function(e){const t="SCROLL_TOP"===e&&!we&&0!==document.documentElement.scrollTop,n=we&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?we=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(we),void(we=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(we),we=null)}((null==n||null==(i=n.props)||null==(r=i.component)?void 0:r.type)===m.U0?"SCROLL_TOP":null),a?(null==n||null==(o=n.props)||o.onHover(),n.setState((()=>({dropIndicator:a})))):n.setState((()=>({dropIndicator:null})))}),100);const De="DRAG_DROPPABLE",_e=[De,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:i={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:i.id,parentType:i.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],Ie=[De,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&Te(e,t,n)},drop(e,t,n){const i=t.getDropResult();if((!i||!i.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const i=ke(t,n);if(!i)return;const{parentComponent:r,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(i===xe||i===Ce)||"column"===l&&(i===Ze||i===Se)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=r&&d.parentId===r.id&&d.index<a?a-1:a;i!==Ce&&i!==Se||(e+=1),u.destination={id:r.id,type:r.type,index:e}}return s(u),Re={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],$e={children:d().func,className:d().string,component:W.cP,parentComponent:W.cP,depth:d().number.isRequired,disableDragDrop:d().bool,orientation:d().oneOf(["row","column"]),index:d().number.isRequired,style:d().object,onDrop:d().func,onHover:d().func,editMode:d().bool,useEmptyDragPreview:d().bool,isDragging:d().bool,isDraggingOver:d().bool,isDraggingOverShallow:d().bool,droppableRef:d().func,dragSourceRef:d().func,dragPreviewRef:d().func},Me={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},onHover(){},orientation:"row",useEmptyDragPreview:!1,isDragging:!1,isDraggingOver:!1,isDraggingOverShallow:!1,droppableRef(){},dragSourceRef(){},dragPreviewRef(){}},Ee=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    position: relative;

    &.dragdroppable--dragging {
      opacity: 0.2;
    }

    &.dragdroppable-row {
      width: 100%;
    }

    &.dragdroppable-column .resizable-container span div {
      z-index: 10;
    }

    & {
      .drop-indicator {
        display: block;
        background-color: ${t.colors.primary.base};
        position: absolute;
        z-index: 10;
      }

      .drop-indicator--top {
        top: 0;
        left: 0;
        height: ${t.gridUnit}px;
        width: 100%;
        min-width: ${4*t.gridUnit}px;
      }

      .drop-indicator--bottom {
        top: 100%;
        left: 0;
        height: ${t.gridUnit}px;
        width: 100%;
        min-width: ${4*t.gridUnit}px;
      }

      .drop-indicator--right {
        top: 0;
        left: 100%;
        height: 100%;
        width: ${t.gridUnit}px;
        min-height: ${4*t.gridUnit}px;
      }

      .drop-indicator--left {
        top: 0;
        left: 0;
        height: 100%;
        width: ${t.gridUnit}px;
        min-height: ${4*t.gridUnit}px;
      }
    }
  `}};
`;class Fe extends s.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){var t,n;this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((ue||((ue=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),ue),{captureDraggingState:!0}):this.props.dragPreviewRef(e),null==(t=(n=this.props).droppableRef)||t.call(n,e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:i,disableDragDrop:r,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!r?{className:b()("drop-indicator",d===xe&&"drop-indicator--top",d===Ce&&"drop-indicator--bottom",d===Ze&&"drop-indicator--left",d===Se&&"drop-indicator--right")}:null,u=l?{dragSourceRef:i,dropIndicatorProps:c}:{};return(0,x.tZ)(Ee,{style:s,ref:this.setRef,className:b()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}Fe.propTypes=$e,Fe.defaultProps=Me;const Oe=(0,ae.DragSource)(..._e)((0,ae.DropTarget)(...Ie)(Fe)),ze={fetchAllSlices:d().func.isRequired,isLoading:d().bool.isRequired,slices:d().objectOf(W.Rw).isRequired,lastUpdated:d().number.isRequired,errorMessage:d().string,userId:d().string.isRequired,selectedSliceIds:d().arrayOf(d().number),editMode:d().bool,filterboxMigrationState:Y.Qi,dashboardId:d().number},Pe={selectedSliceIds:[],editMode:!1,errorMessage:"",filterboxMigrationState:Y.Qi.NOOP},Ue=["slice_name","viz_type","datasource_name"],Ne={slice_name:(0,c.t)("name"),viz_type:(0,c.t)("viz type"),datasource_name:(0,c.t)("dataset"),changed_on:(0,c.t)("recent")},Ae=y.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
  padding-top: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,qe=(0,y.iK)(V.Ph)`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  min-width: 150px;
`,Le=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: flex;
    justify-content: flex-end;
    padding-right: ${2*t.gridUnit}px;
  `}}
`,je=(0,y.iK)(K.Z)`
  ${e=>{let{theme:t}=e;return x.iv`
    height: auto;
    & > .anticon + span {
      margin-left: 0;
    }
    & > [role='img']:first-of-type {
      margin-right: ${t.gridUnit}px;
      padding-bottom: 1px;
      line-height: 0;
    }
  `}}
`,Ve=y.iK.div`
  flex-grow: 1;
  min-height: 0;
`;class Ke extends s.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,i)=>n[e]<i[e]?-1*t:n[e]>i[e]?1*t:0}constructor(e){super(e),this.handleChange=T()((e=>{this.searchUpdated(e);const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchFilteredSlices(t,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Y.Qi.SNOOZED,e)}),300),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Y.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,L.cj)(this.state.searchTerm,Ue)).sort(Ke.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,L.cj)(e,Ue)).sort(Ke.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})));const{userId:t,filterboxMigrationState:n}=this.props;this.slicesRequest=this.props.fetchSortedSlices(t,(0,u.c)(u.T.ENABLE_FILTER_BOX_MIGRATION)&&n!==Y.Qi.SNOOZED,e)}rowRenderer(e){let{key:t,index:n,style:i}=e;const{filteredSlices:r,selectedSliceIdsSet:o}=this.state,a=r[n],s=o.has(a.slice_id),l=m.dW,d=H.Jd,c={chartId:a.slice_id,sliceName:a.slice_name};return(0,x.tZ)(Oe,{key:t,component:{type:l,id:d,meta:c},parentComponent:{id:H.D0,type:m.F0},index:n,depth:0,disableDragDrop:s,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(e=>{let{dragSourceRef:t}=e;return(0,x.tZ)(oe,{innerRef:t,style:i,sliceName:a.slice_name,lastModified:a.changed_on_humanized,visType:a.viz_type,datasourceUrl:a.datasource_url,datasourceName:a.datasource_name,thumbnailUrl:a.thumbnail_url,isSelected:s})}))}render(){return(0,x.tZ)("div",{css:x.iv`
          height: 100%;
          display: flex;
          flex-direction: column;
        `},(0,x.tZ)(Le,null,(0,x.tZ)(je,{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>window.open(`/chart/add?dashboard_id=${this.props.dashboardId}`,"_blank","noopener noreferrer")},(0,x.tZ)(B.Z.PlusSmall,null),(0,c.t)("Create new chart"))),(0,x.tZ)(Ae,null,(0,x.tZ)(j.II,{placeholder:(0,c.t)("Filter your charts"),className:"search-input",onChange:e=>this.handleChange(e.target.value),onKeyPress:this.handleKeyPress}),(0,x.tZ)(qe,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(Ne).map((e=>{let[t,n]=e;return{label:(0,c.t)("Sort by %s",n),value:t}})),placeholder:(0,c.t)("Sort by")})),this.props.isLoading&&(0,x.tZ)(p.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,x.tZ)(Ve,null,(0,x.tZ)(A,null,(e=>{let{height:t,width:n}=e;return(0,x.tZ)(q.t7,{width:n,height:t,itemCount:this.state.filteredSlices.length,itemSize:128,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds},this.rowRenderer)}))),this.props.errorMessage&&(0,x.tZ)("div",{css:x.iv`
              padding: 16px;
            `},this.props.errorMessage),(0,x.tZ)(ce,{slices:this.state.filteredSlices}))}}Ke.propTypes=ze,Ke.defaultProps=Pe;const Be=Ke,He=(0,r.$j)((function(e,t){let{sliceEntities:n,dashboardInfo:i,dashboardState:r}=e;return{height:t.height,userId:i.userId,dashboardId:i.id,selectedSliceIds:r.sliceIds,slices:n.slices,isLoading:n.isLoading,errorMessage:n.errorMessage,lastUpdated:n.lastUpdated,editMode:r.editMode,filterboxMigrationState:r.filterboxMigrationState}}),(function(e){return(0,i.DE)({fetchAllSlices:R.To,fetchSortedSlices:R.Fv,fetchFilteredSlices:R.uC},e)}))(Be),We=e=>{let{registryKeys:t,registry:n}=e;return()=>t.map((e=>n[e]))},Ye=e=>{let{registryKeys:t,registry:n}=e;return e=>{t=t.filter((t=>t!==e)),delete n[e]}},Je=e=>{let{registry:t}=e;return e=>t[e]},Ge=function(e){void 0===e&&(e=[]);const t={registry:{},registryKeys:[]},n=(e=>{let{registryKeys:t,registry:n}=e;return(e,i)=>{t.push(e),n[e]={key:e,metadata:i.metadata,Component:s.lazy(i.loadComponent)}}})(t);return e.forEach((e=>{let{key:t,item:i}=e;n(t,i)})),{set:n,get:Je(t),delete:Ye(t),getAll:We(t)}}([]),Qe={id:d().string.isRequired,type:d().string.isRequired,label:d().string.isRequired,className:d().string},Xe=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: center;
    padding: ${4*t.gridUnit}px;
    background: ${t.colors.grayscale.light5};
    cursor: move;

    &:not(.static):hover {
      background: ${t.colors.grayscale.light4};
    }
  `}}
`,et=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    position: relative;
    background: ${t.colors.grayscale.light4};
    width: ${10*t.gridUnit}px;
    height: ${10*t.gridUnit}px;
    margin-right: ${4*t.gridUnit}px;
    border: 1px solid ${t.colors.grayscale.light5};
    display: flex;
    align-items: center;
    justify-content: center;
    color: ${t.colors.text.label};
    font-size: ${t.typography.sizes.xxl}px;

    &.fa-window-restore {
      font-size: ${t.typography.sizes.l}px;
    }

    &.fa-area-chart {
      font-size: ${t.typography.sizes.xl}px;
    }

    &.divider-placeholder:after {
      content: '';
      height: 2px;
      width: 100%;
      background-color: ${t.colors.grayscale.light2};
    }
  `}}
`;class tt extends s.PureComponent{render(){const{label:e,id:t,type:n,className:i,meta:r}=this.props;return(0,x.tZ)(Oe,{component:{type:n,id:t,meta:r},parentComponent:{id:H.D0,type:m.F0},index:0,depth:0,editMode:!0},(t=>{let{dragSourceRef:n}=t;return(0,x.tZ)(Xe,{ref:n},(0,x.tZ)(et,{className:b()("new-component-placeholder",i)}),e)}))}}function nt(){return(0,x.tZ)(tt,{id:H.Nb,type:m.BA,label:(0,c.t)("Column"),className:"fa fa-long-arrow-down"})}function it(){return(0,x.tZ)(tt,{id:H.ES,type:m.hE,label:(0,c.t)("Divider"),className:"divider-placeholder"})}function rt(){return(0,x.tZ)(tt,{id:H.Z1,type:m.Nc,label:(0,c.t)("Header"),className:"fa fa-header"})}function ot(){return(0,x.tZ)(tt,{id:H.vD,type:m.Os,label:(0,c.t)("Row"),className:"fa fa-long-arrow-right"})}function at(){return(0,x.tZ)(tt,{id:H.NN,type:m.yR,label:(0,c.t)("Tabs"),className:"fa fa-window-restore"})}function st(){return(0,x.tZ)(tt,{id:H.C3,type:m.xh,label:(0,c.t)("Text"),className:"fa fa-font"})}tt.propTypes=Qe,tt.defaultProps={className:null};const lt=e=>{let{componentKey:t,metadata:n}=e;return(0,x.tZ)(tt,{id:H.gR,type:m.t,label:n.name,meta:{metadata:n,componentKey:t},className:`fa fa-${n.iconName}`})},dt=e=>{let{topOffset:t=0}=e;return(0,x.tZ)("div",{css:x.iv`
      position: sticky;
      right: 0;
      top: ${t}px;
      height: calc(100vh - ${t}px);
      width: ${374}px;
    `},(0,x.tZ)("div",{css:e=>x.iv`
        position: absolute;
        height: 100%;
        width: ${374}px;
        box-shadow: -4px 0 4px 0 ${(0,Z.rgba)(e.colors.grayscale.dark2,.1)};
        background-color: ${e.colors.grayscale.light5};
      `},(0,x.tZ)(w.ZP,{id:"tabs",css:e=>x.iv`
          line-height: inherit;
          margin-top: ${2*e.gridUnit}px;
          height: 100%;

          & .ant-tabs-content-holder {
            height: 100%;
            & .ant-tabs-content {
              height: 100%;
            }
          }
        `},(0,x.tZ)(w.ZP.TabPane,{key:1,tab:(0,c.t)("Charts"),css:x.iv`
            height: 100%;
          `},(0,x.tZ)(He,null)),(0,x.tZ)(w.ZP.TabPane,{key:2,tab:(0,c.t)("Layout elements")},(0,x.tZ)(at,null),(0,x.tZ)(ot,null),(0,x.tZ)(nt,null),(0,x.tZ)(rt,null),(0,x.tZ)(st,null),(0,x.tZ)(it,null),Ge.getAll().map((e=>{let{key:t,metadata:n}=e;return(0,x.tZ)(lt,{metadata:n,componentKey:t})}))))))};var ct=n(74599),ut=n(30381),ht=n.n(ut),pt=n(75049),gt=n(78161),mt=n(91877),ft=n(3741),vt=n(12617),bt=n(9679),yt=n(31069),xt=n(83862),St=n(27600),Ct=n(10222),Zt=n(68492),wt=n(23525);const Rt=e=>{const{copyMenuItemTitle:t,emailMenuItemTitle:n,emailSubject:i,emailBody:o,addDangerToast:a,addSuccessToast:s,dashboardId:l,dashboardComponentId:d,...u}=e,{dataMask:h,activeTabs:p}=(0,r.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs})));async function g(){return(0,wt.Nm)({dashboardId:l,dataMask:h,activeTabs:p,anchor:d})}return(0,x.tZ)(xt.v,{selectable:!1},(0,x.tZ)(xt.v.Item,G()({key:"copy-url"},u),(0,x.tZ)("div",{onClick:async function(){try{await(0,Ct.Z)(g),s((0,c.t)("Copied to clipboard!"))}catch(e){Zt.Z.error(e),a((0,c.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},t)),(0,x.tZ)(xt.v.Item,G()({key:"share-by-email"},u),(0,x.tZ)("div",{onClick:async function(){try{const e=encodeURIComponent(`${o}${await g()}`),t=encodeURIComponent(i);window.location.href=`mailto:?Subject=${t}%20&Body=${e}`}catch(e){Zt.Z.error(e),a((0,c.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},n)))};var kt=n(1304),Tt=n(94670);const Dt=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*t.gridUnit}px;\n\n      h5 {\n        margin-top: ${t.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${t.colors.grayscale.light1};\n    }\n  `}}
`,_t={initialCss:d().string,triggerNode:d().node.isRequired,onChange:d().func,templates:d().array};class It extends s.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){Tt.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate(e){let{key:t}=e;this.changeCss(t)}renderTemplateSelector(){if(this.props.templates){const e=(0,x.tZ)(xt.v,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,x.tZ)(xt.v.Item,{key:e.css},e.label))));return(0,x.tZ)(V.Gj,{overlay:e,placement:"bottomRight"},(0,x.tZ)(K.Z,null,(0,c.t)("Load a CSS template")))}return null}render(){return(0,x.tZ)(kt.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("CSS"),modalBody:(0,x.tZ)(Dt,null,(0,x.tZ)("div",{className:"css-editor-header"},(0,x.tZ)("h5",null,(0,c.t)("Live CSS editor")),this.renderTemplateSelector()),(0,x.tZ)(Tt.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}It.propTypes=_t,It.defaultProps={initialCss:"",onChange:()=>{}};const $t=It;var Mt=n(81315),Et=n(29487),Ft=n(49238),Ot=n(85633);const zt=(0,y.iK)(kt.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,Pt=y.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`;class Ut extends s.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=s.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e,t;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef)||null==(t=e.current)||t.close(),this.props.addSuccessToast((0,c.t)("Refresh interval saved"))}onCancel(){var e,t;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef)||null==(t=e.current)||t.close()}handleFrequencyChange(e){const{refreshIntervalOptions:t}=this.props;this.setState({refreshFrequency:e||t[0][0]})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n,refreshIntervalOptions:i}=this.props,{refreshFrequency:r=0}=this.state,o=!!r&&!!t&&r<e;return(0,x.tZ)(zt,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("Refresh interval"),modalBody:(0,x.tZ)("div",null,(0,x.tZ)(Ft.lX,null,(0,c.t)("Refresh frequency")),(0,x.tZ)(Mt.Z,{ariaLabel:(0,c.t)("Refresh interval"),options:i.map((e=>({value:e[0],label:(0,c.t)(e[1])}))),value:r,onChange:this.handleFrequencyChange,sortComparator:(0,Ot.mj)("value")}),o&&(0,x.tZ)(Pt,null,(0,x.tZ)(Et.Z,{type:"warning",message:(0,x.tZ)(s.Fragment,null,(0,x.tZ)("div",null,t),(0,x.tZ)("br",null),(0,x.tZ)("strong",null,(0,c.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,x.tZ)(s.Fragment,null,(0,x.tZ)(K.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,c.t)("Save"):(0,c.t)("Save for this session")),(0,x.tZ)(K.Z,{onClick:this.onCancel,buttonSize:"small"},(0,c.t)("Cancel")))})}}Ut.defaultProps={refreshLimit:0,refreshWarning:null};const Nt=Ut;var At=n(87183),qt=n(87253);const Lt={saveType:H.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class jt extends s.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:e.dashboardTitle+(0,c.t)("[copy]"),duplicateSlices:!1},this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this),this.modal=s.createRef()}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:H.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n}=this.state,{dashboardTitle:i,dashboardInfo:r,layout:o,customCss:a,dashboardId:s,refreshFrequency:l,shouldPersistRefreshFrequency:d,lastModifiedTime:u}=this.props,h=d?l:null==(e=r.metadata)?void 0:e.refresh_frequency,p={certified_by:r.certified_by,certification_details:r.certification_details,css:a,dashboard_title:t===H.kS?n:i,duplicate_slices:this.state.duplicateSlices,last_modified_time:u,owners:r.owners,roles:r.roles,metadata:{...null==r?void 0:r.metadata,positions:o,refresh_frequency:h}};var g,m;t!==H.kS||n?(this.onSave(p,s,t).then((e=>{t===H.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(g=this.modal)||null==(m=g.current)||null==m.close||m.close()):this.props.addDangerToast((0,c.t)("You must pick a name for the new dashboard"))}render(){return(0,x.tZ)(kt.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalTitle:(0,c.t)("Save dashboard"),modalBody:(0,x.tZ)("div",null,(0,x.tZ)(At.Y,{value:H.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===H.TN,disabled:!this.props.canOverwrite},(0,c.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,x.tZ)("hr",null),(0,x.tZ)(At.Y,{value:H.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===H.kS},(0,c.t)("Save as:")),(0,x.tZ)(j.II,{type:"text",placeholder:(0,c.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,x.tZ)("div",{className:"m-l-25 m-t-5"},(0,x.tZ)(qt.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,x.tZ)("span",{className:"m-l-5"},(0,c.t)("also copy (duplicate) charts")))),modalFooter:(0,x.tZ)("div",null,(0,x.tZ)(K.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,c.t)("Save")))})}}jt.defaultProps=Lt;const Vt=jt;var Kt=n(97634),Bt=n(14505),Ht=n(87999),Wt=n(56727),Yt=n(11370);function Jt(e){let{pathname:t,filters:n={},hash:i="",standalone:r}=e;const o=new URLSearchParams;o.set(St.KD.preselectFilters.name,JSON.stringify((0,Yt.Z)(n))),r&&o.set(St.KD.standalone.name,r.toString());const a=(0,wt.eY)(St.KD.nativeFiltersKey);a&&o.set(St.KD.nativeFiltersKey.name,a);const s=i?`#${i}`:"";return`${t}?${o.toString()}${s}`}var Gt=n(43399);const Qt={addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,dashboardInfo:d().object.isRequired,dashboardId:d().number,dashboardTitle:d().string,dataMask:d().object.isRequired,customCss:d().string,colorNamespace:d().string,colorScheme:d().string,onChange:d().func.isRequired,updateCss:d().func.isRequired,forceRefreshAllCharts:d().func.isRequired,refreshFrequency:d().number,shouldPersistRefreshFrequency:d().bool.isRequired,setRefreshFrequency:d().func.isRequired,startPeriodicRender:d().func.isRequired,editMode:d().bool.isRequired,userCanEdit:d().bool,userCanShare:d().bool,userCanSave:d().bool,userCanCurate:d().bool.isRequired,isLoading:d().bool.isRequired,layout:d().object.isRequired,expandedSlices:d().object,onSave:d().func.isRequired,showPropertiesModal:d().func.isRequired,manageEmbedded:d().func.isRequired,logEvent:d().func,refreshLimit:d().number,refreshWarning:d().string,lastModifiedTime:d().number.isRequired,filterboxMigrationState:d().oneOf(Object.keys(Y.Qi).map((e=>Y.Qi[e])))},Xt={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Y.Qi.NOOP},en="refresh-dashboard",tn="edit-properties",nn="download-as-image",rn="toggle-fullscreen",on="manage-embedded";class an extends s.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[],showReportSubMenu:null},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.setShowReportSubMenu=this.setShowReportSubMenu.bind(this)}UNSAFE_componentWillMount(){yt.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((e=>{let{json:t}=e;const n=t.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:n})})).catch((()=>{this.props.addDangerToast((0,c.t)("An error occurred while fetching available CSS templates"))}))}UNSAFE_componentWillReceiveProps(e){this.props.customCss!==e.customCss&&this.setState({css:e.customCss},(()=>{(0,Bt.Z)(e.customCss)}))}setShowReportSubMenu(e){this.setState({showReportSubMenu:e})}changeCss(e){this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick(e){let{key:t,domEvent:n}=e;switch(t){case en:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,c.t)("Refreshing charts"));break;case tn:this.props.showPropertiesModal();break;case nn:{var i,r;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Wt.Z)(".dashboard",this.props.dashboardTitle,!0)(n).then((()=>{e.style.visibility="visible"})),null==(i=(r=this.props).logEvent)||i.call(r,ft.n2);break}case rn:{const e=Jt({pathname:window.location.pathname,filters:(0,Gt.De)(),hash:window.location.hash,standalone:!(0,wt.eY)(St.KD.standalone)});window.location.replace(e);break}case on:this.props.manageEmbedded()}}render(){var e,t;const{dashboardTitle:n,dashboardId:i,dashboardInfo:r,refreshFrequency:o,shouldPersistRefreshFrequency:a,editMode:l,customCss:d,colorNamespace:u,colorScheme:h,layout:p,expandedSlices:g,onSave:m,userCanEdit:f,userCanShare:v,userCanSave:b,userCanCurate:y,isLoading:S,refreshLimit:C,refreshWarning:Z,lastModifiedTime:w,addSuccessToast:R,addDangerToast:k,filterboxMigrationState:T,setIsDropdownVisible:D,isDropdownVisible:_,...I}=this.props,$=`${(0,c.t)("Superset dashboard")} ${n}`,M=(0,c.t)("Check out this dashboard: "),E=Jt({pathname:window.location.pathname,filters:(0,Gt.De)(),hash:window.location.hash}),F=null==(e=r.common)||null==(t=e.conf)?void 0:t.DASHBOARD_AUTO_REFRESH_INTERVALS;return(0,x.tZ)(xt.v,G()({selectable:!1},I),!l&&(0,x.tZ)(xt.v.Item,{key:en,disabled:S,onClick:this.handleMenuClick},(0,c.t)("Refresh dashboard")),!l&&(0,x.tZ)(xt.v.Item,{key:rn,onClick:this.handleMenuClick},(0,wt.eY)(St.KD.standalone)?(0,c.t)("Exit fullscreen"):(0,c.t)("Enter fullscreen")),l&&(0,x.tZ)(xt.v.Item,{key:tn,onClick:this.handleMenuClick},(0,c.t)("Edit properties")),l&&(0,x.tZ)(xt.v.Item,{key:"edit-css"},(0,x.tZ)($t,{triggerNode:(0,x.tZ)("span",null,(0,c.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),(0,x.tZ)(xt.v.Divider,null),b&&(0,x.tZ)(xt.v.Item,{key:"save-modal"},(0,x.tZ)(Vt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:i,dashboardTitle:n,dashboardInfo:r,saveType:H.kS,layout:p,expandedSlices:g,refreshFrequency:o,shouldPersistRefreshFrequency:a,lastModifiedTime:w,customCss:d,colorNamespace:u,colorScheme:h,onSave:m,triggerNode:(0,x.tZ)("span",null,(0,c.t)("Save as")),canOverwrite:f})),!l&&(0,x.tZ)(xt.v.Item,{key:nn,onClick:this.handleMenuClick},(0,c.t)("Download as image")),v&&(0,x.tZ)(xt.v.SubMenu,{key:"share-dashboard",disabled:S,title:(0,c.t)("Share")},(0,x.tZ)(Rt,{url:E,copyMenuItemTitle:(0,c.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,c.t)("Share permalink by email"),emailSubject:$,emailBody:M,addSuccessToast:R,addDangerToast:k,dashboardId:i})),!l&&y&&(0,x.tZ)(xt.v.Item,{key:on,onClick:this.handleMenuClick},(0,c.t)("Embed dashboard")),(0,x.tZ)(xt.v.Divider,null),l?null:this.state.showReportSubMenu?(0,x.tZ)(s.Fragment,null,(0,x.tZ)(xt.v.SubMenu,{title:(0,c.t)("Manage email report")},(0,x.tZ)(Kt.Z,{dashboardId:r.id,setShowReportSubMenu:this.setShowReportSubMenu,showReportSubMenu:this.state.showReportSubMenu,setIsDropdownVisible:D,isDropdownVisible:_,useTextMenu:!0})),(0,x.tZ)(xt.v.Divider,null)):(0,x.tZ)(xt.v,null,(0,x.tZ)(Kt.Z,{dashboardId:r.id,setShowReportSubMenu:this.setShowReportSubMenu,setIsDropdownVisible:D,isDropdownVisible:_,useTextMenu:!0})),l&&T!==Y.Qi.CONVERTED&&(0,x.tZ)(xt.v.Item,{key:"set-filter-mapping"},(0,x.tZ)(Ht.Z,{className:"m-r-5",triggerNode:(0,c.t)("Set filter mapping")})),(0,x.tZ)(xt.v.Item,{key:"autorefresh-modal"},(0,x.tZ)(Nt,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:o,refreshLimit:C,refreshWarning:Z,onChange:this.changeRefreshInterval,editMode:l,refreshIntervalOptions:F,triggerNode:(0,x.tZ)("span",null,(0,c.t)("Set auto-refresh interval"))})))}}an.propTypes=Qt,an.defaultProps=Xt;const sn=an;var ln=n(37921);const dn={dashboardId:d().number,isPublished:d().bool.isRequired,savePublished:d().func.isRequired,canEdit:d().bool,canSave:d().bool},cn=(0,c.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),un=(0,c.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),hn=(0,c.t)("This dashboard is published. Click to make it a draft.");class pn extends s.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,x.tZ)(X.u,{id:"published-dashboard-tooltip",placement:"bottom",title:hn},(0,x.tZ)(ln.Z,{onClick:()=>{this.togglePublished()}},(0,c.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,x.tZ)(X.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:cn},(0,x.tZ)(ln.Z,{onClick:()=>{this.togglePublished()}},(0,c.t)("Draft"))):(0,x.tZ)(X.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:un},(0,x.tZ)(ln.Z,null,(0,c.t)("Draft")))}}pn.propTypes=dn;const gn={onUndo:d().func.isRequired,onRedo:d().func.isRequired};class mn extends s.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,i=document&&document.querySelector(".dashboard-markdown--editing"),r=document&&document.querySelector(".editable-title--editing");i||r||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}mn.propTypes=gn;const fn=mn;var vn=n(20818);const bn=e=>{e&&clearInterval(e)};var yn=n(52564),xn=n(22102),Sn=n(9882),Cn=n(74069),Zn=n(14114);const wn=(0,pt.I)(),Rn=e=>e.split(/(?:\s|,)+/).filter((e=>e)),kn=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,Tn=e=>{var t;let{dashboardId:n,onHide:i}=e;const{addInfoToast:r,addDangerToast:o}=(0,Zn.e1)(),[a,l]=(0,s.useState)(!0),[d,u]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),[m,f]=(0,s.useState)(""),v=`/api/v1/dashboard/${n}/embedded`,b=!h||Rn(m).join()!==h.allowed_domains.join(),y=(0,s.useCallback)((()=>{u(!0),(0,xn.Z)({method:"POST",endpoint:v})({allowed_domains:Rn(m)}).then((e=>{let{result:t}=e;g(t),f(t.allowed_domains.join(", ")),r((0,c.t)("Changes saved."))}),(e=>{console.error(e),o((0,c.t)((0,c.t)("Sorry, something went wrong. The changes could not be saved.")))})).finally((()=>{u(!1)}))}),[v,m]),S=(0,s.useCallback)((()=>{Cn.Z.confirm({title:(0,c.t)("Disable embedding?"),content:(0,c.t)("This will remove your current embed configuration."),okType:"danger",onOk:()=>{u(!0),(0,xn.Z)({method:"DELETE",endpoint:v})({}).then((()=>{g(null),f(""),r((0,c.t)("Embedding deactivated.")),i()}),(e=>{console.error(e),o((0,c.t)("Sorry, something went wrong. Embedding could not be deactivated."))})).finally((()=>{u(!1)}))}})}),[v]);if((0,s.useEffect)((()=>{l(!1),(0,xn.Z)({method:"GET",endpoint:v})({}).catch((e=>{if(404===e.status)return{result:null};throw e})).then((e=>{let{result:t}=e;l(!0),g(t),f(t?t.allowed_domains.join(", "):"")}))}),[n]),!a)return(0,x.tZ)(p.Z,null);const C=wn.get("embedded.documentation.configuration_details"),Z=wn.get("embedded.documentation.description"),w=null!=(t=wn.get("embedded.documentation.url"))?t:"https://www.npmjs.com/package/@superset-ui/embedded-sdk";return(0,x.tZ)(s.Fragment,null,h?C?(0,x.tZ)(C,{embeddedId:h.uuid}):(0,x.tZ)("p",null,(0,c.t)("This dashboard is ready to embed. In your application, pass the following id to the SDK:"),(0,x.tZ)("br",null),(0,x.tZ)("code",null,h.uuid)):(0,x.tZ)("p",null,(0,c.t)("Configure this dashboard to embed it into an external web application.")),(0,x.tZ)("p",null,(0,c.t)("For further instructions, consult the")," ",(0,x.tZ)("a",{href:w,target:"_blank",rel:"noreferrer"},Z?Z():(0,c.t)("Superset Embedded SDK documentation."))),(0,x.tZ)("h3",null,(0,c.t)("Settings")),(0,x.tZ)(Ft.xJ,null,(0,x.tZ)("label",{htmlFor:"allowed-domains"},(0,c.t)("Allowed Domains (comma separated)")," ",(0,x.tZ)(Sn.V,{tooltip:(0,c.t)("A list of domain names that can embed this dashboard. Leaving this field empty will allow embedding from any domain.")})),(0,x.tZ)(j.II,{name:"allowed-domains",value:m,placeholder:"superset.example.com",onChange:e=>f(e.target.value)})),(0,x.tZ)(kn,null,h?(0,x.tZ)(s.Fragment,null,(0,x.tZ)(K.Z,{onClick:S,buttonStyle:"secondary",loading:d},(0,c.t)("Deactivate")),(0,x.tZ)(K.Z,{onClick:y,buttonStyle:"primary",disabled:!b,loading:d},(0,c.t)("Save changes"))):(0,x.tZ)(K.Z,{onClick:y,buttonStyle:"primary",loading:d},(0,c.t)("Enable embedding"))))},Dn=e=>{const{show:t,onHide:n}=e;return(0,x.tZ)(Cn.Z,{show:t,onHide:n,title:(0,c.t)("Embed"),hideFooter:!0},(0,x.tZ)(Tn,e))},_n=(0,n(67913).Z)((()=>n.e(783).then(n.bind(n,13070)))),In=()=>{const e=(0,r.v9)((e=>{let{dashboardState:t}=e;return t.overwriteConfirmMetadata}));return(0,x.tZ)(s.Fragment,null,e&&(0,x.tZ)(_n,{overwriteConfirmMetadata:e}))},$n=(0,pt._)(),Mn={addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,addWarningToast:d().func.isRequired,user:d().object,dashboardInfo:d().object.isRequired,dashboardTitle:d().string,dataMask:d().object.isRequired,charts:d().objectOf(W.$6).isRequired,layout:d().object.isRequired,expandedSlices:d().object,customCss:d().string,colorNamespace:d().string,colorScheme:d().string,setColorScheme:d().func.isRequired,setUnsavedChanges:d().func.isRequired,isStarred:d().bool.isRequired,isPublished:d().bool.isRequired,isLoading:d().bool.isRequired,onSave:d().func.isRequired,onChange:d().func.isRequired,fetchFaveStar:d().func.isRequired,fetchCharts:d().func.isRequired,saveFaveStar:d().func.isRequired,savePublished:d().func.isRequired,updateDashboardTitle:d().func.isRequired,editMode:d().bool.isRequired,setEditMode:d().func.isRequired,showBuilderPane:d().func.isRequired,updateCss:d().func.isRequired,logEvent:d().func.isRequired,hasUnsavedChanges:d().bool.isRequired,maxUndoHistoryExceeded:d().bool.isRequired,lastModifiedTime:d().number.isRequired,onRefresh:d().func.isRequired,onUndo:d().func.isRequired,onRedo:d().func.isRequired,undoLength:d().number.isRequired,redoLength:d().number.isRequired,setMaxUndoHistoryExceeded:d().func.isRequired,maxUndoHistoryToast:d().func.isRequired,refreshFrequency:d().number,shouldPersistRefreshFrequency:d().bool.isRequired,setRefreshFrequency:d().func.isRequired,dashboardInfoChanged:d().func.isRequired,dashboardTitleChanged:d().func.isRequired},En=e=>x.iv`
  border-bottom: 1px solid ${e.colors.grayscale.light2};
`,Fn=e=>x.iv`
  color: ${e.colors.primary.dark2};
`,On=e=>x.iv`
  display: flex;
  align-items: center;

  .action-schedule-report {
    margin-left: ${2*e.gridUnit}px;
  }

  .undoRedo {
    display: flex;
    margin-right: ${2*e.gridUnit}px;
  }
`,zn=(0,y.iK)(V.C0)`
  padding: 0;
  &:hover {
    background: transparent;
  }
`,Pn=e=>x.iv`
  color: ${e.colors.grayscale.light1};
  &:hover {
    color: ${e.colors.grayscale.base};
  }
`,Un=e=>x.iv`
  color: ${e.colors.grayscale.base};
`,Nn=e=>x.iv`
  color: ${e.colors.grayscale.light2};
`,An=e=>x.iv`
  min-width: ${17*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`,qn=e=>x.iv`
  min-width: ${22*e.gridUnit}px;
  height: ${8*e.gridUnit}px;
`;class Ln extends s.PureComponent{static discardChanges(){const e=new URL(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.showEmbedModal=()=>{this.setState({showingEmbedModal:!0})},this.hideEmbedModal=()=>{this.setState({showingEmbedModal:!1})},this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,emphasizeRedo:!1,showingPropertiesModal:!1,isDropdownVisible:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.setIsDropdownVisible=this.setIsDropdownVisible.bind(this)}componentDidMount(){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){H.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>H.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded()}componentWillUnmount(){bn(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}setIsDropdownVisible(e){this.setState({isDropdownVisible:e})}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(ft.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){var n,i;const{dashboardInfo:r}=this.props,o=(null==(n=r.common)||null==(i=n.conf)?void 0:i.DASHBOARD_AUTO_REFRESH_INTERVALS).find((t=>Number(t[0])===e/1e3));t=o?(0,c.t)(o[1]):ht().duration(e,"millisecond").humanize()}this.refreshTimer=function(e){let{interval:t=0,periodicRender:n,refreshTimer:i}=e;return bn(i),t>0?setInterval(n,t):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:i,charts:r,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],l=Object.values(r).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return i(ft.S,{interval:e,chartCount:l.length}),this.props.addWarningToast((0,c.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(l,!1,.2*e,o.id):n(l,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(ft.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t,n;const{dashboardTitle:i,layout:r,colorScheme:o,colorNamespace:a,customCss:s,dashboardInfo:l,refreshFrequency:d,shouldPersistRefreshFrequency:u,lastModifiedTime:h,slug:p}=this.props,g=u?d:null==(e=l.metadata)?void 0:e.refresh_frequency,m=(null==l||null==(t=l.metadata)?void 0:t.color_scheme)||o,f=(null==l||null==(n=l.metadata)?void 0:n.color_namespace)||a,v=Object.fromEntries((0,gt.ZP)().getColorMap()),b={certified_by:l.certified_by,certification_details:l.certification_details,css:s,dashboard_title:i,last_modified_time:h,owners:l.owners,roles:l.roles,slug:p,metadata:{...null==l?void 0:l.metadata,color_namespace:f,color_scheme:m,positions:r,refresh_frequency:g,shared_label_colors:v}},y=(0,bt.o)(r).length,x=l.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||H.Bu;y>=x?this.props.addDangerToast((0,c.t)("Your dashboard is too large. Please reduce its size before saving it.")):(y>=.9*x&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(b,l.id,H.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}render(){var e,t,n,i;const{dashboardTitle:r,layout:o,expandedSlices:a,customCss:s,colorNamespace:l,dataMask:d,setColorScheme:h,setUnsavedChanges:p,colorScheme:g,onUndo:m,onRedo:f,undoLength:v,redoLength:b,onChange:y,onSave:S,updateCss:C,editMode:Z,isPublished:w,user:R,dashboardInfo:k,hasUnsavedChanges:T,isLoading:D,refreshFrequency:_,shouldPersistRefreshFrequency:I,setRefreshFrequency:$,lastModifiedTime:M,filterboxMigrationState:E,logEvent:F}=this.props,O=k.dash_edit_perm&&E!==Y.Qi.REVIEWING&&!k.is_managed_externally,z=k.dash_share_perm,P=k.dash_save_perm&&E!==Y.Qi.REVIEWING,U=(0,mt.cr)(u.T.EMBEDDED_SUPERSET)&&(0,vt.R)("can_set_embedded","Dashboard",R.roles),N=null==(e=k.common)||null==(t=e.conf)?void 0:t.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,A=null==(n=k.common)||null==(i=n.conf)?void 0:i.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE,q=$n.get("dashboard.nav.right");return(0,x.tZ)("div",{css:En,"data-test-id":k.id,className:"dashboard-header-container"},(0,x.tZ)(yn.u,{editableTitleProps:{title:r,canEdit:O&&Z,onSave:this.handleChangeText,placeholder:(0,c.t)("Add the name of the dashboard"),label:(0,c.t)("Dashboard title"),showTooltip:!1},certificatiedBadgeProps:{certifiedBy:k.certified_by,details:k.certification_details},faveStarProps:{itemId:k.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0},titlePanelAdditionalItems:(0,x.tZ)(pn,{dashboardId:k.id,isPublished:w,savePublished:this.props.savePublished,canEdit:O,canSave:P}),rightPanelAdditionalItems:(0,x.tZ)("div",{className:"button-container"},P&&(0,x.tZ)("div",{className:"button-container"},Z&&(0,x.tZ)("div",{css:On},(0,x.tZ)("div",{className:"undoRedo"},(0,x.tZ)(X.u,{id:"dashboard-undo-tooltip",title:(0,c.t)("Undo the action")},(0,x.tZ)(zn,{type:"text",disabled:v<1},(0,x.tZ)(B.Z.Undo,{css:[Pn,this.state.emphasizeUndo&&Un,v<1&&Nn,"",""],onClick:v&&m,iconSize:"xl"}))),(0,x.tZ)(X.u,{id:"dashboard-redo-tooltip",title:(0,c.t)("Redo the action")},(0,x.tZ)(zn,{type:"text",disabled:b<1},(0,x.tZ)(B.Z.Redo,{css:[Pn,this.state.emphasizeRedo&&Un,b<1&&Nn,"",""],onClick:b&&f,iconSize:"xl"})))),(0,x.tZ)(K.Z,{css:qn,buttonSize:"small",onClick:this.constructor.discardChanges,buttonStyle:"default","aria-label":(0,c.t)("Discard")},(0,c.t)("Discard")),(0,x.tZ)(K.Z,{css:An,buttonSize:"small",disabled:!T,buttonStyle:"primary",onClick:this.overwriteDashboard,"aria-label":(0,c.t)("Save")},(0,c.t)("Save")))),Z?(0,x.tZ)(fn,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}):(0,x.tZ)("div",{css:On},q&&(0,x.tZ)(q,null),O&&(0,x.tZ)(K.Z,{buttonStyle:"secondary",onClick:this.toggleEditMode,className:"action-button",css:Fn,"aria-label":(0,c.t)("Edit dashboard")},(0,c.t)("Edit dashboard")))),menuDropdownProps:{getPopupContainer:e=>e.closest(".header-with-actions"),visible:this.state.isDropdownVisible,onVisibleChange:this.setIsDropdownVisible},additionalActionsMenu:(0,x.tZ)(sn,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:k.id,dashboardTitle:r,dashboardInfo:k,dataMask:d,layout:o,expandedSlices:a,customCss:s,colorNamespace:l,colorScheme:g,onSave:S,onChange:y,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:_,shouldPersistRefreshFrequency:I,setRefreshFrequency:$,updateCss:C,editMode:Z,hasUnsavedChanges:T,userCanEdit:O,userCanShare:z,userCanSave:P,userCanCurate:U,isLoading:D,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,refreshLimit:N,refreshWarning:A,lastModifiedTime:M,filterboxMigrationState:E,isDropdownVisible:this.state.isDropdownVisible,setIsDropdownVisible:this.setIsDropdownVisible,logEvent:F}),showFaveStar:(null==R?void 0:R.userId)&&(null==k?void 0:k.id),showTitlePanelItems:!Z}),this.state.showingPropertiesModal&&(0,x.tZ)(vn.Z,{dashboardId:k.id,dashboardInfo:k,dashboardTitle:r,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;h(e.colorScheme),t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),p(!0),n(e.title)},onlyApply:!0}),(0,x.tZ)(In,null),U&&(0,x.tZ)(Dn,{show:this.state.showingEmbedModal,onHide:this.hideEmbedModal,dashboardId:k.id}),(0,x.tZ)(x.xB,{styles:x.iv`
            .ant-menu-vertical {
              border-right: none;
            }
          `}))}}Ln.propTypes=Mn,Ln.defaultProps={colorNamespace:void 0,colorScheme:void 0};const jn=Ln;function Vn(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var Kn=n(41295),Bn=n(9467),Hn=n(12885),Wn=n(72570),Yn=n(97381),Jn=n(61358);const Gn=(0,r.$j)((function(e){let{dashboardLayout:t,dashboardState:n,reports:i,dashboardInfo:r,charts:o,dataMask:a,user:s}=e;return{dashboardInfo:r,undoLength:t.past.length,redoLength:t.future.length,layout:t.present,dashboardTitle:((t.present[H.M2]||{}).meta||{}).text,expandedSlices:n.expandedSlices,refreshFrequency:n.refreshFrequency,shouldPersistRefreshFrequency:!!n.shouldPersistRefreshFrequency,customCss:n.css,colorNamespace:n.colorNamespace,colorScheme:n.colorScheme,charts:o,dataMask:a,user:s,isStarred:!!n.isStarred,isPublished:!!n.isPublished,isLoading:Vn(o),hasUnsavedChanges:!!n.hasUnsavedChanges,maxUndoHistoryExceeded:!!n.maxUndoHistoryExceeded,lastModifiedTime:Math.max(n.lastModifiedTime,r.last_modified_time),editMode:!!n.editMode,slug:r.slug,metadata:r.metadata,reports:i,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,i.DE)({addSuccessToast:Wn.ws,addDangerToast:Wn.Gb,addWarningToast:Wn.Dz,onUndo:Hn.Ou,onRedo:Hn.az,setEditMode:Bn.Mb,showBuilderPane:Bn.O8,setColorScheme:Bn.uW,setUnsavedChanges:Bn.if,fetchFaveStar:Bn.Lb,saveFaveStar:Bn.TN,savePublished:Bn.dr,fetchCharts:Bn.Mn,updateDashboardTitle:Hn.A7,updateCss:Bn.Sn,onChange:Bn.z2,onSave:Bn.M8,setMaxUndoHistoryExceeded:Bn.uN,maxUndoHistoryToast:Bn.Qt,logEvent:Yn.logEvent,setRefreshFrequency:Bn.fE,onRefresh:Bn.Yy,dashboardInfoChanged:Kn.a8,dashboardTitleChanged:Hn.Ww,updateDataMask:ct.eG,fetchUISpecificReport:Jn.Aw},e)}))(jn),Qn=y.iK.div`
  display: flex;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  &:hover {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
`,Xn=y.iK.span`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,ei=e=>{let{icon:t,label:n,onClick:i}=e;return(0,x.tZ)(Qn,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),i(e)}},t,n&&(0,x.tZ)(Xn,null,n))};var ti=n(76697),ni=n(13433),ii=n(98286);function ri(e){let{dashboardId:t,anchorLinkId:n,placement:i="right",emailContent:o="",emailSubject:a=""}=e;const[l,d]=(0,s.useState)(""),{addDangerToast:u}=(0,Zn.e1)(),{dataMask:h,activeTabs:p}=(0,r.v9)((e=>({dataMask:e.dataMask,activeTabs:e.dashboardState.activeTabs}))),g=`mailto:?Subject=${a}%20&Body=${o}${l||""}`;return(0,x.tZ)(ti.ZP,{trigger:"click",placement:i,content:(0,x.tZ)("div",{id:"shorturl-popover",onClick:e=>{e.stopPropagation()}},(0,x.tZ)(ni.Z,{text:l,copyNode:(0,x.tZ)("i",{className:"fa fa-clipboard",title:(0,c.t)("Copy to clipboard")})}),"",(0,x.tZ)("a",{href:g},(0,x.tZ)("i",{className:"fa fa-envelope"})))},(0,x.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",tabIndex:0,role:"button",onClick:e=>{e.stopPropagation(),(async()=>{try{const e=await(0,wt.Nm)({dashboardId:t,dataMask:h,activeTabs:p,anchor:n});d(e)}catch(e){e&&u((await(0,ii.O$)(e)).error||(0,c.t)("Something went wrong."))}})()}},(0,x.tZ)("i",{className:"short-link-trigger fa fa-link"}),""))}var oi=n(56967);function ai(e){let{id:t,dashboardId:n,placement:i="right",scrollIntoView:r=!1,showShortLinkButton:o=!0}=e;const a=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({block:"center",behavior:"smooth"})},l=(0,oi.Z)();return(0,s.useEffect)((()=>{l&&t===l&&a(t)}),[l,t]),(0,s.useEffect)((()=>{r&&a(t)}),[t,r]),(0,x.tZ)("span",{className:"anchor-link-container",id:t},o&&n&&(0,x.tZ)(ri,{anchorLinkId:t,dashboardId:n,emailSubject:(0,c.t)("Superset chart"),emailContent:(0,c.t)("Check out this chart in dashboard:"),placement:i}))}var si,li=n(81395),di=n(52256),ci=n(91914),ui=n(18446),hi=n.n(ui),pi=n(16550),gi=n(12515),mi=n(32657),fi=n(99543),vi=n(40219),bi=n(29147),yi=n(38270),xi=n(73727),Si=n(11064),Ci=n(16355),Zi=n(88694),wi=n(32873),Ri=n(65013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(si||(si={}));const ki=(e,t)=>{var n,i;let{type:r,meta:o}=e;return!(r!==m.gn&&r!==m.dW&&r!==m.U0||t&&"filter_box"===(null==(n=t[null==o?void 0:o.chartId])||null==(i=n.form_data)?void 0:i.viz_type))},Ti=(e,t,n,i,r,o,s)=>{var l;let d=t;if(e&&t&&ki(e,i)&&e.type!==m.U0&&null!=r&&null!=a()(r)&&a()(r).call(r,e.id)){var u;const n=s((e=>{var t,n,i,r,o,a,s,l,d,c;return null!=(t=null!=(n=null!=(i=null!=(r=null!=(o=null==e||null==(a=e.meta)?void 0:a.sliceNameOverride)?o:null==e||null==(s=e.meta)?void 0:s.sliceName)?r:null==e||null==(l=e.meta)?void 0:l.text)?i:null==e||null==(d=e.meta)?void 0:d.defaultText)?n:null==e||null==(c=e.id)||null==c.toString?void 0:c.toString())?t:""})(e),null==o||null==a()(o)?void 0:a()(o).call(o,null==(u=e.meta)?void 0:u.chartId),(0,c.t)("This chart might be incompatible with the filter (datasets don't match)")),i={key:e.id,title:n,children:[]};t.children.push(i),d=i}null==e||null==(l=e.children)||null==l.forEach||l.forEach((e=>{const t=null==n?void 0:n[e];t?Ti(t,d,n,i,r,o,s):Zt.Z.warn(`Unable to find item with id: ${e} in the dashboard layout. This may indicate you have invalid references in your dashboard and the references to id: ${e} should be removed.`)}))},Di=(e,t,n,i)=>{n.forEach((n=>{var r,o;Di(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!ki(e[n.parents[n.parents.length-1]]))).map((e=>{let{id:t}=e;return t}))]})(t,n),i),(null==(r=t[n])?void 0:r.type)!==m.dW||a()(i).call(i,null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},_i=function(e,t){return void 0===t&&(t=[]),{rootPath:[H._4],excluded:e?[e,...t]:t}},Ii=(e,t)=>!e||e.rootPath[0]===H._4&&!e.excluded.filter((e=>e!==t)).length,$i=(e,t,n)=>{let i=(0,x.tZ)("span",null,e);return t&&(i=(0,x.tZ)(s.Fragment,null,i,"",(0,x.tZ)(X.u,{title:n},(0,x.tZ)(B.Z.Info,{iconSize:"m"})))),i},Mi=e=>{let{formScope:t,initialScope:n,forceUpdate:i,updateFormValues:o,chartId:l,initiallyExcludedCharts:d=[]}=e;const[u,h]=(0,s.useState)([H._4]),{treeData:p,layout:g}=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=e=>e);const i=(0,r.v9)((e=>{let{dashboardLayout:{present:t}}=e;return t})),o=(0,r.v9)((e=>{let{charts:t}=e;return t})),a={children:[],key:H._4,type:m.U0,title:(0,c.t)("All panels")},l=(0,s.useMemo)((()=>Object.values(i).reduce(((t,n)=>{const{id:i,parents:r=[],type:o,meta:a}=n;return o===m.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...r,i])]:t}),[])),[i,e]);return(0,s.useMemo)((()=>{Ti(i[H._4],a,i,o,l,t,n)}),[i,a,o,t,n]),{treeData:[a],layout:i}}(l,d,$i),[f,v]=(0,s.useState)(!0),b=(0,s.useMemo)((()=>((e,t)=>{const n=[];return Di(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]})({...t||n},g)),[t,n,g]);return(0,x.tZ)(V.mp,{checkable:!0,selectable:!1,onExpand:e=>{h(e),v(!1)},expandedKeys:u,autoExpandParent:f,onCheck:e=>{i();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===m.dW})).map((e=>{var n;return[H._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>ki(t[e])))}));n.sort(((e,t)=>e.length-t.length));const i=n.map((e=>e[n[0].length-1])),r=[];return Object.entries(t).forEach((t=>{var n;let[o,s]=t;const l=s.parents||[];s.type===m.dW&&null!=(n=[H._4,...l])&&n.find((t=>((t,n)=>a()(i).call(i,t)&&!a()(e).call(e,n))(t,o)))&&r.push(s.meta.chartId)})),{rootPath:[...new Set(i)],excluded:r}})(e,g);void 0!==l&&(t.excluded=[...new Set([...t.excluded,l])]),o({scope:t})},checkedKeys:b,treeData:p})},Ei=y.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
  padding: 0px ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,Fi=(0,y.iK)(V.qz.Item)`
  margin-bottom: 0;
`,Oi=e=>{let{pathToFormValue:t=[],formScopingType:n,formFilterScope:i,forceUpdate:r,filterScope:o,updateFormValues:a,chartId:l,initiallyExcludedCharts:d}=e;const[u]=(0,s.useState)(o||_i(l,d)),[h]=(0,s.useState)(Ii(u,l)?si.all:si.specific),[p,g]=(0,s.useState)(!!o),m=(0,s.useCallback)((e=>{a(e),g(!0)}),[a]),f=(0,s.useCallback)((()=>{if(o||p)return;const e=_i(l,d);a({scope:e,scoping:Ii(e,l)?si.all:si.specific})}),[l,o,p,d,a]);return(0,Ri.d)(f),(0,x.tZ)(Ei,null,(0,x.tZ)(Fi,{name:[...t,"scoping"],initialValue:h},(0,x.tZ)(At.Y.Group,{onChange:e=>{let{target:{value:t}}=e;if(t===si.all){const e=_i(l);a({scope:e})}g(!0),r()}},(0,x.tZ)(At.Y,{value:si.all},(0,c.t)("Apply to all panels")),(0,x.tZ)(At.Y,{value:si.specific},(0,c.t)("Apply to specific panels")))),(0,x.tZ)(V.ZT.Text,{type:"secondary"},(null!=n?n:h)===si.specific?(0,c.t)("Only selected panels will be affected by this filter"):(0,c.t)("All panels with this column will be affected by this filter")),(null!=n?n:h)===si.specific&&(0,x.tZ)(Mi,{updateFormValues:m,initialScope:u,formScope:i,forceUpdate:r,chartId:l,initiallyExcludedCharts:d}),(0,x.tZ)(Fi,{name:[...t,"scope"],hidden:!0,initialValue:u}))};var zi=n(10752),Pi=n.n(zi),Ui=n(88889),Ni=n(55786);const Ai="filters",qi={filter_time:[Ui.Z.TEMPORAL],filter_timegrain:[Ui.Z.TEMPORAL],filter_timecolumn:[Ui.Z.TEMPORAL],filter_select:[Ui.Z.BOOLEAN,Ui.Z.STRING,Ui.Z.NUMERIC,Ui.Z.TEMPORAL],filter_range:[Ui.Z.NUMERIC]},Li=function(e){void 0===e&&(e=!0);const[,t]=s.useState({});return s.useCallback((()=>{e&&t({})}),[e])},ji=(e,t,n)=>{const i=e.getFieldValue(Ai)||{};e.setFields([{name:Ai,value:{...i,[t]:{...i[t],...n}}}])},Vi=e=>({value:e.id,label:e.table_name}),Ki=e=>{const t=(0,Ni.Z)(null==e?void 0:e.column_types);return 0===t.length||a()(t).call(t,Ui.Z.TEMPORAL)},Bi=(e,t)=>{var n;return!t.type_generic||!(e in qi)||(null==(n=qi[e])?void 0:a()(n).call(n,t.type_generic))},Hi=e=>{let{form:t,scope:n,chartId:i}=e;const r=Li(),o=t.getFieldValue("scope"),a=t.getFieldValue("scoping");return(0,x.tZ)(Oi,{updateFormValues:e=>{((e,t)=>{e.setFieldsValue({...t})})(t,{...e})},filterScope:n,chartId:i,formFilterScope:o,forceUpdate:r,formScopingType:a})};var Wi=n(41609),Yi=n.n(Wi),Ji=n(89734),Gi=n.n(Ji),Qi=n(44908),Xi=n.n(Qi),er=n(68122);const tr=function(e,t){return void 0===t&&(t=!1),function(n,i){void 0===i&&(i=!1);const r=i||t;if(!n&&e)return r?e:{"data-test":e};if(n&&!e)return r?n:{"data-test":n};if(!n&&!e)return console.warn('testWithId function has missed "prefix" and "id" params'),r?"":{"data-test":""};const o=`${e}__${n}`;return r?o:{"data-test":o}}};var nr=n(10916);const ir=[];function rr(){return(0,r.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||ir}))}function or(){return(0,r.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function ar(){const e=or();return(0,s.useMemo)((()=>Object.values(e).some((e=>e.type===m.gn))),[e])}var sr=n(27034),lr=n(22068);const dr="FILTER",cr=y.iK.div`
  ${e=>{let{isDragging:t,theme:n}=e;return`\n    opacity: ${t?.3:1};\n    cursor: ${t?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${n.gridUnit}px;\n  `}}
`,ur=(0,y.iK)(B.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${e=>{let{isDragging:t,theme:n}=e;return`\n    font-size: ${n.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${t?"grabbing":"grab"};\n    padding-left: ${n.gridUnit}px;\n  `}}
`;var hr={name:"82a6rk",styles:"flex:1"};const pr=e=>{let{index:t,onRearrange:n,filterIds:i,children:r}=e;const o=(0,s.useRef)(null),[{isDragging:a},l]=(0,sr.c)({item:{filterIds:i,type:dr,index:t},collect:e=>({isDragging:e.isDragging()})}),[,d]=(0,lr.L)({accept:dr,hover:(e,i)=>{var r;if(!o.current)return;const a=e.index,s=t;if(a===s)return;const l=null==(r=o.current)?void 0:r.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=i.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(n(a,s),e.index=s)}});return l(d(o)),(0,x.tZ)(cr,{ref:o,isDragging:a},(0,x.tZ)(ur,{isDragging:a,alt:"Move icon",className:"dragIcon",viewBox:"4 4 16 16"}),(0,x.tZ)("div",{css:hr},r))},gr=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n      display: flex;\n      align-items: center;\n      padding: ${2*t.gridUnit}px;\n      width: 100%;\n      border-radius: ${t.borderRadius}px;\n      &.active {\n        color: ${t.colors.grayscale.dark1};\n        border-radius: ${t.borderRadius}px;\n        background-color: ${t.colors.secondary.light4};\n        span, .anticon {\n          color: ${t.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${t.colors.primary.light1};\n        span, .anticon {\n          color: ${t.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${t.colors.error.base};\n      }\n  `}}
`,mr=(0,y.iK)(B.Z.Trash)`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
`,fr=(0,y.iK)(B.Z.Warning)`
  color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  &.anticon {
    margin-left: auto;
  }
`,vr=y.iK.div`
  height: 100%;
  overflow-y: auto;
`;var br={name:"7whenc",styles:"display:flex;width:100%"},yr={name:"1vr7vmn",styles:"align-items:center;display:flex"},xr={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},Sr={name:"an0ls6",styles:"align-self:flex-start;margin-left:auto"};const Cr=(0,s.forwardRef)(((e,t)=>{let{getFilterTitle:n,onChange:i,onRemove:r,restoreFilter:o,onRearrange:s,currentFilterId:l,removedFilters:d,filters:u,erroredFilters:h=[]}=e;return(0,x.tZ)(vr,{ref:t},(()=>{const e=[];return u.forEach(((t,u)=>{e.push((0,x.tZ)(pr,{key:u,onRearrange:s,index:u,filterIds:[t]},(e=>{const t=!!d[e],s=a()(h).call(h,e),u=l===e,p=[];return s&&p.push("errored"),u&&p.push("active"),(0,x.tZ)(gr,{role:"tab",key:`filter-title-tab-${e}`,onClick:()=>i(e),className:p.join(" ")},(0,x.tZ)("div",{css:br},(0,x.tZ)("div",{css:yr},t?(0,c.t)("(Removed)"):n(e)),!d[e]&&s&&(0,x.tZ)(fr,{className:"warning"}),t&&(0,x.tZ)("span",{css:xr,role:"button",tabIndex:0,onClick:t=>{t.preventDefault(),o(e)}},(0,c.t)("Undo?"))),(0,x.tZ)("div",{css:Sr},t?null:(0,x.tZ)(mr,{onClick:t=>{t.stopPropagation(),r(e)},alt:"RemoveFilter"})))})(t)))})),e})())})),Zr=Cr,wr=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n  cursor: pointer;\n  margin: ${4*t.gridUnit}px;\n  color: ${t.colors.primary.base};\n  &:hover {\n    color: ${t.colors.primary.dark1};\n  }\n`}}
`,Rr=y.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,kr=[{label:(0,c.t)("Filter"),type:nr.BE.NATIVE_FILTER},{label:(0,c.t)("Divider"),type:nr.BE.DIVIDER}],Tr=e=>{let{getFilterTitle:t,onChange:n,onAdd:i,onRemove:r,onRearrange:o,restoreFilter:a,currentFilterId:l,filters:d,removedFilters:u,erroredFilters:h}=e;const p=(0,s.useRef)(null),g=(0,y.Fg)(),m=(0,x.tZ)(xt.$,{mode:"horizontal"},kr.map((e=>(0,x.tZ)(xt.$.Item,{onClick:()=>{return t=e.type,i(t),void setTimeout((()=>{var e;const t=document.getElementById("native-filters-tabs");if(t){const e=t.getElementsByClassName("ant-tabs-nav-list")[0];e.scrollTop=e.scrollHeight}null==p||null==(e=p.current)||null==e.scroll||e.scroll({top:p.current.scrollHeight,behavior:"smooth"})}),0);var t}},e.label))));return(0,x.tZ)(Rr,null,(0,x.tZ)(V.Gj,{overlay:m,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,x.tZ)(wr,null,(0,x.tZ)("div",{className:"fa fa-plus"})," ",(0,x.tZ)("span",null,(0,c.t)("Add filters and dividers")))),(0,x.tZ)("div",{css:(0,x.iv)({height:"100%",overflowY:"auto",marginLeft:3*g.gridUnit},"","")},(0,x.tZ)(Zr,{ref:p,filters:d,currentFilterId:l,removedFilters:u,getFilterTitle:t,erroredFilters:h,onChange:n,onRemove:r,onRearrange:o,restoreFilter:a})))},Dr=y.iK.div`
  display: flex;
  height: 100%;
`,_r=y.iK.div`
  flex-grow: 3;
  margin-left: ${e=>{let{theme:t}=e;return-1*t.gridUnit-1}};
`,Ir=y.iK.div`
  min-width: 270px;
  border-right: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
`,$r=e=>{let{getFilterTitle:t,onChange:n,onRemove:i,onRearrange:r,restoreFilter:o,onAdd:a,erroredFilters:s,children:l,currentFilterId:d,filters:c,removedFilters:u}=e;return(0,x.tZ)(Dr,null,(0,x.tZ)(Ir,null,(0,x.tZ)(Tr,{currentFilterId:d,filters:c,removedFilters:u,erroredFilters:s,getFilterTitle:t,onChange:n,onAdd:e=>a(e),onRearrange:r,onRemove:e=>i(e),restoreFilter:o})),(0,x.tZ)(_r,null,l))};var Mr=n(43700);const Er=y.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${e=>{let{level:t,theme:n}=e;return n.colors[t].light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
  border: 1px solid ${e=>{let{level:t,theme:n}=e;return n.colors[t].base}};
  color: ${e=>{let{level:t,theme:n}=e;return n.colors[t].dark2}};
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  width: 100%;
`,Fr=y.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,Or=y.iK.span`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
`;function zr(e){let{body:t,level:n="error",title:i}=e;const r=(0,y.Fg)().colors[n].base;return(0,x.tZ)(Er,{level:n,role:"alert"},"error"===n?(0,x.tZ)(B.Z.ErrorSolid,{iconColor:r}):(0,x.tZ)(B.Z.WarningSolid,{iconColor:r}),(0,x.tZ)(Fr,null,(0,x.tZ)(Or,null,i),(0,x.tZ)("p",null,t)))}var Pr=n(1090),Ur=n(61890),Nr=n(77997);const Ar=function(e,t,n){return void 0===n&&(n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify([...t])}),function(){const i=n(...arguments);if(t.has(i))return t.get(i);const r=e(...arguments);return t.set(i,r),r}};var qr=n(78676),Lr=n(1510);const jr=y.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  padding-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit+2}}px;

  .checkbox {
    margin-bottom: ${e=>{let{theme:t,checked:n}=e;return n?t.gridUnit:0}}px;
  }

  & > div {
    margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
`,Vr=y.iK.div`
  margin-left: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`,Kr=e=>{const{checked:t,disabled:n,title:i,tooltip:r,children:o,onChange:a=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,s.useState)(l);return(0,s.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,x.tZ)(jr,{checked:d},(0,x.tZ)(V.r4,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),a(n)}},(0,x.tZ)(s.Fragment,null,i,"",r&&(0,x.tZ)(Sn.V,{placement:"top",tooltip:r}))),d&&(0,x.tZ)(Vr,null,o))};var Br=n(28615);const Hr=new Map,Wr=Ar(yt.Z.get,Hr,(e=>{let{endpoint:t}=e;return t||""}));function Yr(e){var t;let{allowClear:n=!1,filterValues:i=(()=>!0),form:r,formField:o="column",filterId:l,datasetId:d,value:u,onChange:h,mode:p}=e;const[g,m]=(0,s.useState)(),{addDangerToast:f}=(0,Zn.e1)(),v=(0,s.useCallback)((()=>{r.setFields([{name:["filters",l,o],touched:!1,value:null}])}),[r,l,o]),b=(0,s.useMemo)((()=>(0,Ni.Z)(g).filter(i).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[g,i]),y=null==(t=r.getFieldValue("filters"))?void 0:t[l].filterType,S=(0,s.useMemo)((()=>null==g?void 0:g.find((e=>e.column_name===u))),[g,u]);return(0,s.useEffect)((()=>{S&&!Bi(y,S)&&v()}),[S,y,v]),(0,Br.S)(d,(e=>{null!=e&&v(),null!=d&&Wr({endpoint:`/api/v1/dataset/${d}`}).then((e=>{let{json:{result:t}}=e;const n=Array.isArray(u)?u:[u];t.columns.some((e=>null==n?void 0:a()(n).call(n,e.column_name)))||v(),m(t.columns)}),(async e=>{const{error:t,message:n}=await(0,ii.O$)(e);let i=n||t||(0,c.t)("An error has occurred");"Forbidden"===n&&(i=(0,c.t)("You do not have permission to edit this dashboard")),f(i)}))})),(0,x.tZ)(V.Ph,{mode:p,value:"multiple"===p?u||[]:u,ariaLabel:(0,c.t)("Column select"),onChange:h,options:b,placeholder:(0,c.t)("Select a column"),notFoundContent:(0,c.t)("No compatible columns found"),showSearch:!0,allowClear:n})}var Jr=n(15926),Gr=n.n(Jr);const Qr=new Map,Xr=Ar(yt.Z.get,Qr,(e=>{let{endpoint:t}=e;return t||""})),eo=e=>{let{onChange:t,value:n}=e;const i=(0,s.useCallback)((e=>{let{error:t,message:n}=e,i=n||t||(0,c.t)("An error has occurred");return"Forbidden"===n&&(i=(0,c.t)("You do not have permission to edit this dashboard")),i}),[]);return(0,x.tZ)(V.qb,{ariaLabel:(0,c.t)("Dataset"),value:n,options:async(e,t,n)=>{const r="table_name",o=Gr().encode({filters:[{col:r,opr:"ct",value:e}],page:t,page_size:n,order_column:r,order_direction:"asc"});return Xr({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(Vi),totalCount:e.json.count}))).catch((async e=>{const t=i(await(0,ii.O$)(e));throw new Error(t)}))},onChange:t,notFoundContent:(0,c.t)("No compatible datasets found")})},to=e=>(0,s.useMemo)((()=>(0,x.tZ)(eo,e)),[]);var no=n(88274);const io=e=>{var t,n,i;let{hasDefaultValue:r,filterId:o,hasDataset:a,form:s,setDataMask:l,formData:d,enableNoResults:u}=e;const h=(s.getFieldValue("filters")||{})[o],g=null==h?void 0:h.defaultValueQueriesData,m=a&&null===g,f=null==h||null==(t=h.defaultDataMask)||null==(n=t.filterState)?void 0:n.value,v=r&&null==f;return m?(0,x.tZ)(p.Z,{position:"inline-centered"}):(0,x.tZ)(no.Z,{height:32,width:"filter_time"===(null==h?void 0:h.filterType)?350:250,appSection:Ci.Tr.FILTER_CONFIG_MODAL,behaviors:[Ci.cg.NATIVE_FILTER],formData:d,queriesData:a?null==h?void 0:h.defaultValueQueriesData:[{data:[{}]}],chartType:null==h?void 0:h.filterType,hooks:{setDataMask:l},enableNoResults:u,filterState:{...null==h||null==(i=h.defaultDataMask)?void 0:i.filterState,validateMessage:v&&(0,c.t)("Value is required"),validateStatus:v&&"error"}})};var ro=n(37687);const oo=(0,y.iK)(Ft.xJ)`
  margin-bottom: 0;
`;const ao=y.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,so=e=>{let{onClick:t}=e;return(0,x.tZ)(ao,null,(0,x.tZ)("p",null,(0,c.t)("You have removed this filter.")),(0,x.tZ)("div",null,(0,x.tZ)(K.Z,{buttonStyle:"primary",onClick:t},(0,c.t)("Restore Filter"))))},lo=y.iK.div`
  display: flex;
  flex-direction: column;
`,co=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: inline-flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    color: ${t.colors.primary.base};\n    &:hover {\n      color: ${t.colors.primary.dark1};\n    }\n  `}}
`,uo=(0,y.iK)(B.Z.Trash)`
  ${e=>{let{theme:t}=e;return`\n    cursor: pointer;\n    margin-left: ${2*t.gridUnit}px;\n    color: ${t.colors.grayscale.base};\n    &:hover {\n      color: ${t.colors.grayscale.dark1};\n    }\n  `}}
`,ho=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${t.gridUnit}px;\n  `}}
`,po=y.iK.div`
  text-transform: uppercase;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,go=e=>{let{availableFilters:t,selection:n,onChange:i,onDelete:r}=e,o=t.find((e=>e.value===n)),a=t;return o||(o={label:(0,c.t)("(deleted or invalid type)"),value:n},a=[o,...a]),(0,x.tZ)(ho,null,(0,x.tZ)(V.Ph,{ariaLabel:(0,c.t)("Limit type"),labelInValue:!0,options:a,onChange:e=>i(n,e.value),value:o}),(0,x.tZ)(uo,{iconSize:"xl",onClick:()=>r(n)}))},mo=e=>{let{availableFilters:t=[],dependencies:n=[],onDependenciesChange:i}=e;const[r,o]=(0,s.useState)(n),l=e=>{o(e),i(e)},d=(e,t)=>{const n=r.findIndex((t=>t===e)),i=[...r];i[n]=t,l(i)},u=e=>{const t=[...r];t.splice(r.indexOf(e),1),l(t)};return 0===t.length?(0,x.tZ)("span",null,(0,c.t)("No available filters.")):(0,x.tZ)(s.Fragment,null,r.map((e=>(0,x.tZ)(go,{key:e,selection:e,availableFilters:t.filter((t=>t.value===e||!a()(r).call(r,t.value))),onChange:d,onDelete:u}))),t.length>r.length&&(0,x.tZ)(co,{onClick:()=>{const e=t.find((e=>!a()(r).call(r,e.value)));if(e){const t=[...r];t.push(e.value),l(t)}}},(0,x.tZ)(B.Z.PlusSmall,null),(0,c.t)("Add filter")))},fo=e=>{let{availableFilters:t=[],dependencies:n=[],onDependenciesChange:i,getDependencySuggestion:r}=e;const o=t.length>0,a=n.length>0;return(0,x.tZ)(lo,null,(0,x.tZ)(Kr,{title:(0,c.t)("Values are dependent on other filters"),initialValue:a,onChange:e=>{const t=[];e&&!a&&o&&t.push(r()),i(t)},tooltip:(0,c.t)("Values selected in other filters will affect the filter options to only show relevant values")},a&&(0,x.tZ)(po,null,(0,c.t)("Values dependent on")),(0,x.tZ)(mo,{availableFilters:t,dependencies:n,onDependenciesChange:i,getDependencySuggestion:r})))},vo=(0,y.iK)(w.ZP.TabPane)`
  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px 0px;
`,bo=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*t.gridUnit}px;\n  `}}
`,yo=y.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,xo=["enableEmptyFilter","defaultToFirstItem","multiSelect","searchAllOptions","inverseSelection"],So=(0,y.iK)(Ft.xJ)`
  width: 49%;
  margin-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  }
`,Co=(0,y.iK)(Ft.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${e=>{let{theme:t}=e;return 10*t.gridUnit}}px;
  }
`,Zo=(0,y.iK)(Ft.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,wo=y.iK.span`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  text-transform: uppercase;
`,Ro=(0,y.iK)(Ft.xJ)`
  margin-bottom: 0;
`,ko=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,To=(0,y.iK)(B.Z.Refresh)`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
`,Do=(0,y.iK)(Mr.Z)`
  border-left: 0;
  border-top: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    border-top: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,_o=(0,y.iK)(w.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,Io=y.iK.span`
  color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit-1}}px;
  &:before {
    content: '*';
  }
`,$o=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    width: 49%;\n    font-size: ${t.typography.sizes.s}px;\n    color: ${t.colors.grayscale.light1};\n    margin:\n      ${2*-t.gridUnit}px\n      0px\n      ${4*t.gridUnit}px\n      ${4*t.gridUnit}px;\n  `}}
`,Mo={configuration:{key:"configuration",name:(0,c.t)("Settings")},scoping:{key:"scoping",name:(0,c.t)("Scoping")}},Eo={configuration:{key:"configuration",name:(0,c.t)("Filter Configuration")},settings:{key:"settings",name:(0,c.t)("Filter Settings")}},Fo=["filter_select","filter_range"],Oo={[(0,c.t)("Select filter")]:(0,c.t)("Value"),[(0,c.t)("Range filter")]:(0,c.t)("Numerical range"),[(0,c.t)("Time filter")]:(0,c.t)("Time range"),[(0,c.t)("Time column")]:(0,c.t)("Time column"),[(0,c.t)("Time grain")]:(0,c.t)("Time grain"),[(0,c.t)("Group By")]:(0,c.t)("Group by")},zo=new Map,Po=Ar(yt.Z.get,zo,(e=>{let{endpoint:t}=e;return t||""})),Uo=(e,t)=>{var n,i,o,l,d,h,g,m,f,v,b,y,S,C,Z,w,R,k,T,D,_,I,$,M;let{filterId:E,filterToEdit:F,removedFilters:O,form:z,getAvailableFilters:P,activeFilterPanelKeys:U,restoreFilter:N,handleActiveFilterPanelChange:A,setErroredFilters:q,validateDependencies:L,getDependencySuggestion:K,isActive:B}=e;const H=!!O[E],[W,Y]=(0,s.useState)(""),[J,Q]=(0,s.useState)([]),[ee,te]=(0,s.useState)(Mo.configuration.key),[ne,ie]=(0,s.useState)(null),re=Li(B),[oe,ae]=(0,s.useState)(),se=(0,s.useMemo)((()=>({})),[]),le=z.getFieldValue("filters"),de=null==le?void 0:le[E],ce=de||ne||se,ue=(null==ce?void 0:ce.dependencies)||(null==F?void 0:F.cascadeParentIds)||[],he=(0,Si.Z)().items,pe=Object.entries(he).filter((e=>{var t;let[,{value:n}]=e;return null==(t=n.behaviors)?void 0:a()(t).call(t,Ci.cg.NATIVE_FILTER)})).map((e=>{let[t]=e;return t})),ge=(0,r.v9)((e=>{let{datasources:t}=e;return t})),me=(0,r.v9)((e=>{let{charts:t}=e;return t})),fe=(0,s.useMemo)((()=>Object.values(ge).some((e=>Ki(e)))),[ge]),ve=(0,s.useMemo)((()=>{const e=Object.values(ge).find((e=>{var t;return e.id===(null==ce||null==(t=ce.dataset)?void 0:t.value)}));return!e||Ki(e)}),[null==ce||null==(n=ce.dataset)?void 0:n.value,ge]),be=!(null==(i=he[null==ce?void 0:ce.filterType])||null==(o=i.value)||!o.datasourceCount),ye=null!=(l=null!=(d=null==ce||null==(h=ce.dataset)?void 0:h.value)?d:null==F||null==(g=F.targets[0])?void 0:g.datasetId)?l:((e,t)=>{var n;const i=new Map;let r="",o=0;return Object.values(t).forEach((e=>{const{form_data:t}=e;if(t){const{datasource:e}=t,n=(i.get(e)||0)+1;i.set(e,n),n>o&&(o=n,r=e)}})),null==(n=e[r])?void 0:n.id})(ge,me),{controlItems:xe={},mainControlItems:Se={}}=ce?function(e){var t;let{datasetId:n,disabled:i,forceUpdate:r,form:o,filterId:a,filterType:l,filterToEdit:d,formFilter:u,removed:h}=e;const p=null!=(void 0===(g=(0,ro.Z)().get(l))&&(g={}),t=null!=(m=null==(f=Pi()(g.controlPanelSections))?void 0:f.reduce(((e,t)=>{let{controlSetRows:n=[]}=t;return[...e,...Pi()(n)]}),[]))?m:[])?t:[];var g,m,f;const v={},b={};return p.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((e=>{var t,i,l,p,g,m,f,v,y;const S=null!=(t=null==d||null==(i=d.controlValues)?void 0:i[e.name])?t:null==e||null==(l=e.config)?void 0:l.default,C=null==d||null==(p=d.targets[0])||null==(g=p.column)?void 0:g.name,Z=(0,x.tZ)(s.Fragment,null,(0,x.tZ)(oo,{name:["filters",a,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(m=e.config)?void 0:m.requiredFirst)&&(null==d?void 0:d.requiredFirst)}),(0,x.tZ)(So,{name:["filters",a,"column"],initialValue:C,label:(0,x.tZ)(wo,null,(null==(f=e.config)?void 0:f.label)||(0,c.t)("Column")),rules:[{required:(null==(v=e.config)?void 0:v.required)&&!h,message:(0,c.t)("Column is required")}]},(0,x.tZ)(Yr,{mode:(null==(y=e.config)?void 0:y.multiple)&&"multiple",form:o,filterId:a,datasetId:n,filterValues:e=>Bi((null==u?void 0:u.filterType)||"",e),onChange:()=>{ji(o,a,{defaultDataMask:null}),r()}})));b[e.name]={element:Z,checked:S}})),p.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var t,n,l,h;const p=null!=(t=null==d||null==(n=d.controlValues)?void 0:n[e.name])?t:null==e||null==(l=e.config)?void 0:l.default,g=(0,x.tZ)(s.Fragment,null,(0,x.tZ)(oo,{name:["filters",a,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==d?void 0:d.requiredFirst)}),(0,x.tZ)(X.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&i&&(0,c.t)('Populate "Default value" to enable this control')},(0,x.tZ)(Co,{key:e.name,name:["filters",a,"controlValues",e.name],initialValue:p,valuePropName:"checked",colon:!1},(0,x.tZ)(V.r4,{disabled:e.config.affectsDataMask&&i,onChange:t=>{let{target:{checked:n}}=t;e.config.requiredFirst&&ji(o,a,{requiredFirst:{...null==u?void 0:u.requiredFirst,[e.name]:n}}),e.config.resetConfig&&ji(o,a,{defaultDataMask:null}),r()}},e.config.label,"",e.config.description&&(0,x.tZ)(Sn.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));v[e.name]={element:g,checked:p}})),{controlItems:v,mainControlItems:b}}({datasetId:ye,disabled:!1,forceUpdate:re,form:z,filterId:E,filterType:null==ce?void 0:ce.filterType,filterToEdit:F,formFilter:ce,removed:H}):{},Ce=!!Se.groupby,Ze=!(null==(f=(null!=(m=he[null==ce?void 0:ce.filterType])?m:{}).value)||!f.enableNoResults),we=Ce&&!!J.length,Re=!be||ye&&((null==ce?void 0:ce.column)||!Ce),ke=a()(Fo).call(Fo,null==ce?void 0:ce.filterType),Te=a()(Qo).call(Qo,null==ce?void 0:ce.filterType),De=null==(v=null==ce?void 0:ce.isDataDirty)||v,_e=e=>{ji(z,E,e),Y(""),re()};let Ie={};ue&&ue.length>0&&le&&ue.forEach((e=>{var t,n;const i=null==(t=le[e])||null==(n=t.defaultDataMask)?void 0:n.extraFormData;Ie=(0,Lr.on)(Ie,i)}));const $e=JSON.stringify(Ie),Me=(0,s.useCallback)((function(e){var t,n;if(void 0===e&&(e=!1),!be||null==ce||null==(t=ce.dataset)||!t.value)return void re();const i=(0,Lr.zi)({datasetId:null==ce||null==(n=ce.dataset)?void 0:n.value,groupby:null==ce?void 0:ce.column,...ce});i.extra_form_data=Ie,_e({defaultValueQueriesData:null,isDataDirty:!1}),(0,di.getChartDataRequest)({formData:i,force:e,requestParams:{dashboardId:0}}).then((e=>{let{response:t,json:n}=e;if((0,mt.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const e="result"in n?n.result[0]:n;if(200===t.status)_e({defaultValueQueriesData:[e]});else{if(202!==t.status)throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`);(0,Nr.YJ)(e).then((e=>{_e({defaultValueQueriesData:e})})).catch((e=>{Y(e.message||e.error||(0,c.t)("Check configuration"))}))}}else _e({defaultValueQueriesData:n.result})})).catch((e=>{e.json().then((t=>{(e=>{ji(z,E,{defaultValueQueriesData:null}),Y(e),re()})(t.message||e.statusText||(0,c.t)("Check configuration"))}))}))}),[E,re,z,ce,be,$e]);(0,s.useEffect)((()=>Me()),[$e]);const Ee=(0,Lr.zi)({datasetId:ye,groupby:Ce?null==ce?void 0:ce.column:void 0,...ce});Ee.extra_form_data=Ie;const[Fe,Oe,ze,Pe]=((e,t)=>{var n,i;const r=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),o=!(null==e||null==(i=e.controlValues)||!i.defaultToFirstItem),[a,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(r),[h,p]=(0,s.useState)(""),g=function(e){void 0===e&&(e=!1);const t=r&&!o;u(t),l(!!t||e)};return(0,s.useEffect)((()=>{var t,n;g(!o&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[o,r]),(0,s.useEffect)((()=>{var e,n;g(!o&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,s.useEffect)((()=>{let e="";o?e=(0,c.t)('Default value set automatically when "Select first filter value by default" is checked'):d?e=(0,c.t)('Default value must be set when "Filter value is required" is checked'):a&&(e=(0,c.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[a,d,o]),[a,d,h,g]})(ce,F),Ue=!ye||oe||(null==ce||null==(b=ce.dataset)?void 0:b.label),Ne=(0,s.useCallback)((()=>{z.setFields([{name:"changed",value:!0}])}),[z]),Ae=(0,s.useCallback)((e=>{ji(z,E,e),Ne()}),[E,z,Ne]),qe=!!(null!=ce&&ce.adhoc_filters||null!=ce&&ce.time_range||null!=F&&null!=(y=F.adhoc_filters)&&y.length||null!=F&&F.time_range),Le=void 0!==(null==ce||null==(S=ce.controlValues)?void 0:S.enableSingleValue)||void 0!==(null==F||null==(C=F.controlValues)?void 0:C.enableSingleValue);let je=null==F||null==(Z=F.controlValues)?void 0:Z.enableSingleValue;void 0!==(null==ce||null==(w=ce.controlValues)?void 0:w.enableSingleMaxValue)&&({enableSingleValue:je}=ce.controlValues);const Ve="boolean"==typeof(null==ce||null==(R=ce.controlValues)?void 0:R.sortAscending)||"boolean"==typeof(null==F||null==(k=F.controlValues)?void 0:k.sortAscending);let Ke=null==F||null==(T=F.controlValues)?void 0:T.sortAscending;"boolean"==typeof(null==ce||null==(D=ce.controlValues)?void 0:D.sortAscending)&&(Ke=ce.controlValues.sortAscending);const Be=!be||!De&&Re||!Se.groupby,He=e=>{var t;const n=null==(t=z.getFieldValue("filters"))?void 0:t[E].controlValues;ji(z,E,{controlValues:{...n,sortAscending:e}}),re()},We=e=>{var t;const n=null==(t=z.getFieldValue("filters"))?void 0:t[E].controlValues;ji(z,E,{controlValues:{...n,enableSingleValue:e}}),re()},Ye=()=>setTimeout((()=>z.validateFields([["filters",E,"adhoc_filters"],["filters",E,"time_range"]])),0),Je=(null==ce?void 0:ce.time_range)&&"No filter"!==ce.time_range,Ge=(null==ce||null==(_=ce.adhoc_filters)?void 0:_.length)>0,Qe=null==ce||null==(I=ce.controlValues)?void 0:I.defaultToFirstItem,Xe=(null==ce?void 0:ce.filterType)===(null==F?void 0:F.filterType)?null==F?void 0:F.defaultDataMask:null,et=()=>Je||Ge?Promise.resolve():Promise.reject(new Error((0,c.t)("Pre-filter is required"))),tt=P(E),nt=tt.length>0;(0,s.useEffect)((()=>{ye&&Po({endpoint:`/api/v1/dataset/${ye}`}).then((e=>{var t,n,i;Q(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const r=null==(i=e.json)?void 0:i.result;r.type=r.datasource_type,r.filter_select=!0,ae(r)})).catch((e=>{(0,Wn.Gb)(e.message)}))}),[ye]),(0,s.useImperativeHandle)(t,(()=>({changeTab(e){te(e)}}))),((e,t)=>{var n;const i=Li(),r=(e.getFieldValue("filters")||{})[t];(0,s.useEffect)((()=>{ji(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),i()}),[e,null==r?void 0:r.filterType,null==r?void 0:r.column,null==r||null==(n=r.dataset)?void 0:n.value,JSON.stringify(null==r?void 0:r.adhoc_filters),null==r?void 0:r.time_range,i,t])})(z,E),(0,s.useEffect)((()=>{be&&Re&&Fe&&De&&Me()}),[be,Re,Fe,De,Me,Ue]);const it=(0,s.useMemo)((()=>{var e;const t=[];return void 0===(null==ce||null==(e=ce.dataset)?void 0:e.value)?[]:(Object.values(me).forEach((e=>{var n,i,r;const o=null==(n=e.form_data)?void 0:n.datasource;void 0!==o&&(null==(i=ge[o])?void 0:i.id)!==(null==ce||null==(r=ce.dataset)?void 0:r.value)&&t.push(e.id)})),t)}),[JSON.stringify(me),null==ce||null==($=ce.dataset)?void 0:$.value,JSON.stringify(ge)]);return(0,s.useEffect)((()=>{H&&ie(de)}),[H]),(0,s.useEffect)((()=>{ne&&!H&&(ji(z,E,ne),ie(null))}),[de,E,z,H,ne]),H?(0,x.tZ)(so,{onClick:()=>N(E)}):(0,x.tZ)(_o,{activeKey:ee,onChange:e=>te(e),centered:!0},(0,x.tZ)(vo,{tab:Mo.configuration.name,key:Mo.configuration.key,forceRender:!0},(0,x.tZ)(bo,null,(0,x.tZ)(So,{name:["filters",E,"type"],hidden:!0,initialValue:nr.BE.NATIVE_FILTER},(0,x.tZ)(j.II,null)),(0,x.tZ)(So,{name:["filters",E,"name"],label:(0,x.tZ)(wo,null,(0,c.t)("Filter name")),initialValue:null==F?void 0:F.name,rules:[{required:!H,message:(0,c.t)("Name is required")}]},(0,x.tZ)(j.II,Go("name-input"))),(0,x.tZ)(So,G()({name:["filters",E,"filterType"],rules:[{required:!H,message:(0,c.t)("Name is required")}],initialValue:(null==F?void 0:F.filterType)||"filter_select",label:(0,x.tZ)(wo,null,(0,c.t)("Filter Type"))},Go("filter-type")),(0,x.tZ)(V.Ph,{ariaLabel:(0,c.t)("Filter type"),options:pe.map((e=>{var t,n,i;const r=null==(t=he[e])?void 0:t.value.name,o=r?Oo[r]:void 0,s=1===(null==(n=qi[e])?void 0:n.length)&&(null==(i=qi[e])?void 0:a()(i).call(i,Ui.Z.TEMPORAL))&&!fe;return{value:e,label:o||r,customLabel:s?(0,x.tZ)(X.u,{title:(0,c.t)("Datasets do not contain a temporal column")},o||r):void 0,disabled:s}})),onChange:e=>{ji(z,E,{filterType:e,defaultDataMask:null,column:null}),re()}}))),"filter_time"===(null==ce?void 0:ce.filterType)&&(0,x.tZ)($o,null,(0,c.t)("Dashboard time range filters apply to temporal columns defined in\n          the filter section of each chart. Add temporal columns to the chart\n          filters to have this dashboard filter impact those charts.")),be&&(0,x.tZ)(yo,null,Ue?(0,x.tZ)(So,G()({name:["filters",E,"dataset"],label:(0,x.tZ)(wo,null,(0,c.t)("Dataset")),initialValue:oe?{label:oe.table_name,value:oe.id}:void 0,rules:[{required:!H,message:(0,c.t)("Dataset is required")}]},Go("datasource-input")),(0,x.tZ)(to,{onChange:e=>{e.value!==ye&&ji(z,E,{dataset:e,defaultDataMask:null,column:null}),re()}})):(0,x.tZ)(So,{label:(0,x.tZ)(wo,null,(0,c.t)("Dataset"))},(0,x.tZ)(p.Z,{position:"inline-centered"})),be&&Object.keys(Se).map((e=>Se[e].element))),(0,x.tZ)(Do,{defaultActiveKey:U,onChange:e=>{A(e)},expandIconPosition:"right",key:`native-filter-config-${E}`},"filter_time"!==(null==ce?void 0:ce.filterType)&&(0,x.tZ)(Mr.Z.Panel,{forceRender:!0,header:Eo.configuration.name,key:`${E}-${Eo.configuration.key}`},Te&&nt&&(0,x.tZ)(Co,{name:["filters",E,"dependencies"],initialValue:ue},(0,x.tZ)(fo,{availableFilters:tt,dependencies:ue,onDependenciesChange:e=>{ji(z,E,{dependencies:e}),re(),L(),Ne()},getDependencySuggestion:()=>K(E)})),be&&ke&&(0,x.tZ)(Ro,{name:["filters",E,"preFilter"]},(0,x.tZ)(Kr,{initialValue:qe,title:(0,c.t)("Pre-filter available values"),onChange:e=>{Ne(),e&&Ye()}},(0,x.tZ)(Zo,{name:["filters",E,"adhoc_filters"],initialValue:null==F?void 0:F.adhoc_filters,required:!0,rules:[{validator:et}]},(0,x.tZ)(Ur.Z,{columns:(null==oe||null==(M=oe.columns)?void 0:M.filter((e=>e.filterable)))||[],savedMetrics:(null==oe?void 0:oe.metrics)||[],datasource:oe,onChange:e=>{ji(z,E,{adhoc_filters:e}),re(),Ye()},label:(0,x.tZ)("span",null,(0,x.tZ)(wo,null,(0,c.t)("Pre-filter")),!Je&&(0,x.tZ)(Io,null))})),ve&&(0,x.tZ)(Co,{name:["filters",E,"time_range"],label:(0,x.tZ)(wo,null,(0,c.t)("Time range")),initialValue:(null==F?void 0:F.time_range)||(0,c.t)("No filter"),required:!Ge,rules:[{validator:et}]},(0,x.tZ)(Pr.ZP,{name:"time_range",onChange:e=>{ji(z,E,{time_range:e}),re(),Ye()}})),Je&&(0,x.tZ)(Co,{name:["filters",E,"granularity_sqla"],label:(0,x.tZ)(s.Fragment,null,(0,x.tZ)(wo,null,(0,c.t)("Time column")),"",(0,x.tZ)(Sn.V,{placement:"top",tooltip:(0,c.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==F?void 0:F.granularity_sqla},(0,x.tZ)(Yr,{allowClear:!0,form:z,formField:"granularity_sqla",filterId:E,filterValues:e=>!!e.is_dttm,datasetId:ye,onChange:e=>{ji(z,E,{granularity_sqla:e}),re()}})))),"filter_range"!==(null==ce?void 0:ce.filterType)?(0,x.tZ)(Ro,{name:["filters",E,"sortFilter"]},(0,x.tZ)(Kr,{initialValue:Ve,title:(0,c.t)("Sort filter values"),onChange:e=>{He(e||void 0),Ne()}},(0,x.tZ)(Co,{name:["filters",E,"controlValues","sortAscending"],initialValue:Ke,label:(0,x.tZ)(wo,null,(0,c.t)("Sort type"))},(0,x.tZ)(At.Y.Group,{onChange:e=>{He(e.target.value)}},(0,x.tZ)(At.Y,{value:!0},(0,c.t)("Sort ascending")),(0,x.tZ)(At.Y,{value:!1},(0,c.t)("Sort descending")))),we&&(0,x.tZ)(Zo,{name:["filters",E,"sortMetric"],initialValue:null==F?void 0:F.sortMetric,label:(0,x.tZ)(s.Fragment,null,(0,x.tZ)(wo,null,(0,c.t)("Sort Metric")),"",(0,x.tZ)(Sn.V,{placement:"top",tooltip:(0,c.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,x.tZ)(V.Ph,{allowClear:!0,ariaLabel:(0,c.t)("Sort metric"),name:"sortMetric",options:J.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:e=>{void 0!==e&&(ji(z,E,{sortMetric:e}),re())}})))):(0,x.tZ)(Ro,{name:["filters",E,"rangeFilter"]},(0,x.tZ)(Kr,{initialValue:Le,title:(0,c.t)("Single Value"),onChange:e=>{We(e?qr.c.Exact:void 0),Ne()}},(0,x.tZ)(Co,{name:["filters",E,"controlValues","enableSingleValue"],initialValue:je,label:(0,x.tZ)(wo,null,(0,c.t)("Single value type"))},(0,x.tZ)(At.Y.Group,{onChange:e=>We(e.target.value)},(0,x.tZ)(At.Y,{value:qr.c.Minimum},(0,c.t)("Minimum")),(0,x.tZ)(At.Y,{value:qr.c.Exact},(0,c.t)("Exact")),(0,x.tZ)(At.Y,{value:qr.c.Maximum},(0,c.t)("Maximum"))))))),(0,x.tZ)(Mr.Z.Panel,{forceRender:!0,header:Eo.settings.name,key:`${E}-${Eo.settings.key}`},(0,x.tZ)(So,{name:["filters",E,"description"],initialValue:null==F?void 0:F.description,label:(0,x.tZ)(wo,null,(0,c.t)("Description"))},(0,x.tZ)(j.Kx,null)),(0,x.tZ)(Ro,{name:["filters",E,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,x.tZ)(Ro,{name:["filters",E,"defaultValue"]},(0,x.tZ)(Kr,{checked:Fe,disabled:Oe||Qe,initialValue:Fe,title:(0,c.t)("Filter has default value"),tooltip:ze,onChange:e=>{Pe(e),e||ji(z,E,{defaultDataMask:null}),Ne()}},!H&&(0,x.tZ)(Zo,{name:["filters",E,"defaultDataMask"],initialValue:Xe,label:(0,x.tZ)(wo,null,(0,c.t)("Default Value")),required:Fe,rules:[{validator:()=>{var e,t;if(null!=ce&&null!=(e=ce.defaultDataMask)&&null!=(t=e.filterState)&&t.value){const e=z.getFieldsError();return q((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return q((e=>a()(e).call(e,E)?e:[...e,E])),Promise.reject(new Error((0,c.t)("Default value is required")))}}]},W?(0,x.tZ)(zr,{title:(0,c.t)("Cannot load filter"),body:W,level:"error"}):Be?(0,x.tZ)(ko,null,(0,x.tZ)(io,{setDataMask:e=>{var t,n;hi()(null==Xe||null==(t=Xe.filterState)?void 0:t.value,null==e||null==(n=e.filterState)?void 0:n.value)||Ne(),ji(z,E,{defaultDataMask:e}),z.validateFields([["filters",E,"defaultDataMask"]]),re()},hasDefaultValue:Fe,filterId:E,hasDataset:be,form:z,formData:Ee,enableNoResults:Ze}),be&&ye&&(0,x.tZ)(X.u,{title:(0,c.t)("Refresh the default values")},(0,x.tZ)(To,{onClick:()=>Me(!0)}))):(0,c.t)('Fill all required fields to enable "Default Value"')))),Object.keys(xe).sort(((e,t)=>xo.indexOf(e)-xo.indexOf(t))).map((e=>xe[e].element))))),(0,x.tZ)(vo,{tab:Mo.scoping.name,key:Mo.scoping.key,forceRender:!0},(0,x.tZ)(Oi,{updateFormValues:Ae,pathToFormValue:["filters",E],forceUpdate:re,filterScope:null==F?void 0:F.scope,formFilterScope:null==ce?void 0:ce.scope,formScopingType:null==ce?void 0:ce.scoping,initiallyExcludedCharts:it})))},No=s.memo((0,s.forwardRef)(Uo));var Ao={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},qo={name:"zjik7",styles:"display:flex"};function Lo(e){let{title:t,onConfirm:n,onDismiss:i,children:r}=e;return(0,x.tZ)(Et.Z,{closable:!1,type:"warning",key:"alert",message:t,css:Ao,description:r,action:(0,x.tZ)("div",{css:qo},(0,x.tZ)(K.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:i},(0,c.t)("Keep editing")),(0,x.tZ)(K.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:n},(0,c.t)("Yes, cancel")))})}const jo=e=>{let{canSave:t=!0,onCancel:n,handleSave:i,onDismiss:r,onConfirmCancel:o,saveAlertVisible:a}=e;return a?(0,x.tZ)(Lo,{key:"cancel-confirm",title:(0,c.t)("There are unsaved changes."),onConfirm:o,onDismiss:r},(0,c.t)("Are you sure you want to cancel?")):(0,x.tZ)(s.Fragment,null,(0,x.tZ)(K.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,c.t)("Cancel")),(0,x.tZ)(K.Z,{disabled:!t,key:"submit",buttonStyle:"primary",onClick:i},(0,c.t)("Save")))};var Vo=n(60812),Ko=n(92242);const Bo=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    padding: ${4*t.gridUnit}px;\n  `}}
`,Ho=e=>{let{componentId:t,divider:n}=e;return(0,x.tZ)(Bo,null,(0,x.tZ)(Ft.xJ,{initialValue:n?n.title:"",label:(0,c.t)("Title"),name:["filters",t,"title"],rules:[{required:!0,message:(0,c.t)("Title is required"),whitespace:!0}]},(0,x.tZ)(j.II,null)),(0,x.tZ)(Ft.xJ,{initialValue:n?n.description:"",label:(0,c.t)("Description"),name:["filters",t,"description"]},(0,x.tZ)(j.Kx,{rows:4})),(0,x.tZ)(Ft.xJ,{hidden:!0,name:["filters",t,"type"],initialValue:nr.BE.DIVIDER}))},Wo=(0,y.iK)(Cn.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,Yo=y.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${e=>{let{theme:t}=e;return 50*t.gridUnit}}px;
    overflow: auto;
  }
`,Jo=(0,y.iK)(V.qz)`
  width: 100%;
`,Go=tr("filters-config-modal"),Qo=["filter_select"],Xo=[],ea={},ta={filters:{}};function na(e){let{isOpen:t,initialFilterId:n,createNewOnOpen:i,onSave:r,onCancel:o}=e;const[l]=V.qz.useForm(),d=(0,s.useRef)(),u=rr(),h=function(){const e=rr();return(0,s.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[p,g]=(0,s.useState)(Xo),[m,f]=(0,s.useState)(ea),[v,b]=(0,s.useState)(!1),y=(0,s.useMemo)((()=>Xi()([...(0,Ko.QN)(u),...p]).filter((e=>{var t;return!m[e]||(null==(t=m[e])?void 0:t.isPending)}))),[u,p,m]),S=null!=n?n:y[0],[Z,w]=(0,s.useState)(S),[R,k]=(0,s.useState)(Xo),[D,_]=(0,s.useState)(ta),I=p.filter((e=>!m[e])),$=(0,s.useCallback)((e=>{const t=m[e];null!=t&&t.isPending&&clearTimeout(t.timerId),f((t=>({...t,[e]:null})))}),[m]),M=(0,s.useMemo)((()=>Object.keys(h)),[h]),[E,F]=(0,s.useState)(M),[O,z]=(0,s.useState)([S]),P=e=>[`${e}-${Eo.configuration.key}`,`${e}-${Eo.settings.key}`],[U,N]=(0,s.useState)(P(S)),A=(0,s.useCallback)((e=>{const t=(0,Ko.W6)(e);g([...p,t]),w(t),b(!1),F([...E,t]),N(P(t))}),[p,E,w,F,g]);((e,t,n)=>{const i=(0,Vo.D)(e);(0,s.useEffect)((()=>{n&&e&&!i&&t(nr.BE.NATIVE_FILTER)}),[n,e,i,t])})(t,A,i),((e,t,n,i)=>{(0,s.useEffect)((()=>{const r=e[t];if(r&&!r.isPending){const r=n.flat().find((n=>!e[n]&&n!==t));r&&i(r)}}),[t,e,n,i])})(m,Z,E,w);const q=(0,Ko.EJ)(f,F,b),L=function(e){void 0===e&&(e=!1),g(Xo),w(S),f(ea),b(!1),_(ta),k(Xo),y.length>0&&N(P(y[0])),e||F(M),z([S]),l.resetFields(["filters"]),l.setFieldsValue({changed:!1})},j=(0,s.useCallback)((e=>{const t=D.filters[e],n=h[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||(0,c.t)("[untitled]")}),[h,D.filters]),K=(0,s.useCallback)((e=>{var t;if(m[e])return!1;const n=(null==(t=l.getFieldValue("filters"))?void 0:t[e])||h[e];return n&&"filterType"in n&&a()(Qo).call(Qo,n.filterType)}),[h,l,m]),B=(0,s.useCallback)((e=>y.filter((t=>t!==e)).filter((e=>K(e))).map((e=>({label:j(e),value:e})))),[K,y,j]),H=(0,s.useCallback)((()=>{const e=l.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!a()(t).call(t,n)&&t.push(n)})),!t.length&&R.length>0?k(Xo):t.length>0&&!hi()(Gi()(R),Gi()(t))&&k(t)}),[l,R]),W=async()=>{const e=await(0,Ko.G$)(l,Z,w);H(),e?((e=>{Object.keys(h).forEach((e=>{const t=h[e];if(!("cascadeParentIds"in t))return;const{cascadeParentIds:n}=t;n&&(t.cascadeParentIds=n.filter((e=>K(e))))}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{const n=t[e];if(!("dependencies"in n))return;const{dependencies:i}=n;i&&(n.dependencies=i.filter((e=>K(e))))}))})(e),(0,Ko.GA)(h,E,m,r,e)(),L(!0)):d.current.changeTab("configuration")},Y=()=>{L(),o()},J=()=>{const e=l.getFieldValue("changed"),t=E.length!==M.length||E.some(((e,t)=>e!==M[t]));I.length>0||l.isFieldsTouched()||e||t?b(!0):Y()},G=(0,s.useCallback)((()=>{const e=new Map,t=l.getFieldValue("filters");return t&&Object.keys(t).forEach((n=>{const i=t[n],r=h[n];let o=[];i&&"dependencies"in i?o=[...i.dependencies]:null!=r&&r.cascadeParentIds&&(o=[...r.cascadeParentIds]),e.set(n,o)})),e}),[h,l]),Q=(0,s.useCallback)((()=>{const e=G();y.filter((e=>!m[e])).forEach((t=>{const n={name:["filters",t,"dependencies"],errors:(0,Ko.uh)(e,t)?[(0,c.t)("Cyclic dependency detected")]:[]};l.setFields([n])})),H()}),[G,y,l,H,m]),X=(0,s.useCallback)((e=>{const t=G(),n=E.filter((t=>t!==e&&K(t))),i=n.find((n=>{const i=t.get(e)||[];return i.push(n),!(0,Ko.uh)(t,e)||(i.pop(),!1)}));return i||n[0]}),[G,K,E]),ee=(0,s.useMemo)((()=>T()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),i=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||i)&&_(t),b(!1),H()}),er.M)),[H]);(0,s.useEffect)((()=>{Yi()(m)||k((e=>e.filter((e=>!m[e]))))}),[m]),(0,s.useEffect)((()=>{a()(O).call(O,Z)||z([...O,Z])}),[Z]);const te=(0,s.useCallback)((e=>N(e)),[N]),ne=(0,s.useMemo)((()=>E.map((e=>{if(!a()(O).call(O,e))return null;const t=e.startsWith(Ko.Ky),n=Z===e;return(0,x.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:n?"":"none"}},t?(0,x.tZ)(Ho,{componentId:e,divider:h[e]}):(0,x.tZ)(No,{ref:d,form:l,filterId:e,filterToEdit:h[e],removedFilters:m,restoreFilter:$,getAvailableFilters:B,key:e,activeFilterPanelKeys:U,handleActiveFilterPanelChange:te,isActive:n,setErroredFilters:k,validateDependencies:Q,getDependencySuggestion:X}))}))),[O,E,Z,h,l,m,$,B,U,Q,X,te]);return(0,x.tZ)(Wo,{visible:t,maskClosable:!1,title:(0,c.t)("Add and edit filters"),width:"50%",destroyOnClose:!0,onCancel:J,onOk:W,centered:!0,footer:(0,x.tZ)(jo,{onDismiss:()=>b(!1),onCancel:J,handleSave:W,canSave:!R.length,saveAlertVisible:v,onConfirmCancel:Y})},(0,x.tZ)(C.Z,null,(0,x.tZ)(Yo,null,(0,x.tZ)(Jo,{form:l,onValuesChange:ee,layout:"vertical"},(0,x.tZ)($r,{erroredFilters:R,onRemove:q,onAdd:A,onChange:e=>{w(e),N(P(e))},getFilterTitle:j,currentFilterId:Z,removedFilters:m,restoreFilter:$,onRearrange:(e,t)=>{const n=[...E],i=n.splice(e,1)[0];n.splice(t,0,i),F(n)},filters:E},ne)))))}const ia=s.memo(na),ra=e=>{var t,n;let{isOpen:i,chartId:o,onClose:a}=e;const l=(0,r.I0)(),[d]=V.qz.useForm(),u=(0,r.v9)((e=>{var t;let{dashboardInfo:n}=e;return null==n||null==(t=n.metadata)?void 0:t.chart_configuration})),h=(0,r.v9)((e=>e.charts)),p=(0,r.v9)((e=>e.dashboardLayout.present)),g=null==u||null==(t=u[o])||null==(n=t.crossFilters)?void 0:n.scope,m=()=>{const e=(0,wi.Q)(d.getFieldValue("scope"),h,p);l((0,Kn.Aw)({...u,[o]:{id:o,crossFilters:{scope:d.getFieldValue("scope"),chartsInScope:e}}})),a()};return(0,x.tZ)(Cn.o,{visible:i,maskClosable:!1,title:(0,c.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:a,onOk:m,centered:!0,footer:(0,x.tZ)(s.Fragment,null,(0,x.tZ)(K.Z,{key:"cancel",buttonStyle:"secondary",onClick:a},(0,c.t)("Cancel")),(0,x.tZ)(K.Z,{key:"submit",buttonStyle:"primary",onClick:m},(0,c.t)("Save")))},(0,x.tZ)(Jo,{preserve:!1,form:d,layout:"vertical"},(0,x.tZ)(Hi,{form:d,scope:g,chartId:o})))};var oa=n(54076);const aa=e=>{if((0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB))return e?(0,c.t)("Click to edit %s in a new tab",e):(0,c.t)("Click to edit chart.");const t="MacOS"===(0,oa.fV)(),n=e?(0,c.t)("Click to edit %s.",e):(0,c.t)("Click to edit chart."),i=(0,c.t)("Use %s to open in a new tab.",t?(0,c.t)(" + click"):(0,c.t)("ctrl + click"));return(0,x.tZ)(s.Fragment,null,(0,x.tZ)("div",null,n),(0,x.tZ)("div",null,i))};var sa=n(15423),la=n(95345),da=n(41814);const ca="cross_filter_scoping",ua="download_as_image",ha="explore_chart",pa="export_csv",ga="export_full_csv",ma="force_refresh",fa="fullscreen",va="toggle_chart_description",ba=y.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit/4}}px
    ${e=>{let{theme:t}=e;return 1.5*t.gridUnit}}px;

  .dot {
    display: block;

    height: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    width: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    border-radius: 50%;
    margin: ${e=>{let{theme:t}=e;return t.gridUnit/2}}px 0;

    background-color: ${e=>{let{theme:t}=e;return t.colors.text.label}};
  }

  &:hover {
    cursor: pointer;
  }
`,ya=y.iK.div`
  height: auto;
  margin: ${e=>{let{theme:t}=e;return t.gridUnit}}px 0;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  line-height: 21px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,xa=()=>(0,x.tZ)(ba,null,(0,x.tZ)("span",{className:"dot"}),(0,x.tZ)("span",{className:"dot"}),(0,x.tZ)("span",{className:"dot"})),Sa=x.iv`
  &&.anticon > .anticon:first-child {
    margin-right: 0;
    vertical-align: 0;
  }
`,Ca=e=>{let{exploreUrl:t,triggerNode:n,modalTitle:i,modalBody:r}=e;const[o,a]=(0,s.useState)(!1),l=(0,s.useCallback)((()=>a(!0)),[]),d=(0,s.useCallback)((()=>a(!1)),[]),u=(0,pi.k6)(),h=(0,y.Fg)();return(0,x.tZ)(s.Fragment,null,(0,x.tZ)("span",{onClick:l,role:"button",tabIndex:0},n),(0,x.tZ)(Cn.Z,{css:x.iv`
            .ant-modal-body {
              display: flex;
              flex-direction: column;
            }
          `,show:o,onHide:d,title:i,footer:(0,x.tZ)(s.Fragment,null,(0,x.tZ)(K.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:()=>u.push(t)},(0,c.t)("Edit chart")),(0,x.tZ)(K.Z,{buttonStyle:"primary",buttonSize:"small",onClick:d},(0,c.t)("Close"))),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*h.gridUnit,minWidth:128*h.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0},r))};class Za extends s.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick(e){var t,n,i,r,o,a,s,l;let{key:d,domEvent:u}=e;switch(d){case ma:this.refreshChart(),this.props.addSuccessToast((0,c.t)("Data refreshed"));break;case ca:this.setState({showCrossFilterScopingModal:!0});break;case va:null==(t=(n=this.props).toggleExpandSlice)||t.call(n,this.props.slice.slice_id);break;case ha:null==(i=(r=this.props).logExploreChart)||i.call(r,this.props.slice.slice_id);break;case pa:null==(o=(a=this.props).exportCSV)||o.call(a,this.props.slice.slice_id);break;case fa:this.props.handleToggleFullSize();break;case ga:null==(s=(l=this.props).exportFullCSV)||s.call(l,this.props.slice.slice_id);break;case ua:{var h,p;const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Wt.Z)((g=this.props.slice.slice_id,`.dashboard-chart-id-${g}`),this.props.slice.slice_name,!0)(u).then((()=>{e.style.visibility="visible"})),null==(h=(p=this.props).logEvent)||h.call(p,ft.xE,{chartId:this.props.slice.slice_id});break}}var g}render(){const{componentId:e,dashboardId:t,slice:n,isFullSize:i,cachedDttm:r=[],updatedDttm:o=null,addSuccessToast:l=(()=>{}),addDangerToast:d=(()=>{}),supersetCanShare:h=!1,isCached:p=[],crossFiltersEnabled:g}=this.props,m=(0,Si.Z)().items,f="table"===n.viz_type,v=Object.entries(m).filter((e=>{var t;let[,{value:n}]=e;return null==(t=n.behaviors)?void 0:a()(t).call(t,Ci.cg.INTERACTIVE_CHART)})).find((e=>{let[t]=e;return t===n.viz_type})),b=(r||[]).map((e=>ht().utc(e).fromNow())),y=o?ht().utc(o).fromNow():"",S=[...new Set(p.map((e=>e?(0,c.t)("Cached %s",b):y?(0,c.t)("Fetched %s",y):""))||"")],C=S.map(((e,t)=>(0,x.tZ)("div",{key:`tooltip-${t}`},S.length>1?(0,c.t)("Query %s: %s",t+1,e):e))),Z=i?(0,c.t)("Exit fullscreen"):(0,c.t)("Enter fullscreen"),w=(0,x.tZ)(xt.v,{onClick:this.handleMenuClick,selectable:!1},(0,x.tZ)(xt.v.Item,{key:ma,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,c.t)("Force refresh"),(0,x.tZ)(ya,null,C)),(0,x.tZ)(xt.v.Item,{key:fa},Z),(0,x.tZ)(xt.v.Divider,null),n.description&&(0,x.tZ)(xt.v.Item,{key:va},this.props.isDescriptionExpanded?(0,c.t)("Hide chart description"):(0,c.t)("Show chart description")),this.props.supersetCanExplore&&(0,x.tZ)(xt.v.Item,{key:ha},(0,x.tZ)(xi.rU,{to:this.props.exploreUrl},(0,x.tZ)(X.u,{title:aa(this.props.slice.slice_name)},(0,c.t)("Edit chart")))),this.props.supersetCanExplore&&(0,x.tZ)(xt.v.Item,{key:"view_query"},(0,x.tZ)(kt.Z,{triggerNode:(0,x.tZ)("span",null,(0,c.t)("View query")),modalTitle:(0,c.t)("View query"),modalBody:(0,x.tZ)(sa.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),this.props.supersetCanExplore&&(0,x.tZ)(xt.v.Item,{key:"view_results"},(0,x.tZ)(Ca,{exploreUrl:this.props.exploreUrl,triggerNode:(0,x.tZ)("span",null,(0,c.t)("View as table")),modalTitle:(0,c.t)("Chart Data: %s",n.slice_name),modalBody:(0,x.tZ)(la.Tg,{queryFormData:this.props.formData,queryForce:!1,dataSize:20,isRequest:!0,isVisible:!0})})),(0,mt.cr)(u.T.DRILL_TO_DETAIL)&&this.props.supersetCanExplore&&(0,x.tZ)(da.p,{chartId:n.slice_id,formData:this.props.formData}),(n.description||this.props.supersetCanExplore)&&(0,x.tZ)(xt.v.Divider,null),(0,mt.cr)(u.T.DASHBOARD_CROSS_FILTERS)&&v&&g&&(0,x.tZ)(s.Fragment,null,(0,x.tZ)(xt.v.Item,{key:ca},(0,c.t)("Cross-filter scoping")),(0,x.tZ)(xt.v.Divider,null)),h&&(0,x.tZ)(xt.v.SubMenu,{title:(0,c.t)("Share")},(0,x.tZ)(Rt,{dashboardId:t,dashboardComponentId:e,copyMenuItemTitle:(0,c.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,c.t)("Share chart by email"),emailSubject:(0,c.t)("Superset chart"),emailBody:(0,c.t)("Check out this chart: "),addSuccessToast:l,addDangerToast:d})),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,x.tZ)(xt.v.SubMenu,{title:(0,c.t)("Download")},(0,x.tZ)(xt.v.Item,{key:pa,icon:(0,x.tZ)(B.Z.FileOutlined,{css:Sa})},(0,c.t)("Export to .CSV")),"filter_box"!==this.props.slice.viz_type&&(0,mt.cr)(u.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&f&&(0,x.tZ)(xt.v.Item,{key:ga,icon:(0,x.tZ)(B.Z.FileOutlined,{css:Sa})},(0,c.t)("Export to full .CSV")),(0,x.tZ)(xt.v.Item,{key:ua,icon:(0,x.tZ)(B.Z.FileImageOutlined,{css:Sa})},(0,c.t)("Download as image"))));return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(ra,{chartId:n.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),i&&(0,x.tZ)(B.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,x.tZ)(Zi.$i,{overlay:w,trigger:["click"],placement:"bottomRight"},(0,x.tZ)("span",{id:`slice_${n.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,x.tZ)(xa,null))))}}const wa=(0,pi.EN)(Za);var Ra=n(87185),ka=n.n(Ra);const Ta=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: inline-block;
    color: ${t.colors.grayscale.light5};
    background: ${t.colors.grayscale.base};
    border-radius: 1em;
    vertical-align: text-top;
    padding: ${t.gridUnit}px ${2*t.gridUnit}px;
    font-size: ${t.typography.sizes.m}px;
    font-weight: ${t.typography.weights.bold};
    min-width: 1em;
    min-height: 1em;
    line-height: 1em;
    vertical-align: middle;
    white-space: nowrap;

    svg {
      position: relative;
      top: -2px;
      color: ${t.colors.grayscale.light5};
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
    }

    &:hover {
      cursor: pointer;
      background: ${t.colors.grayscale.dark1};
    }

    &.has-cross-filters {
      background: ${t.colors.primary.base};
      &:hover {
        background: ${t.colors.primary.dark1};
      }
    }

    &.has-incompatible-filters {
      color: ${t.colors.grayscale.dark2};
      background: ${t.colors.alert.base};
      &:hover {
        background: ${t.colors.alert.dark1};
      }
      svg {
        color: ${t.colors.grayscale.dark2};
      }
    }

    &.filters-inactive {
      color: ${t.colors.grayscale.light5};
      background: ${t.colors.grayscale.light1};
      padding: ${t.gridUnit}px;
      text-align: center;
      height: 22px;
      width: 22px;

      &:hover {
        background: ${t.colors.grayscale.base};
      }
    }
  `}}
`,Da=y.iK.span`
  position: relative;
  margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  font-weight: ${e=>{let{bold:t,theme:n}=e;return t?n.typography.weights.bold:"auto"}};
  color: ${e=>{let{color:t,theme:n}=e;return t||n.colors.grayscale.light5}};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,_a=y.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
`,Ia=y.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,$a=y.iK.div`
  margin: 0 -${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,Ma=y.iK.div`
  padding-left: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  margin: -${e=>{let{theme:t}=e;return 3*t.gridUnit}}px 0;
`,Ea=y.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,Fa=y.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
`,Oa=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n  padding-top: ${3*t.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${t.colors.grayscale.light5};\n  `}}
`;n(14670);const za=(0,c.t)("Please apply filter changes"),Pa=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,c.t)("Unknown value"),Ua=e=>{let{filterSetFilterValues:t,dataMaskSelected:n}=e;return t.find((e=>{let{dataMask:t={}}=e;const i=Object.entries(n);return i.every((e=>{var n;let[r,o]=e;const a=(0,fi.JB)(o.filterState,null==t||null==(n=t[r])?void 0:n.filterState,{ignoreUndefined:!0,ignoreNull:!0}),s=i.length===Object.keys(null!=t?t:{}).length;return a&&s}))}))},Na=e=>{let{indicator:{column:t,name:n,value:i,path:r=[]},onClick:o=(()=>{}),text:a}=e;const l=Pa(i);return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Ia,{onClick:()=>o([...r,`LABEL-${t}`])},(0,x.tZ)(Da,{bold:!0},(0,x.tZ)(_a,null,(0,x.tZ)(B.Z.SearchOutlined,{iconSize:"m",css:x.iv`
                span {
                  vertical-align: 0;
                }
              `})),n,l?": ":""),(0,x.tZ)(Fa,null,l)),a&&(0,x.tZ)(Oa,null,a))},Aa={name:"1gca25q",styles:"span{line-height:0;}"},qa=e=>{let{appliedCrossFilterIndicators:t=[],appliedIndicators:n=[],incompatibleIndicators:i=[],unsetIndicators:o=[],onHighlightFilterSource:a,children:l}=e;const[d,u]=(0,s.useState)(!1),h=(0,y.Fg)(),p=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,s.useEffect)((()=>{d&&window.addEventListener("resize",(()=>u(!1)),{once:!0})}),[d]),(0,s.useEffect)((()=>{u(!1)}),[p]);const g=()=>{const e=[];return t.length&&e.push("appliedCrossFilters"),n.length&&e.push("applied"),i.length&&e.push("incompatible"),e.length?e:["unset"]},[m,f]=(0,s.useState)((()=>[...g()])),v=e=>`${e.column} - ${e.name}`,b=(0,x.tZ)(Ea,null,(0,x.tZ)(x.xB,{styles:(0,x.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",h.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",h.colors.grayscale.dark2,"cc;border-left-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",h.colors.grayscale.dark2,"cc;border-right-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",h.colors.grayscale.dark2,"cc;border-right-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",h.colors.grayscale.dark2,"cc;border-left-color:",h.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",h.colors.grayscale.light4,";z-index:99;}}","")}),(0,x.tZ)($a,null,(0,x.tZ)(Mr.Z,{ghost:!0,light:!0,activeKey:m,onChange:function(e){f("string"==typeof e?[e]:e)}},t.length?(0,x.tZ)(Mr.Z.Panel,{key:"appliedCrossFilters",header:(0,x.tZ)(Da,{bold:!0,color:h.colors.primary.light1},(0,x.tZ)(B.Z.CursorTarget,{css:(0,x.iv)({fill:h.colors.primary.light1},"",""),iconSize:"xl"}),(0,c.t)("Applied Cross Filters (%d)",t.length))},(0,x.tZ)(Ma,{css:(0,x.iv)({paddingBottom:3*h.gridUnit},"","")},t.map((e=>(0,x.tZ)(Na,{key:v(e),indicator:e,onClick:a}))))):null,n.length?(0,x.tZ)(Mr.Z.Panel,{key:"applied",header:(0,x.tZ)(Da,{bold:!0,color:h.colors.success.base},(0,x.tZ)(B.Z.CheckCircleFilled,{css:Aa,iconSize:"m"})," ",(0,c.t)("Applied Filters (%d)",n.length))},(0,x.tZ)(Ma,{css:(0,x.iv)({paddingBottom:3*h.gridUnit},"","")},n.map((e=>(0,x.tZ)(Na,{key:v(e),indicator:e,onClick:a}))))):null,i.length?(0,x.tZ)(Mr.Z.Panel,{key:"incompatible",header:(0,x.tZ)(Da,{bold:!0,color:h.colors.alert.base},(0,x.tZ)(B.Z.ExclamationCircleFilled,{css:Aa,iconSize:"m"})," ",(0,c.t)("Incompatible Filters (%d)",i.length))},(0,x.tZ)(Ma,{css:(0,x.iv)({paddingBottom:3*h.gridUnit},"","")},i.map((e=>(0,x.tZ)(Na,{key:v(e),indicator:e,onClick:a}))))):null,o.length?(0,x.tZ)(Mr.Z.Panel,{key:"unset",header:(0,x.tZ)(Da,{bold:!0,color:h.colors.grayscale.light1},(0,x.tZ)(B.Z.MinusCircleFilled,{css:Aa,iconSize:"m"})," ",(0,c.t)("Unset Filters (%d)",o.length)),disabled:!o.length},(0,x.tZ)(Ma,{css:(0,x.iv)({paddingBottom:3*h.gridUnit},"","")},o.map((e=>(0,x.tZ)(Na,{key:v(e),indicator:e,onClick:a}))))):null)));return(0,x.tZ)(ti.ZP,{overlayClassName:"filterStatusPopover",content:b,visible:d,onVisibleChange:function(e){u(e),e&&f(g())},placement:"bottomRight",trigger:"click"},l)};var La,ja=n(5364),Va=n(10581);!function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(La||(La={}));const Ka=new Set(Object.values(Y.i2)),Ba=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,Ni.Z)(null==e?void 0:e.value).join(", "):null,Ha=(e,t,n)=>{const i=t.columns[e],r=Array.isArray(i)?i:[i];if(null==i||t.isDateFilter&&i===ja.vM||0===r.length)return[];if(t.isDateFilter&&Ka.has(e)){const t=((e===Y.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,t)=>{let[n,i]=t;return{...e,[n]:i}}),{});return r.map((e=>t[e]||e))}return r},Wa=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},Ya=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>(0,Va.Z)(e.column))))},Ja={},Ga={},Qa={},Xa={},es={},ts=[],ns=e=>{var t,n,i;let{chartId:o}=e;const l=(0,r.I0)(),d=(0,r.v9)((e=>e.datasources)),c=(0,r.v9)((e=>e.dashboardFilters)),h=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),p=(0,r.v9)((e=>e.dashboardInfo)),g=(0,r.v9)((e=>e.charts)),m=(0,r.v9)((e=>e.dashboardLayout.present)),f=(0,r.v9)((e=>e.dataMask)),[v,y]=(0,s.useState)(ts),[S,C]=(0,s.useState)(ts),Z=(0,s.useCallback)((e=>{l((0,Bn.E2)(e))}),[l]),w=g[o],R=(0,Vo.D)(w),k=null==R?void 0:R.chartStatus,T=(0,Vo.D)(c),D=(0,Vo.D)(d),_=(null==w?void 0:w.chartStatus)&&a()(t=["rendered","success"]).call(t,w.chartStatus);(0,s.useEffect)((()=>{if(!_&&S.length>0)C(ts);else if("success"!==k){var e,t,n,i,r,s,l,u;(null==w||null==(e=w.queriesResponse)||null==(t=e[0])?void 0:t.rejected_filters)===(null==R||null==(n=R.queriesResponse)||null==(i=n[0])?void 0:i.rejected_filters)&&(null==w||null==(r=w.queriesResponse)||null==(s=r[0])?void 0:s.applied_filters)===(null==R||null==(l=R.queriesResponse)||null==(u=l[0])?void 0:u.applied_filters)&&c===T&&d===D||C(((e,t,n,i)=>{const r=Wa(i),o=Ya(i),s=Object.values(t).filter((t=>t.chartId!==e)),l=Object.entries(n).filter((e=>{let[t]=e;return s.find((e=>e.datasourceId===t))})).map((e=>{let[,t]=e;return t})),d=Ga[e];if(Ja[e]&&(0,fi.JB)(null==d?void 0:d.appliedColumns,r)&&(0,fi.JB)(null==d?void 0:d.rejectedColumns,o)&&(0,fi.JB)(null==d?void 0:d.matchingFilters,s)&&(0,fi.JB)(null==d?void 0:d.matchingDatasources,l))return Ja[e];const c=s.reduce(((t,i)=>t.concat(((e,t,n,i,r)=>{const o=(e,t)=>i.has(e)&&t.columns[e]?La.Applied:r.has(e)?La.Incompatible:La.Unset;return Object.keys(t.columns).filter((n=>{var i;return a()(i=(0,Gt.up)({filterScope:t.scopes[n]})).call(i,e)})).map((e=>({column:e,name:t.labels[e]||e,value:Ha(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,i,n[i.datasourceId]||{},r,o))),[]);return c.sort(((e,t)=>e.name.localeCompare(t.name))),Ja[e]=c,Ga[e]={appliedColumns:r,rejectedColumns:o,matchingFilters:s,matchingDatasources:l},c})(o,c,d,w))}}),[w,o,c,S.length,d,null==R?void 0:R.queriesResponse,k,T,D,_]);const I=(0,Vo.D)(h),$=(0,Vo.D)(m),M=(0,Vo.D)(f),E=(0,Vo.D)(null==(n=p.metadata)?void 0:n.chart_configuration);(0,s.useEffect)((()=>{if(!_&&v.length>0)y(ts);else if("success"!==k){var e,t,n,i,r,s,l,d,c,g;(null==w||null==(e=w.queriesResponse)||null==(t=e[0])?void 0:t.rejected_filters)===(null==R||null==(n=R.queriesResponse)||null==(i=n[0])?void 0:i.rejected_filters)&&(null==w||null==(r=w.queriesResponse)||null==(s=r[0])?void 0:s.applied_filters)===(null==R||null==(l=R.queriesResponse)||null==(d=l[0])?void 0:d.applied_filters)&&h===I&&m===$&&f===M&&E===(null==(c=p.metadata)?void 0:c.chart_configuration)||y(function(e,t,n,i,r,o){void 0===o&&(o=es);const s=Wa(i),l=Ya(i),d=Xa[n];if(Qa[n]&&(0,fi.JB)(null==d?void 0:d.appliedColumns,s)&&(0,fi.JB)(null==d?void 0:d.rejectedColumns,l)&&(null==d?void 0:d.nativeFilters)===e&&(null==d?void 0:d.dashboardLayout)===r&&(null==d?void 0:d.chartConfiguration)===o&&(null==d?void 0:d.dataMask)===t)return Qa[n];const c=e=>{let{label:t,column:n,type:i=nr.gT.NativeFilters}=e;const r=null!==t;return i===nr.gT.CrossFilters&&r?La.CrossFilterApplied:!n&&r?La.Applied:n&&l.has(n)?La.Incompatible:n&&s.has(n)&&r?La.Applied:La.Unset};let h=[];(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)&&(h=e&&Object.values(e).filter((e=>{var t;return e.type===nr.BE.NATIVE_FILTER&&(null==(t=e.chartsInScope)?void 0:a()(t).call(t,n))})).map((e=>{var n,i,r,o;const a=null==(n=e.targets)||null==(i=n[0])||null==(r=i.column)?void 0:r.name,s=null==(o=t[e.id])?void 0:o.filterState,l=Ba(s);return{column:a,name:e.name,path:[e.id],status:c({label:l,column:a}),value:l}})));let p=[];if((0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)){const e=Object.values(r);p=Object.values(o).filter((e=>{var t,i;return null==(t=e.crossFilters)||null==(i=t.chartsInScope)?void 0:a()(i).call(i,n)})).map((n=>{var i,r,o;const a=null==(i=t[n.id])?void 0:i.filterState,s=Ba(a),l=null==a?void 0:a.filters,d=l&&Object.keys(l)[0],u=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n.id}));return{column:d,name:null==u||null==(r=u.meta)?void 0:r.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:c({label:s,type:nr.gT.CrossFilters}),value:s}})).filter((e=>e.status===La.CrossFilterApplied))}const g=p.concat(h);return Qa[n]=g,Xa[n]={nativeFilters:e,dashboardLayout:r,chartConfiguration:o,dataMask:t,appliedColumns:s,rejectedColumns:l},g}(h,f,o,w,m,null==(g=p.metadata)?void 0:g.chart_configuration))}}),[w,o,null==(i=p.metadata)?void 0:i.chart_configuration,f,h,v.length,m,null==R?void 0:R.queriesResponse,E,k,$,M,I,_]);const F=(0,s.useMemo)((()=>ka()((e=>{const t=[La.Applied,La.Unset,La.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...S,...v]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==La.Applied||t.status!==La.Applied)))),[S,v]),O=(0,s.useMemo)((()=>F.filter((e=>e.status===La.CrossFilterApplied))),[F]),z=(0,s.useMemo)((()=>F.filter((e=>e.status===La.Applied))),[F]),P=(0,s.useMemo)((()=>F.filter((e=>e.status===La.Unset))),[F]),U=(0,s.useMemo)((()=>F.filter((e=>e.status===La.Incompatible))),[F]);if(!(O.length||z.length||U.length||P.length))return null;const N=!O.length&&!z.length&&!U.length;return(0,x.tZ)(qa,{appliedCrossFilterIndicators:O,appliedIndicators:z,unsetIndicators:P,incompatibleIndicators:U,onHighlightFilterSource:Z},(0,x.tZ)(Ta,{className:b()("filter-counts",!!U.length&&"has-incompatible-filters",!!O.length&&"has-cross-filters",N&&"filters-inactive")},(0,x.tZ)(B.Z.Filter,{iconSize:"m"}),!N&&(0,x.tZ)("span",null,z.length+O.length),U.length?(0,x.tZ)(s.Fragment,null," ",(0,x.tZ)(B.Z.AlertSolid,null),(0,x.tZ)("span",null,U.length)):null))},is=s.memo(ns);var rs=n(37936);const os=(0,c.t)("Annotation layers are still loading."),as=(0,c.t)("One ore more annotation layers failed loading."),ss=(0,y.iK)(B.Z.CursorTarget)`
  cursor: pointer;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  height: 22px;
  width: 22px;
`,ls=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    font-size: ${t.typography.sizes.l}px;
    font-weight: ${t.typography.weights.bold};
    margin-bottom: ${t.gridUnit}px;
    display: flex;
    max-width: 100%;
    align-items: flex-start;
    min-height: 0;

    & > .header-title {
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      flex-grow: 1;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;

      & > span.ant-tooltip-open {
        display: inline;
      }
    }

    & > .header-controls {
      display: flex;

      & > * {
        margin-left: ${2*t.gridUnit}px;
      }
    }

    .dropdown.btn-group {
      pointer-events: none;
      vertical-align: top;
      & > * {
        pointer-events: auto;
      }
    }

    .dropdown-toggle.btn.btn-default {
      background: none;
      border: none;
      box-shadow: none;
    }

    .dropdown-menu.dropdown-menu-right {
      top: ${5*t.gridUnit}px;
    }

    .divider {
      margin: ${t.gridUnit}px 0;
    }

    .refresh-tooltip {
      display: block;
      height: ${4*t.gridUnit}px;
      margin: ${t.gridUnit}px 0;
      color: ${t.colors.text.label};
    }
  `}}
`,ds=e=>{let{innerRef:t=null,forceRefresh:n=(()=>({})),updateSliceName:i=(()=>({})),toggleExpandSlice:o=(()=>({})),logExploreChart:a=(()=>({})),logEvent:l,exportCSV:d=(()=>({})),editMode:u=!1,annotationQuery:h={},annotationError:p={},cachedDttm:g=null,updatedDttm:m=null,isCached:f=[],isExpanded:v=!1,sliceName:b="",supersetCanExplore:y=!1,supersetCanShare:S=!1,supersetCanCSV:C=!1,sliceCanEdit:Z=!1,exportFullCSV:w,slice:R,componentId:k,dashboardId:T,addSuccessToast:D,addDangerToast:_,handleToggleFullSize:I,isFullSize:$,chartStatus:M,formData:E,width:F,height:O}=e;const z=(0,r.I0)(),P=(0,bi.fG)(),U=(0,s.useContext)(rs.DashboardPageIdContext),[N,A]=(0,s.useState)(null),q=(0,s.useRef)(null),L=(0,r.v9)((e=>{var t,n;return null==(t=e.dataMask[null==R?void 0:R.slice_id])||null==(n=t.filterState)?void 0:n.value})),j=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.crossFiltersEnabled})),V=(0,s.useMemo)((()=>({value:L,name:(0,c.t)("Emitted values")})),[L]),K=!u&&y;(0,s.useEffect)((()=>{const e=q.current;K?A(aa(b)):e&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight)?A(null!=b?b:null):A(null)}),[b,F,O,K]);const B=`/explore/?dashboard_page_id=${U}&slice_id=${R.slice_id}`;return(0,x.tZ)(ls,{ref:t},(0,x.tZ)("div",{className:"header-title",ref:q},(0,x.tZ)(X.u,{title:N},(0,x.tZ)(yi.Z,{title:b||(u?"---":""),canEdit:u,onSaveTitle:i,showTooltip:!1,url:K?B:void 0})),!!Object.values(h).length&&(0,x.tZ)(X.u,{id:"annotations-loading-tooltip",placement:"top",title:os},(0,x.tZ)("i",{role:"img","aria-label":os,className:"fa fa-refresh warning"})),!!Object.values(p).length&&(0,x.tZ)(X.u,{id:"annotation-errors-tooltip",placement:"top",title:as},(0,x.tZ)("i",{role:"img","aria-label":as,className:"fa fa-exclamation-circle danger"}))),(0,x.tZ)("div",{className:"header-controls"},!u&&(0,x.tZ)(s.Fragment,null,L&&(0,x.tZ)(X.u,{placement:"top",title:(0,x.tZ)(Na,{indicator:V,text:(0,c.t)("Click to clear emitted filters")})},(0,x.tZ)(ss,{onClick:()=>z((0,ct.ze)(null==R?void 0:R.slice_id))})),!P.hideChartControls&&(0,x.tZ)(is,{chartId:R.slice_id}),!P.hideChartControls&&(0,x.tZ)(wa,{slice:R,isCached:f,isExpanded:v,cachedDttm:g,updatedDttm:m,toggleExpandSlice:o,forceRefresh:n,logExploreChart:a,logEvent:l,exportCSV:d,exportFullCSV:w,supersetCanExplore:y,supersetCanShare:S,supersetCanCSV:C,sliceCanEdit:Z,componentId:k,dashboardId:T,addSuccessToast:D,addDangerToast:_,handleToggleFullSize:I,isFullSize:$,isDescriptionExpanded:v,chartStatus:M,formData:E,exploreUrl:B,crossFiltersEnabled:j}))))},cs={height:d().number.isRequired};function us(e){let{height:t}=e;return(0,x.tZ)("div",{className:"missing-chart-container",style:{height:t+20}},(0,x.tZ)("div",{className:"missing-chart-body"},(0,c.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,x.tZ)("br",null),(0,x.tZ)("br",null),(0,c.t)("Delete this container and save to remove this message.")))}us.propTypes=cs;var hs=n(20194);const ps={id:d().number.isRequired,componentId:d().string.isRequired,dashboardId:d().number.isRequired,width:d().number.isRequired,height:d().number.isRequired,updateSliceName:d().func.isRequired,isComponentVisible:d().bool,handleToggleFullSize:d().func.isRequired,setControlValue:d().func,chart:W.$6.isRequired,formData:d().object.isRequired,labelColors:d().object,sharedLabelColors:d().object,datasource:d().object,slice:W.Rw.isRequired,sliceName:d().string.isRequired,timeout:d().number.isRequired,maxRows:d().number.isRequired,filterboxMigrationState:d().oneOf(Object.keys(Y.Qi).map((e=>Y.Qi[e]))),filters:d().object.isRequired,refreshChart:d().func.isRequired,logEvent:d().func.isRequired,toggleExpandSlice:d().func.isRequired,changeFilter:d().func.isRequired,setFocusedFilterField:d().func.isRequired,unsetFocusedFilterField:d().func.isRequired,editMode:d().bool.isRequired,isExpanded:d().bool.isRequired,isCached:d().bool,supersetCanExplore:d().bool.isRequired,supersetCanShare:d().bool.isRequired,supersetCanCSV:d().bool.isRequired,sliceCanEdit:d().bool.isRequired,addSuccessToast:d().func.isRequired,addDangerToast:d().func.isRequired,ownState:d().object,filterState:d().object,postTransformProps:d().func,datasetsStatus:d().oneOf(["loading","error","complete"]),isInView:d().bool,emitCrossFilters:d().bool},gs=Object.keys(ps).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),ms=new Set(["filter_box"]),fs=y.iK.div`
  overflow: hidden;
  position: relative;

  &.dashboard-chart--overflowable {
    overflow: visible;
  }
`,vs=y.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  }
`,bs=y.iK.div`
  display: flex;
  flex-direction: column;
  max-height: 100%;
`;class ys extends s.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(ft.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.onExploreChart=async e=>{const t=e.shiftKey||e.ctrlKey||e.metaKey;try{const e=window.localStorage.getItem("last_tab_id"),n=e?String(Number.parseInt(e,10)+1):void 0,i=await(0,vi.nv)(this.props.datasource.id,this.props.datasource.type,this.props.formData,this.props.slice.slice_id,n),r=(0,gi.y8)(null,{[St.KD.formDataKey.name]:i,[St.KD.sliceId.name]:this.props.slice.slice_id});(0,u.c)(u.T.DASHBOARD_EDIT_CHART_IN_NEW_TAB)||t?window.open(r,"_blank","noreferrer"):this.props.history.push(r)}catch(e){Zt.Z.error(e),this.props.addDangerToast((0,c.t)("An error occurred while opening Explore"))}},this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this),this.getChartHeight=this.getChartHeight.bind(this),this.getDescriptionHeight=this.getDescriptionHeight.bind(this)}shouldComponentUpdate(e,t){var n,i,r,o,a,s,l,d,c;if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!hi()(e.datasource,this.props.datasource))return!0;if((null==(n=this.props)||null==(i=n.chart)?void 0:i.chartStatus)!==(null==e||null==(r=e.chart)?void 0:r.chartStatus)&&"loading"===(null==(o=this.props)||null==(a=o.chart)?void 0:a.chartStatus))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height&&e.width===this.state.width&&e.height===this.state.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<gs.length;t+=1){const n=gs[t];if(!(0,fi.JB)(e[n],this.props[n]))return!0}}else if((null==(s=e.formData)?void 0:s.color_scheme)!==(null==(l=this.props.formData)?void 0:l.color_scheme)||!(0,fi.JB)(null==(d=e.formData)?void 0:d.label_colors,null==(c=this.props.formData)?void 0:c.label_colors))return!0;return this.props.cacheBusterProp!==e.cacheBusterProp}componentDidMount(){if(this.props.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}getDescriptionHeight(){return this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0}getChartHeight(){const e=this.getHeaderHeight();return Math.max(this.state.height-e-this.state.descriptionHeight,20)}getHeaderHeight(){if(this.headerRef){const e=getComputedStyle(this.headerRef).getPropertyValue("margin-bottom"),t=parseInt(e,10)||0;return this.headerRef.offsetHeight+t}return 22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e){void 0===e&&(e={}),this.props.logEvent(ft.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e){void 0===e&&(e=!1),this.props.logEvent(ft.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,gi.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv",force:!0,ownState:this.props.ownState})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(ft.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){var e;const{id:t,componentId:n,dashboardId:i,chart:r,slice:o,datasource:s,isExpanded:l,editMode:d,filters:c,formData:u,labelColors:h,sharedLabelColors:p,updateSliceName:g,sliceName:m,toggleExpandSlice:f,timeout:v,supersetCanExplore:y,supersetCanShare:S,supersetCanCSV:C,sliceCanEdit:Z,addSuccessToast:w,addDangerToast:R,ownState:k,filterState:T,handleToggleFullSize:D,isFullSize:_,setControlValue:I,filterboxMigrationState:$,postTransformProps:M,datasetsStatus:E,isInView:F,emitCrossFilters:O,logEvent:z}=this.props,{width:P}=this.state;if(!r||!o)return(0,x.tZ)(us,{height:this.getChartHeight()});const{queriesResponse:U,chartUpdateEndTime:N,chartStatus:A}=r,q="loading"===A,L="filter_box"===o.viz_type&&a()(e=[Y.Qi.REVIEWING,Y.Qi.CONVERTED]).call(e,$),j=(null==U?void 0:U.map((e=>{let{is_cached:t}=e;return t})))||[],V=(null==U?void 0:U.map((e=>{let{cached_dttm:t}=e;return t})))||[],K=ms.has(o.viz_type),B=(0,Gt.Z3)(t)?function(e){let{activeFilters:t={},filterId:n}=e;return Object.entries(t).reduce(((e,t)=>{const[i,{values:r}]=t,{chartId:o,column:a}=(0,hs._)(i);return o===n?{...e,[a]:r}:e}),{})}({activeFilters:c,filterId:t}):{};return(0,x.tZ)(bs,{className:"chart-slice","data-test-chart-id":t,"data-test-viz-type":o.viz_type,"data-test-chart-name":o.slice_name},(0,x.tZ)(ds,{innerRef:this.setHeaderRef,slice:o,isExpanded:l,isCached:j,cachedDttm:V,updatedDttm:N,toggleExpandSlice:f,forceRefresh:this.forceRefresh,editMode:d,annotationQuery:r.annotationQuery,logExploreChart:this.logExploreChart,logEvent:z,onExploreChart:this.onExploreChart,exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:g,sliceName:m,supersetCanExplore:y,supersetCanShare:S,supersetCanCSV:C,sliceCanEdit:Z,componentId:n,dashboardId:i,filters:c,addSuccessToast:w,addDangerToast:R,handleToggleFullSize:D,isFullSize:_,chartStatus:r.chartStatus,formData:u,width:P,height:this.getHeaderHeight()}),l&&o.description_markeddown&&(0,x.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:o.description_markeddown}}),(0,x.tZ)(fs,{className:b()("dashboard-chart",K&&"dashboard-chart--overflowable")},(q||L)&&(0,x.tZ)(vs,{className:b()(L&&"is-deactivated"),style:{width:P,height:this.getChartHeight()}}),(0,x.tZ)(mi.Z,{width:P,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:r.annotationData,chartAlert:r.chartAlert,chartId:t,chartStatus:A,datasource:s,dashboardId:i,initialValues:B,formData:u,labelColors:h,sharedLabelColors:p,ownState:k,filterState:T,queriesResponse:r.queriesResponse,timeout:v,triggerQuery:r.triggerQuery,vizType:o.viz_type,setControlValue:I,isDeactivatedViz:L,filterboxMigrationState:$,postTransformProps:M,datasetsStatus:E,isInView:F,emitCrossFilters:O})))}}ys.propTypes=ps,ys.defaultProps={isCached:!1,isComponentVisible:!0};const xs=(0,pi.EN)(ys);var Ss=n(9531);const Cs={},Zs=(0,r.$j)((function(e,t){var n,i,r,o,a;let{charts:s,dashboardInfo:l,dashboardState:d,dataMask:c,datasources:u,sliceEntities:h,nativeFilters:p,common:g}=e;const{id:m,extraControls:f,setControlValue:v}=t,b=s[m]||Cs,y=b&&b.form_data&&u[b.form_data.datasource]||Ss.tw,{colorScheme:x,colorNamespace:S,datasetsStatus:C}=d,Z=(null==l||null==(n=l.metadata)?void 0:n.label_colors)||{},w=(null==l||null==(i=l.metadata)?void 0:i.shared_label_colors)||{},R=(0,ci.Z)({chart:b,chartConfiguration:null==(r=l.metadata)?void 0:r.chart_configuration,charts:s,filters:(0,Gt._f)(m),colorScheme:x,colorNamespace:S,sliceId:m,nativeFilters:null==p?void 0:p.filters,allSliceIds:d.sliceIds,dataMask:c,extraControls:f,labelColors:Z,sharedLabelColors:w});return R.dashboardId=l.id,{chart:b,datasource:y,labelColors:Z,sharedLabelColors:w,slice:h.slices[m],timeout:l.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,Gt.De)()||Cs,formData:R,editMode:d.editMode,isExpanded:!!d.expandedSlices[m],supersetCanExplore:!!l.superset_can_explore,supersetCanShare:!!l.superset_can_share,supersetCanCSV:!!l.superset_can_csv,sliceCanEdit:!!l.slice_can_edit,ownState:null==(o=c[m])?void 0:o.ownState,filterState:null==(a=c[m])?void 0:a.filterState,maxRows:g.conf.SQL_MAX_ROW,setControlValue:v,filterboxMigrationState:d.filterboxMigrationState,datasetsStatus:C,emitCrossFilters:!!l.crossFiltersEnabled}}),(function(e){return(0,i.DE)({updateComponents:Hn.WZ,addSuccessToast:Wn.ws,addDangerToast:Wn.Gb,toggleExpandSlice:Bn.WL,changeFilter:li.M6,setFocusedFilterField:Bn.GH,unsetFocusedFilterField:Bn.oY,refreshChart:di.refreshChart,logEvent:Yn.logEvent},e)}))(xs),ws=e=>{let{onDelete:t}=e;return(0,x.tZ)(ei,{onClick:t,icon:(0,x.tZ)(B.Z.Trash,{iconSize:"xl"})})},Rs=y.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.m}};
  }

  .hover-menu--left {
    width: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${e=>{let{theme:t}=e;return-7*t.gridUnit}}px;
    padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
  }

  .hover-menu--top {
    height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
    top: ${e=>{let{theme:t}=e;return-6*t.gridUnit}}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class ks extends s.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,x.tZ)(Rs,{className:"hover-menu-container"},(0,x.tZ)("div",{ref:e,className:b()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}ks.defaultProps={position:"left",innerRef:null,children:null};var Ts=n(29119);const Ds={right:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,x.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},_s={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},Is={widthAndHeight:_s,widthOnly:{..._s,bottomRight:!1,bottom:!1},heightOnly:{..._s,bottomRight:!1,right:!1},notAdjustable:{..._s,bottomRight:!1,bottom:!1,right:!1}},$s=Number.MAX_VALUE,Ms={id:d().string.isRequired,children:d().node,adjustableWidth:d().bool,adjustableHeight:d().bool,gutterWidth:d().number,widthStep:d().number,heightStep:d().number,widthMultiple:d().number,heightMultiple:d().number,minWidthMultiple:d().number,maxWidthMultiple:d().number,minHeightMultiple:d().number,maxHeightMultiple:d().number,staticHeight:d().number,staticHeightMultiple:d().number,staticWidth:d().number,staticWidthMultiple:d().number,onResizeStop:d().func,onResize:d().func,onResizeStart:d().func,editMode:d().bool.isRequired},Es={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:H.es,widthStep:H.cd,heightStep:H.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:$s,minHeightMultiple:1,maxHeightMultiple:$s,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},Fs=[H.cd,H.cd],Os={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"},zs=(0,y.iK)(Ts.e)`
  ${e=>{let{theme:t}=e;return x.iv`
    &.resizable-container {
      background-color: transparent;
      position: relative;

      /* re-resizable sets an empty div to 100% width and height, which doesn't
      play well with many 100% height containers we need */

      & ~ div {
        width: auto !important;
        height: auto !important;
      }
    }

    &.resizable-container--resizing {
      /* after ensures border visibility on top of any children */

      &:after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        box-shadow: inset 0 0 0 2px ${t.colors.primary.base};
      }

      & > span .resize-handle {
        border-color: ${t.colors.primary.base};
      }
    }

    .resize-handle {
      opacity: 0;
      z-index: 10;

      &--bottom-right {
        position: absolute;
        border-right: 1px solid ${t.colors.text.label};
        border-bottom: 1px solid ${t.colors.text.label};
        right: ${4*t.gridUnit}px;
        bottom: ${4*t.gridUnit}px;
        width: ${2*t.gridUnit}px;
        height: ${2*t.gridUnit}px;
      }

      &--right {
        width: ${t.gridUnit/2}px;
        height: ${5*t.gridUnit}px;
        right: ${t.gridUnit}px;
        top: 50%;
        transform: translate(0, -50%);
        position: absolute;
        border-left: 1px solid ${t.colors.text.label};
        border-right: 1px solid ${t.colors.text.label};
      }

      &--bottom {
        height: ${t.gridUnit/2}px;
        width: ${5*t.gridUnit}px;
        bottom: ${t.gridUnit}px;
        left: 50%;
        transform: translate(-50%);
        position: absolute;
        border-top: 1px solid ${t.colors.text.label};
        border-bottom: 1px solid ${t.colors.text.label};
      }
    }
  `}}

  &.resizable-container:hover .resize-handle,
  &.resizable-container--resizing .resize-handle {
    opacity: 1;
  }

  .dragdroppable-column & .resizable-container-handle--right {
    /* override the default because the inner column's handle's mouse target is very small */
    right: 0 !important;
  }

  & .resizable-container-handle--bottom {
    bottom: 0 !important;
  }
`;class Ps extends s.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:i,onResizeStart:r}=this.props;r&&r({id:i,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:i,id:r}=this.props;i&&i({id:r,direction:t,ref:n})}handleResizeStop(e,t,n,i){const{id:r,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(i.width/(a+h)),t=d+Math.round(i.height/s);o({id:r,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:i,heightStep:r,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:g,gutterWidth:m,editMode:f}=this.props,v={width:t?(i+m)*o-m:c&&c*i||d||void 0,height:n?r*a:l&&l*r||s||void 0};let y=Is.notAdjustable;f&&t&&n?y=Is.widthAndHeight:f&&t?y=Is.widthOnly:f&&n&&(y=Is.heightOnly);const{isResizing:S}=this.state;return(0,x.tZ)(zs,{enable:y,grid:Fs,minWidth:t?u*(i+m)-m:void 0,minHeight:n?p*r:void 0,maxWidth:t?Math.max(v.width,Math.min($s,h*(i+m)-m)):void 0,maxHeight:n?Math.max(v.height,Math.min($s,g*r)):void 0,size:v,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:Ds,className:b()("resizable-container",S&&"resizable-container--resizing"),handleClasses:Os},e)}}Ps.propTypes=Ms,Ps.defaultProps=Es;const Us=Ps;function Ns(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),i=e.split("-")[0];if(t[i.toLowerCase()]=e,!a()(H.Ep).call(H.Ep,i))break}}return t}const As=x.iv`
  && {
    position: fixed;
    z-index: 3000;
    left: 0;
    top: 0;
  }
`;var qs=n(78186);const Ls=(0,y.iK)(xt.v.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
    }

    &.active {
      font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
      background: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var js={name:"s5xdrg",styles:"display:flex;align-items:center"};const Vs=e=>{const{value:t,options:n,onChange:i,renderButton:r=(e=>e.label),renderOption:o=(e=>(0,x.tZ)("div",{className:e.className},e.label))}=e,a=(0,y.Fg)(),s=n.find((e=>e.value===t));return(0,x.tZ)(V.Gj,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,x.tZ)(xt.v,{onClick:e=>{let{key:t}=e;return i(t)}},n.map((e=>(0,x.tZ)(Ls,{id:"menu-item",key:e.value,className:b()("dropdown-item",{active:e.value===t})},o(e)))))},(0,x.tZ)("div",{role:"button",css:js},s&&r(s),(0,x.tZ)(B.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,x.iv)({marginTop:.5*a.gridUnit},"","")})))},Ks=[{value:"edit",label:(0,c.t)("Edit")},{value:"preview",label:(0,c.t)("Preview")}];class Bs extends s.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,x.tZ)(Vs,{id:e,options:Ks,value:t,onChange:n})}}const Hs=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    position: relative;
    outline: none;

    &.with-popover-menu--focused:after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 2px solid ${t.colors.primary.base};
      pointer-events: none;
    }

    .dashboard-component-tabs li &.with-popover-menu--focused:after {
      top: ${-3*t.gridUnit}px;
      left: ${-2*t.gridUnit}px;
      width: calc(100% + ${4*t.gridUnit}px);
      height: calc(100% + ${7*t.gridUnit}px);
    }
  `}}
`,Ws=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    position: absolute;
    flex-wrap: nowrap;
    left: 1px;
    top: -42px;
    height: ${10*t.gridUnit}px;
    padding: 0 ${4*t.gridUnit}px;
    background: ${t.colors.grayscale.light5};
    box-shadow: 0 1px 2px 1px
      ${(0,S.Zf)(t.colors.grayscale.dark2,parseFloat(t.opacity.mediumLight)/100)};
    font-size: ${t.typography.sizes.m}px;
    cursor: default;
    z-index: 3000;

    &,
    .menu-item {
      display: flex;
      flex-direction: row;
      align-items: center;
    }

    /* vertical spacer after each menu item */
    .menu-item:not(:last-child):after {
      content: '';
      width: 1px;
      height: 100%;
      background: ${t.colors.grayscale.light2};
      margin: 0 ${4*t.gridUnit}px;
    }
  `}}
`;class Ys extends s.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:i}=this.props,r=n(e,this.container);i||!r||this.state.isFocused?!r&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:i,style:r}=this.props,{isFocused:o}=this.state;return(0,x.tZ)(Hs,{ref:this.setRef,onClick:this.handleClick,role:"none",className:b()("with-popover-menu",i&&o&&"with-popover-menu--focused"),style:r},t,i&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,x.tZ)(Ws,null,n.map(((e,t)=>(0,x.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}Ys.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const Js={id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,logEvent:d().func.isRequired,addDangerToast:d().func.isRequired,undoLength:d().number.isRequired,redoLength:d().number.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,deleteComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired,htmlSanitization:d().bool,htmlSchemaOverrides:d().object},Gs="# Header 1\n## Header 2\n### Header 3\n\n<br />\n\nClick here to learn more about [markdown formatting](https://bit.ly/1dQOfRK)",Qs=(0,c.t)("This markdown component has an error."),Xs=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    &.dashboard-markdown {
      overflow: hidden;

      h4,
      h5,
      h6 {
        font-weight: ${t.typography.weights.normal};
      }

      h5 {
        color: ${t.colors.grayscale.base};
      }

      h6 {
        font-size: ${t.typography.sizes.s}px;
      }

      .dashboard-component-chart-holder {
        overflow-y: auto;
        overflow-x: hidden;
      }

      .dashboard--editing & {
        cursor: move;
      }
    }
  `}}
`;class el extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=ft.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(ft.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:ft.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:i,markdownSource:r,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==i||s.meta.code===r?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&Tt.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,c.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:i}=this.props,r="edit"===t;i(e),n&&r&&this.updateMarkdownContent()}renderEditMode(){return(0,x.tZ)(Tt.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:Gs,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,x.tZ)(qs.Z,{source:e?Qs:this.state.markdownSource||Gs,htmlSanitization:this.props.htmlSanitization,htmlSchemaOverrides:this.props.htmlSchemaOverrides})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:i,index:r,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,h=i.type===m.BA?i.meta.width||H.cx:n.meta.width||H.cx,p="edit"===t;return(0,x.tZ)(Oe,{component:n,parentComponent:i,orientation:i.type===m.Os?"column":"row",index:r,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(t=>{let{dropIndicatorProps:r,dragSourceRef:o}=t;return(0,x.tZ)(Ys,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,x.tZ)(Bs,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,x.tZ)(Xs,{className:b()("dashboard-markdown",p&&"dashboard-markdown--editing"),id:n.id},(0,x.tZ)(Us,{id:n.id,adjustableWidth:i.type===m.Os,adjustableHeight:!0,widthStep:s,widthMultiple:h,heightStep:H.cd,heightMultiple:n.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.AA,maxWidthMultiple:a+h,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,x.tZ)("div",{ref:o,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,x.tZ)(ks,{position:"top"},(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent})),u&&p?this.renderEditMode():this.renderPreviewMode()))),r&&(0,x.tZ)("div",r))}))}}el.propTypes=Js,el.defaultProps={};const tl=(0,r.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length,htmlSanitization:e.common.conf.HTML_SANITIZATION,htmlSchemaOverrides:e.common.conf.HTML_SANITIZATION_SCHEMA_EXTENSIONS}}))(el),nl=y.iK.div`
  ${e=>{let{theme:t,position:n}=e;return x.iv`
    height: ${5*t.gridUnit}px;
    overflow: hidden;
    cursor: move;
    ${"top"===n&&x.iv`
      transform: rotate(90deg);
    `}
    & path {
      fill: ${t.colors.grayscale.base};
    }
  `}}
`;function il(e){let{position:t="left",innerRef:n=null}=e;return(0,x.tZ)(nl,{ref:n,position:t},(0,x.tZ)(B.Z.Drag,null))}var rl=n(713);const ol=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: inline-block;

    &:before {
      content: '';
      width: 1em;
      height: 1em;
      margin-right: ${2*t.gridUnit}px;
      display: inline-block;
      vertical-align: middle;
    }

    &.background--white {
      padding-left: 0;
      background: transparent;

      &:before {
        background: ${t.colors.grayscale.light5};
        border: 1px solid ${t.colors.grayscale.light2};
      }
    }

    /* Create the transparent rect icon */
    &.background--transparent:before {
      background-image: linear-gradient(
          45deg,
          ${t.colors.text.label} 25%,
          transparent 25%
        ),
        linear-gradient(-45deg, ${t.colors.text.label} 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, ${t.colors.text.label} 75%),
        linear-gradient(-45deg, transparent 75%, ${t.colors.text.label} 75%);
      background-size: ${2*t.gridUnit}px ${2*t.gridUnit}px;
      background-position: 0 0, 0 ${t.gridUnit}px,
        ${t.gridUnit}px ${-t.gridUnit}px, ${-t.gridUnit}px 0px;
    }
  `}}
`;function al(e){const t=(0,c.t)("background");return(0,x.tZ)(ol,{className:b()("background-style-option",e.className)},`${e.label} ${t}`)}function sl(e){return(0,x.tZ)(ol,{className:b()("background-style-option",e.className)},e.label)}class ll extends s.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,x.tZ)(Vs,{id:e,options:rl.Z,value:t,onChange:n,renderButton:al,renderOption:sl})}}const dl={id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,minColumnWidth:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,deleteComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired},cl=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    &.grid-column {
      width: 100%;
      position: relative;

      & > :not(.hover-menu):not(:last-child) {
        margin-bottom: ${4*t.gridUnit}px;
      }
    }

    .dashboard--editing &:after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1;
      pointer-events: none;
      border: 1px dashed ${t.colors.grayscale.light2};
    }
    .dashboard--editing .resizable-container--resizing:hover > &:after,
    .dashboard--editing .hover-menu:hover + &:after {
      border: 1px dashed ${t.colors.primary.base};
      z-index: 2;
    }
  `}}
`,ul=e=>x.iv`
  min-height: ${25*e.gridUnit}px;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${e.colors.text.label};
`;class hl extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:u,editMode:h,onChangeTab:p,isComponentVisible:g}=this.props,m=e.children||[],f=rl.Z.find((t=>t.value===(e.meta.background||H.HE)));return(0,x.tZ)(Oe,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:u,editMode:h},(t=>{let{dropIndicatorProps:n,dragSourceRef:u}=t;return(0,x.tZ)(Us,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:r,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:i+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:h},(0,x.tZ)(Ys,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,x.tZ)(ll,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:h},h&&(0,x.tZ)(ks,{innerRef:u,position:"top"},(0,x.tZ)(il,{position:"top"}),(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent}),(0,x.tZ)(ei,{onClick:this.handleChangeFocus,icon:(0,x.tZ)(B.Z.Cog,{iconSize:"xl"})})),(0,x.tZ)(cl,{className:b()("grid-column",f.className)},0===m.length?(0,x.tZ)("div",{css:ul},(0,c.t)("Empty column")):m.map(((t,n)=>(0,x.tZ)(Gl,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:g,onChangeTab:p}))),n&&(0,x.tZ)("div",n))))}))}}hl.propTypes=dl,hl.defaultProps={};const pl=hl,gl={id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,depth:d().number.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,editMode:d().bool.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired},ml=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    width: 100%;
    padding: ${2*t.gridUnit}px 0; /* this is padding not margin to enable a larger mouse target */
    background-color: transparent;

    &:after {
      content: '';
      height: 1px;
      width: 100%;
      background-color: ${t.colors.grayscale.light2};
      display: block;
    }

    div[draggable='true'] & {
      cursor: move;
    }

    .dashboard-component-tabs & {
      padding-left: ${4*t.gridUnit}px;
      padding-right: ${4*t.gridUnit}px;
    }
  `}}
`;class fl extends s.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:i,handleComponentDrop:r,editMode:o}=this.props;return(0,x.tZ)(Oe,{component:e,parentComponent:n,orientation:"row",index:i,depth:t,onDrop:r,editMode:o},(e=>{let{dropIndicatorProps:t,dragSourceRef:n}=e;return(0,x.tZ)("div",{ref:n},o&&(0,x.tZ)(ks,{position:"left"},(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent})),(0,x.tZ)(ml,{className:"dashboard-component dashboard-component-divider"}),t&&(0,x.tZ)("div",t))}))}}fl.propTypes=gl;const vl=fl;var bl=n(79271);const yl={id:d().string.isRequired,dashboardId:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,depth:d().number.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,editMode:d().bool.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired},xl=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    font-weight: ${t.typography.weights.bold};
    width: 100%;
    padding: ${4*t.gridUnit}px 0;

    &.header-small {
      font-size: ${t.typography.sizes.l}px;
    }

    &.header-medium {
      font-size: ${t.typography.sizes.xl}px;
    }

    &.header-large {
      font-size: ${t.typography.sizes.xxl}px;
    }

    .dashboard--editing .dashboard-grid & {
      &:after {
        border: 1px dashed transparent;
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
        pointer-events: none;
      }

      &:hover:after {
        border: 1px dashed ${t.colors.primary.base};
        z-index: 2;
      }
    }

    .dashboard--editing .dragdroppable-row & {
      cursor: move;
    }

    /**
   * grids add margin between items, so don't double pad within columns
   * we'll not worry about double padding on top as it can serve as a visual separator
   */
    .grid-column > :not(:last-child) & {
      margin-bottom: ${-4*t.gridUnit}px;
    }

    .background--white &,
    &.background--white,
    .dashboard-component-tabs & {
      padding-left: ${4*t.gridUnit}px;
      padding-right: ${4*t.gridUnit}px;
    }
  `}}
`;class Sl extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{dashboardId:t,component:n,depth:i,parentComponent:r,index:o,handleComponentDrop:a,editMode:s}=this.props,l=bl.Z.find((e=>e.value===(n.meta.headerSize||H.u_))),d=rl.Z.find((e=>e.value===(n.meta.background||H.HE)));return(0,x.tZ)(Oe,{component:n,parentComponent:r,orientation:"row",index:o,depth:i,onDrop:a,disableDragDrop:e,editMode:s},(e=>{let{dropIndicatorProps:r,dragSourceRef:o}=e;return(0,x.tZ)("div",{ref:o},s&&i<=2&&(0,x.tZ)(ks,{position:"left"},(0,x.tZ)(il,{position:"left"})),(0,x.tZ)(Ys,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,x.tZ)(Vs,{id:`${n.id}-header-style`,options:bl.Z,value:n.meta.headerSize,onChange:this.handleChangeSize}),(0,x.tZ)(ll,{id:`${n.id}-background`,value:n.meta.background,onChange:this.handleChangeBackground})],editMode:s},(0,x.tZ)(xl,{className:b()("dashboard-component","dashboard-component-header",l.className,d.className)},s&&(0,x.tZ)(ks,{position:"top"},(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent})),(0,x.tZ)(yi.Z,{title:n.meta.text,canEdit:s,onSaveTitle:this.handleChangeText,showTooltip:!1}),!s&&(0,x.tZ)(ai,{id:n.id,dashboardId:t}))),r&&(0,x.tZ)("div",r))}))}}Sl.propTypes=yl,Sl.defaultProps={};const Cl=Sl;var Zl=n(71894);const wl={id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,editMode:d().bool.isRequired,availableColumnCount:d().number.isRequired,columnWidth:d().number.isRequired,occupiedColumnCount:d().number.isRequired,onResizeStart:d().func.isRequired,onResize:d().func.isRequired,onResizeStop:d().func.isRequired,handleComponentDrop:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired},Rl=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    position: relative;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    align-items: flex-start;
    width: 100%;
    height: fit-content;

    & > :not(:last-child):not(.hover-menu) {
      margin-right: ${4*t.gridUnit}px;
    }

    &.grid-row--empty {
      min-height: ${25*t.gridUnit}px;
    }
  `}}
`,kl=e=>x.iv`
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: ${e.colors.text.label};
`;class Tl extends s.PureComponent{constructor(e){super(e),this.state={isFocused:!1,isInView:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.containerRef=s.createRef(),this.observerEnabler=null,this.observerDisabler=null}componentDidMount(){if((0,u.c)(u.T.DASHBOARD_VIRTUALIZATION)&&!(0,Zl.b)()){this.observerEnabler=new IntersectionObserver((e=>{let[t]=e;t.isIntersecting&&!this.state.isInView&&this.setState({isInView:!0})}),{rootMargin:"100% 0px"}),this.observerDisabler=new IntersectionObserver((e=>{let[t]=e;!t.isIntersecting&&this.state.isInView&&this.setState({isInView:!1})}),{rootMargin:"400% 0px"});const e=this.containerRef.current;e&&(this.observerEnabler.observe(e),this.observerDisabler.observe(e))}}componentWillUnmount(){var e,t;null==(e=this.observerEnabler)||e.disconnect(),null==(t=this.observerDisabler)||t.disconnect()}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:u,editMode:h,onChangeTab:p,isComponentVisible:g}=this.props,m=e.children||[],f=rl.Z.find((t=>t.value===(e.meta.background||H.HE)));return(0,x.tZ)(Oe,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:u,editMode:h},(t=>{let{dropIndicatorProps:n,dragSourceRef:u}=t;return(0,x.tZ)(Ys,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,x.tZ)(ll,{id:`${e.id}-background`,value:f.value,onChange:this.handleChangeBackground})],editMode:h},h&&(0,x.tZ)(ks,{innerRef:u,position:"left"},(0,x.tZ)(il,{position:"left"}),(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent}),(0,x.tZ)(ei,{onClick:this.handleChangeFocus,icon:(0,x.tZ)(B.Z.Cog,{iconSize:"xl"})})),(0,x.tZ)(Rl,{className:b()("grid-row",0===m.length&&"grid-row--empty",f.className),ref:this.containerRef},0===m.length?(0,x.tZ)("div",{css:kl},(0,c.t)("Empty row")):m.map(((t,n)=>(0,x.tZ)(Gl,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:i-o,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:g,onChangeTab:p,isInView:this.state.isInView}))),n&&(0,x.tZ)("div",n)))}))}}Tl.propTypes=wl;const Dl=Tl;var _l=n(94301);const Il="RENDER_TAB",$l="RENDER_TAB_CONTENT",Ml={dashboardId:d().number.isRequired,id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,renderType:d().oneOf([Il,$l]).isRequired,onDropOnTab:d().func,onHoverTab:d().func,editMode:d().bool.isRequired,canEdit:d().bool.isRequired,availableColumnCount:d().number,columnWidth:d().number,onResizeStart:d().func,onResize:d().func,onResizeStop:d().func,handleComponentDrop:d().func.isRequired,updateComponents:d().func.isRequired,setDirectPathToChild:d().func.isRequired,setEditMode:d().func.isRequired},El={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onHoverTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},Fl=y.iK.div`
  ${e=>{let{isHighlighted:t,theme:{gridUnit:n,colors:i}}=e;return`\n    padding: ${n}px ${2*n}px;\n    margin: ${-n}px ${-2*n}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${t&&`box-shadow: 0 0 ${n}px ${i.primary.light1};`}\n  `}}
`,Ol=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),zl=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--top"});class Pl extends s.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleOnHover=this.handleOnHover.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab(e){let{pathToTabIndex:t}=e;this.props.setDirectPathToChild(t)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleOnHover(){this.props.onHoverTab()}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,editMode:l,isComponentVisible:d,canEdit:u,setEditMode:h,dashboardId:p}=this.props,g=0===e.children.length;return(0,x.tZ)("div",{className:"dashboard-component-tabs-content"},l&&(0,x.tZ)(Oe,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},zl),g&&(0,x.tZ)(_l.x3,{title:l?(0,c.t)("Drag and drop components to this tab"):(0,c.t)("There are no components added to this tab"),description:u&&(l?(0,x.tZ)("span",null,(0,c.t)("You can")," ",(0,x.tZ)("a",{href:`/chart/add?dashboard_id=${p}`,rel:"noopener noreferrer",target:"_blank"},(0,c.t)("create a new chart"))," ",(0,c.t)("or use existing ones from the panel on the right")):(0,x.tZ)("span",null,(0,c.t)("You can add the components in the")," ",(0,x.tZ)("span",{role:"button",tabIndex:0,onClick:()=>h(!0)},(0,c.t)("edit mode")))),image:"chart.svg"}),e.children.map(((t,l)=>(0,x.tZ)(Gl,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,onHover:this.handleOnHover,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:d,onChangeTab:this.handleChangeTab}))),l&&(0,x.tZ)(Oe,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,onHover:this.handleOnHover,editMode:!0,className:"empty-droptarget"},Ol))}renderTab(){const{component:e,parentComponent:t,index:n,depth:i,editMode:r,isFocused:o,isHighlighted:a}=this.props;return(0,x.tZ)(Oe,{component:e,parentComponent:t,orientation:"column",index:n,depth:i,onDrop:this.handleDrop,onHover:this.handleOnHover,editMode:r},(t=>{let{dropIndicatorProps:i,dragSourceRef:s}=t;return(0,x.tZ)(Fl,{isHighlighted:a,className:"dragdroppable-tab",ref:s},(0,x.tZ)(yi.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:r&&o,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:r&&o}),!r&&(0,x.tZ)(ai,{id:e.id,dashboardId:this.props.dashboardId,placement:n>=5?"left":"right"}),i&&(0,x.tZ)("div",i))}))}render(){const{renderType:e}=this.props;return e===Il?this.renderTab():this.renderTabContent()}}Pl.propTypes=Ml,Pl.defaultProps=El;const Ul=(0,r.$j)((function(e){return{canEdit:e.dashboardInfo.dash_edit_perm}}),(function(e){return(0,i.DE)({setEditMode:Bn.Mb},e)}))(Pl);function Nl(e){let{currentComponent:t,directPathToChild:n=[]}=e;if(!t||0===n.length||-1===n.indexOf(t.id))return-1;const i=n.findIndex((e=>e===t.id)),r=n[i+1];return t.children.indexOf(r)>=0?t.children.findIndex((e=>e===r)):-1}function Al(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function ql(e){if(void 0===e&&(e=[]),e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!a()(H.Ep).call(H.Ep,n))return e}}return null}const Ll={id:d().string.isRequired,parentId:d().string.isRequired,component:W.cP.isRequired,parentComponent:W.cP.isRequired,index:d().number.isRequired,depth:d().number.isRequired,renderTabContent:d().bool,editMode:d().bool.isRequired,renderHoverMenu:d().bool,directPathToChild:d().arrayOf(d().string),activeTabs:d().arrayOf(d().string),filterboxMigrationState:d().oneOf(Object.keys(Y.Qi).map((e=>Y.Qi[e]))),logEvent:d().func.isRequired,setActiveTabs:d().func,availableColumnCount:d().number,columnWidth:d().number,onResizeStart:d().func,onResize:d().func,onResizeStop:d().func,createComponent:d().func.isRequired,handleComponentDrop:d().func.isRequired,onChangeTab:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired},jl={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,activeTabs:[],directPathToChild:[],filterboxMigrationState:Y.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},Vl=y.iK.div`
  width: 100%;
  background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};

  .dashboard-component-tabs-content {
    min-height: ${e=>{let{theme:t}=e;return 12*t.gridUnit}}px;
    margin-top: ${e=>{let{theme:t}=e;return t.gridUnit/4}}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${e=>{let{theme:t}=e;return 12.5*t.gridUnit}}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class Kl extends s.PureComponent{constructor(e){super(e),this.getTabInfo=e=>{var t;let n=Math.max(0,Nl({currentComponent:e.component,directPathToChild:e.directPathToChild}));0===n&&null!=(t=e.activeTabs)&&t.length&&e.component.children.forEach(((t,i)=>{var r;0===n&&a()(r=e.activeTabs).call(r,t)&&(n=i)}));const{children:i}=e.component,r=i[n];return{tabIndex:n,activeKey:r}},this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;V.xT.confirm({title:(0,c.t)("Delete dashboard tab?"),content:(0,x.tZ)("span",null,(0,c.t)("Deleting a tab will remove all content within it. You may still reverse this action with the")," ",(0,x.tZ)("b",null,(0,c.t)("undo"))," ",(0,c.t)("button (cmd + z) until you save your changes.")),onOk:()=>{n(e,t.id);const i=t.children.indexOf(e);this.handleDeleteTab(i)},okType:"danger",okText:(0,c.t)("DELETE"),cancelText:(0,c.t)("CANCEL"),icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:i}=this.props;"add"===t?(null==e||null==e.stopPropagation||e.stopPropagation(),i({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:H.Xk,type:m.gn}})):"remove"===t&&this.showDeleteConfirmModal(e)};const{tabIndex:t,activeKey:n}=this.getTabInfo(e);this.state={tabIndex:t,activeKey:n},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,i=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),e.dashboardId!==this.props.dashboardId){const{tabIndex:t,activeKey:n}=this.getTabInfo(e);this.setState((()=>({tabIndex:t,activeKey:n})))}if(e.isComponentVisible){const t=ql(e.directPathToChild),r=ql(this.props.directPathToChild);if(t!==r||t===r&&n!==i){const t=Nl({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:i[t]})))}}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=Al(t,e),i=n[n.length-1];this.props.logEvent(ft.Iq,{target_id:i,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.state.tabIndex===e&&this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==m.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:i,availableColumnCount:r,columnWidth:o,onResizeStart:s,onResize:l,onResizeStop:d,renderTabContent:c,renderHoverMenu:u,isComponentVisible:h,editMode:p,nativeFilters:g}=this.props,{children:m}=t,{tabIndex:f,activeKey:v}=this.state;let b;const y=(null==g?void 0:g.focusedFilterId)||(null==g?void 0:g.hoveredFilterId);var S;return y&&(b=null==(S=g.filters[y])?void 0:S.tabsInScope),(0,x.tZ)(Oe,{component:t,parentComponent:n,orientation:"row",index:i,depth:e,onDrop:this.handleDrop,editMode:p},(i=>{let{dropIndicatorProps:g,dragSourceRef:y}=i;return(0,x.tZ)(Vl,{className:"dashboard-component dashboard-component-tabs"},p&&u&&(0,x.tZ)(ks,{innerRef:y,position:"left"},(0,x.tZ)(il,{position:"left"}),(0,x.tZ)(ws,{onDelete:this.handleDeleteComponent})),(0,x.tZ)(w.cl,{id:t.id,activeKey:v,onChange:e=>{this.handleClickTab(m.indexOf(e))},onEdit:this.handleEdit,type:p?"editable-card":"card"},m.map(((n,i)=>{var u;return(0,x.tZ)(w.cl.TabPane,{key:n,tab:(0,x.tZ)(Gl,{id:n,parentId:t.id,depth:e,index:i,renderType:Il,availableColumnCount:r,columnWidth:o,onDropOnTab:this.handleDropOnTab,onHoverTab:()=>this.handleClickTab(i),isFocused:v===n,isHighlighted:v!==n&&(null==(u=b)?void 0:a()(u).call(u,n))})},c&&(0,x.tZ)(Gl,{id:n,parentId:t.id,depth:e,index:i,renderType:$l,availableColumnCount:r,columnWidth:o,onResizeStart:s,onResize:l,onResizeStop:d,onDropOnTab:this.handleDropOnTab,isComponentVisible:f===i&&h}))}))),g&&n.id!==H._4&&(0,x.tZ)("div",g))}))}}Kl.propTypes=Ll,Kl.defaultProps=jl;const Bl=(0,r.$j)((function(e){return{nativeFilters:e.nativeFilters,activeTabs:e.dashboardState.activeTabs,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(Kl),Hl={[m.dW]:e=>{let{id:t,parentId:n,component:i,parentComponent:o,index:l,depth:d,availableColumnCount:c,columnWidth:u,onResizeStart:h,onResize:p,onResizeStop:g,editMode:f,isComponentVisible:v,dashboardId:S,fullSizeChartId:C,getComponentById:Z=(()=>{}),deleteComponent:w,updateComponents:R,handleComponentDrop:k,setFullSizeChartId:T,isInView:D}=e;const{chartId:_}=i.meta,I=C===_,$=(e=>{var t;const n=(0,y.Fg)(),i=(0,r.v9)((e=>e.nativeFilters)),o=((e,t)=>{if(!e.focusedFilterField)return null;const{chartId:n,column:i}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[i]}})((0,r.v9)((e=>e.dashboardState)),(0,r.v9)((e=>e.dashboardFilters))),s=(null==i?void 0:i.focusedFilterId)||(null==i?void 0:i.hoveredFilterId);if(!o&&!s)return{};const l={borderColor:n.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*n.gridUnit}px ${n.colors.primary.base}`,pointerEvents:"auto"};var d,c;if(s){if(null!=(d=i.filters[s])&&null!=(c=d.chartsInScope)&&a()(c).call(c,e))return l}else if(e===(null==o?void 0:o.chartId)||a()(t=(0,Gt.up)({filterScope:null==o?void 0:o.scope})).call(t,e))return l;return{opacity:.3,pointerEvents:"none"}})(_),M=(0,r.v9)((e=>e.dashboardState)),[E,F]=(0,s.useState)({}),[O,z]=(0,s.useState)(),[P,U]=(0,s.useState)(),[N,A]=(0,s.useState)(0),q=(0,s.useMemo)((()=>{var e;return null!=(e=null==M?void 0:M.directPathToChild)?e:[]}),[M]),L=(0,s.useMemo)((()=>{var e;return null!=(e=null==M?void 0:M.directPathLastUpdated)?e:0}),[M]),j=(0,s.useMemo)((()=>Ns(q)),[q]);(0,s.useEffect)((()=>{const{label:e,chart:t}=j;L!==N&&i.id===t&&(A(L),z(i.id),U(e))}),[i,N,L,j]),(0,s.useEffect)((()=>{let e;return O&&(e=setTimeout((()=>{z(void 0),U(void 0)}),2e3)),()=>{e&&clearTimeout(e)}}),[O]);const V=(0,s.useMemo)((()=>{var e,t,n;const r=null==(e=Z(null==(n=o.parents)?void 0:n.find((e=>e.startsWith(m.BA)))))||null==(t=e.meta)?void 0:t.width;let a=i.meta.width||H.cx;return o.type===m.BA?a=o.meta.width||H.cx:r&&a>r&&(a=r),a}),[i,Z,o.meta.width,o.parents,o.type]),{chartWidth:K,chartHeight:B}=(0,s.useMemo)((()=>{let e=0,t=0;return I?(e=window.innerWidth-32,t=window.innerHeight-32):(e=Math.floor(V*u+(V-1)*H.es-32),t=Math.floor(i.meta.height*H.cd-32)),{chartWidth:e,chartHeight:t}}),[u,i,I,V]),W=(0,s.useCallback)((()=>{w(t,n)}),[w,t,n]),Y=(0,s.useCallback)((e=>{R({[i.id]:{...i,meta:{...i.meta,sliceNameOverride:e}}})}),[i,R]),J=(0,s.useCallback)((()=>{T(I?null:_)}),[_,I,T]),G=(0,s.useCallback)(((e,t)=>{F((n=>({...n,[e]:t})))}),[]);return(0,x.tZ)(Oe,{component:i,parentComponent:o,orientation:o.type===m.Os?"column":"row",index:l,depth:d,onDrop:k,disableDragDrop:!1,editMode:f},(e=>{let{dropIndicatorProps:t,dragSourceRef:n}=e;return(0,x.tZ)(Us,{id:i.id,adjustableWidth:o.type===m.Os,adjustableHeight:!0,widthStep:u,widthMultiple:V,heightStep:H.cd,heightMultiple:i.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.AA,maxWidthMultiple:c+V,onResizeStart:h,onResize:p,onResizeStop:g,editMode:f},(0,x.tZ)("div",{ref:n,style:$,css:I?As:void 0,className:b()("dashboard-component","dashboard-component-chart-holder",`dashboard-chart-id-${_}`,O?"fade-in":"fade-out")},!f&&(0,x.tZ)(ai,{id:i.id,scrollIntoView:O===i.id}),!!O&&(0,x.tZ)("style",null,`label[for=${P}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n                  }`),(0,x.tZ)(Zs,{componentId:i.id,id:i.meta.chartId,dashboardId:S,width:K,height:B,sliceName:i.meta.sliceNameOverride||i.meta.sliceName||"",updateSliceName:Y,isComponentVisible:v,handleToggleFullSize:J,isFullSize:I,setControlValue:G,extraControls:E,isInView:D}),f&&(0,x.tZ)(ks,{position:"top"},(0,x.tZ)("div",null,(0,x.tZ)(ws,{onDelete:W})))),t&&(0,x.tZ)("div",t))}))},[m.xh]:tl,[m.BA]:pl,[m.hE]:vl,[m.Nc]:Cl,[m.Os]:Dl,[m.gn]:Ul,[m.yR]:Bl,[m.t]:e=>{let{component:t,parentComponent:n,index:i,depth:o,handleComponentDrop:a,editMode:l,columnWidth:d,availableColumnCount:u,onResizeStart:h,onResizeStop:p,onResize:g,deleteComponent:f,parentId:v,updateComponents:y,id:S}=e;const C=n.type===m.BA?n.meta.width||H.cx:t.meta.width||H.cx,Z=()=>{f(S,v)},w=rl.Z.find((e=>e.value===(t.meta.background||H.HE))),{Component:R}=Ge.get(t.meta.componentKey),k=(0,r.v9)((e=>{let{nativeFilters:t,dataMask:n}=e;return{nativeFilters:t,dataMask:n}}));return(0,x.tZ)(Oe,{component:t,parentComponent:n,orientation:n.type===m.Os?"column":"row",index:i,depth:o,onDrop:a,editMode:l},(e=>{let{dropIndicatorProps:i,dragSourceRef:r}=e;return(0,x.tZ)(Ys,{menuItems:[(0,x.tZ)(ll,{id:`${t.id}-background`,value:t.meta.background,onChange:e=>{return"background",n=e,void y({[t.id]:{...t,meta:{...t.meta,background:n}}});var n}})],editMode:l},(0,x.tZ)("div",{className:b()("dashboard-component",`dashboard-${t.componentKey}`,null==w?void 0:w.className),id:t.id},(0,x.tZ)(Us,{id:t.id,adjustableWidth:n.type===m.Os,widthStep:d,widthMultiple:C,heightStep:H.cd,adjustableHeight:!1,heightMultiple:t.meta.height,minWidthMultiple:H.cx,minHeightMultiple:H.cx,maxWidthMultiple:u+C,onResizeStart:h,onResize:g,onResizeStop:p},(0,x.tZ)("div",{ref:r,className:"dashboard-component"},l&&(0,x.tZ)(ks,{position:"top"},(0,x.tZ)(ws,{onDelete:Z})),(0,x.tZ)(s.Suspense,{fallback:(0,x.tZ)("div",null,(0,c.t)("Loading..."))},(0,x.tZ)(R,{dashboardData:k}))))),i&&(0,x.tZ)("div",i))}))}};var Wl=n(72673);const Yl={id:d().string,parentId:d().string,depth:d().number,index:d().number,renderHoverMenu:d().bool,renderTabContent:d().bool,onChangeTab:d().func,component:W.cP.isRequired,parentComponent:W.cP.isRequired,createComponent:d().func.isRequired,deleteComponent:d().func.isRequired,updateComponents:d().func.isRequired,handleComponentDrop:d().func.isRequired,logEvent:d().func.isRequired,directPathToChild:d().arrayOf(d().string),directPathLastUpdated:d().number,dashboardId:d().number.isRequired,isComponentVisible:d().bool};class Jl extends s.PureComponent{render(){const{component:e}=this.props,t=e?Hl[e.type]:null;return t?(0,x.tZ)(t,this.props):null}}Jl.propTypes=Yl,Jl.defaultProps={isComponentVisible:!0};const Gl=(0,r.$j)((function(e,t){let{dashboardLayout:n,dashboardState:i,dashboardInfo:r}=e;const o=n.present,{id:a,parentId:s}=t,l=o[a],d={component:l,getComponentById:e=>o[e],parentComponent:o[s],editMode:i.editMode,filters:(0,Gt.De)(),dashboardId:r.id,fullSizeChartId:i.fullSizeChartId};if(l){const e=l.type;if(e===m.Os||e===m.BA){const{occupiedWidth:t,minimumWidth:n}=(0,Wl.Z)({id:a,components:o});e===m.Os&&(d.occupiedColumnCount=t),e===m.BA&&(d.minColumnWidth=n)}}return d}),(function(e){return(0,i.DE)({addDangerToast:Wn.Gb,createComponent:Hn.LM,deleteComponent:Hn.v7,updateComponents:Hn.WZ,handleComponentDrop:Hn._p,setDirectPathToChild:Bn.E2,setFullSizeChartId:Bn.zL,setActiveTabs:Bn.$_,logEvent:Yn.logEvent},e)}))(Jl);var Ql=n(52004),Xl=n(90057),ed=n(8868),td=n(6954);const nd=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),id=(e,t)=>{var n;const i=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==i},rd=tr("filter-bar");var od=n(24350),ad=n.n(od),sd=n(63105),ld=n.n(sd);const dd=()=>(0,r.v9)((e=>e.nativeFilters.filterSets||{})),cd=()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,r.v9)((e=>e.nativeFilters.filters));return(0,s.useMemo)((()=>Object.entries(t).reduce(((t,n)=>{let[i,r]=n;return{...t,[i]:{...r,preselect:null==e?void 0:e[i]}}}),{})),[t,e])},ud=()=>{const e=(0,r.v9)((e=>e.dataMask));return(0,s.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(Ko.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])};var hd=n(81788),pd=n(37731);const gd=e=>x.iv`
  display: flex;

  && > .filter-clear-all-button {
    color: ${e.colors.grayscale.base};
    margin-left: 0;
    &:hover {
      color: ${e.colors.primary.dark1};
    }

    &[disabled],
    &[disabled]:hover {
      color: ${e.colors.grayscale.light1};
    }
  }
`,md=(e,t)=>x.iv`
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  position: fixed;
  z-index: 100;

  // filter bar width minus 1px for border
  width: ${t-1}px;
  bottom: 0;

  padding: ${4*e.gridUnit}px;
  padding-top: ${6*e.gridUnit}px;

  background: linear-gradient(
    ${(0,Z.rgba)(e.colors.grayscale.light5,0)},
    ${e.colors.grayscale.light5} ${e.opacity.mediumLight}
  );

  & > button {
    pointer-events: auto;
  }

  & > .filter-apply-button {
    margin-bottom: ${3*e.gridUnit}px;
  }
`,fd=e=>x.iv`
  align-items: center;
  margin-left: auto;
  && > .filter-clear-all-button {
    text-transform: capitalize;
    font-weight: ${e.typography.weights.normal};
  }
  & > .filter-apply-button {
    &[disabled],
    &[disabled]:hover {
      color: ${e.colors.grayscale.light1};
      background: ${e.colors.grayscale.light3};
    }
  }
`,vd=e=>{let{width:t=Ss.I6,onApply:n,onClearAll:i,dataMaskApplied:r,dataMaskSelected:o,isApplyDisabled:a,filterBarOrientation:l=Ql.B.VERTICAL}=e;const d=(0,s.useMemo)((()=>Object.values(r).some((e=>{var t,n,i;return(0,pd.Z)(null==(t=o[e.id])||null==(n=t.filterState)?void 0:n.value)||!o[e.id]&&(0,pd.Z)(null==(i=e.filterState)?void 0:i.value)}))),[r,o]),u=l===Ql.B.VERTICAL;return(0,x.tZ)("div",{css:e=>[gd(e),u?md(e,t):fd(e)]},(0,x.tZ)(K.Z,G()({disabled:a,buttonStyle:"primary",htmlType:"submit",className:"filter-apply-button",onClick:n},rd("apply-button")),u?(0,c.t)("Apply filters"):(0,c.t)("Apply")),(0,x.tZ)(K.Z,G()({disabled:!d,buttonStyle:"link",buttonSize:"small",className:"filter-clear-all-button",onClick:i},rd("clear-button")),(0,c.t)("Clear all")))};var bd,yd=n(90731),xd=(bd=function(e,t){return bd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},bd(e,t)},function(e,t){function n(){this.constructor=e}bd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Sd="html",Cd="svg",Zd=function(e,t){var n,i,r,o={};if(e===Sd)r=document.createElement("div");else{if(e!==Cd)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');r=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"==typeof t)for(var a=0,s=Object.entries(t.attributes);a<s.length;a++){var l=s[a],d=l[0],c=l[1];r.setAttribute(d,c)}var u={element:r,elementType:e,setPortalProps:function(e){o=e},getInitialPortalProps:function(){return o},mount:function(t,r){if(r!==i){if(u.unmount(),t!==n&&!function(e,t){if(t===Sd)return e instanceof HTMLElement;if(t===Cd)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(u.element,r),n=t,i=r}},unmount:function(e){e&&e!==i||n&&i&&(n.replaceChild(i,u.element),n=void 0,i=void 0)}};return u},wd=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return xd(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,i=t.node;return yd.createPortal(s.Children.map(n,(function(t){return s.isValidElement(t)?s.cloneElement(t,e.state.nodeProps):t})),i.element)},t}(s.PureComponent),Rd=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=s.createRef(),n.passPropsThroughPortal(),n}return xd(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode.setPortalProps({}),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){var e=this.props.node;e.unmount(this.placeholderNode.current),e.setPortalProps({})},t.prototype.render=function(){return s.createElement("div",{ref:this.placeholderNode})},t}(s.PureComponent),kd=Zd.bind(null,Sd),Td=(Zd.bind(null,Cd),n(99612)),Dd=n(82607);const _d=(0,s.forwardRef)(((e,t)=>{let{items:n,onOverflowingStateChange:i,dropdownContent:r,dropdownRef:o,dropdownStyle:a={},dropdownTriggerCount:l,dropdownTriggerIcon:d,dropdownTriggerText:u=(0,c.t)("More"),dropdownTriggerTooltip:h=null,style:p}=e;const g=(0,y.Fg)(),{ref:m,width:f=0}=(0,Td.NB)(),v=(0,Vo.D)(f)||0,{current:b}=m,[S,C]=(0,s.useState)([]),[Z,w]=(0,s.useState)(!1),[R,k]=s.useState(-1);let T=(0,s.useRef)(null);o&&(T=o);const[D,_]=(0,s.useState)(!1),I=e=>e.reduce(((e,t)=>{let[n,i]=e;return n.push({id:t.id,element:s.cloneElement(t.element,{key:t.id})}),i.push(t.id),[n,i]}),[[],[]]),[$,M]=(0,s.useMemo)((()=>I(n.slice(0,-1!==R?R:n.length))),[n,R]),[E,F]=(0,s.useMemo)((()=>-1!==R?I(n.slice(R)):[[],[]]),[n,R]);(0,s.useLayoutEffect)((()=>{const e=null==b?void 0:b.children.item(0);if(e){const{children:t}=e,i=Array.from(t);if(S.length!==n.length){if(i.length!==n.length)return void k(-1);C(i.map((e=>e.getBoundingClientRect().width)))}const r=i.findIndex((t=>t.getBoundingClientRect().right>e.getBoundingClientRect().right+1));let o=-1===r&&E.length>0?n.length-E.length:r;if(f>v){const e=null==b?void 0:b.children.item(1),t=(null==e?void 0:e.getBoundingClientRect().right)||0,r=((null==b?void 0:b.getBoundingClientRect().right)||0)-t;let a=0;for(let e=i.length;e<n.length&&(a+=S[e],a<=r);e+=1)o=e+1}k(o)}}),[b,n.length,S,E.length,v,f]),(0,s.useEffect)((()=>{i&&i({notOverflowed:M,overflowed:F})}),[M,i,F]);const O=-1!==R?n.length-R:0,z=(0,s.useMemo)((()=>r||O?(0,x.tZ)("div",{css:x.iv`
              display: flex;
              flex-direction: column;
              gap: ${4*g.gridUnit}px;
            `,style:a,ref:T},r?r(E):E.map((e=>e.element))):null),[r,O,g.gridUnit,a,E]);return(0,s.useLayoutEffect)((()=>{Z&&setTimeout((()=>{T.current&&_(T.current.scrollHeight>500)}),100)}),[Z]),(0,s.useImperativeHandle)(t,(()=>({...m.current,open:()=>w(!0)})),[m]),(0,s.useEffect)((()=>(document.onscroll=Z?()=>w(!1):null,()=>{document.onscroll=null})),[Z]),(0,x.tZ)("div",{ref:m,css:x.iv`
          display: flex;
          align-items: center;
        `},(0,x.tZ)("div",{css:x.iv`
            display: flex;
            align-items: center;
            gap: ${4*g.gridUnit}px;
            margin-right: ${4*g.gridUnit}px;
            min-width: 0px;
          `,style:p},$.map((e=>e.element))),z&&(0,x.tZ)(s.Fragment,null,(0,x.tZ)(x.xB,{styles:x.iv`
                .ant-popover-inner-content {
                  max-height: ${500}px;
                  overflow: ${D?"auto":"visible"};
                  padding: ${3*g.gridUnit}px ${4*g.gridUnit}px;

                  // Some OS versions only show the scroll when hovering.
                  // These settings will make the scroll always visible.
                  ::-webkit-scrollbar {
                    -webkit-appearance: none;
                    width: 14px;
                  }
                  ::-webkit-scrollbar-thumb {
                    border-radius: 9px;
                    background-color: ${g.colors.grayscale.light1};
                    border: 3px solid transparent;
                    background-clip: content-box;
                  }
                  ::-webkit-scrollbar-track {
                    background-color: ${g.colors.grayscale.light4};
                    border-left: 1px solid ${g.colors.grayscale.light2};
                  }
                }
              `}),(0,x.tZ)(ti.ZP,{content:z,trigger:"click",visible:Z,onVisibleChange:e=>w(e),placement:"bottom",destroyTooltipOnHide:!0},(0,x.tZ)(X.u,{title:h},(0,x.tZ)(K.Z,{buttonStyle:"secondary"},d,u,(0,x.tZ)(Dd.Z,{count:null!=l?l:O,color:(null!=l?l:O)>0?g.colors.primary.base:g.colors.grayscale.light1,showZero:!0,css:x.iv`
                      margin-left: ${2*g.gridUnit}px;
                    `}),(0,x.tZ)(B.Z.DownOutlined,{iconSize:"m",iconColor:g.colors.grayscale.light1,css:x.iv`
                      .anticon {
                        display: flex;
                      }
                    `}))))))})),Id=_d,$d=e=>{let{filtersOutOfScope:t,renderer:n,hasTopMargin:i,horizontalOverflow:r,forceRender:o=!1}=e;return(0,x.tZ)(V.Ol,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===t.length?"disabled":void 0,css:e=>r?(0,x.iv)("&.ant-collapse>.ant-collapse-item{&>.ant-collapse-header{padding:0;&>.ant-collapse-arrow{right:0;padding:0;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;margin-bottom:",-4*e.gridUnit,"px;}}",""):(0,x.iv)("&.ant-collapse{margin-top:",i?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,x.tZ)(V.Ol.Panel,{forceRender:o,header:(0,c.t)("Filters out of scope (%d)",t.length),key:"1"},t.map(n)))};var Md=n(63279),Ed=n(28368),Fd=n.n(Ed),Od=n(52794);const zd=T()(((e,t)=>{e(t?(0,Od.qN)(t):(0,Od.DU)())}),St.oP),Pd=T()(((e,t)=>{e(t?(0,Od.$7)(t):(0,Od.Up)())}),St.oP),Ud=()=>(0,r.v9)((e=>{var t;return{outlinedFilterId:null==(t=Ns(e.dashboardState.directPathToChild||[]))?void 0:t.native_filter,lastUpdated:e.dashboardState.directPathLastUpdated}})),Nd=y.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,Ad=[{data:[{}]}],qd=[Ci.cg.NATIVE_FILTER],Ld=e=>{var t,n,i;let{dataMaskSelected:o,filter:a,onFilterSelectionChange:l,inView:d=!0,showOverflow:h,parentRef:g,setFilterActive:m,orientation:f=Ql.B.VERTICAL,overflow:v=!1}=e;const{id:b,targets:y,filterType:S,adhoc_filters:C,time_range:Z}=a,w=(0,Si.Z)().get(S),R=function(e,t){const n=(0,r.v9)((t=>{var n;return null==(n=t.nativeFilters.filters[e])?void 0:n.cascadeParentIds}));return(0,s.useMemo)((()=>{let e={};return(0,Ni.Z)(n).forEach((n=>{const i=null==t?void 0:t[n];e=(0,Lr.on)(e,null==i?void 0:i.extraFormData)})),e}),[t,n])}(b,o),k=(()=>{const e=(0,r.v9)((e=>e.dashboardState.isRefreshing)),t=(0,r.v9)((e=>e.dashboardState.isFiltersRefreshing));return!e&&t})(),[T,D]=(0,s.useState)([]),[_,I]=(0,s.useState)(""),[$,M]=(0,s.useState)({inView:!1}),[E,F]=(0,s.useState)({}),[O,z]=(0,s.useState)(d),P=(0,s.useRef)(null),[U]=y,{datasetId:N,column:A={}}=U,{name:q}=A,L=!!N,[j,V]=(0,s.useState)(L),[K,B]=(0,s.useState)(!1),H=(0,r.I0)(),{outlinedFilterId:W,lastUpdated:Y}=Ud(),J=(0,s.useCallback)((()=>{B(!1),V(!1),k&&H((0,Bn.YC)())}),[H,k]);(0,s.useEffect)((()=>{!O&&d&&z(!0)}),[d,O,z]),(0,s.useEffect)((()=>{var e;if(!O)return;const t=(0,Lr.zi)({...a,datasetId:N,dependencies:R,groupby:q,adhoc_filters:C,time_range:Z}),n=(null==(e=a.dataMask)?void 0:e.ownState)||{};if(!K&&(!Fd()($,t,((e,t,n)=>"url_params"===n||void 0))||!hi()(E,n)||k)){if(M(t),F(n),!L)return;B(!0),(0,di.getChartDataRequest)({formData:t,force:!1,requestParams:{dashboardId:0},ownState:n}).then((e=>{let{response:t,json:n}=e;if((0,mt.cr)(u.T.GLOBAL_ASYNC_QUERIES)){const e="result"in n?n.result[0]:n;if(200===t.status)D([e]),J();else{if(202!==t.status)throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`);(0,Nr.YJ)(e).then((e=>{D(e),J()})).catch((e=>{I(e.message||e.error||(0,c.t)("Check configuration")),J()}))}}else D(n.result),I(""),J()})).catch((e=>{I(e.statusText),J()}))}}),[O,R,N,q,J,JSON.stringify(a),L,K,k]),(0,s.useEffect)((()=>{W&&W===a.id&&setTimeout((()=>{var e;null==P||null==(e=P.current)||e.focus()}),v?St.oP:0)}),[P,W,Y,a.id,v]);const G=(0,s.useCallback)((e=>l(a,e)),[a,l]),Q=(0,s.useCallback)((()=>{W!==b&&Pd(H,b)}),[H,b,W]),X=(0,s.useCallback)((()=>{Pd(H),W===b&&H((0,Bn.E2)([]))}),[H,b,W]),ee=(0,s.useCallback)((()=>zd(H,b)),[H,b]),te=(0,s.useCallback)((()=>zd(H)),[H]),ne=(0,s.useMemo)((()=>({setDataMask:G,setHoveredFilter:ee,unsetHoveredFilter:te,setFocusedFilter:Q,unsetFocusedFilter:X,setFilterActive:m})),[G,m,ee,te,Q,X]),ie=id(a,null==(t=a.dataMask)?void 0:t.filterState),re=(0,s.useMemo)((()=>{var e;return{...null==(e=a.dataMask)?void 0:e.filterState,validateStatus:ie&&"error"}}),[null==(n=a.dataMask)?void 0:n.filterState,ie]),oe=(0,s.useMemo)((()=>({filterBarOrientation:f,isOverflowingFilterBar:v})),[f,v]);return _?(0,x.tZ)(zr,{title:(0,c.t)("Cannot load filter"),body:_,level:"error"}):(0,x.tZ)(Nd,null,j?(0,x.tZ)(p.Z,{position:"inline-centered"}):(0,x.tZ)(no.Z,{height:32,width:"100%",showOverflow:h,formData:$,displaySettings:oe,parentRef:g,inputRef:P,queriesData:L?T:Ad,chartType:S,behaviors:qd,filterState:re,ownState:null==(i=a.dataMask)?void 0:i.ownState,enableNoResults:null==w?void 0:w.enableNoResults,isRefreshing:K,hooks:ne}))},jd=s.memo(Ld),Vd=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.text)||(null==e||null==(n=e.meta)?void 0:n.defaultText)||""},Kd=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.sliceNameOverride)||(null==e||null==(n=e.meta)?void 0:n.sliceName)||(null==e?void 0:e.id)||""},Bd=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: flex;
    align-items: center;
    margin: ${t.gridUnit}px 0;
    font-size: ${t.typography.sizes.s}px;

    &:first-of-type {
      margin-top: 0;
    }

    &:last-of-type {
      margin-bottom: 0;
    }

    & .ant-tooltip-open {
      display: inline-flex;
    }
  `}};
`,Hd=y.iK.span`
  ${e=>{let{theme:t}=e;return x.iv`
    color: ${t.colors.grayscale.base};
    padding-right: ${4*t.gridUnit}px;
    margin-right: auto;
    text-transform: uppercase;
    white-space: nowrap;
  `}};
`,Wd=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    color: ${t.colors.grayscale.dark1};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline;
  `}};
`,Yd=y.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Jd=y.iK.span`
  text-decoration: underline;
  cursor: pointer;
`,Gd=y.iK.span`
  ${e=>{let{theme:t}=e;return x.iv`
    color: ${t.colors.primary.base};
  `}}
`,Qd=y.iK.ul`
  ${e=>{let{theme:t}=e;return x.iv`
    padding-left: ${3*t.gridUnit}px;
    margin-bottom: 0;
  `}};
`,Xd=y.iK.span`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
`,ec=y.iK.div`
  min-width: 0;
  display: inline-flex;
  white-space: nowrap;
`,tc=y.iK.div`
  display: flex;
  align-items: center;
`,nc=e=>{let{title:t,children:n,...i}=e;return(0,x.tZ)(X.u,G()({title:t,placement:"bottom",overlayClassName:"filter-card-tooltip"},i),(0,x.tZ)(ec,null,n))},ic=(e,t)=>Array.isArray(e)&&e.length>0?(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Xd,null,t,":"),(0,x.tZ)(Qd,null,e.map((e=>(0,x.tZ)("li",null,e))))):null,rc=s.memo((e=>{let{filter:t}=e;const n=(e=>{const t=(0,r.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,r.v9)((e=>e.charts));return(0,s.useMemo)((()=>Object.values(e)),[e])})();return(0,s.useMemo)((()=>{var i;let r;const o=t[H._4].children[0];if(o.startsWith("TABS-")&&(r=t[o].children),0===e.scope.rootPath.length)return;if(0===e.scope.excluded.length&&(e.scope.rootPath[0]===H._4||null!=(i=r)&&i.every((t=>{var n;return a()(n=e.scope.rootPath).call(n,t)}))))return{all:[(0,c.t)("All charts")]};if(0===e.scope.excluded.length&&r)return{tabs:e.scope.rootPath.map((e=>Vd(t[e]))).filter(Boolean)};const s=Object.values(t).filter((e=>e.type===m.dW));if(e.scope.rootPath[0]===H._4)return{charts:n.filter((t=>{var n;return!a()(n=e.scope.excluded).call(n,t.id)})).map((e=>{const t=s.find((t=>t.meta.chartId===e.id));return Kd(t)})).filter(Boolean)};if(r){const i=[...e.scope.rootPath],r=s.filter((e=>e.parents.some((e=>a()(i).call(i,e)))));e.scope.excluded.forEach((e=>{const t=i.findIndex((t=>{var n,i;return null==(n=r.find((t=>t.meta.chartId===e)))?void 0:a()(i=n.parents).call(i,t)}));t>-1&&i.splice(t,1)}));const o=n.filter((t=>{var n;return!a()(n=e.scope.excluded).call(n,t.id)})).reduce(((e,t)=>{const n=r.find((e=>e.meta.chartId===t.id&&e.parents.every((e=>!a()(i).call(i,e)))));return n&&e.push(n),e}),[]);return{tabs:i.map((e=>Vd(t[e]))).filter(Boolean),charts:o.map(Kd).filter(Boolean)}}}),[n,e.scope.excluded,e.scope.rootPath,t])})(t),i=(0,s.useRef)(null),o=(0,s.useRef)(null),[l,d]=(0,Md.ro)(i,o),u=(0,s.useMemo)((()=>0!==l&&n?n.all?(0,x.tZ)("span",null,(0,c.t)("All charts")):(0,x.tZ)("div",null,ic(n.tabs,(0,c.t)("Tabs")),ic(n.charts,(0,c.t)("Charts"))):null),[l,n]);return(0,x.tZ)(Bd,null,(0,x.tZ)(Hd,null,(0,c.t)("Scope")),(0,x.tZ)(nc,{title:u},(0,x.tZ)(Wd,{ref:i},n?Object.values(n).flat().map(((e,t)=>(0,x.tZ)("span",{key:e},0===t?e:`, ${e}`))):(0,c.t)("None")),d>0&&(0,x.tZ)(Gd,{ref:o},"+",l)))})),oc=e=>{let{dependency:t,hasSeparator:n}=e;const i=(0,r.I0)(),o=(0,s.useCallback)((()=>{i((0,Bn.E2)([t.id]))}),[t.id,i]);return(0,x.tZ)("span",null,n&&(0,x.tZ)("span",null,", "),(0,x.tZ)(Jd,{role:"button",onClick:o,tabIndex:0},t.name))},ac=s.memo((e=>{let{filter:t}=e;const n=(e=>{const t=(0,Ni.Z)(e.cascadeParentIds);return(0,r.v9)((e=>0===t.length?[]:t.reduce(((t,n)=>(t.push(e.nativeFilters.filters[n]),t)),[])))})(t),i=(0,s.useRef)(null),o=(0,s.useRef)(null),[a,l]=(0,Md.ro)(i,o),d=(0,y.Fg)(),u=(0,s.useMemo)((()=>a>0&&n?(0,x.tZ)(Qd,null,n.map((e=>(0,x.tZ)("li",null,(0,x.tZ)(oc,{dependency:e}))))):null),[a,n]);return Array.isArray(n)&&0!==n.length?(0,x.tZ)(Bd,null,(0,x.tZ)(Hd,{css:x.iv`
          display: inline-flex;
          align-items: center;
        `},(0,c.t)("Dependent on")," ",(0,x.tZ)(nc,{title:(0,c.t)("Filter only displays values relevant to selections made in other filters.")},(0,x.tZ)(B.Z.Info,{iconSize:"m",iconColor:d.colors.grayscale.light1,css:x.iv`
              margin-left: ${d.gridUnit}px;
            `}))),(0,x.tZ)(nc,{title:u},(0,x.tZ)(Wd,{ref:i},n.map(((e,t)=>(0,x.tZ)(oc,{key:e.id,dependency:e,hasSeparator:0!==t})))),l&&(0,x.tZ)(Gd,{ref:o},"+",a))):null})),sc=(0,y.iK)(K.Z)`
  padding: 0;
`,lc=e=>{let{createNewOnOpen:t,dashboardId:n,initialFilterId:i,onClick:o,children:a}=e;const l=(0,r.I0)(),[d,c]=(0,s.useState)(!1),u=(0,s.useCallback)((()=>{c(!1)}),[c]),h=(0,s.useCallback)((async e=>{l(await(0,Od.RY)(e)),u()}),[l,u]),p=(0,s.useCallback)((()=>{c(!0),o&&o()}),[c,o]);return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(sc,G()({},rd("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:p}),a),(0,x.tZ)(ia,{isOpen:d,onSave:h,onCancel:u,initialFilterId:i,createNewOnOpen:t,key:`filters-for-${n}`}))},dc=s.memo(lc),cc=e=>{let{filter:t,hidePopover:n}=e;const i=(0,y.Fg)(),o=(0,s.useRef)(null),[a]=(0,Md.ro)(o),l=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.id})),d=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm}));return(0,x.tZ)(Bd,{css:e=>x.iv`
          margin-bottom: ${3*e.gridUnit}px;
          justify-content: space-between;
        `},(0,x.tZ)(tc,null,(0,x.tZ)(B.Z.FilterSmall,{css:e=>x.iv`
              margin-right: ${e.gridUnit}px;
            `}),(0,x.tZ)(nc,{title:a?t.name:null},(0,x.tZ)(Yd,{ref:o},t.name))),d&&(0,x.tZ)(lc,{dashboardId:l,onClick:n,initialFilterId:t.id},(0,x.tZ)(B.Z.Edit,{iconSize:"l",iconColor:i.colors.grayscale.light1})))},uc=e=>{let{filter:t}=e;const n=(0,s.useMemo)((()=>(0,Si.Z)().get(t.filterType)),[t.filterType]);return(0,x.tZ)(Bd,null,(0,x.tZ)(Hd,null,(0,c.t)("Filter type")),(0,x.tZ)(Wd,null,null==n?void 0:n.name))},hc=e=>{let{filter:t,hidePopover:n}=e;return(0,x.tZ)("div",null,(0,x.tZ)(cc,{filter:t,hidePopover:n}),(0,x.tZ)(uc,{filter:t}),(0,x.tZ)(rc,{filter:t}),(0,x.tZ)(ac,{filter:t}))},pc=e=>{let{children:t,filter:n,getPopupContainer:i,isVisible:r=!0,placement:o}=e;const[a,l]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{r||l(!1)}),[r]),(0,x.tZ)(ti.ZP,{placement:o,overlayClassName:"filter-card-popover",mouseEnterDelay:.2,mouseLeaveDelay:.2,onVisibleChange:e=>{l(r&&e)},visible:r&&a,content:(0,x.tZ)(hc,{filter:n,hidePopover:()=>{l(!1)}}),getPopupContainer:null!=i?i:()=>document.body},t)};var gc;!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(gc||(gc={}));const mc=(e,t)=>{const n=dd(),i=Object.values(n),r=(0,s.useMemo)((()=>!!i.find((t=>{let{name:n}=t;return n===e}))),[i,e]);return t!==e&&r},fc=y.iK.div`
  display: flex;
  & button {
    ${e=>{let{disabled:t}=e;return"pointer-events: "+(t?"none":"all")}};
    flex: 1;
  }
`,vc=y.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,bc=e=>{let{onCancel:t,editMode:n,onEdit:i,onCreate:r,disabled:o,filterSetName:a}=e;const l=mc(a),d=!a||l||o;return(0,x.tZ)(s.Fragment,null,n?(0,x.tZ)(vc,null,(0,x.tZ)(K.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,c.t)("Cancel")),(0,x.tZ)(X.u,{placement:"right",title:!a&&(0,c.t)("Please filter set name")||l&&(0,c.t)("Filter set with this name already exists")||o&&za},(0,x.tZ)(fc,{disabled:d},(0,x.tZ)(K.Z,G()({disabled:d,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:r},rd("create-filter-set-button")),(0,c.t)("Create"))))):(0,x.tZ)(X.u,{placement:"bottom",title:o&&za},(0,x.tZ)(fc,{disabled:o},(0,x.tZ)(K.Z,G()({disabled:o,buttonStyle:"tertiary",buttonSize:"small",onClick:i},rd("new-filter-set-button")),(0,c.t)("Create new filter set")))))},yc=y.iK.div`
  display: flex;
  align-items: center;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
`,xc=(0,y.iK)(V.Ol)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
      }
  }
`,Sc=y.iK.div`
  padding-top: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,Cc=e=>{let{dataMask:t,filterSet:n}=e;const i=(0,y.Fg)(),r=cd(),o=Object.values(r).filter(nr.kI);let s=null!=o?o:[];return null!=n&&n.nativeFilters&&(s=Object.values(null==n?void 0:n.nativeFilters).filter(nr.kI)),(0,x.tZ)(xc,{ghost:!0,expandIconPosition:"right",defaultActiveKey:n?void 0:["filters"],expandIcon:e=>{let{isActive:t}=e;const n=i.colors.grayscale.base,r=t?B.Z.CaretUpOutlined:B.Z.CaretDownOutlined;return(0,x.tZ)(r,{iconColor:n})}},(0,x.tZ)(V.Ol.Panel,G()({},rd("collapse-filter-set-description"),{header:(0,x.tZ)(yc,null,(0,x.tZ)(V.ZT.Text,{type:"secondary"},(0,c.t)("Filters (%d)",s.length))),key:"filters"}),s.map((e=>{var i,o,s,l,d,u;let{id:h,name:p}=e;const g=n&&!(0,fi.JB)(null==(i=r[h])?void 0:i.controlValues,null==n||null==(o=n.nativeFilters)||null==(s=o[h])?void 0:s.controlValues,{ignoreUndefined:!0}),m=!a()(l=Object.keys(r)).call(l,h);return(0,x.tZ)(V._e,{title:m&&(0,c.t)("This filter doesn't exist in dashboard. It will not be applied.")||g&&(0,c.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:h},(0,x.tZ)(Sc,null,(0,x.tZ)(V.ZT.Text,{strong:!0,delete:m,mark:g},p,":"),(0,x.tZ)(V.ZT.Text,{delete:m,mark:g},Pa(null==t||null==(d=t[h])||null==(u=d.filterState)?void 0:u.value)||(0,x.tZ)(V.ZT.Text,{type:"secondary"},(0,c.t)("None")))))}))))},Zc=(0,y.iK)(K.Z)`
  padding: 0;
`,wc=y.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,Rc=y.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${e=>{let{theme:t}=e;return`margin-left: ${2*t.gridUnit}px`}};
  }
`,kc=e=>{var t,n;let{editMode:i,setFilterSetName:r,onDelete:o,onEdit:a,filterSetName:l,dataMaskSelected:d,filterSet:u,isApplied:h,onRebuild:p}=e;const g=(0,y.Fg)(),m=(0,x.tZ)(xt.v,null,(0,x.tZ)(xt.v.Item,{onClick:a},(0,c.t)("Edit")),(0,x.tZ)(xt.v.Item,{onClick:p},(0,x.tZ)(X.u,{placement:"right",title:(0,c.t)("Remove invalid filters")},(0,c.t)("Rebuild"))),(0,x.tZ)(xt.v.Item,{onClick:o,danger:!0},(0,c.t)("Delete")));return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(wc,null,(0,x.tZ)(V.ZT.Text,{strong:!0,editable:{editing:i,icon:(0,x.tZ)("span",null),onChange:r}},null!=(t=null==u?void 0:u.name)?t:l),(0,x.tZ)(Rc,null,h&&(0,x.tZ)(B.Z.CheckOutlined,{iconSize:"m",iconColor:g.colors.success.base}),o&&(0,x.tZ)(V.Gj,{overlay:m,placement:"bottomRight",trigger:["click"]},(0,x.tZ)(Zc,G()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},rd("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,x.tZ)(B.Z.EllipsisOutlined,{iconSize:"m"}))))),(0,x.tZ)(Cc,{filterSet:u,dataMask:null!=(n=null==u?void 0:u.dataMask)?n:d}))},Tc=y.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${e=>{let{theme:t}=e;return 27*t.gridUnit}}px;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,Dc=y.iK.div`
  ${e=>{let{theme:t,"data-selected":n,onClick:i}=e;return`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${t.gridUnit}px;\n    border-bottom: 1px solid ${t.colors.grayscale.light2};\n    padding: ${2*t.gridUnit}px ${4*t.gridUnit}px;\n    cursor: ${i?"pointer":"auto"};\n    background: ${n?t.colors.primary.light5:"transparent"};\n  `}}
`,_c=(0,c.t)("New filter set"),Ic=e=>{let{dataMaskSelected:t,onEditFilterSet:n,disabled:i,onFilterSelectionChange:o,tab:a}=e;const l=(0,r.I0)(),[d,c]=(0,s.useState)(_c),[u,h]=(0,s.useState)(!1),p=ud(),g=dd(),m=Object.values(g),f=cd(),v=Object.values(f),[b,y]=(0,s.useState)(null);(0,s.useEffect)((()=>{var e;if(a===gc.AllFilters)return;if(!m.length)return void y(null);const n=Ua({dataMaskSelected:t,filterSetFilterValues:m});y(null!=(e=null==n?void 0:n.id)?e:null)}),[a,t,m]);const S=(e,t)=>{var n,i,r;return!v.find((t=>(null==t?void 0:t.id)===e))||!(0,fi.JB)(null==(n=f[e])?void 0:n.controlValues,null==t||null==(i=t.nativeFilters)||null==(r=i[e])?void 0:r.controlValues,{ignoreUndefined:!0})},C=(e,t)=>{var n;const i=null==t?void 0:t.target;if(i){var r;const e=i.closest(`[data-anchor=${rd("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(r=e.querySelector(".ant-collapse-header"))&&r.contains(i)||null!=i&&i.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=g[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:i}=e;S(i,a)||o({id:i},{extraFormData:t,filterState:n})}))};return(0,x.tZ)(Tc,null,!b&&(0,x.tZ)(Dc,null,(0,x.tZ)(kc,{dataMaskSelected:t,editMode:u,setFilterSetName:c,filterSetName:d}),(0,x.tZ)(bc,{filterSetName:d.trim(),disabled:i,onCancel:()=>{h(!1),c(_c)},editMode:u,onEdit:()=>h(!0),onCreate:()=>{const e={name:d.trim(),nativeFilters:f,dataMask:Object.keys(f).reduce(((e,t)=>({...e,[t]:p[t]})),{})};l((0,Od.xQ)(e)),h(!1),c(_c)}})),m.map((e=>(0,x.tZ)(Dc,G()({},rd("filter-set-wrapper"),{"data-anchor":rd("filter-set-wrapper",!0),"data-selected":e.id===b,onClick:t=>C(e.id,t),key:e.id}),(0,x.tZ)(kc,{isApplied:e.id===b&&!i,onDelete:()=>{return t=e.id,l((0,Od.$l)(t)),void(t===b&&y(null));var t},onEdit:()=>{return t=e.id,C(t),void n(t);var t},onRebuild:()=>(e=>{var t;const n=g[e],i=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!S(t,n)})).reduce(((e,t)=>({...e,[t.id]:f[t.id]})),{}),r={...n,nativeFilters:i,dataMask:Object.keys(i).reduce(((e,t)=>{var i;return{...e,[t]:null==(i=n.dataMask)?void 0:i[t]}}),{})};l((0,Od.ql)(r))})(e.id),dataMaskSelected:t,filterSet:e})))))},$c=y.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  background: ${e=>{let{theme:t}=e;return t.colors.primary.light4}};
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,Mc=(0,y.iK)(V.ZT.Text)`
  color: ${e=>{let{theme:t}=e;return t.colors.primary.dark2}};
`,Ec=(0,y.iK)(V.ZT.Text)`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  & .anticon {
    padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,Fc=y.iK.div`
  display: flex;
  & button {
    ${e=>{let{disabled:t}=e;return"pointer-events: "+(t?"none":"all")}};
    flex: 1;
  }
`,Oc=e=>{let{filterSetId:t,onCancel:n,dataMaskSelected:i,disabled:o}=e;const a=ud(),l=(0,r.I0)(),d=dd(),u=cd(),h=Object.values(d),[p,g]=(0,s.useState)(d[t].name),m=mc(p,d[t].name),f=(0,s.useMemo)((()=>Ua({dataMaskSelected:i,filterSetFilterValues:h})),[i,h]),v=f&&f.id!==t,b=o||v||m;return(0,x.tZ)($c,null,(0,x.tZ)(Mc,{strong:!0},(0,c.t)("Editing filter set:")),(0,x.tZ)(Mc,{editable:{editing:!0,icon:(0,x.tZ)("span",null),onChange:g}},p),(0,x.tZ)(vc,null,(0,x.tZ)(K.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:n},(0,c.t)("Cancel")),(0,x.tZ)(V._e,{placement:"right",title:m&&(0,c.t)("Filter set with this name already exists")||v&&(0,c.t)("Filter set already exists")||o&&za},(0,x.tZ)(Fc,{disabled:b},(0,x.tZ)(K.Z,G()({disabled:b,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{l((0,Od.ql)({id:t,name:p,nativeFilters:u,dataMask:{...a}})),n()}},rd("filter-set-edit-save")),(0,c.t)("Save"))))),v&&(0,x.tZ)(Ec,{mark:!0},(0,x.tZ)(B.Z.WarningOutlined,{iconSize:"m"}),(0,c.t)('This filter set is identical to: "%s"',null==f?void 0:f.name)))};var zc=n(21804),Pc=n.n(zc);const Uc=y.iK.div`
  .ant-btn-group {
    button.ant-btn {
      background-color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
      border-color: transparent;
      color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
      font-size: 12px;
      line-height: 13px;
      outline: none;
      text-transform: uppercase;
      &:first-of-type {
        border-radius: ${e=>{let{theme:t}=e;return`${t.gridUnit}px 0 0 ${t.gridUnit}px`}};
        margin: 0;
        width: 120px;
      }

      &:disabled {
        background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
        color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
      }
      &:nth-child(2) {
        margin: 0;
        border-radius: ${e=>{let{theme:t}=e;return`0 ${t.gridUnit}px ${t.gridUnit}px 0`}};
        width: ${e=>{let{theme:t}=e;return 9*t.gridUnit}}px;
        &:before,
        &:hover:before {
          border-left: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
          content: '';
          display: block;
          height: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
          margin: 0;
          position: absolute;
          width: ${e=>{let{theme:t}=e;return.25*t.gridUnit}}px;
        }

        &:disabled:before {
          border-left: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
        }
      }
    }
  }
`,{SubMenu:Nc}=xt.v,Ac=(0,y.iK)((e=>{let{overlay:t,tooltip:n,placement:i,...r}=e;const o=function(e){return void 0===e&&(e={}),(0,x.tZ)(Uc,null,(0,x.tZ)(V.Gj.Button,G()({overlay:t},r,e)))};return n?o({buttonsRender:e=>{let[t,r]=e;return[(0,x.tZ)(V._e,{placement:i,id:`${Pc()(n)}-tooltip`,title:n},t),r]}}):o()}))`
  button.ant-btn:first-of-type {
    display: none;
  }
  > button.ant-btn:nth-child(2) {
    display: inline-flex;
    background-color: transparent !important;
    height: unset;
    padding: 0;
    border: none;
    width: auto !important;

    .anticon {
      line-height: 0;
    }
    &:after {
      box-shadow: none !important;
    }
  }
`,qc=(0,y.iK)(xt.v)`
  ${e=>{let{theme:t}=e;return`\n    .info {\n      font-size: ${t.typography.sizes.s}px;\n      color: ${t.colors.grayscale.base};\n      padding: ${t.gridUnit}px ${3*t.gridUnit}px ${t.gridUnit}px ${3*t.gridUnit}px;\n    }\n    .ant-dropdown-menu-item-selected {\n      color: ${t.colors.grayscale.dark1};\n      background-color: ${t.colors.primary.light5};\n    }\n  `}}
`,Lc=(0,y.iK)(xt.v.Item)`
  display: flex;
  justify-content: space-between;
  > span {
    width: 100%;
  }
  border-bottom: ${e=>{let{divider:t,theme:n}=e;return t?`1px solid ${n.colors.grayscale.light3};`:"none;"}};
`,jc=y.iK.div`
  display: flex;
  justify-content: space-between;
  > span {
    width: 100%;
  }
`,Vc=e=>{const t=(0,y.Fg)(),{icon:n,info:i,menuItems:r,selectedKeys:o,onSelect:l}=e,d=(e,n,i)=>(0,x.tZ)(Lc,{key:n,divider:i},(0,x.tZ)(jc,null,(0,x.tZ)("span",null,e),(null==o?void 0:a()(o).call(o,n))&&(0,x.tZ)(B.Z.Check,{iconColor:t.colors.primary.base,className:"tick-menu-item",iconSize:"xl"}))),c=(0,s.useMemo)((()=>(0,x.tZ)(qc,{selectedKeys:o,onSelect:l,selectable:!0},i&&(0,x.tZ)("div",{className:"info"},i),r.map((e=>{var t;return null!=(t=e.children)&&t.length?(0,x.tZ)(Nc,{title:e.label,key:e.key},e.children.map((e=>d(e.label,e.key)))):d(e.label,e.key,e.divider)})))),[i,r]);return(0,x.tZ)(Ac,{overlay:c,trigger:["click"],icon:n})},Kc=y.iK.span`
  display: flex;
  align-items: center;
  justify-content: space-between;

  .enable-cross-filters-text {
    padding-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit+"px"}};
  }
`,Bc=(0,y.iK)(qt.ZP)`
  ${e=>{let{theme:t}=e;return`\n  &,\n  svg {\n    display: inline-block;\n    width: ${4*t.gridUnit}px;\n    height: ${4*t.gridUnit}px;\n  }\n`}}
`,Hc=()=>{const e=(0,r.I0)(),t=(0,y.Fg)(),n=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.crossFiltersEnabled})),i=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.filterBarOrientation})),[o,a]=(0,s.useState)(i),l=(0,u.c)(u.T.DASHBOARD_CROSS_FILTERS),d=!!n&&l,[h,p]=(0,s.useState)(d),g=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),m=g&&(0,u.c)(u.T.HORIZONTAL_FILTER_BAR),f="cross-filters-menu-key",v=(0,s.useCallback)((async t=>{t||e((0,ct.sh)()),await e((0,Kn.C6)(t))}),[e,h]),b=(0,s.useCallback)((async t=>{const n=t.key;if(n===f)return p(!h),void v(!h);if(((r=n)===Ql.B.VERTICAL||r===Ql.B.HORIZONTAL)&&n!==i){a(n);try{await e((0,Kn.Mn)(t.key))}catch{a(i)}}var r}),[e,h,i]),S=(0,s.useMemo)((()=>(0,x.tZ)(Kc,null,(0,x.tZ)(Bc,{className:"enable-cross-filters",checked:h,onChange:e=>p(e||!1)})," ",(0,x.tZ)("span",{className:"enable-cross-filters-text"},(0,c.t)("Enable cross-filtering")))),[h]),C=[];return l&&g&&C.unshift({key:f,label:S,divider:m}),m&&C.push({key:"placement",label:(0,c.t)("Orientation of filter bar"),children:[{key:Ql.B.VERTICAL,label:(0,c.t)("Vertical (Left)")},{key:Ql.B.HORIZONTAL,label:(0,c.t)("Horizontal (Top)")}]}),C.length?(0,x.tZ)(Vc,{onSelect:b,icon:(0,x.tZ)(B.Z.Gear,{name:"gear",iconColor:t.colors.grayscale.base}),menuItems:C,selectedKeys:[o]}):null},Wc=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: flex;
    align-items: center;
    flex-direction: row;
    justify-content: space-between;
    margin: 0;
    padding: 0 ${2*t.gridUnit}px ${2*t.gridUnit}px;

    & > span {
      font-size: ${t.typography.sizes.l}px;
      flex-grow: 1;
      font-weight: ${t.typography.weights.bold};
    }

    & > div:first-of-type {
      line-height: 0;
    }

    & > button > span.anticon {
      line-height: 0;
    }
  `}}
`,Yc=(0,y.iK)(K.Z)`
  padding: 0;
`,Jc=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    padding: ${3*t.gridUnit}px ${2*t.gridUnit}px ${t.gridUnit}px;\n\n    .ant-dropdown-trigger span {\n      padding-right: ${2*t.gridUnit}px;\n    }\n  `}}
`,Gc=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    margin-top: ${2*t.gridUnit}px;

    & button > [role='img']:first-of-type {
      margin-right: ${t.gridUnit}px;
      line-height: 0;
    }

    span[role='img'] {
      padding-bottom: 1px;
    }

    .ant-btn > .anticon + span {
      margin-left: 0;
    }
  `}}
`,Qc=e=>{let{toggleFiltersBar:t}=e;const n=(0,y.Fg)(),i=cd(),o=(0,s.useMemo)((()=>Object.values(i)),[i]),a=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),l=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.id}));return(0,x.tZ)(Jc,null,(0,x.tZ)(Wc,null,(0,x.tZ)("span",null,(0,c.t)("Filters")),(0,x.tZ)(Hc,null),(0,x.tZ)(Yc,G()({},rd("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>t(!1)}),(0,x.tZ)(B.Z.Expand,{iconColor:n.colors.grayscale.base}))),a&&(0,x.tZ)(Gc,null,(0,x.tZ)(dc,{dashboardId:l,createNewOnOpen:0===o.length},(0,x.tZ)(B.Z.PlusSmall,null)," ",(0,c.t)("Add/Edit Filters"))))},Xc=s.memo(Qc),eu=y.iK.div`
  width: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${e=>{let{width:t}=e;return t}}px; // arbitrary...
  }
`,tu=y.iK.div`
  ${e=>{let{theme:t,width:n}=e;return`\n    & .ant-typography-edit-content {\n      left: 0;\n      margin-top: 0;\n      width: 100%;\n    }\n    position: absolute;\n    top: 0;\n    left: 0;\n    flex-direction: column;\n    flex-grow: 1;\n    width: ${n}px;\n    background: ${t.colors.grayscale.light5};\n    border-right: 1px solid ${t.colors.grayscale.light2};\n    border-bottom: 1px solid ${t.colors.grayscale.light2};\n    min-height: 100%;\n    display: none;\n    &.open {\n      display: flex;\n    }\n  `}}
`,nu=y.iK.div`
  ${e=>{let{theme:t,offset:n}=e;return`\n    position: absolute;\n    top: ${n}px;\n    left: 0;\n    height: 100%;\n    width: ${8*t.gridUnit}px;\n    padding-top: ${2*t.gridUnit}px;\n    display: none;\n    text-align: center;\n    &.open {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: ${2*t.gridUnit}px;\n    }\n    svg {\n      cursor: pointer;\n    }\n  `}}
`,iu=(0,y.iK)(B.Z.Collapse)`
  ${e=>{let{theme:t}=e;return`\n    color: ${t.colors.primary.base};\n    margin-bottom: ${3*t.gridUnit}px;\n  `}}
`,ru=(0,y.iK)(B.Z.Filter)`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,ou=(0,y.iK)(V.D6)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }

  & > .ant-tabs-nav .ant-tabs-nav-operations {
    display: none;
  }
`,au=y.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
`,su=y.iK.div`
  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${e=>{let{theme:t}=e;return 27*t.gridUnit}}px;
`,lu=(0,s.createContext)(!1),du=e=>{let{actions:t,canEdit:n,dataMaskSelected:i,filtersOpen:r,filterValues:o,height:a,isDisabled:l,isInitialized:d,offset:h,onSelectionChange:g,toggleFiltersBar:m,width:f}=e;const[v,y]=(0,s.useState)(null),S=dd(),C=Object.values(S),[Z,w]=(0,s.useState)(gc.AllFilters),R=o.filter(nr.kI),[k,T]=(0,s.useState)(!1),D=(0,s.useRef)(),_=(0,s.useCallback)((()=>m(!0)),[m]),I=(0,s.useMemo)((()=>pe()((()=>{clearTimeout(D.current),T(!0),D.current=setTimeout((()=>{T(!1)}),300)}),200)),[]);(0,s.useEffect)((()=>(document.onscroll=I,()=>{document.onscroll=null})),[I]);const $=(0,s.useMemo)((()=>({overflow:"auto",height:a,overscrollBehavior:"contain"})),[a]),M=R.length;return(0,x.tZ)(lu.Provider,{value:k},(0,x.tZ)(eu,G()({},rd(),{className:b()({open:r}),width:f}),(0,x.tZ)(nu,G()({},rd("collapsable"),{className:b()({open:!r}),onClick:_,offset:h}),(0,x.tZ)(iu,G()({},rd("expand-button"),{iconSize:"l"})),(0,x.tZ)(ru,G()({},rd("filter-icon"),{iconSize:"l"}))),(0,x.tZ)(tu,{className:b()({open:r}),width:f},(0,x.tZ)(Xc,{toggleFiltersBar:m}),d?(0,mt.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,x.tZ)(ou,{centered:!0,onChange:w,defaultActiveKey:gc.AllFilters,activeKey:v?gc.AllFilters:void 0},(0,x.tZ)(V.D6.TabPane,{tab:(0,c.t)("All filters (%(filterCount)d)",{filterCount:M}),key:gc.AllFilters,css:$},v&&(0,x.tZ)(Oc,{dataMaskSelected:i,disabled:!l,onCancel:()=>y(null),filterSetId:v}),0===o.length?(0,x.tZ)(au,null,(0,x.tZ)(_l.Tc,{title:(0,c.t)("No filters are currently added"),image:"filter.svg",description:n&&(0,c.t)("Click the button above to add a filter to the dashboard")})):(0,x.tZ)(su,null,(0,x.tZ)(zu,{dataMaskSelected:i,onFilterSelectionChange:g}))),(0,x.tZ)(V.D6.TabPane,{disabled:!!v,tab:(0,c.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:C.length}),key:gc.FilterSets,css:$},(0,x.tZ)(Ic,{onEditFilterSet:y,disabled:!l,dataMaskSelected:i,tab:Z,onFilterSelectionChange:g}))):(0,x.tZ)("div",{css:$,onScroll:I},0===o.length?(0,x.tZ)(au,null,(0,x.tZ)(_l.Tc,{title:(0,c.t)("No filters are currently added"),image:"filter.svg",description:n&&(0,c.t)("Click the button above to add a filter to the dashboard")})):(0,x.tZ)(su,null,(0,x.tZ)(zu,{dataMaskSelected:i,onFilterSelectionChange:g}))):(0,x.tZ)("div",{css:(0,x.iv)({height:a},"","")},(0,x.tZ)(p.Z,null)),t)))},cu=s.memo(du);var uu;!function(e){e.Right="right",e.Bottom="bottom",e.Left="left"}(uu||(uu={}));const hu=y.iK.div`
  position: absolute;
  right: 0;
`,pu=y.iK.h4`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
  margin: 0;
  overflow-wrap: break-word;
`,gu=(0,y.iK)(pu)`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.normal}};
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  max-width: ${e=>{let{theme:t}=e;return 15*t.gridUnit}}px;
  ${Md.B3};
`,mu=(0,y.iK)(gu)`
  max-width: none;
`,fu=y.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,vu=(0,y.iK)(fu)`
  margin-bottom: unset;
`,bu=(0,y.iK)(fu)`
  width: 100%;
`,yu=(0,y.iK)(Ft.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${e=>{let{theme:t}=e;return 11*t.gridUnit}}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,xu=(0,y.iK)(Ft.l0)`
  && .ant-form-item-label > label {
    margin-bottom: 0;
    text-transform: none;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,Su=(0,y.iK)(yu)`
  && .ant-form-item-label {
    line-height: 1;
    & > label {
      padding-right: unset;
    }
  }
`,Cu=(0,y.iK)(Ft.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,Zu=(0,y.iK)(Ft.xJ)`
  && {
    margin-bottom: 0;
    align-items: center;
  }

  .ant-form-item-label {
    padding-bottom: 0;
    margin-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }

    & > label::after {
      display: none;
    }
  }

  .ant-form-item-control {
    width: ${e=>{let{theme:t}=e;return 41*t.gridUnit}}px;
  }
`,wu=Cu,Ru=y.iK.div`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.m}}px;
  display: flex;
`,ku=()=>(0,x.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),Tu=e=>{let{description:t}=e;return(0,x.tZ)(Ru,null,(0,x.tZ)(X.u,{title:t,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,x.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})})))},Du=e=>{var t,n,i;let{dataMaskSelected:r,filter:o,icon:a,onFilterSelectionChange:l,inView:d,showOverflow:c,parentRef:u,orientation:h=Ql.B.VERTICAL,overflow:p=!1}=e;const g=(0,s.useMemo)((()=>kd()),[]),[m,f]=(0,s.useState)(!1),{name:v="<undefined>"}=o,b=id(o,null==(t=o.dataMask)?void 0:t.filterState),y=!(null==(n=o.controlValues)||!n.enableEmptyFilter),{FilterControlContainer:S,FormItem:C,FilterControlTitleBox:Z,FilterControlTitle:w}=((e,t)=>(0,s.useMemo)((()=>e===Ql.B.HORIZONTAL?t?{FilterControlContainer:Su,FormItem:wu,FilterControlTitleBox:bu,FilterControlTitle:mu}:{FilterControlContainer:xu,FormItem:Zu,FilterControlTitleBox:vu,FilterControlTitle:gu}:{FilterControlContainer:yu,FormItem:Cu,FilterControlTitleBox:fu,FilterControlTitle:pu}),[e,t]))(h,p),R=(0,s.useMemo)((()=>{var e;return(0,x.tZ)(Z,null,(0,x.tZ)(w,null,v),y&&(0,x.tZ)(ku,null),(null==(e=o.description)?void 0:e.trim())&&(0,x.tZ)(Tu,{description:o.description}),(0,x.tZ)(hu,null,a))}),[Z,w,v,y,o.description,a]),k=(0,s.useContext)(lu),T=(0,s.useMemo)((()=>h===Ql.B.HORIZONTAL?p?uu.Left:uu.Bottom:uu.Right),[h,p]);return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(wd,{node:g},(0,x.tZ)(jd,{dataMaskSelected:r,filter:o,showOverflow:c,onFilterSelectionChange:l,inView:d,parentRef:u,setFilterActive:f,orientation:h,overflow:p})),(0,x.tZ)(S,{layout:h!==Ql.B.HORIZONTAL||p?"vertical":"horizontal"},(0,x.tZ)(pc,{filter:o,isVisible:!m&&!k,placement:T},(0,x.tZ)("div",null,(0,x.tZ)(C,{label:R,required:null==o||null==(i=o.controlValues)?void 0:i.enableEmptyFilter,validateStatus:b?"error":void 0},(0,x.tZ)(Rd,{node:g}))))))},_u=s.memo(Du),Iu=e=>{let{title:t,description:n}=e;return(0,x.tZ)("div",null,(0,x.tZ)("h3",null,t),n?(0,x.tZ)("p",null,n):null)},$u=e=>{let{title:t,description:n}=e;const i=(0,y.Fg)(),[r,o]=(0,Md.cB)();return(0,x.tZ)("div",{css:x.iv`
        display: flex;
        align-items: center;
        height: ${6*i.gridUnit}px;
        border-left: 1px solid ${i.colors.grayscale.light2};
        padding-left: ${4*i.gridUnit}px;

        .filter-item-wrapper:first-child & {
          border-left: none;
          padding-left: 0;
        }
      `},(0,x.tZ)(X.u,{overlay:o?t:null},(0,x.tZ)("h3",{ref:r,css:x.iv`
            ${Md.B3};
            max-width: ${32.5*i.gridUnit}px;
            font-size: ${i.typography.sizes.m}px;
            font-weight: ${i.typography.weights.normal};
            margin: 0;
            color: ${i.colors.grayscale.dark1};
          `},t)),n?(0,x.tZ)(X.u,{overlay:n},(0,x.tZ)(B.Z.BookOutlined,{iconSize:"l",iconColor:i.colors.grayscale.base,css:x.iv`
              margin: 0 ${1.5*i.gridUnit}px;
              vertical-align: unset;
              line-height: unset;
            `})):null)},Mu=e=>{let{title:t,description:n}=e;const i=(0,y.Fg)(),[r,o]=(0,Md.cB)(),[a,s]=(0,Md.cB)();return(0,x.tZ)("div",{css:x.iv`
        border-top: 1px solid ${i.colors.grayscale.light2};
        padding-top: ${4*i.gridUnit}px;
        margin-bottom: ${4*i.gridUnit}px;
      `},(0,x.tZ)(X.u,{overlay:o?(0,x.tZ)("strong",null,t):null},(0,x.tZ)("h3",{ref:r,css:x.iv`
            ${Md.B3};
            display: block;
            color: ${i.colors.grayscale.dark1};
            font-weight: ${i.typography.weights.normal};
            font-size: ${i.typography.sizes.m}px;
            margin: 0 0 ${i.gridUnit}px 0;
          `},t)),n?(0,x.tZ)(X.u,{overlay:s?n:null},(0,x.tZ)("p",{ref:a,css:x.iv`
              ${Md.B3};
              display: block;
              font-size: ${i.typography.sizes.s}px;
              color: ${i.colors.grayscale.base};
              margin: ${i.gridUnit}px 0 0 0;
            `},n)):null)},Eu=e=>{let{title:t,description:n,orientation:i=Ql.B.VERTICAL,overflow:r=!1}=e;return i===Ql.B.HORIZONTAL?r?(0,x.tZ)(Mu,{title:t,description:n}):(0,x.tZ)($u,{title:t,description:n}):(0,x.tZ)(Iu,{title:t,description:n})},Fu=e=>{let{filtersInScope:t,filtersOutOfScope:n,renderer:i,showCollapsePanel:r,forceRenderOutOfScope:o}=e;return(0,x.tZ)("div",{css:e=>x.iv`
        width: ${56*e.gridUnit}px;
        padding: ${e.gridUnit}px 0;
      `},t.map(i),r&&(0,x.tZ)($d,{filtersOutOfScope:n,renderer:i,forceRender:o,horizontalOverflow:!0}))},Ou=e=>{let{dataMaskSelected:t,onFilterSelectionChange:n}=e;const i=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return(0,u.c)(u.T.HORIZONTAL_FILTER_BAR)?t.filterBarOrientation:Ql.B.VERTICAL})),{outlinedFilterId:o,lastUpdated:l}=Ud(),[d,h]=(0,s.useState)([]),p=(0,s.useRef)(null),{filterControlFactory:g,filtersWithValues:f}=((e,t)=>{const n=cd(),i=(0,s.useMemo)((()=>Object.values(n)),[n]),r=(0,s.useMemo)((()=>i.map((t=>({...t,dataMask:e[t.id]})))),[i,e]),o=(0,s.useCallback)(((n,i,o)=>{const a=r[n];return(0,nr.nY)(a)?(0,x.tZ)(Eu,{title:a.title,description:a.description,orientation:i,overflow:o}):(0,x.tZ)(_u,{dataMaskSelected:e,filter:a,onFilterSelectionChange:t,inView:!1,orientation:i,overflow:o})}),[r,e,t]);return{filterControlFactory:o,filtersWithValues:r}})(t,n),v=(0,s.useMemo)((()=>{const e=new Array(f.length);for(let t=0;t<f.length;t+=1)e[t]=kd();return e}),[f.length]),b=new Set(f.map((e=>e.id))),[y,S]=function(e){const t=ar(),n=function(){const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=or();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===m.gn))}}();return n=>{var i;return(0,nr.nY)(n)||"chartsInScope"in n&&(null==(i=n.chartsInScope)?void 0:i.some((n=>{const i=t(n);return 0===(null==i?void 0:i.length)||(null==i?void 0:i.every((t=>a()(e).call(e,t))))})))}}();return(0,s.useMemo)((()=>{let i=[];const r=[];return t?e.forEach((e=>{n(e)?i.push(e):r.push(e)})):i=e,[i,r]}),[e,t,n])}(f),C=(0,s.useMemo)((()=>f.some((e=>e.requiredFirst))),[f]),Z=ar()&&f.length>0,w=(0,s.useCallback)(((e,t)=>{let{id:n}=e;const i=f.findIndex((e=>e.id===n)),r=null!=t?t:n;return(0,x.tZ)(s.Fragment,{key:r},"",(0,x.tZ)(Rd,{node:v[i],inView:!0}))}),[f,v]),R=(0,s.useMemo)((()=>y.map(((e,t)=>({id:e.id,element:(0,x.tZ)("div",{className:"filter-item-wrapper",css:x.iv`
              flex-shrink: 0;
            `},w(e,t))})))),[y,w]),k=(0,s.useMemo)((()=>y.filter((e=>{let{id:t}=e;return null==d?void 0:a()(d).call(d,t)}))),[y,d]),T=(0,s.useMemo)((()=>k.filter((e=>(0,nr.S0)(e)))),[k]),D=(0,s.useMemo)((()=>{const e=new Set(S.map((e=>{let{id:t}=e;return t}))),t=new Set(k.map((e=>{let{id:t}=e;return t})));return f.map((n=>e.has(n.id)||t.has(n.id)))}),[S,f,k]);return(0,s.useEffect)((()=>{var e;o&&a()(d).call(d,o)&&(null==p||null==(e=p.current)||e.open())}),[o,l,p,d]),(0,x.tZ)(s.Fragment,null,v.filter(((e,t)=>b.has(f[t].id))).map(((e,t)=>(0,x.tZ)(wd,{node:e,key:f[t].id},g(t,i,D[t])))),i===Ql.B.VERTICAL&&(0,x.tZ)(s.Fragment,null,y.map(w),Z&&(0,x.tZ)($d,{filtersOutOfScope:S,forceRender:C,hasTopMargin:y.length>0,renderer:w})),i===Ql.B.HORIZONTAL&&(0,x.tZ)("div",{css:e=>x.iv`
          padding: 0 ${4*e.gridUnit}px;
          min-width: 0;
          flex: 1;
        `},(0,x.tZ)(Id,{items:R,dropdownTriggerIcon:(0,x.tZ)(B.Z.FilterSmall,{css:x.iv`
              && {
                margin-right: -4px;
                display: flex;
              }
            `}),dropdownTriggerText:(0,c.t)("More filters"),dropdownTriggerCount:T.length,dropdownTriggerTooltip:0===T.length?(0,c.t)("No applied filters"):(0,c.t)("Applied filters: %s",T.map((e=>e.name)).join(", ")),dropdownContent:k.length||S.length&&Z?()=>(0,x.tZ)(Fu,{filtersInScope:k,filtersOutOfScope:S,renderer:w,showCollapsePanel:Z,forceRenderOutOfScope:C}):void 0,ref:p,onOverflowingStateChange:e=>{let{overflowed:t}=e;(t.length!==d.length||d.reduce(((e,n,i)=>e||n!==t[i]),!1))&&h(t)}})))},zu=s.memo(Ou),Pu=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    padding: ${3*t.gridUnit}px ${2*t.gridUnit}px ${3*t.gridUnit}px ${4*t.gridUnit}px;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: inset 0px -2px 2px -1px ${t.colors.grayscale.light2};\n  `}}
`,Uu=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    align-items: center;\n    justify-content: flex-start;\n    line-height: 0;\n\n    .loading {\n      margin: ${2*t.gridUnit}px auto ${2*t.gridUnit}px;\n      padding: 0;\n    }\n  `}}
`,Nu=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    font-weight: ${t.typography.weights.bold};\n    color: ${t.colors.grayscale.base};\n    font-size: ${t.typography.sizes.s}px;\n  `}}
`,Au=y.iK.div`
  ${e=>{let{theme:t,hasFilters:n}=e;return`\n    height: 24px;\n    display: flex;\n    align-items: center;\n    padding: 0 ${4*t.gridUnit}px 0 ${4*t.gridUnit}px;\n    border-right: ${n?`1px solid ${t.colors.grayscale.light2}`:0};\n\n    button {\n      display: flex;\n      align-items: center;\n      > .anticon {\n        height: 24px;\n        padding-right: ${t.gridUnit}px;\n      }\n      > .anticon + span, > .anticon {\n          margin-right: 0;\n          margin-left: 0;\n        }\n    }\n  `}}
`,qu=e=>{let{actions:t,canEdit:n,dashboardId:i,dataMaskSelected:r,filterValues:o,isInitialized:a,onSelectionChange:l}=e;const d=o.length>0;return(0,x.tZ)(Pu,rd(),(0,x.tZ)(Uu,null,a?(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Hc,null),n&&(0,x.tZ)(Au,{hasFilters:d},(0,x.tZ)(dc,{dashboardId:i,createNewOnOpen:0===o.length},(0,x.tZ)(B.Z.PlusSmall,null)," ",(0,c.t)("Add/Edit Filters"))),!d&&(0,x.tZ)(Nu,null,(0,c.t)("No filters are currently added to this dashboard.")),d&&(0,x.tZ)(zu,{dataMaskSelected:r,onFilterSelectionChange:l}),t):(0,x.tZ)(p.Z,{position:"inline-centered"})))},Lu=s.memo(qu),ju=[St.KD.nativeFilters.name,St.KD.permalinkKey.name],Vu=T()((async(e,t,n,i,r)=>{var o;const{location:s}=e,{search:l}=s,d=new URLSearchParams(l),c=new URLSearchParams;let u;d.forEach(((e,t)=>{a()(ju).call(ju,t)||c.append(t,e)}));const h=(0,wt.eY)(St.KD.nativeFiltersKey),p=JSON.stringify(i);u=n&&h&&await(0,hd.TZ)(t,p,h,r)?h:await(0,hd.u7)(t,p,r),u&&c.set(St.KD.nativeFiltersKey.name,u),a()(o=window.location.pathname).call(o,"/superset/dashboard")&&(e.location.pathname=window.location.pathname,e.replace({search:c.toString()}))}),er.M),Ku=e=>{let{orientation:t=Ql.B.VERTICAL,verticalConfig:n}=e;const i=(0,pi.k6)(),o=ud(),[a,l]=(0,Xl.x)(o),d=(0,r.I0)(),[c,u]=(0,s.useState)(0),h=(0,td.z)(),p=cd(),g=(0,Vo.D)(p),m=Object.values(p),f=m.filter(nr.kI),v=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return null==t?void 0:t.id})),b=(0,Vo.D)(v),y=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),S=(0,s.useCallback)(((e,t)=>{l((n=>{var i,r,o;void 0!==(null==(i=t.filterState)?void 0:i.value)&&void 0===(null==(r=a[e.id])||null==(o=r.filterState)?void 0:o.value)&&e.requiredFirst&&d((0,ct.eG)(e.id,t)),n[e.id]={...(0,ed.H)(e.id),...t}}))}),[a,d,l]);(0,s.useEffect)((()=>{if(g&&v===b){const e={};Object.values(p).forEach((t=>{const n=null==g?void 0:g[t.id];if(!n)return;const i=t.filterType,r=t.targets,o=t.defaultDataMask,a=null==n?void 0:n.filterType,s=null==n?void 0:n.targets,l=null==n?void 0:n.defaultDataMask,d=i!==a,c=!hi()(r,s),u=!hi()(o,l);(d||c||u)&&(e[t.id]=(0,ed.H)(t.id))})),Yi()(e)||(l((t=>({...t,...e}))),Object.keys(e).forEach((e=>d((0,ct.ze)(e)))))}}),[JSON.stringify(p),JSON.stringify(g),b]);const C=JSON.stringify(o);(0,s.useEffect)((()=>{l((()=>o))}),[C,l]),(0,s.useEffect)((()=>{Vu(i,v,c,o,h)}),[v,C,i,c,h]);const Z=(0,s.useCallback)((()=>{const e=Object.keys(a);u(1),e.forEach((e=>{a[e]&&d((0,ct.eG)(e,a[e]))}))}),[a,d]),w=(0,s.useCallback)((()=>{Object.keys(a).forEach((e=>{a[e]&&(d((0,ct.ze)(e)),l((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)})))}))}),[a,d,l]);((e,t)=>{const n=cd(),i=ud();(0,s.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[i,e,n,t])})(a,l);const R=((e,t,n)=>{const i=Object.values(e),r=Object.values(t);return(0,fi.JB)(nd(e),nd(t),{ignoreUndefined:!0})||i.length!==r.length||n.some((t=>{var n;return id(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(a,o,f),k=(()=>{const[e,t]=(0,s.useState)(!1),n=cd(),i=(0,s.useContext)(rs.MigrationContext);let o=(0,r.v9)((e=>e.charts)),a=0;if(!e)if(i===Y.Qi.REVIEWING){o=ad()(ld()(o,(e=>{var t;return"filter_box"!==(null==(t=e.form_data)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;a=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else a=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,s.useEffect)((()=>{if(e)return;if(Object.values(n).find((e=>{let{requiredFirst:t}=e;return t})))return void t(!0);let i;0===a&&(i=setTimeout((()=>{t(!0)}),1e3)),a>0&&void 0!==i&&clearTimeout(i);const r=Object.values(o).filter((e=>{let{chartStatus:t}=e;return"loading"!==t})).length;a>0&&r>=a&&t(!0)}),[o,e,a]),e})(),T=(0,x.tZ)(vd,{filterBarOrientation:t,width:null==n?void 0:n.width,onApply:Z,onClearAll:w,dataMaskSelected:a,dataMaskApplied:o,isApplyDisabled:R});return t===Ql.B.HORIZONTAL?(0,x.tZ)(Lu,{actions:T,canEdit:y,dashboardId:v,dataMaskSelected:a,filterValues:m,isInitialized:k,onSelectionChange:S}):n?(0,x.tZ)(cu,{actions:T,canEdit:y,dataMaskSelected:a,filtersOpen:n.filtersOpen,filterValues:m,isInitialized:k,isDisabled:R,height:n.height,offset:n.offset,onSelectionChange:S,toggleFiltersBar:n.toggleFiltersBar,width:n.width}):null},Bu=s.memo(Ku);var Hu=n(61337);const Wu=y.iK.div`
  position: absolute;
  height: 100%;

  :hover .sidebar-resizer::after {
    background-color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }

  .sidebar-resizer {
    // @z-index-above-sticky-header (100) + 1 = 101
    z-index: 101;
  }

  .sidebar-resizer::after {
    display: block;
    content: '';
    width: 1px;
    height: 100%;
    margin: 0 auto;
  }
`,Yu=e=>{let{id:t,initialWidth:n,minWidth:i,maxWidth:r,enable:o,children:a}=e;const[l,d]=function(e,t){const n=(0,s.useRef)(),[i,r]=(0,s.useState)(t);return(0,s.useEffect)((()=>{var t;n.current=null!=(t=n.current)?t:(0,Hu.rV)(Hu.dR.common__resizable_sidebar_widths,{}),n.current[e]&&r(n.current[e])}),[e]),[i,function(t){r(t),(0,Hu.LS)(Hu.dR.common__resizable_sidebar_widths,{...n.current,[e]:t})}]}(t,n);return(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Wu,null,(0,x.tZ)(Ts.e,{enable:{right:o},handleClasses:{right:"sidebar-resizer"},size:{width:l,height:"100%"},minWidth:i,maxWidth:r,onResizeStop:(e,t,n,i)=>d(l+i.width)})),a(l))},Ju=e=>{const t=e[H._4],n=null==t?void 0:t.children[0];return n===H.PV?e[H._4]:e[n]},Gu=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target);var Qu=n(81545),Xu=["className","children","debounceTime","ignoreDimensions","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"];function eh(){return eh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},eh.apply(this,arguments)}var th=[],nh={width:"100%",height:"100%"};function ih(e){var t=e.className,n=e.children,i=e.debounceTime,r=void 0===i?300:i,o=e.ignoreDimensions,a=void 0===o?th:o,l=e.parentSizeStyles,d=void 0===l?nh:l,c=e.enableDebounceLeadingCall,u=void 0===c||c,h=e.resizeObserverPolyfill,p=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,Xu),g=(0,s.useRef)(null),m=(0,s.useRef)(0),f=(0,s.useState)({width:0,height:0,top:0,left:0}),v=f[0],b=f[1],y=(0,s.useMemo)((function(){var e=Array.isArray(a)?a:[a];return T()((function(t){b((function(n){return Object.keys(n).filter((function(e){return n[e]!==t[e]})).every((function(t){return e.includes(t)}))?n:t}))}),r,{leading:u})}),[r,u,a]);return(0,s.useEffect)((function(){var e=new(h||window.ResizeObserver)((function(e){e.forEach((function(e){var t,n=null!=(t=null==e?void 0:e.contentRect)?t:{},i=n.left,r=n.top,o=n.width,a=n.height;m.current=window.requestAnimationFrame((function(){y({width:o,height:a,top:r,left:i})}))}))}));return g.current&&e.observe(g.current),function(){window.cancelAnimationFrame(m.current),e.disconnect(),y.cancel()}}),[y,h]),s.createElement("div",eh({style:d,ref:g,className:t},p),n(eh({},v,{ref:g.current,resize:y})))}ih.propTypes={className:d().string,debounceTime:d().number,enableDebounceLeadingCall:d().bool,ignoreDimensions:d().oneOfType([d().any,d().arrayOf(d().any)]),children:d().func.isRequired};var rh=n(78718),oh=n.n(rh);const ah={depth:d().number.isRequired,editMode:d().bool,gridComponent:W.cP,handleComponentDrop:d().func.isRequired,isComponentVisible:d().bool.isRequired,resizeComponent:d().func.isRequired,setDirectPathToChild:d().func.isRequired,width:d().number.isRequired,dashboardId:d().number},sh=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),lh=e=>e.dropIndicatorProps&&(0,x.tZ)("div",{className:"drop-indicator drop-indicator--top"}),dh=y.iK.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
`,ch=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: flex;
    flex-direction: column;

    /* gutters between rows */
    & > div:not(:last-child):not(.empty-droptarget) {
      margin-bottom: ${4*t.gridUnit}px;
    }

    & > .empty-droptarget {
      width: 100%;
      height: 100%;
    }

    & > .empty-droptarget:first-child {
      height: ${12*t.gridUnit}px;
      margin-top: ${-6*t.gridUnit}px;
      margin-bottom: ${-6*t.gridUnit}px;
    }

    & > .empty-droptarget:only-child {
      height: 80vh;
    }
  `}}
`,uh=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    // /* Editing guides */
    &.grid-column-guide {
      position: absolute;
      top: 0;
      min-height: 100%;
      background-color: ${(0,S.Zf)(t.colors.primary.base,parseFloat(t.opacity.light)/100)};
      pointer-events: none;
      box-shadow: inset 0 0 0 1px
        ${(0,S.Zf)(t.colors.primary.base,parseFloat(t.opacity.mediumHeavy)/100)};
    }
  `}};
`;class hh extends s.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart(){this.setState((()=>({isResizing:!0})))}handleResizeStop(e){let{id:t,widthMultiple:n,heightMultiple:i}=e;this.props.resizeComponent({id:t,width:n,height:i}),this.setState((()=>({isResizing:!1})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab(e){let{pathToTabIndex:t}=e;this.props.setDirectPathToChild(t)}render(){var e,t,n;const{gridComponent:i,handleComponentDrop:r,depth:o,width:a,isComponentVisible:l,editMode:d,canEdit:u,setEditMode:h,dashboardId:p}=this.props,g=(a+H.es)/H.cz-H.es,{isResizing:f}=this.state,v=0===(null==i||null==(e=i.children)?void 0:e.length),b=v&&i.type===m.gn,y=d&&(0,x.tZ)(_l.XJ,{title:(0,c.t)("Drag and drop components and charts to the dashboard"),description:(0,c.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,x.tZ)(s.Fragment,null,(0,x.tZ)("i",{className:"fa fa-plus"}),(0,c.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${p}`,"_blank","noopener noreferrer")},image:"chart.svg"}),S=d?(0,x.tZ)(_l.XJ,{title:(0,c.t)("Drag and drop components to this tab"),description:(0,c.t)("You can create a new chart or use existing ones from the panel on the right"),buttonText:(0,x.tZ)(s.Fragment,null,(0,x.tZ)("i",{className:"fa fa-plus"}),(0,c.t)("Create a new chart")),buttonAction:()=>{window.open(`/chart/add?dashboard_id=${p}`,"_blank","noopener noreferrer")},image:"chart.svg"}):(0,x.tZ)(_l.XJ,{title:(0,c.t)("There are no components added to this tab"),description:u&&(0,c.t)("You can add the components in the edit mode."),buttonText:u&&(0,c.t)("Edit the dashboard"),buttonAction:u&&(()=>{h(!0)}),image:"chart.svg"});return a<100?null:(0,x.tZ)(s.Fragment,null,v&&(0,x.tZ)(dh,null,b?S:y),(0,x.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,x.tZ)(ch,{className:"grid-content"},d&&(0,x.tZ)(Oe,{component:i,depth:o,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},sh),null==i||null==(t=i.children)?void 0:t.map(((e,t)=>(0,x.tZ)(Gl,{key:e,id:e,parentId:i.id,depth:o+1,index:t,availableColumnCount:H.cz,columnWidth:g,isComponentVisible:l,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),d&&(null==i||null==(n=i.children)?void 0:n.length)>0&&(0,x.tZ)(Oe,{component:i,depth:o,parentComponent:null,index:i.children.length,orientation:"column",onDrop:r,className:"empty-droptarget",editMode:!0},lh),f&&Array(H.cz).fill(null).map(((e,t)=>(0,x.tZ)(uh,{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*H.es+t*g,width:g}}))))))}}hh.propTypes=ah,hh.defaultProps={};const ph=hh,gh=(0,r.$j)((function(e){let{dashboardState:t,dashboardInfo:n}=e;return{editMode:t.editMode,canEdit:n.dash_edit_perm,dashboardId:n.id}}),(function(e){return(0,i.DE)({handleComponentDrop:Hn._p,resizeComponent:Hn.iO,setDirectPathToChild:Bn.E2,setEditMode:Bn.Mb},e)}))(ph);var mh=n(51127),fh=n.n(mh);const vh=e=>{let{topLevelTabs:t}=e;const n=(()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters}));return(0,s.useMemo)((()=>e?Object.values(e).map((e=>oh()(e,["id","scope","type"]))):[]),[JSON.stringify(e)])})(),i=(0,r.I0)(),o=(0,r.v9)((e=>e.dashboardLayout.present)),a=(0,r.v9)((e=>e.dashboardInfo)),l=(0,r.v9)((e=>e.dashboardState.directPathToChild)),d=(0,r.v9)((e=>e.charts)),c=(0,s.useMemo)((()=>{const e=Nl({currentComponent:Ju(o),directPathToChild:l});return e>-1?e:((e,t)=>Math.max(0,Nl({currentComponent:Ju(e),directPathToChild:t})))(o,l)}),[o,l]);(0,s.useEffect)((()=>{if(!(0,u.c)(u.T.DASHBOARD_NATIVE_FILTERS)||0===n.length)return;const e=n.map((e=>{if(e.id.startsWith(Ko.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const t=(0,wi.Q)(e.scope,d,o),n=(0,Lr.Rz)(o,t);return{filterId:e.id,tabsInScope:Array.from(n),chartsInScope:t}}));i((0,Od.xk)(e))}),[n,o,i]);const h=(0,s.useCallback)((()=>{const e=a.metadata;if(null!=e&&e.color_scheme){const n={...e},r=null==n?void 0:n.color_scheme,o=(null==n?void 0:n.color_scheme_domain)||[],s=(0,Qu.Z)(),l=s.get(r,!0)||void 0,d=(null==l?void 0:l.colors)||[],c=s.defaultKey,u=!!l,h=()=>{yt.Z.put({endpoint:`/api/v1/dashboard/${a.id}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({json_metadata:fh()(n)})}).catch((e=>console.log(e)))},p=e=>{i((0,Bn.uW)(e))},g=()=>{i((0,Kn.a8)({metadata:n})),h()};if(u)u&&!o.length&&(n.color_scheme_domain=d,g()),u&&o.length&&d.toString()!==o.toString()&&(n.color_scheme_domain=d,n.shared_label_colors={},p(r),g());else{var t;const e=(null==c?void 0:c.toString())||"supersetColors";n.color_scheme=e,n.color_scheme_domain=(null==(t=s.get(c))?void 0:t.colors)||[],n.shared_label_colors={},p(e),g()}}}),[d]);(0,Ri.d)(h);const p=t?t.children:[H.PV],g=Math.min(c,p.length-1),m=0===g?H.PV:g.toString();return(0,x.tZ)("div",{className:"grid-container"},(0,x.tZ)(ih,null,(e=>{let{width:t}=e;return(0,x.tZ)(w.ZP,{id:H.PV,activeKey:m,renderTabBar:()=>(0,x.tZ)(s.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},p.map(((e,n)=>(0,x.tZ)(w.ZP.TabPane,{key:0===n?H.PV:n.toString()},(0,x.tZ)(gh,{gridComponent:o[e],depth:H.Mu+1,width:t,isComponentVisible:n===c})))))})))},bh=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    display: grid;
    grid-template-columns: auto 1fr;
    grid-template-rows: auto 1fr;
    flex: 1;
    /* Special cases */

    /* A row within a column has inset hover menu */
    .dragdroppable-column .dragdroppable-row .hover-menu--left {
      left: ${-3*t.gridUnit}px;
      background: ${t.colors.grayscale.light5};
      border: 1px solid ${t.colors.grayscale.light2};
    }

    .dashboard-component-tabs {
      position: relative;
    }

    /* A column within a column or tabs has inset hover menu */
    .dragdroppable-column .dragdroppable-column .hover-menu--top,
    .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
      top: ${-3*t.gridUnit}px;
      background: ${t.colors.grayscale.light5};
      border: 1px solid ${t.colors.grayscale.light2};
    }

    /* move Tabs hover menu to top near actual Tabs */
    .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
      top: 0;
      transform: unset;
      background: transparent;
    }

    /* push Chart actions to upper right */
    .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
    .dragdroppable .dashboard-component-header .hover-menu--top {
      right: ${2*t.gridUnit}px;
      top: ${2*t.gridUnit}px;
      background: transparent;
      border: none;
      transform: unset;
      left: unset;
    }
    div:hover > .hover-menu-container .hover-menu,
    .hover-menu-container .hover-menu:hover {
      opacity: 1;
    }

    p {
      margin: 0 0 ${2*t.gridUnit}px 0;
    }

    i.danger {
      color: ${t.colors.error.base};
    }

    i.warning {
      color: ${t.colors.alert.base};
    }
  `}}
`,yh=y.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
  width: ${e=>{let{width:t}=e;return t}}px;
`,xh=y.iK.div`
  position: sticky;
  top: -1px;
  width: ${e=>{let{width:t}=e;return t}}px;
  flex: 0 0 ${e=>{let{width:t}=e;return t}}px;
`,Sh=y.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0;
  z-index: 100;
  max-width: 100vw;
`,Ch=y.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${e=>{let{fullSizeChartId:t}=e;return t&&"z-index: 101;"}}
`,Zh=y.iK.div`
  ${e=>{let{theme:t}=e;return x.iv`
    &.dashboard {
      position: relative;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      height: 100%;

      /* drop shadow for top-level tabs only */
      & .dashboard-component-tabs {
        box-shadow: 0 ${t.gridUnit}px ${t.gridUnit}px 0
          ${(0,S.Zf)(t.colors.grayscale.dark2,parseFloat(t.opacity.light)/100)};
        padding-left: ${2*t.gridUnit}px; /* note this is added to tab-level padding, to match header */
      }

      .dropdown-toggle.btn.btn-primary .caret {
        color: ${t.colors.grayscale.light5};
      }

      .background--transparent {
        background-color: transparent;
      }

      .background--white {
        background-color: ${t.colors.grayscale.light5};
      }
    }
    &.dashboard--editing {
      .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed transparent;
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 1;
        pointer-events: none;
      }

      .resizable-container {
        & .dashboard-component-chart-holder {
          .dashboard-chart {
            .chart-container {
              cursor: move;
              opacity: 0.2;
            }

            .slice_container {
              /* disable chart interactions in edit mode */
              pointer-events: none;
            }
          }

          &:hover .dashboard-chart .chart-container {
            opacity: 0.7;
          }
        }

        &:hover,
        &.resizable-container--resizing:hover {
          & > .dashboard-component-chart-holder:after {
            border: 1px dashed ${t.colors.primary.base};
          }
        }
      }

      .resizable-container--resizing:hover > .grid-row:after,
      .hover-menu:hover + .grid-row:after,
      .dashboard-component-tabs > .hover-menu:hover + div:after {
        border: 1px dashed ${t.colors.primary.base};
        z-index: 2;
      }

      .grid-row:after,
      .dashboard-component-tabs > .hover-menu + div:after {
        border: 1px dashed ${t.colors.grayscale.light2};
      }

      /* provide hit area in case row contents is edge to edge */
      .dashboard-component-tabs-content {
        .dragdroppable-row {
          padding-top: ${4*t.gridUnit}px;
        }

        & > div:not(:last-child):not(.empty-droptarget) {
          margin-bottom: ${4*t.gridUnit}px;
        }
      }

      .dashboard-component-chart-holder {
        &:after {
          content: '';
          position: absolute;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
          z-index: 1;
          pointer-events: none;
          border: 1px solid transparent;
        }

        &:hover:after {
          border: 1px dashed ${t.colors.primary.base};
          z-index: 2;
        }
      }

      .contract-trigger:before {
        display: none;
      }
    }

    & .dashboard-component-tabs-content {
      & > div:not(:last-child):not(.empty-droptarget) {
        margin-bottom: ${4*t.gridUnit}px;
      }

      & > .empty-droptarget {
        position: absolute;
        width: 100%;
      }

      & > .empty-droptarget:first-child {
        height: ${4*t.gridUnit}px;
        top: -2px;
        z-index: 10;
      }

      & > .empty-droptarget:last-child {
        height: ${3*t.gridUnit}px;
        bottom: 0;
      }
    }

    .empty-droptarget:first-child .drop-indicator--bottom {
      top: ${6*t.gridUnit}px;
    }
  `}}
`,wh=y.iK.div`
  ${e=>{let{theme:t,editMode:n,marginLeft:i}=e;return x.iv`
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    height: auto;
    flex: 1;

    .grid-container .dashboard-component-tabs {
      box-shadow: none;
      padding-left: 0;
    }

    .grid-container {
      /* without this, the grid will not get smaller upon toggling the builder panel on */
      width: 0;
      flex: 1;
      position: relative;
      margin-top: ${6*t.gridUnit}px;
      margin-right: ${8*t.gridUnit}px;
      margin-bottom: ${6*t.gridUnit}px;
      margin-left: ${i}px;

      ${n&&`\n      max-width: calc(100% - ${Ss.XX+16*t.gridUnit}px);\n    `}

      /* this is the ParentSize wrapper */
    & > div:first-child {
        height: inherit !important;
      }
    }

    .dashboard-builder-sidepane {
      width: ${Ss.XX}px;
      z-index: 1;
    }

    .dashboard-component-chart-holder {
      width: 100%;
      height: 100%;
      background-color: ${t.colors.grayscale.light5};
      position: relative;
      padding: ${4*t.gridUnit}px;
      overflow-y: visible;

      // transitionable traits to show filter relevance
      transition: opacity ${t.transitionTiming}s ease-in-out,
        border-color ${t.transitionTiming}s ease-in-out,
        box-shadow ${t.transitionTiming}s ease-in-out;

      &.fade-in {
        border-radius: ${t.borderRadius}px;
        box-shadow: inset 0 0 0 2px ${t.colors.primary.base},
          0 0 0 3px
            ${(0,S.Zf)(t.colors.primary.base,parseFloat(t.opacity.light)/100)};
      }

      &.fade-out {
        border-radius: ${t.borderRadius}px;
        box-shadow: none;
      }

      & .missing-chart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-y: auto;
        justify-content: center;

        .missing-chart-body {
          font-size: ${t.typography.sizes.s}px;
          position: relative;
          display: flex;
        }
      }
    }
  `}}
`,Rh=()=>{var e,t;const i=(0,r.I0)(),o=(0,bi.fG)(),l=(0,y.Fg)(),d=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return`${t.id}`})),h=(0,r.v9)((e=>e.dashboardLayout.present)),g=(0,r.v9)((e=>e.dashboardState.editMode)),m=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),f=(0,r.v9)((e=>{let{dashboardState:t}=e;return t.dashboardIsSaving})),v=(0,r.v9)((e=>e.dashboardState.fullSizeChartId)),S=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return(0,mt.cr)(u.T.HORIZONTAL_FILTER_BAR)?t.filterBarOrientation:Ql.B.VERTICAL})),Z=(0,s.useCallback)((e=>{let{pathToTabIndex:t}=e;i((0,Bn.E2)(t))}),[i]),w=(0,s.useCallback)((()=>{i((0,Hn.g3)());const e=Al(Ju(h),0);i((0,Bn.E2)(e))}),[h,i]),R=(0,s.useCallback)((e=>i((0,Hn._p)(e))),[i]),k=s.useRef(null),T=h[H._4],D=null==T?void 0:T.children[0],_=D!==H.PV?h[D]:void 0,I=(0,wt.eY)(St.KD.standalone),$=I===H._B.REPORT,M=o.hideTitle||I===H._B.HIDE_NAV_AND_TITLE||$,[E,F]=(0,s.useState)(0);(0,s.useEffect)((()=>{var e,t;let i;return F((null==(e=k.current)||null==(t=e.getBoundingClientRect())?void 0:t.height)||0),n.g.hasOwnProperty("ResizeObserver")&&k.current&&(i=new ResizeObserver((e=>{F((t=>{var n,i;return(null==e||null==(n=e[0])||null==(i=n.contentRect)?void 0:i.height)||t}))})),i.observe(k.current)),()=>{var e;null==(e=i)||e.disconnect()}}),[]);const{showDashboard:O,dashboardFiltersOpen:z,toggleDashboardFiltersOpen:P,nativeFiltersEnabled:U}=(()=>{const e=(0,s.useContext)(rs.MigrationContext),[t,n]=(0,s.useState)(!1),i=(0,r.v9)((e=>{var t,n;return(null==(t=(0,wt.eY)(St.KD.showFilters))||t)&&(null==(n=e.dashboardInfo.metadata)?void 0:n.show_native_filters)})),o=(0,r.v9)((e=>{let{dashboardInfo:t}=e;return t.dash_edit_perm})),l=cd(),d=Object.values(l),c=(0,wt.eY)(St.KD.expandFilters),[h,p]=(0,s.useState)(null!=c?c:!!d.length),g=i&&(0,mt.cr)(u.T.DASHBOARD_NATIVE_FILTERS)&&(o||!o&&0!==d.length),m=d.filter((e=>e.requiredFirst)),f=ud(),v=t||!g||!(g&&m.length&&m.find((e=>{var t,n;let{id:i}=e;return void 0===(null==(t=f[i])||null==(n=t.filterState)?void 0:n.value)}))),b=(0,s.useCallback)((e=>{p(null!=e?e:!h)}),[h]);return(0,s.useEffect)((()=>{var t;!1===c||0===d.length&&g&&a()(t=["CONVERTED","REVIEWING","NOOP"]).call(t,e)?b(!1):b(!0)}),[d.length,e]),(0,s.useEffect)((()=>{v&&n(!0)}),[v]),{showDashboard:v,dashboardFiltersOpen:h,toggleDashboardFiltersOpen:b,nativeFiltersEnabled:g}})(),[N,A]=function(e){const t=(0,s.useRef)(null),[n,i]=(0,s.useState)(!1),r=e=>{const[t]=e;i(t.intersectionRatio<1)};return(0,s.useEffect)((()=>{const n=new IntersectionObserver(r,e),i=t.current;return i&&n.observe(i),()=>{i&&n.unobserve(i)}}),[t,e]),[t,n]}({threshold:[1]}),q=(0,mt.cr)(u.T.DASHBOARD_NATIVE_FILTERS_SET),L=U&&!g,j=`calc(100vh - ${Ss.UN+(A||I?0:Ss.Ky)+(q?Ss.a7:0)}px)`,V=z?0:E+20,K=(0,s.useMemo)((()=>({marginLeft:z||g||!U||S===Ql.B.HORIZONTAL?0:-32})),[z,g,S,U]),W=(0,s.useRef)(_);(0,s.useEffect)((()=>{var e,t,n;const r=null==(e=W.current)||null==(t=e.children)?void 0:t.length,o=null==_||null==(n=_.children)?void 0:n.length;if(void 0!==r&&void 0!==o&&o>r){const e=Al(Ju(h),o-1);i((0,Bn.E2)(e))}W.current=_}),[_]);const Y=(0,s.useCallback)((e=>{let{dropIndicatorProps:t}=e;return(0,x.tZ)("div",null,!M&&(0,x.tZ)(Gn,null),L&&S===Ql.B.HORIZONTAL&&(0,x.tZ)(Bu,{orientation:Ql.B.HORIZONTAL}),t&&(0,x.tZ)("div",t),!$&&_&&!o.hideNav&&(0,x.tZ)(Ys,{shouldFocus:Gu,menuItems:[(0,x.tZ)(ei,{icon:(0,x.tZ)(B.Z.FallOutlined,{iconSize:"xl"}),label:(0,c.t)("Collapse tab content"),onClick:w})],editMode:g},(0,x.tZ)(Gl,{id:null==_?void 0:_.id,parentId:H._4,depth:H.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:Z})))}),[U,S,g,Z,w,M,$,_,o.hideNav]),J=z||g||!U||S===Ql.B.HORIZONTAL?8*l.gridUnit:0;return(0,x.tZ)(bh,null,L&&S===Ql.B.VERTICAL&&(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Yu,{id:`dashboard:${d}`,enable:z,minWidth:Ss.I6,maxWidth:Ss.aF,initialWidth:Ss.I6},(e=>{const t=z?e:Ss.gz;return(0,x.tZ)(yh,{width:t},(0,x.tZ)(xh,{ref:N,width:t},(0,x.tZ)(C.Z,null,!$&&(0,x.tZ)(Bu,{orientation:Ql.B.VERTICAL,verticalConfig:{filtersOpen:z,toggleFiltersBar:P,width:t,height:j,offset:V}}))))}))),(0,x.tZ)(Sh,{ref:k},(0,x.tZ)(Oe,{component:T,parentComponent:null,depth:H.Mu,index:0,orientation:"column",onDrop:R,editMode:g,disableDragDrop:!!_,style:K},Y)),(0,x.tZ)(Ch,{fullSizeChartId:v},(0,x.tZ)(x.xB,{styles:x.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${v&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),!g&&!_&&0===(null==(e=h[H.PV])||null==(t=e.children)?void 0:t.length)&&(0,x.tZ)(_l.XJ,{title:(0,c.t)("There are no charts added to this dashboard"),description:m&&(0,c.t)("Go to the edit mode to configure the dashboard and add charts"),buttonText:m&&(0,c.t)("Edit the dashboard"),buttonAction:()=>i((0,Bn.Mb)(!0)),image:"dashboard.svg"}),(0,x.tZ)(Zh,{className:b()("dashboard",g&&"dashboard--editing")},(0,x.tZ)(wh,{className:"dashboard-content",editMode:g,marginLeft:J},O?(0,x.tZ)(vh,{topLevelTabs:_}):(0,x.tZ)(p.Z,null),g&&(0,x.tZ)(dt,{topOffset:E})))),f&&(0,x.tZ)(p.Z,{css:x.iv`
            && {
              position: fixed;
            }
          `}))},kh=[m.dW,m.xh,m.t];function Th(e){return!Object.values(e).some((e=>{let{type:t}=e;return t&&a()(kh).call(kh,t)}))}const Dh={actions:d().shape({addSliceToDashboard:d().func.isRequired,removeSliceFromDashboard:d().func.isRequired,triggerQuery:d().func.isRequired,logEvent:d().func.isRequired,clearDataMaskState:d().func.isRequired}).isRequired,dashboardInfo:W.$X.isRequired,dashboardState:W.DZ.isRequired,charts:d().objectOf(W.$6).isRequired,slices:d().objectOf(W.Rw).isRequired,activeFilters:d().object.isRequired,chartConfiguration:d().object,datasources:d().object.isRequired,ownDataCharts:d().object.isRequired,layout:d().object.isRequired,impressionId:d().string.isRequired,initMessages:d().array,timeout:d().number,userId:d().string};class _h extends s.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",_h.unload):window.removeEventListener("beforeunload",_h.unload)}static unload(){const e=(0,c.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=(0,g.Z)(),{dashboardState:t,layout:n}=this.props,i={is_soft_navigation:ft.Yd.timeOriginOffset>0,is_edit_mode:t.editMode,mount_duration:ft.Yd.getTimestamp(),is_empty:Th(n),is_published:t.isPublished,bootstrap_data_length:e.length},r=(0,oi.Z)();r&&(i.target_id=r),this.props.actions.logEvent(ft.Wl,i),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:ft.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=f(this.props.layout),n=f(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,i=t,Object.values(n).find((e=>e&&e.type===m.dW&&e.meta&&e.meta.chartId===i))));var n,i})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:i}=this,{activeFilters:r,ownDataCharts:o,chartConfiguration:a}=this.props;(0,u.c)(u.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,fi.JB)(i,o,{ignoreUndefined:!0})&&(0,fi.JB)(n,r,{ignoreUndefined:!0})||this.applyFilters(),e?_h.onBeforeUnload(!0):_h.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:ft.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(ft.Ev,{...this.visibilityEventData,duration:ft.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,i=Object.keys(t),r=Object.keys(e),o=new Set(i.concat(r)),s=((e,t)=>{const n=Object.keys(e),i=Object.keys(t),r=(o=n,s=i,[...o.filter((e=>!a()(s).call(s,e))),...s.filter((e=>!a()(o).call(o,e)))]).filter((n=>e[n]||t[n]));var o,s;return new Set([...n,...i]).forEach((n=>{(0,fi.JB)(e[n],t[n])||r.push(n)})),[...new Set(r)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!a()(i).call(i,n)&&a()(r).call(r,n))s.push(...e[n].scope);else if(a()(r).call(r,n)){if((0,fi.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||s.push(...t[n].scope),!(0,fi.JB)(e[n].scope,t[n].scope)){const i=(t[n].scope||[]).concat(e[n].scope||[]);s.push(...i)}}else s.push(...t[n].scope)})),this.refreshCharts([...new Set(s)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,x.tZ)(p.Z,null):(0,x.tZ)(s.Fragment,null,(0,x.tZ)(Rh,null))}}_h.contextType=h.Zn,_h.propTypes=Dh,_h.defaultProps={initMessages:[],timeout:60,userId:""};const Ih=_h;var $h=n(50810),Mh=n(87915);const Eh=(0,r.$j)((function(e){var t,n,i,r,o;const{datasources:a,sliceEntities:s,charts:l,dataMask:d,dashboardInfo:c,dashboardState:u,dashboardLayout:h,impressionId:p,nativeFilters:g}=e;return{initMessages:null==(t=c.common)?void 0:t.flash_messages,timeout:null==(n=c.common)||null==(i=n.conf)?void 0:i.SUPERSET_WEBSERVER_TIMEOUT,userId:c.userId,dashboardInfo:c,dashboardState:u,charts:l,datasources:a,activeFilters:{...(0,Gt.De)(),...(0,Mh.g)({chartConfiguration:null==(r=c.metadata)?void 0:r.chart_configuration,nativeFilters:g.filters,dataMask:d,allSliceIds:u.sliceIds})},chartConfiguration:null==(o=c.metadata)?void 0:o.chart_configuration,ownDataCharts:(0,Mh.U)(d,"ownState"),slices:s.slices,layout:h.present,impressionId:p}}),(function(e){return{actions:(0,i.DE)({setDatasources:$h.Fy,clearDataMaskState:ct.sh,addSliceToDashboard:Bn.Pi,removeSliceFromDashboard:Bn.rL,triggerQuery:di.triggerQuery,logEvent:Yn.logEvent},e)}}))(Ih)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var i=n(18172),r=n(67294);function o(e){var t=(0,r.useState)((function(){return(0,i.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,r.useCallback)((function(e){n("function"==typeof e?(0,i.ZP)(e):(0,i.vV)(e))}),[])]}function a(e,t,n){var o=(0,r.useMemo)((function(){return(0,i.ZP)(e)}),[e]);return(0,r.useReducer)(o,t,n)}}}]);
//# sourceMappingURL=1917c6e320758a8c30b7.chunk.js.map
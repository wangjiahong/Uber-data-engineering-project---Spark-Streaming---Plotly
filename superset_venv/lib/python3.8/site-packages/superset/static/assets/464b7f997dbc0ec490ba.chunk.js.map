{"version":3,"file":"464b7f997dbc0ec490ba.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/Pie/EchartsPie.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/utils/eventHandlers.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { PieChartTransformedProps } from './types';\nimport Echart from '../components/Echart';\nimport { allEventHandlers } from '../utils/eventHandlers';\n\nexport default function EchartsPie(props: PieChartTransformedProps) {\n  const {\n    height,\n    width,\n    echartOptions,\n    setDataMask,\n    labelMap,\n    groupby,\n    selectedValues,\n    refs,\n    emitCrossFilters,\n  } = props;\n  const handleChange = useCallback(\n    (values: string[]) => {\n      if (!emitCrossFilters) {\n        return;\n      }\n\n      const groupbyValues = values.map(value => labelMap[value]);\n\n      setDataMask({\n        extraFormData: {\n          filters:\n            values.length === 0\n              ? []\n              : groupby.map((col, idx) => {\n                  const val = groupbyValues.map(v => v[idx]);\n                  if (val === null || val === undefined)\n                    return {\n                      col,\n                      op: 'IS NULL',\n                    };\n                  return {\n                    col,\n                    op: 'IN',\n                    val: val as (string | number | boolean)[],\n                  };\n                }),\n        },\n        filterState: {\n          value: groupbyValues.length ? groupbyValues : null,\n          selectedValues: values.length ? values : null,\n        },\n      });\n    },\n    [groupby, labelMap, setDataMask, selectedValues],\n  );\n\n  const eventHandlers = allEventHandlers(props, handleChange);\n\n  return (\n    <Echart\n      refs={refs}\n      height={height}\n      width={width}\n      echartOptions={echartOptions}\n      eventHandlers={eventHandlers}\n      selectedValues={selectedValues}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { BinaryQueryObjectFilterClause } from '@superset-ui/core';\nimport {\n  BaseTransformedProps,\n  CrossFilterTransformedProps,\n  EventHandlers,\n} from '../types';\n\nexport type Event = {\n  name: string;\n  event: { stop: () => void; event: PointerEvent };\n};\n\nexport const clickEventHandler =\n  (\n    selectedValues: Record<number, string>,\n    handleChange: (values: string[]) => void,\n  ) =>\n  ({ name }: { name: string }) => {\n    const values = Object.values(selectedValues);\n    if (values.includes(name)) {\n      handleChange(values.filter(v => v !== name));\n    } else {\n      handleChange([name]);\n    }\n  };\n\nexport const contextMenuEventHandler =\n  (\n    groupby: (BaseTransformedProps<any> &\n      CrossFilterTransformedProps)['groupby'],\n    onContextMenu: BaseTransformedProps<any>['onContextMenu'],\n    labelMap: Record<string, string[]>,\n  ) =>\n  (e: Event) => {\n    if (onContextMenu) {\n      e.event.stop();\n      const pointerEvent = e.event.event;\n      const filters: BinaryQueryObjectFilterClause[] = [];\n      if (groupby.length > 0) {\n        const values = labelMap[e.name];\n        groupby.forEach((dimension, i) =>\n          filters.push({\n            col: dimension,\n            op: '==',\n            val: values[i],\n            formattedVal: String(values[i]),\n          }),\n        );\n      }\n      onContextMenu(pointerEvent.clientX, pointerEvent.clientY, filters);\n    }\n  };\n\nexport const allEventHandlers = (\n  transformedProps: BaseTransformedProps<any> & CrossFilterTransformedProps,\n  handleChange: (values: string[]) => void,\n) => {\n  const { groupby, selectedValues, onContextMenu, labelMap } = transformedProps;\n  const eventHandlers: EventHandlers = {\n    click: clickEventHandler(selectedValues, handleChange),\n    contextmenu: contextMenuEventHandler(groupby, onContextMenu, labelMap),\n  };\n  return eventHandlers;\n};\n"],"names":["EchartsPie","props","height","width","echartOptions","setDataMask","labelMap","groupby","selectedValues","refs","emitCrossFilters","handleChange","useCallback","values","groupbyValues","map","value","extraFormData","filters","length","col","idx","val","v","op","filterState","eventHandlers","allEventHandlers","Styles","styled","Echart","ref","zrEventHandlers","divRef","useRef","chartRef","currentSelection","useMemo","Object","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","init","entries","forEach","name","handler","off","on","getZr","setOption","dispatchAction","type","dataIndex","filter","handleSizeChange","resize","dispose","useLayoutEffect","forwardRef","clickEventHandler","contextMenuEventHandler","onContextMenu","e","event","stop","pointerEvent","dimension","i","push","formattedVal","String","clientX","clientY","transformedProps","click","contextmenu"],"sourceRoot":""}
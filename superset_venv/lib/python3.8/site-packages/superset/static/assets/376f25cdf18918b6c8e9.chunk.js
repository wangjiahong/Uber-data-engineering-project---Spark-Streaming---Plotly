"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8551],{88551:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(78580),l=n.n(r),a=n(67294),o=n(16355),s=n(5364),c=n(63475),u=n(6915),i=n(51995),f=n(356),h=n(49239),d=n(11965);const{RadioButtonControl:g}=f.Z,p=i.iK.div`
  text-align: center;
`;function m(e){let{formData:t,setControlValue:n}=e;const{extraControlsOptions:r,extraControlsHandler:l,extraValue:o}=function(e){let{formData:t,setControlValue:n}=e;const{stack:r,area:l}=t,[o,s]=(0,a.useState)(null!=r?r:void 0);return(0,a.useEffect)((()=>{s(r)}),[r]),{extraControlsOptions:(0,a.useMemo)((()=>l?h.O0:[]),[l]),extraControlsHandler:(0,a.useCallback)((e=>{l&&n&&(n("stack",e),s(e))}),[l,n]),extraValue:o}}({formData:t,setControlValue:n});return t.showExtraControls?(0,d.tZ)(p,null,(0,d.tZ)(g,{options:r,onChange:l,value:o})):null}function v(e){let{formData:t,height:n,width:r,echartOptions:i,groupby:f,labelMap:h,selectedValues:g,setDataMask:p,setControlValue:v,legendData:C=[],onContextMenu:b,xValueFormatter:w,xAxis:x,refs:y,emitCrossFilters:E}=e;const{stack:k}=t,I=(0,a.useRef)(null);y.echartRef=I;const V=(0,a.useRef)(Date.now()),S=(0,a.useRef)(""),O=(0,a.useRef)(),R=(0,a.useRef)(null),[Z,D]=(0,a.useState)(0);(0,a.useEffect)((()=>{var e;const t=(null==(e=R.current)?void 0:e.offsetHeight)||0;D(t)}),[t.showExtraControls]);const H=(0,a.useCallback)((e=>{var t;const n=null==(t=I.current)?void 0:t.getEchartInstance();e?C.forEach((t=>{t===e?(u.aI.legend=t,null==n||n.dispatchAction({type:"legendSelect",name:t})):null==n||n.dispatchAction({type:"legendUnSelect",name:t})})):(u.aI.legend="",null==n||n.dispatchAction({type:"legendAllSelect"}))}),[C]),A=(0,a.useCallback)((e=>{if(!E)return;const t=e.map((e=>h[e]));p({extraFormData:{filters:0===e.length?[]:f.map(((e,n)=>{const r=t.map((e=>e[n]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}}))},filterState:{label:t.length?t:void 0,value:t.length?t:null,selectedValues:e.length?e:null}})}),[f,h,p,E]),M={click:e=>{O.current&&clearTimeout(O.current),O.current=setTimeout((()=>{const{seriesName:t}=e,n=Object.values(g);l()(n).call(n,t)?A(n.filter((e=>e!==t))):A([t])}),300)},mouseout:()=>{u.aI.name=""},mouseover:e=>{u.aI.name=e.seriesName},legendselectchanged:e=>{const t=Date.now();t-V.current<300&&S.current===e.name?H(e.name):(V.current=t,S.current=e.name),Object.values(e.selected).every((e=>!e))&&H()},contextmenu:e=>{if(b){e.event.stop();const{data:n}=e;if(n){const r=e.event.event,l=[...e.name?[e.name]:[],...h[e.seriesName]],a=[];x.type===o.we.time&&a.push({col:x.label===s.W3?t.granularitySqla:x.label,grain:t.timeGrainSqla,op:"==",val:n[0],formattedVal:w(n[0])}),[...x.type===o.we.category?[x.label]:[],...t.groupby].forEach(((e,t)=>a.push({col:e,op:"==",val:l[t],formattedVal:String(l[t])}))),b(r.clientX,r.clientY,a)}}}},T={dblclick:e=>{var t;O.current&&clearTimeout(O.current);const n=[e.offsetX,e.offsetY],r=null==(t=I.current)?void 0:t.getEchartInstance();if(null!=r&&r.containPixel("grid",n)){var l;if(!k&&"ec-polygon"===(null==(l=e.target)?void 0:l.type))return;const t=r.getModel(),n=((e,t)=>{let n=e,r=null;for(;n;){const e=n.__ecComponentInfo;if(null!=e){r=t.getComponent(e.mainType,e.index);break}n=n.parent}return r})(e.target,t),a=t.getSeriesCount(),o=t.getCurrentSeriesIndices();if(n){const{name:e}=n;a!==o.length?H():H(e)}}}};return(0,d.tZ)(a.Fragment,null,(0,d.tZ)("div",{ref:R},(0,d.tZ)(m,{formData:t,setControlValue:v})),(0,d.tZ)(c.Z,{refs:y,height:n-Z,width:r,echartOptions:i,eventHandlers:M,zrEventHandlers:T,selectedValues:g}))}},63475:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(78580),l=n.n(r),a=n(67294),o=n(51995),s=n(31431),c=n(11965);const u=o.iK.div`
  height: ${e=>{let{height:t}=e;return t}};
  width: ${e=>{let{width:t}=e;return t}};
`;function i(e,t){let{width:n,height:r,echartOptions:o,eventHandlers:i,zrEventHandlers:f,selectedValues:h={},refs:d}=e;const g=(0,a.useRef)(null);d&&(d.divRef=g);const p=(0,a.useRef)(),m=(0,a.useMemo)((()=>Object.keys(h)||[]),[h]),v=(0,a.useRef)([]);(0,a.useImperativeHandle)(t,(()=>({getEchartInstance:()=>p.current}))),(0,a.useEffect)((()=>{g.current&&(p.current||(p.current=(0,s.S1)(g.current)),Object.entries(i||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.off(r),null==(n=p.current)||n.on(r,l)})),Object.entries(f||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.getZr().off(r),null==(n=p.current)||n.getZr().on(r,l)})),p.current.setOption(o,!0))}),[o,i,f]),(0,a.useEffect)((()=>{p.current&&(p.current.dispatchAction({type:"downplay",dataIndex:v.current.filter((e=>!l()(m).call(m,e)))}),m.length&&p.current.dispatchAction({type:"highlight",dataIndex:m}),v.current=m)}),[m]);const C=(0,a.useCallback)((e=>{let{width:t,height:n}=e;p.current&&p.current.resize({width:t,height:n})}),[]);return(0,a.useEffect)((()=>(C({width:n,height:r}),()=>{var e;return null==(e=p.current)?void 0:e.dispose()})),[]),(0,a.useLayoutEffect)((()=>{C({width:n,height:r})}),[n,r,C]),(0,c.tZ)(u,{ref:g,height:r,width:n})}const f=(0,a.forwardRef)(i)}}]);
//# sourceMappingURL=376f25cdf18918b6c8e9.chunk.js.map
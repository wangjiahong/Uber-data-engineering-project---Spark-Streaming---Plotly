{"version":3,"file":"dd8594b7375347be0f5c.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/MixedTimeseries/EchartsMixedTimeseries.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport {\n  AxisType,\n  DataRecordValue,\n  DTTM_ALIAS,\n  BinaryQueryObjectFilterClause,\n} from '@superset-ui/core';\nimport { EchartsMixedTimeseriesChartTransformedProps } from './types';\nimport Echart from '../components/Echart';\nimport { EventHandlers } from '../types';\nimport { currentSeries } from '../utils/series';\n\nexport default function EchartsMixedTimeseries({\n  height,\n  width,\n  echartOptions,\n  setDataMask,\n  labelMap,\n  labelMapB,\n  groupby,\n  groupbyB,\n  selectedValues,\n  formData,\n  emitCrossFilters,\n  seriesBreakdown,\n  onContextMenu,\n  xValueFormatter,\n  xAxis,\n  refs,\n}: EchartsMixedTimeseriesChartTransformedProps) {\n  const isFirstQuery = useCallback(\n    (seriesIndex: number) => seriesIndex < seriesBreakdown,\n    [seriesBreakdown],\n  );\n\n  const handleChange = useCallback(\n    (values: string[], seriesIndex: number) => {\n      if (!emitCrossFilters) {\n        return;\n      }\n\n      const currentGroupBy = isFirstQuery(seriesIndex) ? groupby : groupbyB;\n      const currentLabelMap = isFirstQuery(seriesIndex) ? labelMap : labelMapB;\n      const groupbyValues = values\n        .map(value => currentLabelMap?.[value])\n        .filter(value => !!value);\n\n      setDataMask({\n        extraFormData: {\n          // @ts-ignore\n          filters:\n            values.length === 0\n              ? []\n              : [\n                  ...currentGroupBy.map((col, idx) => {\n                    const val: DataRecordValue[] = groupbyValues.map(\n                      v => v[idx],\n                    );\n                    if (val === null || val === undefined)\n                      return {\n                        col,\n                        op: 'IS NULL',\n                      };\n                    return {\n                      col,\n                      op: 'IN',\n                      val: val as (string | number | boolean)[],\n                    };\n                  }),\n                ],\n        },\n        filterState: {\n          value: !groupbyValues.length ? null : groupbyValues,\n          selectedValues: values.length ? values : null,\n        },\n      });\n    },\n    [groupby, groupbyB, labelMap, labelMapB, setDataMask, selectedValues],\n  );\n\n  const eventHandlers: EventHandlers = {\n    click: props => {\n      const { seriesName, seriesIndex } = props;\n      const values: string[] = Object.values(selectedValues || {});\n      if (values.includes(seriesName)) {\n        handleChange(\n          values.filter(v => v !== seriesName),\n          seriesIndex,\n        );\n      } else {\n        handleChange([seriesName], seriesIndex);\n      }\n    },\n    mouseout: () => {\n      currentSeries.name = '';\n    },\n    mouseover: params => {\n      currentSeries.name = params.seriesName;\n    },\n    contextmenu: eventParams => {\n      if (onContextMenu) {\n        eventParams.event.stop();\n        const { data, seriesIndex } = eventParams;\n        if (data) {\n          const pointerEvent = eventParams.event.event;\n          const values = [\n            ...(eventParams.name ? [eventParams.name] : []),\n            ...(isFirstQuery(seriesIndex) ? labelMap : labelMapB)[\n              eventParams.seriesName\n            ],\n          ];\n          const filters: BinaryQueryObjectFilterClause[] = [];\n          if (xAxis.type === AxisType.time) {\n            filters.push({\n              col:\n                xAxis.label === DTTM_ALIAS\n                  ? formData.granularitySqla\n                  : xAxis.label,\n              grain: formData.timeGrainSqla,\n              op: '==',\n              val: data[0],\n              formattedVal: xValueFormatter(data[0]),\n            });\n          }\n          [\n            ...(xAxis.type === AxisType.category ? [xAxis.label] : []),\n            ...(isFirstQuery(seriesIndex)\n              ? formData.groupby\n              : formData.groupbyB),\n          ].forEach((dimension, i) =>\n            filters.push({\n              col: dimension,\n              op: '==',\n              val: values[i],\n              formattedVal: String(values[i]),\n            }),\n          );\n          onContextMenu(pointerEvent.clientX, pointerEvent.clientY, filters);\n        }\n      }\n    },\n  };\n\n  return (\n    <Echart\n      refs={refs}\n      height={height}\n      width={width}\n      echartOptions={echartOptions}\n      eventHandlers={eventHandlers}\n      selectedValues={selectedValues}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n  useLayoutEffect,\n  useCallback,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n    refs,\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  if (refs) {\n    // eslint-disable-next-line no-param-reassign\n    refs.divRef = divRef;\n  }\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  const handleSizeChange = useCallback(\n    ({ width, height }: { width: number; height: number }) => {\n      if (chartRef.current) {\n        chartRef.current.resize({ width, height });\n      }\n    },\n    [],\n  );\n\n  // did mount\n  useEffect(() => {\n    handleSizeChange({ width, height });\n    return () => chartRef.current?.dispose();\n  }, []);\n\n  useLayoutEffect(() => {\n    handleSizeChange({ width, height });\n  }, [width, height, handleSizeChange]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["EchartsMixedTimeseries","height","width","echartOptions","setDataMask","labelMap","labelMapB","groupby","groupbyB","selectedValues","formData","emitCrossFilters","seriesBreakdown","onContextMenu","xValueFormatter","xAxis","refs","isFirstQuery","useCallback","seriesIndex","handleChange","values","currentGroupBy","currentLabelMap","groupbyValues","map","value","filter","extraFormData","filters","length","col","idx","val","v","op","filterState","eventHandlers","click","props","seriesName","Object","mouseout","currentSeries","mouseover","params","contextmenu","eventParams","event","stop","data","pointerEvent","name","type","AxisType","push","label","DTTM_ALIAS","granularitySqla","grain","timeGrainSqla","formattedVal","forEach","dimension","i","String","clientX","clientY","Styles","styled","Echart","ref","zrEventHandlers","divRef","useRef","chartRef","currentSelection","useMemo","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","init","entries","handler","off","on","getZr","setOption","dispatchAction","dataIndex","handleSizeChange","resize","dispose","useLayoutEffect","forwardRef"],"sourceRoot":""}